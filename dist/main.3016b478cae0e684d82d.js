"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[179],{5320:(e,t,n)=>{var a=n(7294),i=n(745),s=(n(5369),n(7462)),r=n(5861),l=n(5671),o=n(3144),c=n(7326),m=n(136),u=n(6215),d=n(1120),h=n(4942),p=n(7757),f=n.n(p),E=n(6720),_=n(3720),g=n(4386),Z=n(2440),v=n(799),y=n(9334),x=n(2658),w=n(7720),b=n(6867),k=n(9066),I=n(6089),D=n(5725),P=n(326),S=n(9572),C=n(5817),T=n(9941),A=n(7425),N=n(5092),O=n(3508),R=n(4345),M=n(5974),z=n(9711),F=n(6974),L=n(5116),B=n(1174),U=n(5159),W=(n(1715),n(4567)),j=n(9062);var V=n(7563),Y=function(e){(0,m.Z)(s,e);var t,n,i=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,a=(0,d.Z)(t);if(n){var i=(0,d.Z)(this).constructor;e=Reflect.construct(a,arguments,i)}else e=a.apply(this,arguments);return(0,u.Z)(this,e)});function s(e){var t;return(0,l.Z)(this,s),t=i.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:V.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){return setTimeout((function(){t.setState({is_load:!1})}),300),e})).catch((function(e){console.log(e)}))})),t.state={module:"home",module_name:"",is_load:!1,points:[],point:"0",showReady:!1,read:[],onstol:[],ordersQueue:[]},t}return(0,o.Z)(s,[{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:12,style:{height:"100vh"}})))}}]),s}(a.Component);function X(){return a.createElement(Y,null)}n(7943);var H=n(7109),J=n(2642),G=n(4666),q=n(8979),Q=n(7750),K=n(6408),$=n(7645);var ee=n(7563),te=function(e){(0,m.Z)(_,e);var t,n,i,s,p,E=(s=_,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(s);if(p){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function _(e){var t;return(0,l.Z)(this,_),t=E.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:ee.stringify({method:e,module:t.state.module,version:2,login:"+79879340391",data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"auth",module_name:"",is_load:!1,modalDialog:!1,dialogTitle:"",dialogText:""},t}return(0,o.Z)(_,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"updateData",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point,showReady:!0===this.state.showReady?1:0},e.next=3,this.getData("get_orders",t);case 3:n=e.sent,this.setState({read:n.read,onstol:n.onstol,ordersQueue:n.prestol_new});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"auth",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={login:document.getElementById("phone").value,pwd:document.getElementById("password").value},e.next=3,this.getData("auth",t);case 3:n=e.sent,console.log(n),!1===n.st?setTimeout((function(){a.setState({modalDialog:!0,dialogTitle:"Предупреждение",dialogText:n.text})}),500):(localStorage.setItem("token",n.token),setTimeout((function(){window.location.pathname="/"}),300));case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},this.state.dialogTitle),a.createElement(Q.Z,null,a.createElement(K.Z,{id:"alert-dialog-description"},this.state.dialogText)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:function(){e.setState({modalDialog:!1})},color:"primary",autoFocus:!0},"Хорошо"))),a.createElement(D.ZP,{container:!0,spacing:3,direction:"row",justifyContent:"center",alignItems:"center"},a.createElement(D.ZP,{item:!0,xs:12,sm:6,md:6,lg:4,xl:3},a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},a.createElement(H.Z,{style:{borderRadius:0,width:"100%",height:150,margin:0,backgroundColor:"#fff"}},a.createElement("img",{alt:"Жако доставка роллов и пиццы",src:"../assets/img_other/Favikon.png",style:{height:"100%"}})),a.createElement("form",{style:{width:"100%"},noValidate:!0},a.createElement(L.Z,{variant:"outlined",margin:"normal",size:"small",required:!0,fullWidth:!0,id:"phone",label:"Номер телефона",name:"phone",autoComplete:"phone",autoFocus:!0}),a.createElement(L.Z,{variant:"outlined",margin:"normal",size:"small",required:!0,fullWidth:!0,name:"password",label:"Пароль",type:"password",id:"password",autoComplete:"current-password"}),a.createElement(J.Z,{fullWidth:!0,variant:"contained",color:"primary",style:{marginTop:10,marginBottom:10},onClick:this.auth.bind(this)},"Войти"),a.createElement(D.ZP,{container:!0},a.createElement(D.ZP,{item:!0,xs:!0},a.createElement("a",{href:"/registration",style:{color:"#c03"}},"Восстановить пароль"))))))))}}]),_}(a.Component);function ne(){return a.createElement(te,null)}n(4010);var ae=n(4436),ie=n(5272),se=n(5162);var re=n(7563),le=function(e){(0,m.Z)(E,e);var t,n,i,s,p=(i=E,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(i);if(s){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function E(e){var t;return(0,l.Z)(this,E),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:re.stringify({method:e,module:t.state.module,version:2,login:"+79879340391",data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"auth",module_name:"",is_load:!1,modalDialog:!1,dialogTitle:"",dialogText:"",activeStep:0,steps:["Телефон","Подтверждение","Новый пароль"],phone:"",code:"",pwd:""},t}return(0,o.Z)(E,[{key:"updateData",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point,showReady:!0===this.state.showReady?1:0},e.next=3,this.getData("get_orders",t);case 3:n=e.sent,this.setState({read:n.read,onstol:n.onstol,ordersQueue:n.prestol_new});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"nextStep",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r,l=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=this.state.activeStep){e.next=8;break}return t={login:document.getElementById("phone").value},e.next=4,this.getData("check_phone",t);case 4:!1===(n=e.sent).st?setTimeout((function(){l.setState({modalDialog:!0,dialogTitle:"Предупреждение",dialogText:n.text})}),500):this.setState({activeStep:this.state.activeStep+1,phone:t.login}),e.next=22;break;case 8:if(1!=this.state.activeStep){e.next=16;break}return a={login:this.state.phone,code:document.getElementById("code").value},e.next=12,this.getData("check_code",a);case 12:!1===(i=e.sent).st?setTimeout((function(){l.setState({modalDialog:!0,dialogTitle:"Предупреждение",dialogText:i.text})}),500):this.setState({activeStep:this.state.activeStep+1,code:a.code}),e.next=22;break;case 16:if(2!=this.state.activeStep){e.next=22;break}return s={login:this.state.phone,code:this.state.code,pwd:document.getElementById("password").value},e.next=20,this.getData("save_new_pwd",s);case 20:!1===(r=e.sent).st?setTimeout((function(){l.setState({modalDialog:!0,dialogTitle:"Предупреждение",dialogText:r.text})}),500):(localStorage.setItem("token",r.token),setTimeout((function(){window.location.pathname="/"}),300));case 22:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"enterNextStep",value:function(e){13==e.charCode&&this.nextStep()}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},this.state.dialogTitle),a.createElement(Q.Z,null,a.createElement(K.Z,{id:"alert-dialog-description"},this.state.dialogText)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:function(){e.setState({modalDialog:!1})},color:"primary",autoFocus:!0},"Хорошо"))),a.createElement(D.ZP,{container:!0,spacing:3,direction:"row",justifyContent:"center",alignItems:"center"},a.createElement(D.ZP,{item:!0,xs:12,sm:6,md:6,lg:4,xl:3},a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},a.createElement(H.Z,{style:{borderRadius:0,width:"100%",height:150,margin:0,backgroundColor:"#fff",marginBottom:20}},a.createElement("img",{alt:"Жако доставка роллов и пиццы",src:"../assets/img_other/Favikon.png",style:{height:"100%"}})),a.createElement(ae.Z,{activeStep:this.state.activeStep,alternativeLabel:!0,style:{width:"100%"}},this.state.steps.map((function(e){return a.createElement(ie.Z,{key:e},a.createElement(se.Z,null,e))}))),a.createElement("div",{style:{width:"100%"}},0==this.state.activeStep?a.createElement(L.Z,{variant:"outlined",margin:"normal",size:"small",required:!0,fullWidth:!0,id:"phone",label:"Номер телефона",name:"phone",autoComplete:"phone",autoFocus:!0,onKeyPress:this.enterNextStep.bind(this)}):null,1==this.state.activeStep?a.createElement(L.Z,{variant:"outlined",margin:"normal",size:"small",required:!0,fullWidth:!0,id:"code",label:"Код из смс",name:"code",autoComplete:"code",autoFocus:!0,onKeyPress:this.enterNextStep.bind(this)}):null,2==this.state.activeStep?a.createElement(L.Z,{variant:"outlined",margin:"normal",size:"small",required:!0,fullWidth:!0,name:"password",label:"Пароль",type:"password",id:"password",autoComplete:"current-password",onKeyPress:this.enterNextStep.bind(this)}):null,a.createElement(J.Z,{fullWidth:!0,variant:"contained",color:"primary",style:{marginTop:10,marginBottom:10},onClick:this.nextStep.bind(this)},"Дальше"),a.createElement(D.ZP,{container:!0},a.createElement(D.ZP,{item:!0,xs:!0},a.createElement("a",{href:"/auth",style:{color:"#c03"}},"Вернуться к авторизации"))))))))}}]),E}(a.Component);function oe(){return a.createElement(le,null)}n(7993);var ce=n(9573),me=n(8732),ue=n(6926),de=n(7896),he=n(6011),pe=n(3694),fe=n(6501),Ee=n(7666),_e=n(5305),ge=n(6446),Ze=n(6036),ve=n(3709),ye=n(542),xe=n(4212),we=n(6447),be=n(8523),ke=n(6872),Ie=n(2856),De=n(9349),Pe=n(826);function Se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,d.Z)(e);if(t){var i=(0,d.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}var Ce=function(e){(0,m.Z)(n,e);var t=Se(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={},a}return(0,o.Z)(n,[{key:"render",value:function(){return a.createElement(Ie._,{dateAdapter:ke.Z,locale:be.Z,size:"small"},a.createElement(Pe.D,{allowSameDateSelection:!0,showTodayButton:!0,startText:this.props.startText,endText:this.props.endText,value:this.props.value,inputFormat:"yyyy-MM-dd",mask:"____-__-__",onChange:this.props.func,renderInput:function(e,t){return a.createElement(a.Fragment,null,a.createElement(L.Z,(0,s.Z)({style:{width:"100%"}},e)),a.createElement(L.Z,(0,s.Z)({style:{width:"100%"}},t)))}}))}}]),n}(a.PureComponent),Te=function(e){(0,m.Z)(n,e);var t=Se(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={},a}return(0,o.Z)(n,[{key:"render",value:function(){var e,t=this;return a.createElement(we.Z,{spacing:3},a.createElement(B.Z,{size:"small",disableCloseOnSelect:!0,id:null!==(e=this.props.id)&&void 0!==e?e:null,options:this.props.data,getOptionLabel:function(e){return e.name},value:this.props.value,onChange:this.props.func,filterSelectedOptions:!0,multiple:!(!this.props.multiple||!0!==this.props.multiple),isOptionEqualToValue:function(e,t){return parseInt(e.id)===parseInt(t.id)},renderInput:function(e){return a.createElement(L.Z,(0,s.Z)({},e,{label:t.props.label,placeholder:t.props.placeholder}))}}))}}]),n}(a.PureComponent),Ae=function(e){(0,m.Z)(n,e);var t=Se(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={},a}return(0,o.Z)(n,[{key:"render",value:function(){return a.createElement(ge.Z,{fullWidth:!0,variant:"outlined",size:"small"},a.createElement(Ee.Z,null,this.props.label),a.createElement(Ze.Z,{value:this.props.value,label:this.props.label,disabled:!(!this.props.disabled&&!0!==this.props.disabled),onChange:this.props.func,multiple:!(!this.props.multiple||!0!==this.props.multiple)},a.createElement(_e.Z,{value:""},a.createElement("em",null,"None")),this.props.data.map((function(e,t){return a.createElement(_e.Z,{key:t,value:e.id},e.name)}))))}}]),n}(a.PureComponent),Ne=function(e){(0,m.Z)(n,e);var t=Se(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={type:"text"},a}return(0,o.Z)(n,[{key:"render",value:function(){return a.createElement(L.Z,{label:this.props.label,value:this.props.value,onChange:this.props.func,onBlur:this.props.onBlur?this.props.onBlur:null,disabled:!(!this.props.disabled&&!0!==this.props.disabled),variant:"outlined",size:"small",color:"primary",multiline:!!this.props.multiline&&this.props.multiline,maxRows:this.props.maxRows?this.props.maxRows:1,type:this.props.type?this.props.type:this.state.type,style:{width:"100%"}})}}]),n}(a.PureComponent),Oe=function(e){(0,m.Z)(n,e);var t=Se(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={thisVal:""},a}return(0,o.Z)(n,[{key:"onChange",value:function(e){this.setState({thisVal:e.target.value})}},{key:"onBlur",value:function(){this.setState({thisVal:""}),this.props.onBlur()}},{key:"render",value:function(){return a.createElement(L.Z,{variant:"outlined",size:"small",color:"primary",label:this.props.label,type:"time",id:this.props.id?this.props.id:null,value:this.props.func?this.props.value:this.state.thisVal,style:{width:"100%"},onChange:this.props.func?this.props.func:this.onChange.bind(this),onBlur:this.props.onBlur?this.onBlur.bind(this):null,InputLabelProps:{shrink:!0},step:600,inputProps:{step:600}})}}]),n}(a.PureComponent),Re=(a.PureComponent,function(e){(0,m.Z)(n,e);var t=Se(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={},a}return(0,o.Z)(n,[{key:"render",value:function(){return a.createElement(Ie._,{dateAdapter:ke.Z,locale:be.Z},a.createElement(De.M,{multiple:!0,mask:"____-__-__",inputFormat:"yyyy-MM-dd",label:this.props.label,value:(e=this.props.value,t=new Date(e),n=""+(t.getMonth()+1),i=""+t.getDate(),r=t.getFullYear(),n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),[r,n,i].join("-")),onChange:this.props.func,renderInput:function(e){return a.createElement(L.Z,(0,s.Z)({variant:"outlined",size:"small",color:"primary",style:{width:"100%"}},e))}}));var e,t,n,i,r}}]),n}(a.PureComponent)),Me=function(e){(0,m.Z)(n,e);var t=Se(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={},a}return(0,o.Z)(n,[{key:"render",value:function(){return a.createElement(ve.Z,{row:!0,style:this.props.style?this.props.style:{}},a.createElement(ye.Z,{control:a.createElement(xe.Z,{checked:this.props.value,onChange:this.props.func,color:"primary"}),label:this.props.label}))}}]),n}(a.PureComponent),ze=function(e){(0,m.Z)(n,e);var t=Se(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={},a}return(0,o.Z)(n,[{key:"render",value:function(){return a.createElement("tinymce-editor",{apiKey:"r0ihgs4ukfpmudzw7aexxgb88tnx5jw26h1xx9x6409ji3gx",id:this.props.id,menubar:!0,plugins:"advlist autolink lists link image charmap print preview anchor searchreplace visualblocks code fullscreen insertdatetime media table paste code help wordcount",toolbar:"undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"},this.props.text)}}]),n}(a.PureComponent);var Fe=n(7563),Le=function(e){(0,m.Z)(E,e);var t,n,i,s,p=(i=E,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(i);if(s){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function E(e){var t;return(0,l.Z)(this,E),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Fe.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/auth"})).catch((function(e){console.log(e)}))})),t.state={module:"live_orders",module_name:"",is_load:!1,points:[],point:"0",showReady:!1,read:[],onstol:[],ordersQueue:[]},t}return(0,o.Z)(E,[{key:"componentDidMount",value:(n=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({points:t.point_list,point:t.point_list[0].id,module_name:t.module_info.name}),document.title=t.module_info.name,setTimeout((function(){n.updateData()}),100);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"changePoint",value:function(e){var t=this,n=e.target.value;this.setState({point:n}),setTimeout((function(){t.updateData()}),50)}},{key:"changeCheckOrders",value:function(e){var t=e.target.checked;this.setState({showReady:t})}},{key:"updateData",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point,showReady:!0===this.state.showReady?1:0},e.next=3,this.getData("get_orders",t);case 3:n=e.sent,this.setState({read:n.read,onstol:n.onstol,ordersQueue:n.prestol_new});case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(W.Z,{open:this.state.is_load,style:{zIndex:99}},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:6,sm:6},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:6,sm:6},a.createElement(J.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Me,{value:this.state.showReady,func:this.changeCheckOrders.bind(this),label:"Показывать готовые"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,{"aria-label":"a dense table"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"#"),a.createElement(ue.Z,null,"Тип"),a.createElement(ue.Z,null,"Время заказа"),a.createElement(ue.Z,null,"Время предзакза"),a.createElement(ue.Z,null,"Время выхода на стол"),a.createElement(ue.Z,null,"Во сколько собрали"),a.createElement(ue.Z,null,"Закрыли"),a.createElement(ue.Z,null,"Приготовили"),a.createElement(ue.Z,null,"Отдали"),a.createElement(ue.Z,null,"Обещали"),a.createElement(ue.Z,null,"Статус"),a.createElement(ue.Z,null,"Стол"))),a.createElement(me.Z,null,this.state.read.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.id),a.createElement(ue.Z,null,e.type_order),a.createElement(ue.Z,null,1==parseInt(e.preorder)?"":e.date_time_order),a.createElement(ue.Z,null,1==parseInt(e.preorder)?e.date_time_preorder_:""),a.createElement(ue.Z,null,e.unix_start_stol_or),a.createElement(ue.Z,null,e.give_data_time_),a.createElement(ue.Z,null,e.close_date_time_order),a.createElement(ue.Z,{style:{backgroundColor:1==parseInt(e.type_)?"":e.color}},e.time_),a.createElement(ue.Z,{style:{backgroundColor:1!=parseInt(e.type_)?"":e.color}},e.test_time),a.createElement(ue.Z,null,0==parseInt(e.preorder)?e.unix_time_to_client:""),a.createElement(ue.Z,null,e.status),a.createElement(ue.Z,null,e.stol_sborki))})),this.state.onstol.map((function(e,t){return a.createElement(pe.Z,{key:t,style:{backgroundColor:"yellow"}},a.createElement(ue.Z,null,e.id),a.createElement(ue.Z,null,e.type_order),a.createElement(ue.Z,null,1==parseInt(e.preorder)?"":e.date_time_order),a.createElement(ue.Z,null,1==parseInt(e.preorder)?e.date_time_preorder_:""),a.createElement(ue.Z,null,e.unix_start_stol_or),a.createElement(ue.Z,null),a.createElement(ue.Z,null),a.createElement(ue.Z,null),a.createElement(ue.Z,null),a.createElement(ue.Z,null,0==parseInt(e.preorder)?e.unix_time_to_client:""),a.createElement(ue.Z,null,e.status),a.createElement(ue.Z,null,e.stol_sborki))}))))),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,{"aria-label":"a dense table"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"#"),a.createElement(ue.Z,null,"Пред"),a.createElement(ue.Z,null,"Время оформления"),a.createElement(ue.Z,null,"Время выхода на стол"),a.createElement(ue.Z,null,"Время закрытия"),a.createElement(ue.Z,null,"Обещали"))),a.createElement(me.Z,null,this.state.ordersQueue.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.id),a.createElement(ue.Z,null,1==parseInt(e.is_preorder)?e.date_time_preorder:""),a.createElement(ue.Z,null,0==parseInt(e.is_preorder)?e.date_time_order:""),a.createElement(ue.Z,null,e.time_start_order),a.createElement(ue.Z,null,e.time_end_order),a.createElement(ue.Z,null,0==parseInt(e.is_preorder)?e.unix_time_to_client:""))}))))))))}}]),E}(a.Component);function Be(){return a.createElement(Le,null)}n(3758);var Ue=n(594);var We=n(7563),je=function(e){(0,m.Z)(w,e);var t,n,i,s,p,E,_,g=(E=w,_=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(E);if(_){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function w(e){var t;return(0,l.Z)(this,w),t=g.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:We.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"events",module_name:"",is_load:!1,points:[],point:"0",mounth:"0",mounths:[],years:[],year:"0",calendar:[],modalDialog:!1,chooseDayHoly:"",events:[],chooseEvent:0,eventPoint1:0,everyYear1:!1,timeStart2:"10:00",timeEnd2:"21:30",expanded:"",dayEvents:[],events_hist:[]},t}return(0,o.Z)(w,[{key:"componentDidMount",value:(p=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,console.log(t),this.setState({points:t.points,point:t.points[0].id,module_name:t.module_info.name,mounths:t.mounth,mounth:t.this_m,years:t.years,year:t.this_y}),document.title=t.module_info.name,setTimeout((function(){n.updateData()}),50);case 7:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"changePoint",value:function(e){var t=this,n=e.target.value;this.setState({point:n}),setTimeout((function(){t.updateData()}),50)}},{key:"changeMounth",value:function(e){var t=e.target.value;this.setState({mounth:t}),setTimeout((function(){}),50)}},{key:"changeYear",value:function(e){var t=e.target.value;this.setState({year:t})}},{key:"changeCheckOrders",value:function(e){var t=e.target.checked;this.setState({showReady:t})}},{key:"updateData",value:(s=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={m:this.state.mounth,y:this.state.year,point_id:this.state.point},e.next=3,this.getData("get_calendar",t);case 3:n=e.sent,console.log(n),this.setState({calendar:n.year});case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"chooseDay",value:(i=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.full_day){e.next=8;break}return this.setState({chooseDay:null,eventPoint1:this.state.point,chooseEvent:0,everyYear1:!1,timeStart2:"10:00",timeEnd2:"21:30",modalDialog:!1,events_hist:[]}),n={date:t.full_day,point_id:this.state.point},e.next=5,this.getData("get_calendar_day",n);case 5:a=e.sent,console.log("res",a),this.setState({chooseDay:t,chooseDayHoly:a.holy,events:a.events,events_hist:a.hist,dayEvents:a.this_events,modalDialog:!0});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"changeEvent",value:function(e){var t=e.target.value;this.setState({chooseEvent:t})}},{key:"changePoint1",value:function(e){var t=e.target.value;this.setState({eventPoint1:t})}},{key:"changeEveryYear1",value:function(e){var t=e.target.checked;this.setState({everyYear1:t})}},{key:"changeTimeStart2",value:function(e){var t=e.target.value;this.setState({timeStart2:t})}},{key:"changeTimeEnd2",value:function(e){var t=e.target.value;this.setState({timeEnd2:t})}},{key:"save",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={date:this.state.chooseDay.full_day,point_id:this.state.eventPoint1,event:this.state.chooseEvent,every_year:!0===this.state.everyYear1?1:0,time_start:this.state.timeStart2,time_end:this.state.timeEnd2},e.next=3,this.getData("save_event",t);case 3:n=e.sent,console.log(n),!1===n.st?alert(n.text):(this.setState({chooseDay:null,eventPoint1:this.state.point,chooseEvent:0,everyYear1:!1,timeStart2:"10:00",timeEnd2:"21:30",modalDialog:!1}),setTimeout((function(){a.updateData()}),300));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleChange",value:function(e){this.setState({expanded:e})}},{key:"delEvent",value:(t=(0,r.Z)(f().mark((function e(t){var n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("delEvent",t),!confirm('Удалить событие "'+t.title+" "+t.date+'" ?')){e.next=10;break}return n={del_id:t.id},e.next=5,this.getData("del_event",n);case 5:e.sent,this.setState({chooseDay:null,eventPoint1:this.state.point,chooseEvent:0,everyYear1:!1,timeStart2:"10:00",timeEnd2:"21:30",modalDialog:!1}),setTimeout((function(){a.updateData()}),300),e.next=10;break;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},this.state.chooseDay?this.state.chooseDay.full_day:""),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(K.Z,{id:"alert-dialog-description"},a.createElement(D.ZP,{container:!0,spacing:3},0==this.state.chooseDayHoly.length?null:a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(x.Z,{component:"span"},this.state.chooseDayHoly)),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ae,{data:this.state.events,value:this.state.chooseEvent,func:this.changeEvent.bind(this),label:"Событие"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ae,{data:this.state.points,value:this.state.eventPoint1,func:this.changePoint1.bind(this),label:"Точка"})),2!==parseInt(this.state.chooseEvent)?null:a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:6,sm:6},a.createElement(Oe,{value:this.state.timeStart2,func:this.changeTimeStart2.bind(this),label:"Время начала работы"})),a.createElement(D.ZP,{item:!0,xs:6,sm:6},a.createElement(Oe,{value:this.state.timeEnd2,func:this.changeTimeEnd2.bind(this),label:"Время окончания работы"}))),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Me,{value:this.state.everyYear1,func:this.changeEveryYear1.bind(this),label:"Каждый год"}))),a.createElement(Z.Z,{component:"nav"},this.state.dayEvents.map((function(t,n){return a.createElement(v.ZP,{key:n},a.createElement(y.Z,{primary:t.title}),4==parseInt(t.type)?null:a.createElement(Ue.Z,{color:"primary",onClick:e.delEvent.bind(e,t),style:{cursor:"pointer"}}))}))),a.createElement(T.Z,null,a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null),"aria-controls":"panel1a-content",id:"panel1a-header"},a.createElement(x.Z,null,"История")),a.createElement(N.Z,null,a.createElement(Z.Z,{component:"nav"},this.state.events_hist.map((function(e,t){return a.createElement(v.ZP,{key:t},a.createElement(y.Z,{primary:e.title}))}))))))),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.save.bind(this),color:"primary"},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.mounths,value:this.state.mounth,func:this.changeMounth.bind(this),label:"Месяц"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.years,value:this.state.year,func:this.changeYear.bind(this),label:"Год"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20}},this.state.calendar.map((function(t,n){return a.createElement(D.ZP,{item:!0,xs:12,sm:4,key:n,style:{padding:20}},a.createElement("h1",{style:{textAlign:"center"}},t[0][0].mounth),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,{"aria-label":"a dense table",style:{overflow:"hidden"}},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center",padding:15}},"Пн"),a.createElement(ue.Z,{style:{textAlign:"center",padding:15}},"Вт"),a.createElement(ue.Z,{style:{textAlign:"center",padding:15}},"Ср"),a.createElement(ue.Z,{style:{textAlign:"center",padding:15}},"Чт"),a.createElement(ue.Z,{style:{textAlign:"center",padding:15}},"Пт"),a.createElement(ue.Z,{style:{textAlign:"center",padding:15}},"Сб"),a.createElement(ue.Z,{style:{textAlign:"center",padding:15}},"Вс"))),a.createElement(me.Z,null,t.map((function(t,n){return a.createElement(pe.Z,{key:n},t.map((function(t,n){return a.createElement(ue.Z,{key:n,onClick:e.chooseDay.bind(e,t),style:{color:t.dir?"yellow":t.holy?"#c03":"#000"},className:t.event?"customCel":"tableCel"}," ",t.day," ")})))}))))))})))))}}]),w}(a.Component);function Ve(){return a.createElement(je,null)}n(7122);var Ye=n(7563);function Xe(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}var He=function(e){(0,m.Z)(_,e);var t,n,i,s,p,E=(s=_,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(s);if(p){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function _(e){var t;return(0,l.Z)(this,_),t=E.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Ye.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"ras_by_bill",module_name:"",is_load:!1,modalDialog:!1,points:[],point:[],date_start:Xe(new Date),date_end:Xe(new Date),rangeDate:[Xe(new Date),Xe(new Date)],items:[],cats:[],items_cat:[],item_cat:0,myItems:[],calendar:[]},t}return(0,o.Z)(_,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,points:t.points,items:t.items,cats:t.cats,items_cat:t.items_cat}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"changePoint",value:function(e){var t=e.target.value;this.setState({point:t})}},{key:"changeItems",value:function(e,t){this.setState({myItems:t})}},{key:"getItems",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={points:this.state.point,items:this.state.myItems,item_cat:this.state.item_cat,start_date:this.state.date_start,end_date:this.state.date_end},e.next=3,this.getData("get_this_rev",t);case 3:n=e.sent,a=0,n.items_ras.map((function(e,t){a+=parseFloat(e.sum)})),this.setState({resItems:{items_ras:n.items_ras,pf_ras:n.pf_ras,rec_ras:n.rec_ras,full_sum:a.toFixed(2)},catItems:null});case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getCats",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={points:this.state.point,items:this.state.myItems,start_date:this.state.date_start,end_date:this.state.date_end},e.next=3,this.getData("get_this_rev_cat",t);case 3:n=e.sent,a=0,n.rec_ras.map((function(e,t){a+=parseFloat(e.this_price)})),this.setState({catItems:{count_pos:n.count_pos,items_ras:n.items_ras,rec_ras:n.rec_ras,full_sum:a.toFixed(2)},resItems:null});case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeDateRange",value:function(e,t){this.setState((0,h.Z)({},e,Xe(t)))}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"  "),a.createElement(Q.Z,null,a.createElement(K.Z,{id:"alert-dialog-description"})),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:function(){},color:"primary"},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.points,multiple:!0,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата до",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.items_cat,multiple:!1,value:this.state.item_cat,func:function(t){e.setState({item_cat:t.target.value})},label:"Категория товара"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Te,{data:this.state.items,multiple:!0,value:this.state.myItems,func:this.changeItems.bind(this),label:"Заготовки"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.getItems.bind(this)},"Показать заготовки")),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.getCats.bind(this)},"Показать категории")),this.state.resItems&&this.state.resItems.items_ras?a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h1",null,"Куплено по наклданым"),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,{"aria-label":"a dense table"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Наименование товара"),a.createElement(ue.Z,null,"Объем товра"),a.createElement(ue.Z,null,"Объем заготовки"),a.createElement(ue.Z,null,"Сумма"),a.createElement(ue.Z,null,"Кол-во наклданых"))),a.createElement(me.Z,null,this.state.resItems.items_ras.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null," ",e.name," "),a.createElement(ue.Z,null," ",e.count_item+" "+e.ei_name," "),a.createElement(ue.Z,null," ",e.count_pf+" "+e.ei_name_pf," "),a.createElement(ue.Z,null," ",e.sum," "),a.createElement(ue.Z,null," ",e.count_bill," "))})),a.createElement(pe.Z,null,a.createElement(ue.Z,null," Всего: "),a.createElement(ue.Z,null," "),a.createElement(ue.Z,null," "),a.createElement(ue.Z,null," ",this.state.resItems.full_sum," "),a.createElement(ue.Z,null," ")))))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h1",null,"Расход заготовок (включая рецепты)"),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,{"aria-label":"a dense table"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Наименование заготовки"),a.createElement(ue.Z,null,"Объем заготовок"),a.createElement(ue.Z,null,"Кол-во роллов"),a.createElement(ue.Z,null,"Сумма роллов (примерно)"))),a.createElement(me.Z,null,this.state.resItems.pf_ras.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null," ",e.pf_name," "),a.createElement(ue.Z,null," ",e.count_pf+" "+e.ei_name," "),a.createElement(ue.Z,null," ",e.count_rolls," "),a.createElement(ue.Z,null," ",e.price_rolls," "))})))))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h1",null,"Расход рецептов"),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,{"aria-label":"a dense table"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Наименование заготовки"),a.createElement(ue.Z,null,"Объем заготовок"),a.createElement(ue.Z,null,"Кол-во роллов"))),a.createElement(me.Z,null,this.state.resItems.rec_ras.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null," ",e.pf_name," "),a.createElement(ue.Z,null," ",e.count_pf+" "+e.ei_name," "),a.createElement(ue.Z,null," ",e.count_rolls," "))}))))))):null,this.state.catItems&&this.state.catItems.rec_ras?a.createElement(D.ZP,{item:!0,xs:12},a.createElement(T.Z,{disabled:!0},a.createElement(A.Z,null,a.createElement(x.Z,{style:{width:"50%"}},"Роллов: ",this.state.catItems.count_pos.count_rolls),a.createElement(x.Z,{style:{width:"50%"}},"Пиццы: ",this.state.catItems.count_pos.count_pizza))),this.state.catItems.rec_ras.map((function(e,t){return a.createElement(T.Z,{key:t},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null),"aria-controls":"panel1bh-content"},a.createElement(x.Z,{style:{width:"60%"}},e.name),a.createElement(x.Z,{style:{width:"20%"}},e.this_price),a.createElement(x.Z,{style:{width:"20%"}},e.price_by_items)),a.createElement(N.Z,null,e.parent_cat.map((function(e,t){return a.createElement(T.Z,{key:t},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null),"aria-controls":"panel1bh-content"},a.createElement(x.Z,{style:{width:"60%",paddingLeft:20}},e.name),a.createElement(x.Z,{style:{width:"20%",paddingLeft:20}},e.this_price),a.createElement(x.Z,{style:{width:"20%",paddingLeft:20}},e.price_by_items)),a.createElement(N.Z,null,a.createElement(T.Z,{disabled:!0},a.createElement(A.Z,null,a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},"Товар"),a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},"Товара"),a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},"Заготовок"),a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},"Накладных"),a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},"Сумма"))),e.items.map((function(e,t){return a.createElement(T.Z,{key:t,disabled:!0},a.createElement(A.Z,null,a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},e.name),a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},e.count_item," ",e.ei_name),a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},e.count_pf," ",e.ei_name),a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},e.count_bill),a.createElement(x.Z,{style:{width:"20%",paddingLeft:40}},e.sum)))}))))}))))})),a.createElement(T.Z,{disabled:!0},a.createElement(A.Z,null,a.createElement(x.Z,{style:{width:"60%",marginRight:-15}},"Всего:"),a.createElement(x.Z,{style:{width:"40%"}},this.state.catItems.full_sum)))):null))}}]),_}(a.Component);function Je(){return a.createElement(He,null)}n(134);var Ge=n(7563),qe=function(e){(0,m.Z)(g,e);var t,n,i,s,p,E,_=(p=g,E=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(p);if(E){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function g(e){var t;return(0,l.Z)(this,g),t=_.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Ge.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"category_items",module_name:"",is_load:!1,modalDialog:!1,modalDialog2:!1,modalDialog3:!1,newMainCatMy:0,editMainCatMy:0,newMainNameMy:"",editMainNameMy:"",editCat:null,allCats:[],allItems:[],thisValItems:[],thisDataItems:[],thisCatId:0},t}return(0,o.Z)(g,[{key:"componentDidMount",value:(s=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,allCats:t.cats,allItems:t.items}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"createCat",value:function(){this.setState({modalDialog:!0,newMainCatMy:0,newMainNameMy:""})}},{key:"changeCatMain",value:function(e){var t=e.target.value;this.setState({newMainCatMy:t})}},{key:"changeCatMainEdit",value:function(e){var t=e.target.value;this.setState({editMainCatMy:t})}},{key:"changeNameMain",value:function(e){var t=e.target.value;this.setState({newMainNameMy:t})}},{key:"changeNameMainEdit",value:function(e){var t=e.target.value;this.setState({editMainNameMy:t})}},{key:"saveCat",value:(i=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={name:this.state.newMainNameMy,cat_id:this.state.newMainCatMy},e.next=3,this.getData("save_cat",t);case 3:if(!1!==(n=e.sent).st){e.next=7;break}return alert(n.text),e.abrupt("return");case 7:this.setState({allCats:n.cats,modalDialog:!1});case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"addItems",value:function(e){var t=this.state.allItems.filter((function(t){return parseInt(t.cat_id)==parseInt(e)})),n=this.state.allItems.filter((function(e){return 0==parseInt(e.cat_id)}));this.setState({modalDialog2:!0,thisValItems:t,thisDataItems:n,thisCatId:e})}},{key:"saveItems",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={cat_id:this.state.thisCatId,items:this.state.thisValItems},e.next=3,this.getData("save_items_cat",t);case 3:n=e.sent,this.setState({allCats:n.cats,allItems:n.items,modalDialog2:!1,thisValItems:[],thisDataItems:[],thisCatId:0});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"editCat",value:function(e){this.setState({modalDialog3:!0,editMainCatMy:e.parent_id,editMainNameMy:e.name,editCat:e})}},{key:"saveEditCat",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={name:this.state.editMainNameMy,cat_id:this.state.editMainCatMy,id:this.state.editCat.id},e.next=3,this.getData("edit_cat",t);case 3:if(!1!==(n=e.sent).st){e.next=7;break}return alert(n.text),e.abrupt("return");case 7:this.setState({allCats:n.cats,modalDialog:!1});case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"Новая категория"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ae,{label:"Главная категория",data:this.state.allCats.filter((function(e){return-1==parseInt(e.parent_id)||!e.parent_id})),value:this.state.newMainCatMy,func:this.changeCatMain.bind(this)})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(L.Z,{label:"Название категории",size:"small",variant:"outlined",style:{width:"100%"},color:"primary",value:this.state.newMainNameMy,onChange:this.changeNameMain.bind(this)})))),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.saveCat.bind(this),color:"primary"},"Сохранить"))),a.createElement(G.Z,{open:this.state.modalDialog2,onClose:function(){e.setState({modalDialog2:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,null,"Позиции категории"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Te,{label:"Выбранные позиции",multiple:!0,func:function(t,n){e.setState({thisValItems:n})},data:this.state.thisDataItems,value:this.state.thisValItems})))),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.saveItems.bind(this),color:"primary"},"Сохранить"))),a.createElement(G.Z,{open:this.state.modalDialog3,onClose:function(){e.setState({modalDialog3:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"Редактирование категории"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ae,{label:"Главная категория",data:this.state.allCats.filter((function(e){return-1==parseInt(e.parent_id)||!e.parent_id})),value:this.state.editMainCatMy,func:this.changeCatMainEdit.bind(this)})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(L.Z,{label:"Название категории",size:"small",variant:"outlined",style:{width:"100%"},color:"primary",value:this.state.editMainNameMy,onChange:this.changeNameMainEdit.bind(this)})))),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.saveEditCat.bind(this),color:"primary"},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(J.Z,{onClick:this.createCat.bind(this)},"Создать категорию")),a.createElement(D.ZP,{item:!0,xs:12,sm:12},this.state.allCats.map((function(t,n){return-1!=parseInt(t.parent_id)?null:a.createElement(T.Z,{key:n},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null),"aria-controls":"panel1a-content"},a.createElement(P.Z,{style:{marginRight:10},onClick:e.editCat.bind(e,t)}),a.createElement(x.Z,null,t.name)),a.createElement(N.Z,null,e.state.allCats.map((function(i,s){return parseInt(t.id)!=parseInt(i.parent_id)?null:a.createElement(T.Z,{key:n+"_"+s},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null),"aria-controls":"panel1a-content"},a.createElement(P.Z,{style:{marginRight:10},onClick:e.editCat.bind(e,i)}),a.createElement(x.Z,null,i.name)),a.createElement(N.Z,null,e.state.allItems.filter((function(e){return parseInt(e.cat_id)==parseInt(i.id)})).map((function(e,t){return a.createElement(T.Z,{key:n+"_"+s+"_"+t},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null),"aria-controls":"panel1a-content"},a.createElement(x.Z,null,e.name)))})),a.createElement(J.Z,{onClick:e.addItems.bind(e,parseInt(i.id))},"Добавить")))}))))})))))}}]),g}(a.Component);function Qe(){return a.createElement(qe,null)}n(5537);var Ke=n(2961),$e=n(2450),et=n(4637),tt=n(6540);var nt=n(7563),at=function(e){(0,m.Z)(w,e);var t,n,i,s,p,E,_,g,Z,v,y=(Z=w,v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(Z);if(v){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function w(e){var t;return(0,l.Z)(this,w),t=y.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:nt.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){setTimeout((function(){t.setState({is_load:!1})}),300),console.log(e)}))})),t.state={module:"vendor_module",module_name:"",is_load:!1,modalItems:!1,modalVendor:!1,modalVendorNew:!1,vendors:[],allItems:[],vendor_items:[],openVendor:null,customAdd:0,vendorCities:[],allCities:[],nds:[{id:-1,name:"Без НДС"},{id:10,name:"10% НДС"},{id:20,name:"20% НДС"}],nds_:[-1,10,20],cities:[],city:-1},t}return(0,o.Z)(w,[{key:"componentDidMount",value:(g=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,vendors:t.vendors,cities:t.cities}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"changeNDS",value:function(e,t){this.state.vendor_items.map((function(n,a){parseInt(n.item_id)==parseInt(e)&&(n.nds=t.target.value)})),this.setState({vendor_items:this.state.vendor_items})}},{key:"openModalItems",value:(_=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={vendor_id:t.id},e.next=3,this.getData("get_vendor_items",n);case 3:a=e.sent,this.setState({modalItems:!0,allItems:a.all_items,vendor_items:a.vendor_items,openVendor:t});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"openModalVendor",value:(E=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={vendor_id:t.id},e.next=3,this.getData("get_vendor_info",n);case 3:a=e.sent,this.setState({modalVendor:!0,openVendor:a.vendor,vendorCities:a.vendor_cities,allCities:a.all_cities});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"openModalVendorNew",value:(p=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={vendor_id:0},e.next=3,this.getData("get_vendor_info",t);case 3:n=e.sent,this.setState({modalVendorNew:!0,openVendor:{addr:"",bill_ex:"0",email:"",email_2:"",inn:"",min_price:"",name:"",need_img_bill_ex:"0",ogrn:"",phone:"",text:""},vendorCities:[],allCities:n.all_cities});case 5:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"saveVendorItems",value:(s=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t={vendor_id:this.state.openVendor.id,items:this.state.vendor_items}).items.filter((function(e,t){return!n.state.nds_.includes(parseInt(e.nds))})).length>0)){e.next=5;break}return alert("У одной или нескольких позиций не заполнен НДС"),e.abrupt("return");case 5:return e.next=7,this.getData("save_vendor_items",t);case 7:e.sent,this.setState({modalItems:!1,vendor_items:[],openVendor:null});case 9:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"saveVendor",value:(i=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={vendor:this.state.openVendor,vendor_cities:this.state.vendorCities,city:this.state.city},e.next=3,this.getData("update_vendor",t);case 3:n=e.sent,this.setState({modalVendor:!1,openVendor:null,vendorCities:[],allCities:[],vendors:n.vendors});case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"addVendor",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={vendor:this.state.openVendor,vendor_cities:this.state.vendorCities,city:this.state.city},e.next=3,this.getData("new_vendor",t);case 3:if(!1!==(n=e.sent).st){e.next=7;break}return alert(n.text),e.abrupt("return");case 7:this.setState({modalVendorNew:!1,openVendor:null,vendorCities:[],allCities:[],vendors:n.vendors});case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"delItem",value:function(e){var t=this.state.vendor_items;t=t.filter((function(t){return parseInt(t.item_id)!=parseInt(e)})),this.setState({vendor_items:t})}},{key:"addItem",value:function(e){var t=this.state.vendor_items;t.find((function(t){return parseInt(t.item_id)==parseInt(e.id)}))||t.push({item_id:e.id,item_name:e.name,nds:-2}),this.setState({vendor_items:t})}},{key:"addItemCustom",value:function(){var e=this,t=this.state.allItems.find((function(t){return parseInt(t.id)==parseInt(e.state.customAdd)}));this.addItem(t)}},{key:"testChange",value:function(e,t){var n=this.state.openVendor;n[e]="bill_ex"==e||"need_img_bill_ex"==e?!0===t.target.checked?1:0:t.target.value,this.setState({openVendor:n})}},{key:"changeCity",value:(t=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={city:t.target.value},e.next=3,this.getData("get_vendors",n);case 3:a=e.sent,this.setState({vendors:a,city:t.target.value});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"changeSort",value:function(e,t){var n=this;this.state.vendor_items.map((function(a,i){parseInt(a.item_id)==parseInt(e)&&(n.state.vendor_items[i].sort=t.target.value)})),this.setState({vendor_items:this.state.vendor_items})}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalItems,fullWidth:!0,maxWidth:"md",onClose:function(){e.setState({modalItems:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"Товары поставщика ",this.state.openVendor?this.state.openVendor.name:""),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,style:{paddingTop:20}},a.createElement(D.ZP,{item:!0,xs:12,sm:5,style:{paddingRight:10}},a.createElement(ce.Z,null,a.createElement(me.Z,null,a.createElement(pe.Z,{style:{height:75}},a.createElement(ue.Z,null,a.createElement(Ae,{data:this.state.allItems,value:this.state.customAdd,func:function(t){e.setState({customAdd:t.target.value})}})),a.createElement(ue.Z,null,a.createElement(tt.Z,{onClick:this.addItemCustom.bind(this),style:{cursor:"pointer"}}))),this.state.allItems.map((function(t,n){return a.createElement(pe.Z,{key:n,style:{height:75}},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(tt.Z,{onClick:e.addItem.bind(e,t),style:{cursor:"pointer"}})))}))))),a.createElement(D.ZP,{item:!0,xs:12,sm:7},a.createElement(ce.Z,null,a.createElement(me.Z,null,this.state.vendor_items.map((function(t,n){return a.createElement(pe.Z,{key:n,style:{height:75}},a.createElement(ue.Z,null,t.item_name),a.createElement(ue.Z,null,a.createElement(Ne,{label:"",value:t.sort,func:e.changeSort.bind(e,t.item_id)})),a.createElement(ue.Z,null,a.createElement(Ae,{data:e.state.nds,value:t.nds,func:e.changeNDS.bind(e,t.item_id)})),a.createElement(ue.Z,null,a.createElement(Ue.Z,{onClick:e.delItem.bind(e,t.item_id),style:{cursor:"pointer"}})))}))))))),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.saveVendorItems.bind(this),color:"primary"},"Сохранить"))),a.createElement(G.Z,{open:this.state.modalVendor,fullWidth:!0,maxWidth:"md",onClose:function(){e.setState({modalVendor:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"Поставщик ",this.state.openVendor?this.state.openVendor.name:""),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},this.state.openVendor?a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12,sm:5},a.createElement(Ne,{label:"Наименование",value:this.state.openVendor.name,func:this.testChange.bind(this,"name")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Описание",value:this.state.openVendor.text,func:this.testChange.bind(this,"text")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Мин. сумма заявки",value:this.state.openVendor.min_price,func:this.testChange.bind(this,"min_price")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"ИНН",value:this.state.openVendor.inn,func:this.testChange.bind(this,"inn"),disabled:!0})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"ОГРН",value:this.state.openVendor.ogrn,func:this.testChange.bind(this,"ogrn")})),a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(Ne,{label:"Адрес компании",value:this.state.openVendor.addr,func:this.testChange.bind(this,"addr")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Контактное лицо",value:this.state.openVendor.user,func:this.testChange.bind(this,"user")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Телефон",value:this.state.openVendor.phone,func:this.testChange.bind(this,"phone")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Почта",value:this.state.openVendor.email,func:this.testChange.bind(this,"email")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Доп почта",value:this.state.openVendor.email_2,func:this.testChange.bind(this,"email_2")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Работа по счетам",value:1==parseInt(this.state.openVendor.bill_ex),func:this.testChange.bind(this,"bill_ex")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Необходима картинка",value:1==parseInt(this.state.openVendor.need_img_bill_ex),func:this.testChange.bind(this,"need_img_bill_ex")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Te,{multiple:!0,label:"Города",data:this.state.allCities,value:this.state.vendorCities,func:function(t,n){console.log(n),e.setState({vendorCities:n})}}))):null)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.saveVendor.bind(this),color:"primary"},"Сохранить"))),a.createElement(G.Z,{open:this.state.modalVendorNew,fullWidth:!0,maxWidth:"md",onClose:function(){e.setState({modalVendorNew:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"Новый поставщик"),a.createElement(Q.Z,null,a.createElement(D.ZP,{container:!0,spacing:3},this.state.openVendor?a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12,sm:5},a.createElement(Ne,{label:"Наименование",value:this.state.openVendor.name,func:this.testChange.bind(this,"name")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Описание",value:this.state.openVendor.text,func:this.testChange.bind(this,"text")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Мин. сумма заявки",value:this.state.openVendor.min_price,func:this.testChange.bind(this,"min_price")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"ИНН",value:this.state.openVendor.inn,func:this.testChange.bind(this,"inn")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"ОГРН",value:this.state.openVendor.ogrn,func:this.testChange.bind(this,"ogrn")})),a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(Ne,{label:"Адрес компании",value:this.state.openVendor.addr,func:this.testChange.bind(this,"addr")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Контактное лицо",value:this.state.openVendor.user,func:this.testChange.bind(this,"user")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Телефон",value:this.state.openVendor.phone,func:this.testChange.bind(this,"phone")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Почта",value:this.state.openVendor.email,func:this.testChange.bind(this,"email")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Доп почта",value:this.state.openVendor.email_2,func:this.testChange.bind(this,"email_2")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Работа по счетам",value:1==parseInt(this.state.openVendor.bill_ex),func:this.testChange.bind(this,"bill_ex")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Необходима картинка",value:1==parseInt(this.state.openVendor.need_img_bill_ex),func:this.testChange.bind(this,"need_img_bill_ex")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Te,{label:"Города",data:this.state.allCities,value:this.state.vendorCities,func:function(t,n){e.setState({vendorCities:n})}}))):null)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.addVendor.bind(this),color:"primary"},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.cities,value:this.state.city,func:this.changeCity.bind(this),label:"Город"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{onClick:this.openModalVendorNew.bind(this),variant:"contained"},"Добавить поставщика")),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{component:"th"},"Название"),a.createElement(ue.Z,{component:"th"},"Назначенные товары"),a.createElement(ue.Z,{component:"th"},a.createElement(Ke.Z,null)))),a.createElement(me.Z,null,this.state.vendors.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,a.createElement(x.Z,{onClick:e.openModalVendor.bind(e,t),style:{cursor:"pointer",width:"max-content"}},t.name)),a.createElement(ue.Z,null,a.createElement(et.Z,{onClick:e.openModalItems.bind(e,t),style:{cursor:"pointer"}})),a.createElement(ue.Z,null,1==parseInt(t.is_show)?a.createElement(Ke.Z,null):a.createElement($e.Z,null)))}))))))))}}]),w}(a.Component);function it(){return a.createElement(at,null)}n(5986);var st=n(7563),rt=function(e){(0,m.Z)(g,e);var t,n,i,s,p,E,_=(p=g,E=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(p);if(E){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function g(e){var t;return(0,l.Z)(this,g),t=_.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:st.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){setTimeout((function(){t.setState({is_load:!1})}),300),console.log(e)}))})),t.state={module:"vendor_item_price",module_name:"",is_load:!1,modalDialog:!1,vendors:[],vendor:null,items:[],cities:[],city:"",allCity:!1,isPrioriti:!1},t}return(0,o.Z)(g,[{key:"componentDidMount",value:(s=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,cities:t.cities}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"changeCity",value:(i=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={city:t.target.value},e.next=3,this.getData("get_vendors",n);case 3:a=e.sent,this.setState({vendors:a,city:t.target.value,vendor:null,items:[]});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"changeVendor",value:(n=(0,r.Z)(f().mark((function e(t,n){var a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t.target.value,n),a={city:this.state.city,vendor_id:n.id},e.next=4,this.getData("get_vendor_items",a);case 4:i=e.sent,this.setState({items:i,vendor:n});case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"update",value:function(e,t,n){var a=this.state.items;a.map((function(i,s){parseInt(i.item_id)==parseInt(e)&&(a[s][t]=n.target.value,a[s].price=(parseFloat(a[s].full_price)/parseFloat(a[s].rec_pq)).toFixed(2))})),this.setState({items:a})}},{key:"save",value:(t=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=(t={vendor_id:this.state.vendor,items:this.state.items,city_id:this.state.city,all_city:!0===this.state.allCity?1:0,is_prioriti:!0===this.state.isPrioriti?1:0}).all_city){e.next=8;break}if(!confirm("Точно сохранить на все города поставщика ?")){e.next=6;break}return e.next=5,this.getData("save_price",t);case 5:e.sent;case 6:e.next=11;break;case 8:return e.next=10,this.getData("save_price",t);case 10:e.sent;case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:999},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"}),a.createElement(Q.Z,null,a.createElement(K.Z,{id:"alert-dialog-description"})),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary"},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.cities,value:this.state.city,func:this.changeCity.bind(this),label:"Город"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Te,{data:this.state.vendors,value:this.state.vendor,func:this.changeVendor.bind(this),multiple:!1,label:"Поставщик"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{value:this.state.allCity,func:function(t){e.setState({allCity:t.target.checked})},label:"На все города поставщика"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Me,{value:this.state.isPrioriti,func:function(t){e.setState({isPrioriti:t.target.checked})},label:"Приоритетный постащик"})),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(J.Z,{onClick:this.save.bind(this),variant:"contained"},"Сохранить")),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Позиция"),a.createElement(ue.Z,null),a.createElement(ue.Z,null,"Комментарий"),a.createElement(ue.Z,null,"Цена за упаковку"),a.createElement(ue.Z,null,"Объем упаковки"),a.createElement(ue.Z,null,"Цена за 1 ед."))),a.createElement(me.Z,null,this.state.items.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,t.name_for_vendor),a.createElement(ue.Z,null,a.createElement(Ne,{label:"",value:t.comment,func:e.update.bind(e,t.item_id,"comment")})),a.createElement(ue.Z,null,a.createElement(Ne,{label:"",value:t.full_price,func:e.update.bind(e,t.item_id,"full_price")})),a.createElement(ue.Z,null,a.createElement(Ae,{data:t.pqs,value:0==parseInt(t.rec_pq)?"":t.rec_pq,func:e.update.bind(e,t.item_id,"rec_pq"),label:""})),a.createElement(ue.Z,null,t.price," / ",t.ei_name))}))))))))}}]),g}(a.Component);function lt(){return a.createElement(rt,null)}n(7887);var ot=n(4e3);var ct=n(7563),mt=function(e){return"Цена"==e.colDef.headerName?{borderRight:"1px solid #bababa"}:null},ut=function(e){(0,m.Z)(E,e);var t,n,i,s,p=(i=E,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(i);if(s){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function E(e){var t;return(0,l.Z)(this,E),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:ct.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"tender",module_name:"",is_load:!1,modalDialog:!1,testTable:[],vendors:[],myVendors:[],showVendors:[],params_api:null,params_columnApi:null},t}return(0,o.Z)(E,[{key:"componentDidMount",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,n=[],t.items.map((function(e,a){n.push({section:"big-title",item:e.name}),e.cats.map((function(e,a){n.push({section:"big-title",item:e.name}),e.items.map((function(e,a){var i={};t.vendors.map((function(n,a){var s=t.vendor_price.find((function(t){return parseInt(t.vendor_id)==parseInt(n.id)&&parseInt(t.item_id)==parseInt(e.id)}));s?(i["vend_price_"+n.id]=s.price,i["vend_city_"+n.id]="тлт"):(i["vend_price_"+n.id]="",i["vend_city_"+n.id]="")})),i.item=e.name,i.section="last";var s=t.ras.find((function(t){return parseInt(t.item_id)==parseInt(e.id)}));i.ras=s?s.count_pf:"",n.push(i)}))}))})),this.setState({module_name:t.module_info.name,testTable:n,vendors:t.vendors,showVendors:t.vendors}),document.title=t.module_info.name;case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onCellClicked",value:function(e){console.log(e.data),console.log(e.colDef.field)}},{key:"onGridReady",value:function(e){this.setState({params_api:e.api,params_columnApi:e.columnApi})}},{key:"show",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={vendors:this.state.myVendors},e.next=3,this.getData("get_data",t);case 3:n=e.sent,a=[],n.items.map((function(e,t){a.push({section:"big-title",item:e.name}),e.cats.map((function(e,t){a.push({section:"big-title",item:e.name}),e.items.map((function(e,t){var i={};n.vendors.map((function(t,a){var s=n.vendor_price.find((function(n){return parseInt(n.vendor_id)==parseInt(t.id)&&parseInt(n.item_id)==parseInt(e.id)}));s?(i["vend_price_"+t.id]=s.price,i["vend_city_"+t.id]="тлт"):(i["vend_price_"+t.id]="",i["vend_city_"+t.id]="")})),i.item=e.name,i.section="last";var s=n.ras.find((function(t){return parseInt(t.item_id)==parseInt(e.id)}));i.ras=s?s.count_pf:"",a.push(i)}))}))})),this.setState({testTable:a,showVendors:n.vendors});case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"Новая категория"),a.createElement(Q.Z,null),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary"},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Te,{data:this.state.vendors,multiple:!0,value:this.state.myVendors,func:function(t,n){e.setState({myVendors:n})},label:"Поставщики"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.show.bind(this)},"Показать")),a.createElement(D.ZP,{item:!0,xs:12},a.createElement("div",{className:"ag-theme-alpine",style:{height:600,width:"100%"}},a.createElement(ot.AgGridReact,{onGridReady:this.onGridReady.bind(this),onCellClicked:this.onCellClicked,rowData:this.state.testTable},a.createElement(ot.AgGridColumn,{field:"ras",width:120,pinned:"left"}),a.createElement(ot.AgGridColumn,{field:"item",width:300,pinned:"left",cellClassRules:{"cell-span":"data.section==='big-title'"}}),a.createElement(ot.AgGridColumn,{hide:!0}),this.state.showVendors.map((function(e,t){return a.createElement(ot.AgGridColumn,{key:t,headerName:e.name,resizable:!0,width:180},a.createElement(ot.AgGridColumn,{field:"vend_city_"+e.id,headerName:"Город",resizable:!0,width:90}),a.createElement(ot.AgGridColumn,{field:"vend_price_"+e.id,headerName:"Цена",resizable:!0,width:90,cellStyle:mt}))}))))),a.createElement(D.ZP,{item:!0,xs:12,sm:12})))}}]),E}(a.Component);function dt(){return a.createElement(ut,null)}n(521);var ht=n(5987),pt=n(5697),ft=n.n(pt),Et=n(20),_t=n(2640),gt=n(1508),Zt=n(4172),vt=n(2004),yt=n(7097),xt=n(7233),wt=["children","value","index"];function bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,d.Z)(e);if(t){var i=(0,d.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}var kt=n(7563);function It(e){var t=e.children,n=e.value,i=e.index,r=(0,ht.Z)(e,wt);return a.createElement("div",(0,s.Z)({role:"tabpanel",hidden:n!==i,id:"simple-tabpanel-".concat(i),"aria-labelledby":"simple-tab-".concat(i)},r),n===i&&a.createElement(gt.Z,{sx:{p:3}},t))}function Dt(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}It.propTypes={children:ft().node,index:ft().number.isRequired,value:ft().number.isRequired};var Pt=function(e){(0,m.Z)(E,e);var t,n,i,u,d,p=bt(E);function E(e){var t;return(0,l.Z)(this,E),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:kt.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"revizion",module_name:"",is_load:!1,points:[],point:"0",revList:[],chooseRev:"",search:"",items:[],pf:[],rec:[],items_b:[],pf_b:[],rec_b:[],all_data:[],chooseTab:0},t}return(0,o.Z)(E,[{key:"componentDidMount",value:(d=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({points:t.point_list,point:1==t.point_list.length?t.point_list[0].id:"0",module_name:t.module_info.name,all_data:t.get_data_for_new_rev}),document.title=t.module_info.name,setTimeout((function(){}),100);case 6:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"changePoint",value:function(e){var t=this,n=e.target.value;this.setState({point:n,search:""}),setTimeout((function(){t.getRevList()}),50)}},{key:"changeRev",value:function(e){var t=this,n=e.target.value;this.setState({chooseRev:n,search:""}),setTimeout((function(){t.getDataRev()}),300)}},{key:"search",value:(u=(0,r.Z)(f().mark((function e(t){var n,a,i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.state.point,this.state.showReady,this.state,s=t.target.value.toLowerCase(),n=this.state.items_b.filter((function(e){return e.name.toLowerCase().includes(s)})),a=this.state.rec_b.filter((function(e){return e.name.toLowerCase().includes(s)})),i=this.state.pf_b.filter((function(e){return e.name.toLowerCase().includes(s)})),this.setState({items:n,rec:a,pf:i,search:s});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"updateData",value:(i=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={rev_id:this.state.chooseRev,point_id:this.state.point},e.next=3,this.getData("get_data_rev",t);case 3:n=e.sent,this.setState({items:n.item,rec:n.rec,pf:n.pf,items_b:n.item,rec_b:n.rec,pf_b:n.pf});case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getRevList",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point},e.next=3,this.getData("get_rev_list",t);case 3:n=e.sent,this.setState({revList:n,chooseRev:n.length>0?n[0].id:""}),n.length>0&&setTimeout((function(){a.getDataRev()}),300);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getDataRev",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point,rev_id:this.state.chooseRev},e.next=3,this.getData("get_data_rev",t);case 3:n=e.sent,this.setState({items:n.item,rec:n.rec,pf:n.pf,items_b:n.item,rec_b:n.rec,pf_b:n.pf});case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(z.OL,{to:"/revizion/new"},"Новая ревизия")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.revList,value:this.state.chooseRev,func:this.changeRev.bind(this),label:"Ревизия"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{func:this.search.bind(this),label:"Поиск",value:this.state.search})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),a.createElement(D.ZP,{item:!0,xs:12,sm:12,id:"revTable"},a.createElement(Et.Z,{value:this.state.chooseTab,onChange:function(t,n){e.setState({chooseTab:n})},textColor:"primary",indicatorColor:"primary",centered:!0},a.createElement(_t.Z,(0,s.Z)({label:"Товары"},Dt(0))),a.createElement(_t.Z,(0,s.Z)({label:"Заготовки"},Dt(1)))),a.createElement(It,{value:this.state.chooseTab,index:0},a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Товар"),a.createElement(ue.Z,null,"Объем"))),a.createElement(me.Z,null,this.state.items.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.name),a.createElement(ue.Z,null,e.value," ",e.ei_name))})))))),a.createElement(It,{value:this.state.chooseTab,index:1},a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Заготовка"),a.createElement(ue.Z,null,"Объем"))),a.createElement(me.Z,null,this.state.pf.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.name),a.createElement(ue.Z,null,e.value," ",e.ei_name))})))))))))}}]),E}(a.Component),St=function(e){(0,m.Z)(n,e);var t=bt(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={item:a.props.item,pf:a.props.pf,change:a.props.change,type:a.props.type},a}return(0,o.Z)(n,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.change!==t.change||this.state.change!==e.change}},{key:"render",value:function(){var e=this;return a.createElement(T.Z,null,a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null)},a.createElement(x.Z,{style:{width:"60%"}},this.state.item.name," "),a.createElement(x.Z,{style:{width:"40%"}},this.state.item.value," ",this.state.item.ei_name," ")),"item"!=this.state.type?null:a.createElement(N.Z,null,this.state.item.counts.map((function(t,n){return a.createElement(D.ZP,{container:!0,spacing:3,key:n,style:{paddingTop:10,paddingBottom:10}},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:e.state.item.size,value:t.need_pq,func:e.props.func.bind(e,"item",e.props.itemKey,"need_pq",n),label:"Объем упаковки"})),a.createElement(D.ZP,{item:!0,xs:0==n?12:9,sm:5},a.createElement(L.Z,{value:t.value,onChange:e.props.func.bind(e,"item",e.props.itemKey,"value",n),fullWidth:!0,variant:"outlined",size:"small",label:"Количество"})),0==n?null:a.createElement(D.ZP,{item:!0,xs:3,sm:1},a.createElement(J.Z,{onClick:e.props.clear.bind(e,"item",e.props.itemKey,n),variant:"contained"}," ",a.createElement(Ue.Z,null)," ")))})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:this.props.copy.bind(this,"item",this.props.itemKey)},"Дублировать"))),"pf"!=this.state.type?null:a.createElement(N.Z,null,a.createElement(D.ZP,{item:!0,sm:5},a.createElement(L.Z,{value:this.state.pf.value,onChange:this.props.func.bind(this,"pf",this.props.itemKey,"value",0),fullWidth:!0,variant:"outlined",size:"small",label:"Количество"}))))}}]),n}(a.Component),Ct=function(e){(0,m.Z)(d,e);var t,n,i,u=bt(d);function d(e){var t;return(0,l.Z)(this,d),t=u.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:kt.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"revizion",module_name:"",is_load:!1,points:[],point:"0",revList:[],chooseRev:"",storages:[],items:[],rec:[],pf:[],chooseTab:0,modalDialog:!1,open:!1},t}return(0,o.Z)(d,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({points:t.point_list,point:1==t.point_list.length?t.point_list[0].id:"0",module_name:t.module_info.name}),document.title=t.module_info.name,setTimeout((function(){}),100);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"changePoint",value:function(e){var t=this,n=e.target.value;this.setState({point:n}),setTimeout((function(){t.getDataRev()}),300)}},{key:"getDataRev",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point},e.next=3,this.getData("get_data_for_new_rev",t);case 3:n=e.sent,this.setState({storages:n.storages,items:n.items,rec:n.rec,pf:n.pf});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"saveData",value:function(e,t,n,a,i){if(console.log("saveData"),"item"==e){var s=this.state.items;s[t].counts[a][[n]]=i.target.value;var r=0;s[t].counts.map((function(e,t){r+=parseFloat(e.need_pq)*parseFloat(e.value)})),s[t].value=r,s[t].change++,this.setState({items:s})}if("pf"==e){var l=this.state.pf;l[t].value=i.target.value,l[t].change++,this.setState({pf:l}),console.log("pf",l)}}},{key:"checkData",value:function(){console.log("checkData");var e=this.state.items,t=this.state.pf;e.map((function(e,t){0!=e.value&&(e.is_show=0)})),t.map((function(e,t){0!=e.value&&(e.is_show=0)})),this.setState({items:e,pf:t}),this.setState({modalDialog:!0,titleDialog:"Ты уверен в правильности этих позиций ?"})}},{key:"copyData",value:function(e,t){if("item"==e){var n=this.state.items;n[t].counts.push({need_pq:n[t].counts[0].need_pq,value:0}),n[t].change++,this.setState({items:n})}}},{key:"clearData",value:function(e,t,n){if("item"==e){var a=this.state.items,i=[];a[t].counts.map((function(e,t){t!=n&&i.push(e)})),a[t].counts=i;var s=0;a[t].counts.map((function(e,t){s+=parseFloat(e.need_pq)*parseFloat(e.value)})),a[t].value=s,a[t].change++,this.setState({items:a})}}},{key:"saveRev",value:(t=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={point_id:this.state.point,item:this.state.item,rec:this.state.rec,pf:this.state.pf},console.log("saveRev ",t);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,"Новая ревизии")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.checkData.bind(this)},"Сохранить")),a.createElement(D.ZP,{item:!0,xs:12,sm:12,id:"revTable"},a.createElement(Et.Z,{value:this.state.chooseTab,onChange:function(t,n){e.setState({chooseTab:n})},textColor:"primary",indicatorColor:"primary",centered:!0},a.createElement(_t.Z,(0,s.Z)({label:"Товары"},Dt(0))),a.createElement(_t.Z,(0,s.Z)({label:"Заготовки"},Dt(1)))),a.createElement("div",{style:0==this.state.chooseTab?{display:"block"}:{display:"none"}},this.state.items.map((function(t,n){return 0==parseInt(t.is_show)?null:a.createElement(St,{key:n,type:"item",itemKey:n,item:t,change:t.change,func:e.saveData.bind(e),copy:e.copyData.bind(e),clear:e.clearData.bind(e)})}))),a.createElement("div",{style:1==this.state.chooseTab?{display:"block"}:{display:"none"}},this.state.pf.map((function(t,n){return 0==parseInt(t.is_show)?null:a.createElement(St,{key:n,type:"pf",itemKey:n,item:t,pf:t,change:t.change,func:e.saveData.bind(e),copy:e.copyData.bind(e),clear:e.clearData.bind(e)})}))))),a.createElement(a.Fragment,null,a.createElement(U.Z,{anchor:"left",open:this.state.open,onClose:function(){e.setState({open:!1})},onOpen:function(){e.setState({open:!0})}},a.createElement(Z.Z,{style:{width:"100%"}},this.state.storages.map((function(e,t){return a.createElement(v.ZP,{button:!0,key:t},a.createElement(y.Z,{primary:e.name}))}))))),0==this.state.storages.length?null:a.createElement(fe.Z,{sx:{position:"fixed",bottom:0,left:0,right:0},elevation:3},a.createElement(Zt.Z,{showLabels:!0},a.createElement(vt.Z,{onClick:function(t,n){e.setState({open:!0})},label:"Recents",icon:a.createElement(yt.Z,null)}),a.createElement(vt.Z,{onClick:this.checkData.bind(this),label:"Save",icon:a.createElement(xt.Z,null)}))),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},this.state.titleDialog),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(K.Z,{id:"alert-dialog-description"},a.createElement(D.ZP,{container:!0,spacing:3},"Не все поля заполнены ")),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0},"Позиция "),a.createElement(D.ZP,{item:!0},"Кол-во "),a.createElement(D.ZP,{item:!0},"Ед. измер. "))),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary"},"Хорошо"),a.createElement(J.Z,{color:"primary"},"Сохранить"))))}}]),d}(a.Component);function Tt(){return a.createElement(Pt,null)}function At(){return a.createElement(Ct,null)}n(4220);var Nt=n(3887),Ot=n(244),Rt=n(417),Mt=n(5433),zt=n(4336),Ft=n(4893),Lt=n(9316),Bt=n(1497),Ut=n(6755),Wt=n(7036),jt=["children","value","index"];function Vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,d.Z)(e);if(t){var i=(0,d.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}var Yt=n(7563);function Xt(e){var t=e.children,n=e.value,i=e.index,r=(0,ht.Z)(e,jt);return a.createElement("div",(0,s.Z)({role:"tabpanel",hidden:n!==i,id:"simple-tabpanel-".concat(i),"aria-labelledby":"simple-tab-".concat(i)},r),n===i&&a.createElement(gt.Z,{sx:{p:3}},t))}function Ht(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}ft().func.isRequired,ft().bool.isRequired,ft().string.isRequired,Xt.propTypes={children:ft().node,index:ft().number.isRequired,value:ft().number.isRequired};var Jt=function(e){(0,m.Z)(n,e);var t=Vt(n);function n(){return(0,l.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{minWidth:140,minHeight:38}},"Ур. кафе: ",this.props.lv_cafe),a.createElement(ue.Z,{style:{minWidth:165,minHeight:38}},"Число месяца"),"manager"==this.props.kind?null:a.createElement(ue.Z,null),this.props.days.map((function(e,t){return a.createElement(ue.Z,{className:"min_block",style:{backgroundColor:"Пт"==e.day||"Сб"==e.day||"Вс"==e.day?"#ffe9bd":"#fff"},key:t},e.date)})),"manager"==this.props.kind?null:a.createElement(a.Fragment,null,a.createElement(ue.Z,null),this.props.dataKey>0?a.createElement(a.Fragment,null,a.createElement(ue.Z,{style:{textAlign:"center"}}),a.createElement(ue.Z,{style:{textAlign:"center"}})):a.createElement(a.Fragment,null,a.createElement(ue.Z,{style:{textAlign:"center",cursor:"pointer"},onClick:this.props.changeDopBonus},this.props.bonus_other?1==parseInt(this.props.bonus_other)?a.createElement(tt.Z,{style:{fontSize:30,color:"green"}}):a.createElement(Ue.Z,{style:{fontSize:30,color:"red"}}):"+ / -"),a.createElement(ue.Z,{style:{textAlign:"center",cursor:"pointer"},onClick:this.props.changeLVDir},"Ур. дира: ",this.props.lv_dir)),a.createElement(ue.Z,null),a.createElement(ue.Z,null),a.createElement(ue.Z,null),a.createElement(ue.Z,null))),a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{minWidth:140,minHeight:38}},"Сотрудник"),a.createElement(ue.Z,{style:{minWidth:165,minHeight:38}},"Должность"),"manager"==this.props.kind?null:a.createElement(ue.Z,null),this.props.days.map((function(e,t){return a.createElement(ue.Z,{className:"min_block",style:{backgroundColor:"Пт"==e.day||"Сб"==e.day||"Вс"==e.day?"#ffe9bd":"#fff"},key:t},e.day)})),"manager"==this.props.kind?null:a.createElement(a.Fragment,null,a.createElement(ue.Z,{style:{textAlign:"center"}},"За 1ч"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Командный бонус"),a.createElement(ue.Z,{style:{textAlign:"center"}},"За часы"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Ошибки"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Бонус"),1==this.props.show_zp||0==this.props.show_zp?a.createElement(ue.Z,{style:{textAlign:"center"}},"Всего"):null,a.createElement(ue.Z,{style:{textAlign:"center"}},"Выдано"))),a.createElement(pe.Z,{style:{backgroundColor:"#e5e5e5"}},a.createElement(ue.Z,{style:{textAlign:"center"},colSpan:this.props.days.length+3+7},this.props.item.data)))}}]),n}(a.Component),Gt=function(e){(0,m.Z)(b,e);var t,n,i,u,d,p,E,_,g,w=Vt(b);function b(e){var t;return(0,l.Z)(this,b),t=w.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Yt.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){setTimeout((function(){t.setState({is_load:!1})}),300),console.log(e)}))})),t.state={module:"work_schedule",module_name:"",is_load:!1,points:[],mounths:[],point:"0",mounth:"0",one:null,two:null,test_one:[],test_two:[],isOpenModalH:!1,userInfo:null,hList:[],mList:[],newTimeStart:"10:00",newTimeEnd:"22:00",openNewTimeAdd:!1,otherAppList:[],otherApp:"",testVal:"",testOpen:!1,mainMenu:!1,mainMenuH:!1,mainMenuSmena:!1,show_bonus:!1,mainMenuPrice:!1,mainMenuLVDIR:!1,mainMenuDopBonus:!1,show_zp_one:0,show_zp_two:0,kind:"",myOtherSmens:[],chooseUser:null,tabTable:1,lv_cafe:0,lv_dir:0,arr_dir_lv:[]},t}return(0,o.Z)(b,[{key:"componentDidMount",value:(g=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r,l,o,c=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,this.getData("get_all",t);case 3:for(n=e.sent,a=[],i=[],s=0;s<=23;s++)a.push({id:s,name:s});for(r=0;r<=50;r+=10)i.push({id:r,name:r});for(this.setState({points:n.point_list,point:n.point_list[0].id,mounths:n.mounths,mounth:n.mounths.find((function(e){return 1==parseInt(e.is_active)})).id,hList:a,mList:i,module_name:n.module_info.name}),document.title=n.module_info.name,l=[],o=1;o<=20;o++)l.push(o);this.setState({arr_dir_lv:l}),setTimeout((function(){c.updateData()}),100);case 14:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"changeCheckOrders",value:function(e){var t=e.target.checked;this.setState({showReady:t})}},{key:"updateData",value:(_=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point,mounth:this.state.mounth},e.next=3,this.getData("get_graph",t);case 3:n=e.sent,console.log(n),this.setState({one:n.date.one,two:n.date.two,test_one:n.one,test_two:n.two,show_zp_one:n.show_zp_one,show_zp_two:n.show_zp_two,kind:n.kind,lv_cafe:n.lv_cafe,lv_dir:n.lv_dir});case 6:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"openH",value:(E=(0,r.Z)(f().mark((function e(t,n){var a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),a={smena_id:t.smena_id,app_id:t.app_id,user_id:t.id,date:n,date_start:t.date},e.next=4,this.getData("get_user_day",a);case 4:i=e.sent,console.log(i),this.setState({isOpenModalH:!0,userInfo:i.h_info,otherAppList:i.other_app,show_bonus:i.show_bonus});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"delTime",value:function(e){var t=this.state.userInfo;t.hours=t.hours.filter((function(t,n){return parseInt(n)!=parseInt(e)})),this.setState({userInfo:t})}},{key:"changeHourse",value:function(e,t,n){var a=this.state.userInfo;a.hours[t][[e]]=n.target.value,this.setState({userInfo:a})}},{key:"saveDayHourse",value:(p=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={date:this.state.userInfo.date,user_id:this.state.userInfo.user_id,smena_id:this.state.userInfo.smena_id,app_id:this.state.userInfo.app_id,hours:this.state.userInfo.hours,new_app:this.state.userInfo.new_app,mentor_id:this.state.userInfo.mentor_id},e.next=3,this.getData("save_user_day",t);case 3:1==(n=e.sent).st?(this.setState({mainMenu:!1,mainMenuH:!1,mainMenuSmena:!1}),this.updateData()):alert(n.text);case 5:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"addTime",value:function(){var e=this,t=this.state.userInfo;t.hours.find((function(t){return t.time_start==e.state.newTimeStart&&t.time_end==e.state.newTimeEnd}))?this.setState({openNewTimeAdd:!1}):(t.hours.push({time_start:this.state.newTimeStart,time_end:this.state.newTimeEnd}),this.setState({userInfo:t,openNewTimeAdd:!1}))}},{key:"fastTime",value:(d=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={type:t,user_id:this.state.chooseUser.id,app_id:this.state.chooseUser.app_id,smena_id:this.state.chooseUser.smena_id,date:this.state.mounth},e.next=3,this.getData("save_fastTime",n);case 3:a=e.sent,console.log(a),1==a.st?(this.setState({mainMenu:!1,mainMenuH:!1,mainMenuSmena:!1}),this.updateData()):alert(a.text);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"fastSmena",value:(u=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={new_smena_id:t,user_id:this.state.chooseUser.id,app_id:this.state.chooseUser.app_id,smena_id:this.state.chooseUser.smena_id,date:this.state.mounth,part:this.state.tabTable},e.next=3,this.getData("save_fastSmena",n);case 3:a=e.sent,console.log(a),1==a.st?(this.setState({mainMenu:!1,mainMenuH:!1,mainMenuSmena:!1}),this.updateData()):alert(a.text);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"changePriceH",value:(i=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={price:t,user_id:this.state.chooseUser.id,app_id:this.state.chooseUser.app_id,smena_id:this.state.chooseUser.smena_id,date:this.state.mounth,part:this.state.tabTable},e.next=3,this.getData("save_userPriceH",n);case 3:a=e.sent,console.log(a),1==a.st?(this.setState({mainMenu:!1,mainMenuH:!1,mainMenuPrice:!1}),this.updateData()):alert(a.text);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"changeLVDir",value:function(){this.setState({mainMenuLVDIR:!0})}},{key:"newLvDir",value:(n=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={date:this.state.mounth,point_id:this.state.point,dir_lv:t},e.next=3,this.getData("save_dir_lv",n);case 3:a=e.sent,console.log(a),1==a.st?(this.setState({mainMenuLVDIR:!1}),this.updateData()):alert(a.text);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"changeDopBonus",value:function(){this.setState({mainMenuDopBonus:!0})}},{key:"dop_bonus",value:(t=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={date:this.state.mounth,part:this.state.tabTable,point_id:this.state.point,type:t},e.next=3,this.getData("save_dop_bonus",n);case 3:a=e.sent,console.log(a),1==a.st?(this.setState({mainMenuDopBonus:!1}),this.updateData()):alert(a.text);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{onClose:function(){e.setState({mainMenu:!1})},open:this.state.mainMenu},this.state.chooseUser?a.createElement($.Z,null,this.state.chooseUser.full_app_name," ",this.state.chooseUser.user_name," ",this.state.mounth):null,a.createElement(Z.Z,{sx:{pt:0}},a.createElement(v.ZP,{button:!0,onClick:function(){e.setState({mainMenu:!1,mainMenuH:!0})}},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(Ot.Z,null))),a.createElement(y.Z,{primary:"Сменить часы на месяц"})),a.createElement(v.ZP,{button:!0,onClick:function(){e.setState({mainMenu:!1,mainMenuSmena:!0,myOtherSmens:e.state.chooseUser.other_smens})}},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(zt.Z,null))),a.createElement(y.Z,{primary:"Сменить смену"})),a.createElement(v.ZP,{button:!0},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(Mt.Z,null))),a.createElement(y.Z,{primary:"Сменить точку"})))),a.createElement(G.Z,{onClose:function(){e.setState({mainMenuH:!1})},open:this.state.mainMenuH},this.state.chooseUser?a.createElement($.Z,null,this.state.chooseUser.user_name," ",this.state.mounth," Часы"):null,a.createElement(Z.Z,{sx:{pt:0}},a.createElement(v.ZP,{button:!0,onClick:this.fastTime.bind(this,1)},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(Ft.Z,null))),a.createElement(y.Z,{primary:"С 1 числа 2/2 с 10 до 22 на месяц"})),a.createElement(v.ZP,{button:!0,onClick:this.fastTime.bind(this,2)},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(Lt.Z,null))),a.createElement(y.Z,{primary:"Со 2 числа 2/2 с 10 до 22 на месяц"})),a.createElement(v.ZP,{button:!0,onClick:this.fastTime.bind(this,3)},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(Bt.Z,null))),a.createElement(y.Z,{primary:"С 3 числа 2/2 с 10 до 22 на месяц"})),a.createElement(v.ZP,{button:!0,onClick:this.fastTime.bind(this,4)},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(Bt.Z,null))),a.createElement(y.Z,{primary:"С 4 числа 2/2 с 10 до 22 на месяц"})))),a.createElement(G.Z,{onClose:function(){e.setState({mainMenuSmena:!1})},open:this.state.mainMenuSmena},this.state.chooseUser?a.createElement($.Z,null,this.state.chooseUser.user_name," ",this.state.mounth," Смена"):null,a.createElement(Z.Z,{sx:{pt:0}},this.state.myOtherSmens.map((function(t,n){return a.createElement(v.ZP,{key:n,button:!0,onClick:e.fastSmena.bind(e,t.id)},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(Ut.Z,null))),a.createElement(y.Z,{primary:t.name}))})))),a.createElement(G.Z,{onClose:function(){e.setState({mainMenuPrice:!1})},open:this.state.mainMenuPrice},this.state.chooseUser?a.createElement($.Z,null,this.state.chooseUser.user_name," ",this.state.mounth," Часовая ставка"):null,this.state.chooseUser?a.createElement(Z.Z,{sx:{pt:0}},this.state.chooseUser.price_arr.map((function(t,n){return a.createElement(v.ZP,{key:n,button:!0,onClick:e.changePriceH.bind(e,t),style:parseFloat(e.state.chooseUser.price_p_h)==parseFloat(t)?{backgroundColor:"green",color:"#fff"}:{}},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(Ut.Z,null))),a.createElement(y.Z,{primary:t}))}))):null),a.createElement(G.Z,{onClose:function(){e.setState({mainMenuLVDIR:!1})},open:this.state.mainMenuLVDIR},a.createElement($.Z,null,this.state.mounth," Уровень директора"),a.createElement(Z.Z,{sx:{pt:0}},this.state.arr_dir_lv.map((function(t,n){return a.createElement(v.ZP,{key:n,button:!0,style:parseFloat(e.state.lv_dir)==parseFloat(t)?{backgroundColor:"green",color:"#fff"}:{},onClick:e.newLvDir.bind(e,t)},a.createElement(Rt.Z,null,a.createElement(H.Z,null,a.createElement(Ut.Z,null))),a.createElement(y.Z,{primary:t+" уровень"}))})))),a.createElement(G.Z,{onClose:function(){e.setState({mainMenuDopBonus:!1})},open:this.state.mainMenuDopBonus},a.createElement($.Z,null,this.state.mounth," Командный бонус"),a.createElement(Z.Z,{sx:{pt:0}},a.createElement(v.ZP,{button:!0},a.createElement(Rt.Z,null,a.createElement(H.Z,{style:{backgroundColor:"green"}},a.createElement(Wt.Z,{style:{color:"#fff"}}))),a.createElement(y.Z,{primary:"Выдать"})),a.createElement(v.ZP,{button:!0},a.createElement(Rt.Z,null,a.createElement(H.Z,{style:{backgroundColor:"red"}},a.createElement(Ue.Z,{style:{color:"#fff"}}))),a.createElement(y.Z,{primary:"Отказать"})))),this.state.userInfo?a.createElement(G.Z,{open:this.state.isOpenModalH,onClose:function(){e.setState({isOpenModalH:!1})},scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description"},a.createElement($.Z,{id:"scroll-dialog-title"},this.state.userInfo.user.app_name+" "+this.state.userInfo.user.user_name+" "+this.state.userInfo.date),a.createElement(Q.Z,{dividers:!0},a.createElement(x.Z,{style:{marginBottom:10}},"Моя нагрузка: "+this.state.userInfo.user.my_load_h+" / Средняя нагрузка: "+this.state.userInfo.user.all_load_h),!1===this.state.show_bonus?null:a.createElement(x.Z,{style:{marginBottom:20}},"Бонус: "+this.state.userInfo.user.bonus),0==this.state.otherAppList.length?null:a.createElement(Ae,{data:this.state.otherAppList,value:this.state.userInfo.new_app,func:function(t){var n=e.state.userInfo;n.new_app=t.target.value,e.setState({userInfo:n})},label:"Кем работает"}),0==this.state.userInfo.mentor_list.length?null:a.createElement(Ae,{data:this.state.userInfo.mentor_list,value:this.state.userInfo.mentor_id,func:function(t){var n=e.state.userInfo;n.mentor_id=t.target.value,e.setState({userInfo:n})},label:"Кем работает"}),a.createElement(T.Z,{style:{marginTop:10},expanded:this.state.openNewTimeAdd,onChange:function(){e.setState({openNewTimeAdd:!e.state.openNewTimeAdd})}},a.createElement(A.Z,{expandIcon:a.createElement(tt.Z,null)},a.createElement(Ot.Z,{style:{marginRight:10}}),a.createElement(x.Z,null,"Добавить время")),a.createElement(N.Z,{style:{display:"flex",flexDirection:"row"}},a.createElement(Oe,{value:this.state.newTimeStart,func:function(t){e.setState({newTimeStart:t.target.value})},label:"Время начала работы"}),a.createElement(Oe,{value:this.state.newTimeEnd,func:function(t){e.setState({newTimeEnd:t.target.value})},label:"Время окончания работы"}),a.createElement(tt.Z,{style:{minWidth:50,minHeight:38,cursor:"pointer"},onClick:this.addTime.bind(this)}))),this.state.userInfo.hours.map((function(t,n){return a.createElement(T.Z,{key:n},a.createElement(A.Z,{expandIcon:a.createElement(Ue.Z,{onClick:e.delTime.bind(e,n)})},a.createElement(Ot.Z,{style:{marginRight:10}}),a.createElement(x.Z,null,t.time_start+" - "+t.time_end)),a.createElement(N.Z,{style:{display:"flex",flexDirection:"row"}},a.createElement(Oe,{value:t.time_start,func:e.changeHourse.bind(e,"time_start",n),label:"Время начала работы"}),a.createElement(Oe,{value:t.time_end,func:e.changeHourse.bind(e,"time_end",n),label:"Время окончания работы"})))})),a.createElement(T.Z,{style:{marginTop:50},disabled:!0},a.createElement(A.Z,null,a.createElement(x.Z,null,"История"))),this.state.userInfo.hist.map((function(e,t){return a.createElement(T.Z,{key:t},a.createElement(A.Z,null,a.createElement(x.Z,null,e.date+" - "+e.user_name)),a.createElement(N.Z,{style:{display:"flex",flexDirection:"column"}},e.items.map((function(e,t){return a.createElement(x.Z,{key:t},e.time_start+" - "+e.time_end," ",""==e.app_name?"":" - "+e.app_name," ")}))))}))),a.createElement(q.Z,{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},a.createElement(J.Z,{style:{backgroundColor:"green",color:"#fff"},onClick:this.saveDayHourse.bind(this)},"Сохранить"),a.createElement(J.Z,{style:{backgroundColor:"red",color:"#fff"},onClick:function(){e.setState({isOpenModalH:!1})}},"Отмена"))):null,a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:function(t){e.setState({point:t.target.value})},label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.mounths,value:this.state.mounth,func:function(t){e.setState({mounth:t.target.value})},label:"Месяц"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),a.createElement(gt.Z,{sx:{width:"100%"}},a.createElement(gt.Z,{sx:{borderBottom:1,borderColor:"divider"}},a.createElement(Et.Z,{value:this.state.tabTable,onChange:function(t,n){e.setState({tabTable:n})},centered:!0},a.createElement(_t.Z,(0,s.Z)({label:"С 1 по 15 числа"},Ht(0))),a.createElement(_t.Z,(0,s.Z)({label:"С 16 по конец месяца"},Ht(1))))),a.createElement(Xt,{value:this.state.tabTable,index:0},this.state.one?a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,{"aria-label":"a dense table",id:"table_graph_one"},a.createElement(me.Z,null,this.state.test_one.map((function(t,n){return"header"==t.row?a.createElement(Jt,{key:n,bonus_other:e.state.one.bonus_other,changeLVDir:e.changeLVDir.bind(e),changeDopBonus:e.changeDopBonus.bind(e),kind:e.state.kind,show_zp:e.state.show_zp_one,lv_dir:e.state.lv_dir,lv_cafe:e.state.lv_cafe,dataKey:n,days:e.state.one.days,item:t}):a.createElement(pe.Z,{key:n},a.createElement(ue.Z,{style:{minWidth:140,minHeight:38,position:"absolute",backgroundColor:"#fff",marginLeft:"-1px",borderBottom:"2px solid #e5e5e5"}},t.data.user_name),a.createElement(ue.Z,{style:{minWidth:165,minHeight:38}},t.data.app_name),"manager"==e.state.kind?null:a.createElement(ue.Z,{style:{textAlign:"center"}}," ",a.createElement(zt.Z,{style:{cursor:"pointer"},onClick:function(){e.setState({mainMenu:!0,chooseUser:t.data})}})," "),t.data.dates.map((function(n,i){return a.createElement(ue.Z,{onClick:e.openH.bind(e,t.data,n.date),className:"min_block",style:{backgroundColor:n.info?n.info.color:"#fff",cursor:"pointer"},key:i},n.info?n.info.hours:"")})),"manager"==e.state.kind?null:a.createElement(a.Fragment,null,a.createElement(ue.Z,{style:{textAlign:"center",minWidth:70,cursor:"pointer"},onClick:function(){e.setState({mainMenuPrice:!0,chooseUser:t.data})}},t.data.price_p_h),a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.dop_bonus),a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.h_price),a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.err_price),a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.my_bonus),1==e.state.show_zp_one||0==e.state.show_zp_one?a.createElement(ue.Z,{style:{textAlign:"center"}},parseInt(t.data.dop_bonus)+parseInt(t.data.dir_price_dop)+parseInt(t.data.h_price)+parseInt(t.data.my_bonus)-parseInt(t.data.err_price)+""):null,a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.given)))}))),a.createElement(Nt.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null),a.createElement(ue.Z,null),"manager"==this.state.kind?null:a.createElement(ue.Z,null),this.state.one.bonus.map((function(e,t){return a.createElement(ue.Z,{className:"min_block min_size",style:{backgroundColor:"cur"==e.type?"#98e38d":"#fff"},key:t},e.res)}))),a.createElement(pe.Z,null,a.createElement(ue.Z,null),a.createElement(ue.Z,null,"Роллов"),"manager"==this.state.kind?null:a.createElement(ue.Z,null),this.state.one.bonus.map((function(e,t){return a.createElement(ue.Z,{className:"min_block min_size",key:t},e.count_rolls)}))),a.createElement(pe.Z,null,a.createElement(ue.Z,null),a.createElement(ue.Z,null,"Пиццы"),"manager"==this.state.kind?null:a.createElement(ue.Z,null),this.state.one.bonus.map((function(e,t){return a.createElement(ue.Z,{className:"min_block min_size",key:t},e.count_pizza)}))),a.createElement(pe.Z,null,a.createElement(ue.Z,null),a.createElement(ue.Z,{className:"min_size"},"Заказы готовились больше 40 минут"),"manager"==this.state.kind?null:a.createElement(ue.Z,null),this.state.one.order_stat.map((function(e,t){return a.createElement(ue.Z,{className:"min_block min_size",key:t},e.count_false)})))))):null),a.createElement(Xt,{value:this.state.tabTable,index:1},this.state.two?a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,{"aria-label":"a dense table",id:"table_graph_two"},a.createElement(me.Z,null,this.state.test_two.map((function(t,n){return"header"==t.row?a.createElement(Jt,{bonus_other:e.state.two.bonus_other,changeLVDir:e.changeLVDir.bind(e),changeDopBonus:e.changeDopBonus.bind(e),key:n,kind:e.state.kind,show_zp:e.state.show_zp_two,lv_dir:e.state.lv_dir,lv_cafe:e.state.lv_cafe,dataKey:n,days:e.state.two.days,item:t}):a.createElement(pe.Z,{key:n},a.createElement(ue.Z,{style:{minWidth:140,minHeight:38,position:"absolute",backgroundColor:"#fff",marginLeft:"-1px",borderBottom:"2px solid #e5e5e5"}},t.data.user_name),a.createElement(ue.Z,{style:{minWidth:165,minHeight:38}},t.data.app_name),"manager"==e.state.kind?null:a.createElement(ue.Z,{style:{textAlign:"center"}}," ",a.createElement(zt.Z,{style:{cursor:"pointer"},onClick:function(){e.setState({mainMenu:!0,chooseUser:t.data})}})," "),t.data.dates.map((function(n,i){return a.createElement(ue.Z,{onClick:e.openH.bind(e,t.data,n.date),className:"min_block",style:{backgroundColor:n.info?n.info.color:"#fff",cursor:"pointer"},key:i},n.info?n.info.hours:"")})),"manager"==e.state.kind?null:a.createElement(a.Fragment,null,a.createElement(ue.Z,{style:{textAlign:"center",minWidth:70,cursor:"pointer"},onClick:function(){e.setState({mainMenuPrice:!0,chooseUser:t.data})}},t.data.price_p_h),a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.dop_bonus),a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.h_price),a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.err_price),a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.my_bonus),1==e.state.show_zp_two||0==e.state.show_zp_two?a.createElement(ue.Z,{style:{textAlign:"center"}},parseInt(t.data.dop_bonus)+parseInt(t.data.dir_price_dop)+parseInt(t.data.h_price)+parseInt(t.data.my_bonus)-parseInt(t.data.err_price)+""):null,a.createElement(ue.Z,{style:{textAlign:"center"}},t.data.given)))}))),a.createElement(Nt.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null),a.createElement(ue.Z,null),"manager"==this.state.kind?null:a.createElement(ue.Z,null),this.state.two.bonus.map((function(e,t){return a.createElement(ue.Z,{className:"min_block min_size",style:{backgroundColor:"cur"==e.type?"#98e38d":"#fff"},key:t},e.res)}))),a.createElement(pe.Z,null,a.createElement(ue.Z,null),a.createElement(ue.Z,null,"Роллов"),"manager"==this.state.kind?null:a.createElement(ue.Z,null),this.state.two.bonus.map((function(e,t){return a.createElement(ue.Z,{className:"min_block min_size",key:t},e.count_rolls)}))),a.createElement(pe.Z,null,a.createElement(ue.Z,null),a.createElement(ue.Z,null,"Пиццы"),"manager"==this.state.kind?null:a.createElement(ue.Z,null),this.state.two.bonus.map((function(e,t){return a.createElement(ue.Z,{className:"min_block min_size",key:t},e.count_pizza)}))),a.createElement(pe.Z,null,a.createElement(ue.Z,null),a.createElement(ue.Z,{className:"min_size"},"Заказы готовились больше 40 минут"),"manager"==this.state.kind?null:a.createElement(ue.Z,null),this.state.two.order_stat.map((function(e,t){return a.createElement(ue.Z,{className:"min_block min_size",key:t},e.count_false)})))))):null))))}}]),b}(a.Component);function qt(){return a.createElement(Gt,null)}n(5584);var Qt=n(7598),Kt=n(6278);function $t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,d.Z)(e);if(t){var i=(0,d.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}var en=function(e){(0,m.Z)(n,e);var t=$t(n);function n(e){var a;return(0,l.Z)(this,n),(a=t.call(this,e)).state={},a}return(0,o.Z)(n,[{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(x.Z,null,this.props.label),a.createElement(Kt.ZP,{format:"YYYY-MM-DD",multiple:!0,sort:!0,style:{width:"100%"},label:this.props.label,value:this.props.value,onChange:this.props.func}))}}]),n}(a.PureComponent),tn=n(7563);function nn(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}function an(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[a,n,i].join(".")}function sn(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate();t.getFullYear(),a.length<2&&(a="0"+a);var i="";switch(parseInt(n)){case 1:i="Января";break;case 2:i="Февраля";break;case 3:i="Марта";break;case 4:i="Апреля";break;case 5:i="Мая";break;case 6:i="Июня";break;case 7:i="Июля";break;case 8:i="Августа";break;case 9:i="Сентября";break;case 10:i="Октября";break;case 11:i="Ноября";break;case 12:i="Декабря"}return[a,i].join(" ")}var rn=function(e){(0,m.Z)(s,e);var t,n,i=$t(s);function s(e){var t;return(0,l.Z)(this,s),t=i.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:tn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1}),t.click=!1}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,modalText:"",points:[],point:0,cities:[],city:0,modalDialog:!1,modalLink:"",where_promo_list:[{id:1,name:"Создать"},{id:2,name:"Создать и показать"},{id:3,name:"Отправить на почту"},{id:4,name:"Отправить в смс"},{id:5,name:"Рассылка смс"},{id:6,name:"Отправить в ЛК (через 8)"},{id:7,name:"Создать сертификат(ы)"},{id:8,name:"Отправить через бота ВК"}],promo_action_list:[],sale_list:[{id:1,name:"На товары"},{id:2,name:"На категории"},{id:3,name:"На все меню (кроме допов и закусок)"}],promo_conditions_list:[{id:1,name:"В корзине есть определенные товар(ы)"},{id:2,name:"В корзине набрана определенная сумма"}],promo_sale_list:[],type_sale_list:[{id:1,name:"В рублях"},{id:2,name:"В процентах"}],date_promo_list:[{id:1,name:"В определенные даты"},{id:2,name:"14 дней с 10:00 до 21:40"},{id:3,name:"14 дней с 00:00 до 23:59"},{id:4,name:"30 дней с 10:00 до 21:40"},{id:5,name:"30 дней с 00:00 до 23:59"}],type_order_list:[{id:1,name:"Все"},{id:2,name:"Доставка"},{id:3,name:"Самовывоз"},{id:4,name:"Зал"}],where_order_list:[{id:1,name:"В городе"},{id:2,name:"На точке"}],promo_prizw_vk:"Привет!\r\nПоздравляем 🎉\r\nПромокод --promo-- на --position--, действует до --endDate--. Активировать можно при заказе на доставку, самовывоз и в кафе.\r\n\r\nОбратите внимание, что за подарочную позицию надо будет заплатить 1 руб, это необходимое условие для получения приза. В промокод не входят соевый соус, имбирь и васаби.\r\n\r\nЗаказы принимаем на сайте --site--\r\n\r\nРежим работы: с 10:00 до 21:30\r\nАдреса наших кафе:\r\n--addrCity--",spamNameSMS:"",auto_text:!0,where_promo:1,promo_name:"",generate_new:!1,count_action:1,promo_action:1,type_sale:3,promo_sale:1,sale_type:2,promo_conditions:2,price_start:0,price_end:0,date_promo:1,date_start:nn(new Date),date_end:nn(new Date),rangeDate:[nn(new Date),nn(new Date)],time_start:"10:00",time_end:"21:30",promo_length:5,promo_count:1,day_1:!0,day_2:!0,day_3:!0,day_4:!0,day_5:!0,day_6:!0,day_7:!0,type_order:1,where_order:1,numberList:"",promo_desc_true:"",promo_desc_false:"",textSMS:"",addItem:null,addItemCount:1,addItemPrice:1,addItemAllPrice:0,itemsAdd:[],itemsAddPrice:[],items:[],cats:[],saleCat:[],saleItem:[],priceItem:null,conditionItems:[],testDate:[],createdPromo:[]},t}return(0,o.Z)(s,[{key:"componentDidMount",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r,l=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all_for_new");case 2:t=e.sent,n=new Date,i=n.getFullYear(),s=n.getMonth()+1,r=n.getDate(),a=i+"-"+(parseInt(s)>9?s:"0"+s)+"-"+(parseInt(r)>9?r:"0"+r),this.setState({points:t.points,cities:t.cities,module_name:t.module_info.name,promo_action_list:t.promo_action_list,promo_sale_list:t.promo_sale_list,date_start:a,date_end:a,items:t.items,cats:t.cats}),document.title=t.module_info.name,setTimeout((function(){l.generateTextDescFalse(),l.generateTextDescTrue()}),300);case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"save",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r,l,o=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.click){e.next=30;break}return this.click=!0,this.setState({createdPromo:[]}),0,t=2==parseInt(this.state.sale_type)?this.state.promo_sale_list.find((function(e){return parseInt(e.id)==parseInt(o.state.promo_sale)})).name:parseInt(this.state.promo_sale),n=[],this.state.conditionItems.map((function(e){n.push(e.id)})),a=[],this.state.saleItem.map((function(e){a.push(e.id)})),i=[],this.state.saleCat.map((function(e){i.push(e.id)})),s=[],this.state.testDate.map((function(e){s.push(new Date(e).toISOString().split("T")[0])})),s=s.join(","),r={spamNameSMS:this.state.spamNameSMS,promo_vk_prize:this.state.promo_prizw_vk,cert_text:this.state.cert_text,addr:this.state.numberList,where_promo:this.state.where_promo,promo_count:this.state.promo_count,promo_len:this.state.promo_length,promo_name:this.state.promo_name,generate:this.state.generate_new?1:0,promo_in_count:this.state.count_action,promo_action:this.state.promo_action,promo_type_sale:this.state.type_sale,count_promo:t,promo_type:this.state.sale_type,promo_conditions:this.state.promo_conditions,promo_summ:this.state.price_start,promo_summ_to:this.state.price_end,promo_when:this.state.date_promo,date_start:this.state.date_start,date_end:this.state.date_end,time_start:this.state.time_start,time_end:this.state.time_end,day_1:this.state.day_1?1:0,day_2:this.state.day_2?1:0,day_3:this.state.day_3?1:0,day_4:this.state.day_4?1:0,day_5:this.state.day_5?1:0,day_6:this.state.day_6?1:0,day_7:this.state.day_7?1:0,promo_type_order:this.state.type_order,promo_where:this.state.where_order,numberList:this.state.numberList,promo_city:this.state.city,promo_point:this.state.point,about_promo_text:this.state.promo_desc_true,condition_promo_text:this.state.promo_desc_false,textSMS:this.state.textSMS,promo_items:JSON.stringify(a),promo_cat:JSON.stringify(i),promo_items_add:JSON.stringify(this.state.itemsAdd),promo_items_sale:JSON.stringify(this.state.itemsAddPrice),promo_conditions_items:JSON.stringify(n),date_between:s},e.next=17,this.getData("save_new_promo",r);case 17:if(l=e.sent,console.log(l),0!=l.st){e.next=23;break}return this.setState({modalDialog:!0,modalText:l.text_err}),setTimeout((function(){o.click=!1}),300),e.abrupt("return");case 23:this.setState({createdPromo:l.promo_text}),1!=parseInt(this.state.where_promo)&&8!=parseInt(this.state.where_promo)||this.setState({modalDialog:!0,modalText:"Создано"}),2==parseInt(this.state.where_promo)&&this.setState({modalDialog:!0,modalText:"Промокоды: "+l.promo_text.join(", ")}),3==parseInt(this.state.where_promo)&&this.setState({modalDialog:!0,modalText:l.text}),4!=parseInt(this.state.where_promo)&&5!=parseInt(this.state.where_promo)&&6!=parseInt(this.state.where_promo)||this.setState({modalDialog:!0,modalText:l.text}),7==parseInt(this.state.where_promo)&&this.setState({modalDialog:!0,modalText:l.text,modalLink:l.link}),setTimeout((function(){o.click=!1}),300);case 30:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeData",value:function(e,t){var n=this;if(this.setState((0,h.Z)({},e,t.target.value)),"date_promo"==e&&(2==t.target.value||3==t.target.value)){var a=new Date,i=new Date;i.setDate(i.getDate()+14),this.setState({rangeDate:[nn(a),nn(i)],date_start:nn(a),date_end:nn(i),time_start:2==t.target.value?"10:00":"00:00",time_end:2==t.target.value?"21:40":"23:59"})}if("date_promo"==e&&(4==t.target.value||5==t.target.value)){var s=new Date,r=new Date;r.setDate(r.getDate()+30),this.setState({rangeDate:[nn(s),nn(r)],date_start:nn(s),date_end:nn(r),time_start:4==t.target.value?"10:00":"00:00",time_end:4==t.target.value?"21:40":"23:59"})}setTimeout((function(){n.generateTextDescFalse(),n.generateTextDescTrue()}),300)}},{key:"changeDataCheck",value:function(e,t){var n=this;this.setState((0,h.Z)({},e,t.target.checked)),setTimeout((function(){n.generateTextDescFalse(),n.generateTextDescTrue()}),300)}},{key:"changeDateRange",value:function(e,t){var n=this;this.setState((0,h.Z)({},e,nn(t))),setTimeout((function(){n.generateTextDescFalse(),n.generateTextDescTrue()}),300)}},{key:"changeDataData",value:function(e,t){var n=this;this.setState((0,h.Z)({},e,t)),setTimeout((function(){n.generateTextDescFalse(),n.generateTextDescTrue()}),300)}},{key:"generateTextDescTrue",value:function(){var e=this;if(this.state.auto_text){var t=this.state.promo_action,n="";if(1==parseInt(t)){var a=this.state.type_sale,i=this.state.sale_type,s=0;if(s=2==parseInt(this.state.sale_type)?s=this.state.promo_sale_list.find((function(t){return parseInt(t.id)==parseInt(e.state.promo_sale)})).name:parseInt(this.state.promo_sale),1==parseInt(a)){var r=this.state.saleItem,l="";r.map((function(e,t){l+=e.name+", "})),n="скидку на "+(l=l.substring(0,l.length-2))+" в размере "+s+(1==parseInt(i)?"руб.":"%")}2==parseInt(a)&&(r=this.state.saleCat,l="",r.map((function(e,t){l+=e.name+", "})),n="скидку на "+(l=l.substring(0,l.length-2))+" в размере "+s+(1==parseInt(i)?"руб.":"%")),3==parseInt(a)&&(n="скидку на всё меню, кроме напитков, соусов, приправ и палочек, в размере "+s+(1==parseInt(i)?"руб.":"%"))}if(2==parseInt(t)){var o="";this.state.itemsAdd.map((function(e,t){0==parseInt(e.price)?o+="бесплатную "+e.name+" "+e.count+"шт. за "+e.price+"руб., ":o+=e.name+" "+e.count+"шт. за "+e.price+"руб., "})),o=o.substring(0,o.length-2),n=1==this.state.itemsAdd.length?"позицию "+o:"позиции "+o}3==parseInt(t)&&(o="",this.state.itemsAddPrice.map((function(e,t){o+=e.name+" по "+e.price+"руб., "})),o=o.substring(0,o.length-2),n=this.state.itemsAddPrice.length-1==1?"позицию "+o:"позиции "+o);var c="Промокод --promo_name--, действует до "+sn(this.state.date_end)+". Заказывай на jacofood.ru!";this.setState({promo_desc_true:n,textSMS:c,cert_text:n})}}},{key:"generateTextDescFalse",value:function(){var e=this;if(this.state.auto_text){var t="",n="";if(console.log(this.state.testDate),this.state.testDate.length>0){var a=[];this.state.testDate.map((function(e){a.push(new Date(e).toISOString().split("T")[0])})),n="(кроме ",a.map((function(e){n+=sn(e)+", "})),n=(n=n.slice(0,-1)).slice(0,-1),n+=")",console.log("text",n)}1==parseInt(this.state.where_order)&&0!=parseInt(this.state.city)&&(t=" в г. "+this.state.cities.find((function(t){return parseInt(t.id)==parseInt(e.state.city)})).name),2==parseInt(this.state.where_order)&&0!=parseInt(this.state.point)&&(t=" в г. "+this.state.points.find((function(t){return parseInt(t.id)==parseInt(e.state.point)})).name);var i="Промокод действует c "+an(this.state.date_start)+" до "+an(this.state.date_end)+" с "+this.state.time_start+" до "+this.state.time_end+" "+n+t;this.setState({promo_desc_false:i})}}},{key:"addItemAdd",value:function(){var e=this,t=this.state.itemsAdd;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.addItem.id)}))){var n=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.addItem.id)}));t.push({item_id:this.state.addItem.id,name:n.name,count:this.state.addItemCount,price:this.state.addItemPrice});var a=0;t.map((function(e){a+=parseInt(e.price)})),this.setState({itemsAdd:t,addItemAllPrice:a})}setTimeout((function(){e.generateTextDescFalse(),e.generateTextDescTrue()}),300)}},{key:"delItemAdd",value:function(e){var t=this,n=this.state.itemsAdd.filter((function(t){return parseInt(t.item_id)!=parseInt(e.item_id)})),a=0;n.map((function(e){a+=parseInt(e.price)})),this.setState({itemsAdd:n,addItemAllPrice:a}),setTimeout((function(){t.generateTextDescFalse(),t.generateTextDescTrue()}),300)}},{key:"priceItemAdd",value:function(){var e=this,t=this.state.itemsAddPrice;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.priceItem.id)}))){var n=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.priceItem.id)}));t.push({id:this.state.priceItem.id,name:n.name,price:this.state.addItemCount}),this.setState({itemsAddPrice:t})}setTimeout((function(){e.generateTextDescFalse(),e.generateTextDescTrue()}),300)}},{key:"delItemPrice",value:function(e){var t=this,n=this.state.itemsAddPrice.filter((function(t){return parseInt(t.item_id)!=parseInt(e.item_id)}));n.map((function(e){parseInt(e.price)})),this.setState({itemsAddPrice:n}),setTimeout((function(){t.generateTextDescFalse(),t.generateTextDescTrue()}),300)}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,modalLink:""})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"Результат операции"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(x.Z,null,this.state.modalText),a.createElement("br",null),a.createElement(x.Z,null,"Созданыне промокоды: ",this.state.createdPromo.join(", ")),a.createElement("br",null),""==this.state.modalLink?null:a.createElement("a",{href:this.state.modalLink,style:{color:"red"}},"Скачать")),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:function(){e.setState({modalDialog:!1})}},"Хорошо"))),a.createElement(D.ZP,{container:!0},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},!0===this.state.generate_new?null:a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.promo_name,func:this.changeData.bind(this,"promo_name"),label:"Название промокода"})),!1===this.state.generate_new?null:a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.promo_length,func:this.changeData.bind(this,"promo_length"),label:"Длина промокода"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{value:this.state.generate_new,func:this.changeDataCheck.bind(this,"generate_new"),label:"Сгенерировать"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.count_action,func:this.changeData.bind(this,"count_action"),label:"Количество активаций"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.promo_count,func:this.changeData.bind(this,"promo_count"),label:"Количество промокодов"}))),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.promo_action_list,value:this.state.promo_action,func:this.changeData.bind(this,"promo_action"),label:"Промокод дает:"}))),1!==parseInt(this.state.promo_action)?null:a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.sale_list,value:this.state.type_sale,func:this.changeData.bind(this,"type_sale"),label:"Скидка"})),1!==parseInt(this.state.type_sale)?null:a.createElement(D.ZP,{item:!0,xs:12,sm:9},a.createElement(Te,{data:this.state.items,value:this.state.saleItem,func:function(t,n){e.changeDataData("saleItem",n)},multiple:!0,label:"Товары"})),2!==parseInt(this.state.type_sale)?null:a.createElement(D.ZP,{item:!0,xs:12,sm:9},a.createElement(Te,{data:this.state.cats,value:this.state.saleCat,func:function(t,n){e.changeDataData("saleCat",n)},multiple:!0,label:"Категории"})),1==parseInt(this.state.sale_type)?a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.promo_sale,func:this.changeData.bind(this,"promo_sale"),label:"Размер скидки"})):a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.promo_sale_list,value:this.state.promo_sale,func:this.changeData.bind(this,"promo_sale"),label:"Размер скидки"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.type_sale_list,value:this.state.sale_type,func:this.changeData.bind(this,"sale_type"),label:"Какая скидка"}))),2!==parseInt(this.state.promo_action)?null:a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Te,{data:this.state.items,value:this.state.addItem,func:function(t,n){e.changeDataData("addItem",n)},label:"Позиция"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.addItemCount,func:this.changeData.bind(this,"addItemCount"),label:"Количество"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.addItemPrice,func:this.changeData.bind(this,"addItemPrice"),label:"Цена за все"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.addItemAdd.bind(this)},"Добавить"))),2!==parseInt(this.state.promo_action)?null:a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Позиция"),a.createElement(ue.Z,null,"Количество"),a.createElement(ue.Z,null,"Цена за все"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,this.state.itemsAdd.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,t.count),a.createElement(ue.Z,null,t.price),a.createElement(ue.Z,null," ",a.createElement(Ue.Z,{onClick:e.delItemAdd.bind(e,t),style:{cursor:"pointer"}})," "))}))),a.createElement(Nt.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null),a.createElement(ue.Z,null),a.createElement(ue.Z,null,this.state.addItemAllPrice),a.createElement(ue.Z,null)))))),3!==parseInt(this.state.promo_action)?null:a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Te,{data:this.state.items,value:this.state.priceItem,func:function(t,n){e.changeDataData("priceItem",n)},label:"Позиция"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.addItemCount,func:this.changeData.bind(this,"addItemCount"),label:"Цена за 1 ед"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.priceItemAdd.bind(this)},"Добавить"))),3!==parseInt(this.state.promo_action)?null:a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Позиция"),a.createElement(ue.Z,null,"Цена за 1 ед"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,this.state.itemsAddPrice.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,t.price),a.createElement(ue.Z,null," ",a.createElement(Ue.Z,{onClick:e.delItemPrice.bind(e,t),style:{cursor:"pointer"}})," "))})))))),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.promo_conditions_list,value:this.state.promo_conditions,func:this.changeData.bind(this,"promo_conditions"),label:"Условие"})),1!==parseInt(this.state.promo_conditions)?null:a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(Te,{data:this.state.items,value:this.state.conditionItems,func:function(t,n){e.changeDataData("conditionItems",n)},multiple:!0,label:"Товары"}))),2!==parseInt(this.state.promo_conditions)?null:a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.price_start,func:this.changeData.bind(this,"price_start"),label:"Сумма от"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.price_end,func:this.changeData.bind(this,"price_end"),label:"Сумма до"})))),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.date_promo_list,value:this.state.date_promo,func:this.changeData.bind(this,"date_promo"),label:"Когда работает промокод"}))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата до",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Oe,{label:"Время от",value:this.state.time_start,func:this.changeData.bind(this,"time_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Oe,{label:"Время до",value:this.state.time_end,func:this.changeData.bind(this,"time_end")}))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(en,{multiple:!1,label:"Кроме дат",value:this.state.testDate,func:this.changeDataData.bind(this,"testDate")}))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{marginTop:20},spacing:3},a.createElement(Me,{value:this.state.day_1,func:this.changeDataCheck.bind(this,"day_1"),label:"Понедельник"}),a.createElement(Me,{value:this.state.day_2,func:this.changeDataCheck.bind(this,"day_2"),label:"Вторник"}),a.createElement(Me,{value:this.state.day_3,func:this.changeDataCheck.bind(this,"day_3"),label:"Среда"}),a.createElement(Me,{value:this.state.day_4,func:this.changeDataCheck.bind(this,"day_4"),label:"Четверг"}),a.createElement(Me,{value:this.state.day_5,func:this.changeDataCheck.bind(this,"day_5"),label:"Пятница"}),a.createElement(Me,{value:this.state.day_6,func:this.changeDataCheck.bind(this,"day_6"),label:"Суббота"}),a.createElement(Me,{value:this.state.day_7,func:this.changeDataCheck.bind(this,"day_7"),label:"Воскресенье"})),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.type_order_list,value:this.state.type_order,func:this.changeData.bind(this,"type_order"),label:"Тип заказа"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.where_order_list,value:this.state.where_order,func:this.changeData.bind(this,"where_order"),label:"Где работает"})),1!==parseInt(this.state.where_order)?null:a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.cities,value:this.state.city,func:this.changeData.bind(this,"city"),label:"Город"})),2!==parseInt(this.state.where_order)?null:a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:this.changeData.bind(this,"point"),label:"Точка"}))),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.where_promo_list,value:this.state.where_promo,func:this.changeData.bind(this,"where_promo"),label:"Что сделать с промокодом"})),1==parseInt(this.state.where_promo)||2==parseInt(this.state.where_promo)?null:5==parseInt(this.state.where_promo)?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement("span",null,"Список номеров для рассылки"),a.createElement(Qt.Z,{"aria-label":"empty textarea",placeholder:"",minRows:3,value:this.state.numberList,onChange:this.changeData.bind(this,"numberList"),label:"Куда отправить",style:{width:"100%"}})):a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.numberList,func:this.changeData.bind(this,"numberList"),label:"Куда отправить"}))),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},8!==parseInt(this.state.where_promo)?null:a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("span",null,"Текст расссылки"),a.createElement(Qt.Z,{"aria-label":"empty textarea",placeholder:"",minRows:3,value:this.state.promo_prizw_vk,onChange:this.changeData.bind(this,"promo_prizw_vk"),style:{width:"100%"}})),5==parseInt(this.state.where_promo)?a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.spamNameSMS,func:this.changeData.bind(this,"spamNameSMS"),label:"Наименование рассылки"})):null,4==parseInt(this.state.where_promo)||5==parseInt(this.state.where_promo)?a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.textSMS,func:this.changeData.bind(this,"textSMS"),label:"Текст СМС ( --promo_name-- )"})):null,7==parseInt(this.state.where_promo)?a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.cert_text,func:this.changeData.bind(this,"cert_text"),label:"Текст для описания сертификата"})):null,a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Me,{value:this.state.auto_text,func:this.changeDataCheck.bind(this,"auto_text"),label:"Авто-текст"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.promo_desc_true,func:this.changeData.bind(this,"promo_desc_true"),label:"Описание промокода после активации (Промокод дает: )"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.promo_desc_false,func:this.changeData.bind(this,"promo_desc_false"),label:"Условие промокода, когда условия не соблюдены"}))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"end",style:{paddingTop:50},spacing:3},a.createElement(J.Z,{variant:"contained",onClick:this.save.bind(this)},"Сохранить"))))}}]),s}(a.Component),ln=function(e){(0,m.Z)(s,e);var t,n,i=$t(s);function s(e){var t;return(0,l.Z)(this,s),t=i.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:tn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1}),t.click=!1}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,modalText:"",points:[],point:0,cities:[],city:0,modalDialog:!1,modalLink:"",where_promo_list:[{id:1,name:"Создать"},{id:2,name:"Создать и показать"},{id:3,name:"Отправить на почту"},{id:4,name:"Отправить в смс"},{id:5,name:"Рассылка смс"},{id:6,name:"Отправить в ЛК (через 8)"},{id:7,name:"Создать сертификат(ы)"}],promo_action_list:[],sale_list:[{id:1,name:"На товары"},{id:2,name:"На категории"},{id:3,name:"На все меню (кроме допов и закусок)"}],promo_conditions_list:[{id:1,name:"В корзине есть определенные товар(ы)"},{id:2,name:"В корзине набрана определенная сумма"}],promo_sale_list:[],type_sale_list:[{id:1,name:"В рублях"},{id:2,name:"В процентах"}],date_promo_list:[{id:1,name:"В определенные даты"},{id:2,name:"14 дней с 10:00 до 21:40"},{id:3,name:"14 дней с 00:00 до 23:59"},{id:4,name:"30 дней с 10:00 до 21:40"},{id:5,name:"30 дней с 00:00 до 23:59"}],type_order_list:[{id:1,name:"Все"},{id:2,name:"Доставка"},{id:3,name:"Самовывоз"},{id:4,name:"Зал"}],where_order_list:[{id:1,name:"В городе"},{id:2,name:"На точке"}],auto_text:!1,where_promo:1,promo_name:"",generate_new:!1,count_action:1,promo_action:1,type_sale:3,promo_sale:1,sale_type:2,promo_conditions:2,price_start:0,price_end:0,date_promo:1,date_start:nn(new Date),date_end:nn(new Date),rangeDate:[nn(new Date),nn(new Date)],time_start:"10:00",time_end:"21:30",promo_length:5,promo_count:1,day_1:!0,day_2:!0,day_3:!0,day_4:!0,day_5:!0,day_6:!0,day_7:!0,type_order:1,where_order:1,numberList:"",promo_desc_true:"",promo_desc_false:"",textSMS:"",addItem:1,addItemCount:1,addItemPrice:1,addItemAllPrice:0,itemsAdd:[],itemsAddPrice:[],items:[],cats:[],saleCat:[],saleItem:[],priceItem:1,conditionItems:[],testDate:[]},t}return(0,o.Z)(s,[{key:"componentDidMount",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={promo_id:this.props.promoId},e.next=3,this.getData("get_all_for_edit",t);case 3:n=e.sent,a=[],n.promo.promo_conditions_items.length>4&&(n.promo.promo_conditions_items=JSON.parse(n.promo.promo_conditions_items,!0),n.promo.promo_conditions_items.map((function(e){var t=n.items.find((function(t){return parseInt(t.id)==parseInt(e)}));a.push(t)}))),setTimeout((function(){console.log("conditionItems",a),console.log("items",n.items);var e=[];n.limit.map((function(t){e.push(new Date(t.date))})),i.setState({points:n.points,cities:n.cities,module_name:n.module_info.name,promo_action_list:n.promo_action_list,promo_sale_list:n.promo_sale_list,date_start:n.promo.date1,date_end:n.promo.date2,time_start:n.promo.time1,time_end:n.promo.time2,rangeDate:[n.promo.date1,n.promo.date2],items:n.items,cats:n.cats,day_1:1==parseInt(n.promo.d1),day_2:1==parseInt(n.promo.d2),day_3:1==parseInt(n.promo.d3),day_4:1==parseInt(n.promo.d4),day_5:1==parseInt(n.promo.d5),day_6:1==parseInt(n.promo.d6),day_7:1==parseInt(n.promo.d7),count_action:n.promo.count,promo_name:n.promo.name,price_start:n.promo.promo_summ,price_end:n.promo.promo_summ_to,conditionItems:a,promo_conditions:a.length>0?1:2,point:n.promo.point_id,city:n.promo.city_id,where_order:parseInt(n.promo.city_id)>0?1:parseInt(n.promo.point_id)>0?2:1,type_order:n.promo.type_order,promo_desc_true:n.promo.coment,promo_desc_false:n.promo.condition_text,promo_id:n.promo.id,testDate:e})}),300),document.title=n.module_info.name,setTimeout((function(){i.generateTextDescFalse(),i.generateTextDescTrue()}),300);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"save",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r,l=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.click){e.next=16;break}return this.click=!0,t=[],this.state.conditionItems.map((function(e){t.push(e.id)})),n=[],a=[],i=[],this.state.testDate.map((function(e){i.push(new Date(e).toISOString().split("T")[0])})),i=i.join(","),s={promo_id:this.state.promo_id,cert_text:this.state.cert_text,addr:this.state.numberList,where_promo:this.state.where_promo,promo_count:this.state.promo_count,promo_len:this.state.promo_length,promo_name:this.state.promo_name,generate:this.state.generate_new?1:0,promo_in_count:this.state.count_action,promo_action:this.state.promo_action,promo_type_sale:this.state.type_sale,promo_type:this.state.sale_type,promo_conditions:this.state.promo_conditions,promo_summ:this.state.price_start,promo_summ_to:this.state.price_end,promo_when:this.state.date_promo,date_start:this.state.date_start,date_end:this.state.date_end,time_start:this.state.time_start,time_end:this.state.time_end,day_1:this.state.day_1?1:0,day_2:this.state.day_2?1:0,day_3:this.state.day_3?1:0,day_4:this.state.day_4?1:0,day_5:this.state.day_5?1:0,day_6:this.state.day_6?1:0,day_7:this.state.day_7?1:0,promo_type_order:this.state.type_order,promo_where:this.state.where_order,numberList:this.state.numberList,promo_city:this.state.city,promo_point:this.state.point,about_promo_text:this.state.promo_desc_true,condition_promo_text:this.state.promo_desc_false,textSMS:this.state.textSMS,promo_items:JSON.stringify(n),promo_cat:JSON.stringify(a),promo_items_add:JSON.stringify(this.state.itemsAdd),promo_items_sale:JSON.stringify(this.state.itemsAddPrice),promo_conditions_items:JSON.stringify(t),date_between:i},e.next=12,this.getData("save_edit_promo",s);case 12:r=e.sent,console.log(r),this.setState({modalDialog:!0,modalText:r.text}),setTimeout((function(){l.click=!1}),300);case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeData",value:function(e,t){var n=this;if(this.setState((0,h.Z)({},e,t.target.value)),"date_promo"==e&&(2==t.target.value||3==t.target.value)){var a=new Date,i=new Date;i.setDate(i.getDate()+14),this.setState({rangeDate:[nn(a),nn(i)],date_start:nn(a),date_end:nn(i),time_start:2==t.target.value?"10:00":"00:00",time_end:2==t.target.value?"21:40":"23:59"})}if("date_promo"==e&&(4==t.target.value||5==t.target.value)){var s=new Date,r=new Date;r.setDate(r.getDate()+30),this.setState({rangeDate:[nn(s),nn(r)],date_start:nn(s),date_end:nn(r),time_start:4==t.target.value?"10:00":"00:00",time_end:4==t.target.value?"21:40":"23:59"})}setTimeout((function(){n.generateTextDescFalse(),n.generateTextDescTrue()}),300)}},{key:"changeDataCheck",value:function(e,t){var n=this;this.setState((0,h.Z)({},e,t.target.checked)),setTimeout((function(){n.generateTextDescFalse(),n.generateTextDescTrue()}),300)}},{key:"changeDateRange",value:function(e,t){var n=this;this.setState((0,h.Z)({},e,nn(t))),setTimeout((function(){n.generateTextDescFalse(),n.generateTextDescTrue()}),300)}},{key:"changeDataData",value:function(e,t){var n=this;this.setState((0,h.Z)({},e,t)),setTimeout((function(){n.generateTextDescFalse(),n.generateTextDescTrue()}),300)}},{key:"generateTextDescTrue",value:function(){var e=this;if(this.state.auto_text){var t=this.state.promo_action,n="";if(1==parseInt(t)){var a=this.state.type_sale,i=this.state.promo_sale_list.find((function(t){return parseInt(t.id)==parseInt(e.state.promo_sale)})).name,s=this.state.sale_type;if(1==parseInt(a)){var r=this.state.saleItem,l="";r.map((function(e,t){l+=e.name+", "})),n="скидку на "+(l=l.substring(0,l.length-2))+" в размере "+i+(1==parseInt(s)?"руб.":"%")}2==parseInt(a)&&(r=this.state.saleCat,l="",r.map((function(e,t){l+=e.name+", "})),n="скидку на "+(l=l.substring(0,l.length-2))+" в размере "+i+(1==parseInt(s)?"руб.":"%")),3==parseInt(a)&&(n="скидку на всё меню, кроме напитков, соусов, приправ и палочек, в размере "+i+(1==parseInt(s)?"руб.":"%"))}if(2==parseInt(t)){var o="";this.state.itemsAdd.map((function(e,t){0==parseInt(e.price)?o+="бесплатную "+e.name+" "+e.count+"шт. за "+e.price+"руб., ":o+=e.name+" "+e.count+"шт. за "+e.price+"руб., "})),o=o.substring(0,item.length-2),n=1==this.state.itemsAdd.length?"позицию "+o:"позиции "+o}3==parseInt(t)&&(o="",this.state.promo_items_sale.map((function(e,t){o+=e.name+" по "+e.price+"руб., "})),o=o.substring(0,o.length-2),n=this.state.promo_items_sale.length-1==1?"позицию "+o:"позиции "+o);var c="Промокод --promo_name--, действует до "+sn(this.state.date_end)+". Заказывай на jacofood.ru!";this.setState({promo_desc_true:n,textSMS:c,cert_text:n})}}},{key:"generateTextDescFalse",value:function(){var e=this;if(this.state.auto_text){var t="";1==parseInt(this.state.where_order)&&0!=parseInt(this.state.city)&&(t=" в г. "+this.state.cities.find((function(t){return parseInt(t.id)==parseInt(e.state.city)})).name),2==parseInt(this.state.where_order)&&0!=parseInt(this.state.point)&&(t=" в г. "+this.state.points.find((function(t){return parseInt(t.id)==parseInt(e.state.point)})).name);var n="Промокод действует c "+an(this.state.date_start)+" до "+an(this.state.date_end)+" с "+this.state.time_start+" до "+this.state.time_end+t;this.setState({promo_desc_false:n})}}},{key:"addItemAdd",value:function(){var e=this,t=this.state.itemsAdd;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.addItem)}))){var n=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.addItem)}));t.push({item_id:this.state.addItem,name:n.name,count:this.state.addItemCount,price:this.state.addItemPrice});var a=0;t.map((function(e){a+=parseInt(e.price)})),this.setState({itemsAdd:t,addItemAllPrice:a})}}},{key:"priceItemAdd",value:function(){var e=this,t=this.state.itemsAddPrice;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.priceItem)}))){var n=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.priceItem)}));t.push({id:this.state.priceItem,name:n.name,price:this.state.addItemCount}),this.setState({itemsAddPrice:t})}}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,modalLink:""})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"Результат операции"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(x.Z,null,this.state.modalText),a.createElement("br",null),""==this.state.modalLink?null:a.createElement("a",{href:this.state.modalLink,style:{color:"red"}},"Скачать")),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:function(){e.setState({modalDialog:!1})}},"Хорошо"))),a.createElement(D.ZP,{container:!0},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(x.Z,null,"Промокод: ",this.state.promo_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.count_action,func:this.changeData.bind(this,"count_action"),label:"Количество активаций"}))),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.promo_conditions_list,value:this.state.promo_conditions,func:this.changeData.bind(this,"promo_conditions"),label:"Условие"})),1!==parseInt(this.state.promo_conditions)?null:a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(Te,{data:this.state.items,value:this.state.conditionItems,func:function(t,n){e.changeDataData("conditionItems",n)},multiple:!0,label:"Товары"}))),2!==parseInt(this.state.promo_conditions)?null:a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.price_start,func:this.changeData.bind(this,"price_start"),label:"Сумма от"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.price_end,func:this.changeData.bind(this,"price_end"),label:"Сумма до"})))),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.date_promo_list,value:this.state.date_promo,func:this.changeData.bind(this,"date_promo"),label:"Когда работает промокод"}))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата до",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Oe,{label:"Время от",value:this.state.time_start,func:this.changeData.bind(this,"time_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Oe,{label:"Время до",value:this.state.time_end,func:this.changeData.bind(this,"time_end")}))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(en,{multiple:!1,label:"Кроме дат",value:this.state.testDate,func:this.changeDataData.bind(this,"testDate")}))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{marginTop:20},spacing:3},a.createElement(Me,{value:this.state.day_1,func:this.changeDataCheck.bind(this,"day_1"),label:"Понедельник"}),a.createElement(Me,{value:this.state.day_2,func:this.changeDataCheck.bind(this,"day_2"),label:"Вторник"}),a.createElement(Me,{value:this.state.day_3,func:this.changeDataCheck.bind(this,"day_3"),label:"Среда"}),a.createElement(Me,{value:this.state.day_4,func:this.changeDataCheck.bind(this,"day_4"),label:"Четверг"}),a.createElement(Me,{value:this.state.day_5,func:this.changeDataCheck.bind(this,"day_5"),label:"Пятница"}),a.createElement(Me,{value:this.state.day_6,func:this.changeDataCheck.bind(this,"day_6"),label:"Суббота"}),a.createElement(Me,{value:this.state.day_7,func:this.changeDataCheck.bind(this,"day_7"),label:"Воскресенье"})),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.type_order_list,value:this.state.type_order,func:this.changeData.bind(this,"type_order"),label:"Тип заказа"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.where_order_list,value:this.state.where_order,func:this.changeData.bind(this,"where_order"),label:"Где работает"})),1!==parseInt(this.state.where_order)?null:a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.cities,value:this.state.city,func:this.changeData.bind(this,"city"),label:"Город"})),2!==parseInt(this.state.where_order)?null:a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:this.changeData.bind(this,"point"),label:"Точка"}))),a.createElement(w.Z,{style:{width:"100%",marginTop:20}}),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.promo_desc_true,func:this.changeData.bind(this,"promo_desc_true"),label:"Описание промокода после активации (Промокод дает: )"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.promo_desc_false,func:this.changeData.bind(this,"promo_desc_false"),label:"Условие промокода, когда условия не соблюдены"}))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"end",style:{paddingTop:50},spacing:3},a.createElement(J.Z,{variant:"contained",onClick:this.save.bind(this)},"Сохранить"))))}}]),s}(a.Component),on=function(e){(0,m.Z)(u,e);var t,n,i,s=$t(u);function u(e){var t;return(0,l.Z)(this,u),t=s.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:tn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1})}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,modalText:"",modalDialog:!1,modalLink:"",city_list:[],city_id:0,promoName:"",findPromoList:[]},t}return(0,o.Z)(u,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,city_list:t.all_city_list}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"showPromoList",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={city_id:this.state.city_id,promo_name:this.state.promoName},e.next=3,this.getData("search_promo",t);case 3:n=e.sent,console.log(n),this.setState({findPromoList:n});case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"delPromo",value:(t=(0,r.Z)(f().mark((function e(t){var n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("Удалить промокод ?")){e.next=7;break}return n={promo_id:t},e.next=5,this.getData("remove_promo",n);case 5:e.sent,setTimeout((function(){a.showPromoList()}),300);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,modalLink:""})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{id:"alert-dialog-title"},"Результат операции"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(x.Z,null,this.state.modalText),a.createElement("br",null),""==this.state.modalLink?null:a.createElement("a",{href:this.state.modalLink,style:{color:"red"}},"Скачать")),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:function(){e.setState({modalDialog:!1})}},"Хорошо"))),a.createElement(D.ZP,{container:!0},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(z.OL,{to:"/site_sale_2/new",style:{zIndex:10}},a.createElement(J.Z,{variant:"contained"},"Новый промокод")),a.createElement(z.OL,{to:"/site_sale_2/stat",style:{zIndex:10,marginLeft:20}},a.createElement(J.Z,{variant:"contained"},"Статистика")),a.createElement(z.OL,{to:"/site_sale_2/stat_list",style:{zIndex:10,marginLeft:20}},a.createElement(J.Z,{variant:"contained"},"Выписанные промокоды"))),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.city_list,value:this.state.city_id,func:function(t){e.setState({city_id:t.target.value})},label:"Город"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.promoName,func:function(t){e.setState({promoName:t.target.value})},label:"Промокод"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(J.Z,{variant:"contained",onClick:this.showPromoList.bind(this)},"Найти"))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Промокод"),a.createElement(ue.Z,null,"Город"),a.createElement(ue.Z,null,"Было кол-во"),a.createElement(ue.Z,null,"Ост. кол-во"),a.createElement(ue.Z,null,"Дата окончания"),a.createElement(ue.Z,null,"Описание"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,this.state.findPromoList.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,a.createElement(z.OL,{to:"/site_sale_2/edit/"+t.id,style:{zIndex:10}},t.name)),a.createElement(ue.Z,null,0==parseInt(t.city_id)?"Все города":t.city_name),a.createElement(ue.Z,null,t.def_count),a.createElement(ue.Z,null,t.count),a.createElement(ue.Z,null,t.date2),a.createElement(ue.Z,null,t.coment),a.createElement(ue.Z,null," ",a.createElement(Ue.Z,{style:{cursor:"pointer"},onClick:e.delPromo.bind(e,t.id)})," "))}))))))))}}]),u}(a.Component),cn=function(e){(0,m.Z)(s,e);var t,n,i=$t(s);function s(e){var t;return(0,l.Z)(this,s),t=i.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:tn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1})}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,spam_list:[],spam_id:0,findPromoList:[],spam_list_data:[],spam_list_data_stat:{true:0,all:0,percent:0}},t}return(0,o.Z)(s,[{key:"componentDidMount",value:(n=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_spam_list");case 2:t=e.sent,console.log(t),this.setState({module_name:t.module_info.name,spam_list:t.spam_list}),document.title=t.module_info.name;case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"show",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={spam_id:this.state.spam_id},e.next=3,this.getData("get_spam_data",t);case 3:n=e.sent,console.log(n),this.setState({spam_list_data:n.spam_list,spam_list_data_stat:n.stat});case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeSpam",value:function(e){var t=this;this.setState({spam_id:e.target.value}),setTimeout((function(){t.show()}),300)}},{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{container:!0,direction:"row",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.spam_list,value:this.state.spam_id,func:this.changeSpam.bind(this),label:"Рассылка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(J.Z,{variant:"contained",onClick:this.show.bind(this)},"Обновить"))),a.createElement(D.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:6},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Всего"),a.createElement(ue.Z,null,"Использовали"),a.createElement(ue.Z,null,"%"))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,this.state.spam_list_data_stat.all),a.createElement(ue.Z,null,this.state.spam_list_data_stat.true),a.createElement(ue.Z,null,this.state.spam_list_data_stat.percent))))),a.createElement(D.ZP,{item:!0,xs:6},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"#"),a.createElement(ue.Z,null,"Номер"),a.createElement(ue.Z,null,"Ост активаций"))),a.createElement(me.Z,null,this.state.spam_list_data.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,t+1),a.createElement(ue.Z,null,e.number),a.createElement(ue.Z,null,e.count))}))))))))}}]),s}(a.Component),mn=function(e){(0,m.Z)(u,e);var t,n,i,s=$t(u);function u(e){var t;return(0,l.Z)(this,u),t=s.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:tn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1})}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,date_start:nn(new Date),date_end:nn(new Date),rangeDate:[nn(new Date),nn(new Date)],promo_list:[]},t}return(0,o.Z)(u,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_spam_list");case 2:t=e.sent,console.log(t),this.setState({module_name:t.module_info.name,spam_list:t.spam_list}),document.title=t.module_info.name;case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"show",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={spam_id:this.state.spam_id},e.next=3,this.getData("get_spam_data",t);case 3:n=e.sent,console.log(n),this.setState({spam_list_data:n.spam_list,spam_list_data_stat:n.stat});case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getUsers",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={dateStart:this.state.date_start,dateEnd:this.state.date_end},e.next=3,this.getData("get_promo_users",t);case 3:n=e.sent,this.setState({promo_list:n.promo_list});case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeDateRange",value:function(e){var t=e[0]?nn(e[0]):"",n=e[1]?nn(e[1]):"";this.setState({rangeDate:[t,n],date_start:t,date_end:n})}},{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{container:!0,direction:"row",style:{paddingTop:20},spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6,className:"MyDaterange"},a.createElement(Ce,{startText:"Дата от",endText:"Дата до",value:this.state.rangeDate,func:this.changeDateRange.bind(this)})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.getUsers.bind(this)},"Обновить"))),a.createElement(D.ZP,{item:!0,xs:12,sm:12,style:{marginTop:20}},this.state.promo_list.map((function(e,t){return a.createElement(T.Z,{key:t,style:{width:"100%"}},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null)},a.createElement(x.Z,null,e.name)),a.createElement(N.Z,null,a.createElement(ce.Z,{size:"small",style:{marginTop:15}},a.createElement(me.Z,null,e.promo_list.map((function(e,t){return a.createElement(pe.Z,{key:t,style:{backgroundColor:1==parseInt(e.is_delete)?"#c03":"white",color:1==parseInt(e.is_delete)?"white":"black"}},a.createElement(ue.Z,{style:{color:"inherit"}},t+1),a.createElement(ue.Z,{style:{color:"inherit",backgroundColor:0==parseInt(e.count)?"green":"#c03"}},e.name),a.createElement(ue.Z,{style:{color:"inherit"}},e.coment),a.createElement(ue.Z,{style:{color:"inherit"}},0==parseInt(e.count)?a.createElement(Wt.Z,null):a.createElement(Ue.Z,null)))}))))))})))))}}]),u}(a.Component);function un(){return a.createElement(rn,null)}function dn(){var e=(0,F.UO)().promoId;return a.createElement(ln,{promoId:e})}function hn(){return a.createElement(on,null)}function pn(){return a.createElement(cn,null)}function fn(){return a.createElement(mn,null)}n(3208);var En=n(7563),_n=function(e){(0,m.Z)(E,e);var t,n,i,s,p=(i=E,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(i);if(s){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function E(e){var t;return(0,l.Z)(this,E),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"map",null),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:En.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"drive_map_stat_all",module_name:"",is_load:!1,points:[],point:"0",drivers:[]},t}return(0,o.Z)(E,[{key:"componentDidMount",value:(n=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({points:t.point_list,point:t.point_list[0].id,module_name:t.module_info.name}),document.title=t.module_info.name,setTimeout((function(){}),100);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"changePoint",value:function(e){var t=this,n=e.target.value;this.setState({point:n}),setTimeout((function(){t.updateData()}),50)}},{key:"updateData",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point},e.next=3,this.getData("get_orders",t);case 3:n=e.sent,this.getOrders(n.orders,n.home,n.drivers),this.setState({drivers:n.drivers}),console.log(n.drivers);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getOrders",value:function(e,t,n){var a=this,i=new ymaps.ObjectManager;if(this.map){var s={type:"FeatureCollection",features:[]};s.features.push({type:"Feature",id:0,options:{preset:"islands#blackDotIcon",iconColor:"black"},geometry:{type:"Point",coordinates:[t.latitude,t.longitude]}}),e.map((function(e){s.features.push({type:"Feature",id:e.id,options:{preset:6==parseInt(e.status_order)?"islands#blueCircleDotIconWithCaption":"islands#circleDotIcon",iconColor:e.point_color?e.point_color:e.color},properties:{iconCaption:e.point_text},geometry:{type:"Point",coordinates:[e.xy.latitude,e.xy.longitude]}})})),i.add(s),n.map((function(e){e.positions.map((function(t,n){t.xy=JSON.parse(t.xy,!0),s.features.push({type:"Feature",id:t.id,options:{preset:"islands#stretchyIcon",iconColor:e.color},properties:{iconContent:n},geometry:{type:"Point",coordinates:[t.xy[0],t.xy[1]]}})}))})),i.add(s),this.map.geoObjects.removeAll(),this.map.geoObjects.add(i)}else ymaps.ready((function(){a.map=new ymaps.Map("map",{center:[t.latitude,t.longitude],zoom:11},{searchControlProvider:"yandex#search"});var s=new ymaps.GeoObject({geometry:{type:"Point",coordinates:[t.latitude,t.longitude]}},{preset:"islands#blackDotIcon",iconColor:"black"});a.map.geoObjects.add(s);var r={type:"FeatureCollection",features:[]};e.map((function(e){r.features.push({type:"Feature",id:e.id,options:{preset:6==parseInt(e.status_order)?"islands#blueCircleDotIconWithCaption":"islands#circleDotIcon",iconColor:e.point_color?e.point_color:e.color},properties:{iconCaption:e.point_text},geometry:{type:"Point",coordinates:[e.xy.latitude,e.xy.longitude]}})})),i.add(r),n.map((function(e){e.positions.map((function(t,n){t.xy=JSON.parse(t.xy,!0),r.features.push({type:"Feature",id:t.id,options:{preset:"islands#stretchyIcon",iconColor:e.color},properties:{iconContent:n},geometry:{type:"Point",coordinates:[t.xy[0],t.xy[1]]}})}))})),i.add(r),a.map.geoObjects.add(i)}))}},{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(W.Z,{open:this.state.is_load,style:{zIndex:99}},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:6,sm:6},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:6,sm:6},a.createElement(J.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),a.createElement(D.ZP,{item:!0,xs:12,sm:12},this.state.drivers.map((function(e,t){return a.createElement("div",{key:t,style:{display:"flex",flexDirection:"row",alignItems:"center"}},a.createElement("div",{style:{width:50,height:20,backgroundColor:e.color}}),a.createElement("div",null,e.driver_name))}))),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("div",{id:"map",name:"map",style:{width:"100%",height:700,paddingTop:10}}))))}}]),E}(a.Component);function gn(){return a.createElement(_n,null)}n(1574);var Zn=n(7563);function vn(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}var yn=function(e){(0,m.Z)(v,e);var t,n,i,s,p,E,_,g,Z=(_=v,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(_);if(g){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function v(e){var t;return(0,l.Z)(this,v),t=Z.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Zn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"driver_stat",module_name:"",is_load:!1,points:[],point:"0",date_start:vn(new Date),date_end:vn(new Date),rangeDate:[vn(new Date),vn(new Date)],modalDialog:!1,drive_stat_full:[],drive_stat_date:null,summ:0,choose_driver_id:0,check_cash:0,getSumm:0,modalDialogGetSumm:!1,getSummDriverId:null,getSummComment:"",modalDialogStatSumm:!1,modalDialogStatSummMain:!1,statSumm:[],statSummMain:[]},t}return(0,o.Z)(v,[{key:"componentDidMount",value:(E=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,console.log(t),this.setState({points:t.points,point:t.points[0].id,module_name:t.module_info.name}),document.title=t.module_info.name,setTimeout((function(){n.updateData()}),50);case 7:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"updateData",value:(p=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point,date_start:this.state.date_start,date_end:this.state.date_end},e.next=3,this.getData("get_data",t);case 3:n=e.sent,console.log(n),this.setState({drive_stat_full:n.drive_stat_full,drive_stat_date:n.stat_drive_date});case 6:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"changeDate",value:function(e,t){this.setState((0,h.Z)({},e,vn(t)))}},{key:"changePoint",value:function(e){var t=e.target.value;this.setState({point:t})}},{key:"giveCash",value:function(e,t){this.setState({modalDialog:!0,choose_driver_id:e,check_cash:t})}},{key:"changeSumm",value:function(e){this.setState({summ:e.target.value})}},{key:"saveGivePrice",value:(s=(0,r.Z)(f().mark((function e(){var t,n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.click){e.next=2;break}return e.abrupt("return");case 2:if(this.click=!0,!(parseInt(this.state.summ)>parseInt(this.state.check_cash))){e.next=7;break}return alert("Нельзя сдать денег больше, чем есть у курьера"),setTimeout((function(){a.click=!1}),300),e.abrupt("return");case 7:return t={point_id:this.state.point,price:this.state.summ,driver_id:this.state.choose_driver_id},e.next=10,this.getData("save_give",t);case 10:n=e.sent,console.log(n),1==n.st?(this.setState({modalDialog:!1,check_cash:0,choose_driver_id:0,summ:0}),this.updateData()):alert(n.text),setTimeout((function(){a.click=!1}),300);case 14:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getCash",value:function(e){this.setState({modalDialogGetSumm:!0,getSumm:0,getSummDriverId:e,getSummComment:""})}},{key:"saveGetPrice",value:(i=(0,r.Z)(f().mark((function e(){var t,n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.click){e.next=2;break}return e.abrupt("return");case 2:if(this.click=!0,!(parseInt(this.state.getSumm)>1e3)){e.next=7;break}return alert("Нельзя выдать больше 1000р за раз"),setTimeout((function(){a.click=!1}),300),e.abrupt("return");case 7:return t={point_id:this.state.point,price:this.state.getSumm,driver_id:this.state.getSummDriverId.driver_id,comment:this.state.getSummComment},e.next=10,this.getData("save_get",t);case 10:n=e.sent,console.log(n),1==n.st?(this.setState({modalDialogGetSumm:!1,getSumm:0,getSummDriverId:null,getSummComment:""}),this.updateData()):alert(n.text),setTimeout((function(){a.click=!1}),300);case 14:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getStatDop",value:(n=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={point_id:this.state.point,driver_id:t.driver_id,date_start:this.state.date_start,date_end:this.state.date_end},e.next=3,this.getData("getStatDop",n);case 3:a=e.sent,console.log(a),this.setState({modalDialogStatSumm:!0,statSumm:a,getSummDriverId:t});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getStatDopMain",value:(t=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={point_id:this.state.point,driver_id:t.driver_id,date_start:this.state.date_start,date_end:this.state.date_end},e.next=3,this.getData("getStatDopMain",n);case 3:a=e.sent,console.log(a),this.setState({modalDialogStatSummMain:!0,statSummMain:a,getSummDriverId:t});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,check_cash:0,choose_driver_id:0,summ:0})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,null,"Какую сумму сдает курьер"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(Ne,{label:"",value:this.state.summ,func:this.changeSumm.bind(this)})),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:this.saveGivePrice.bind(this)},"Сохранить"))),a.createElement(G.Z,{open:this.state.modalDialogGetSumm,onClose:function(){e.setState({modalDialogGetSumm:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,null,'Дополнительная выплата курьеру "',this.state.getSummDriverId?this.state.getSummDriverId.name:"",'"'),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{type:"number",value:this.state.getSumm,func:function(t){e.setState({getSumm:t.target.value})},label:"Сумма"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{maxRows:2,value:this.state.getSummComment,func:function(t){e.setState({getSummComment:t.target.value})},label:"Комментарий"})))),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:this.saveGetPrice.bind(this)},"Сохранить"))),a.createElement(G.Z,{open:this.state.modalDialogStatSumm,onClose:function(){e.setState({modalDialogStatSumm:!1,getSummDriverId:null})},fullWidth:!0,maxWidth:"md"},a.createElement($.Z,null,'Доп выплаты "',this.state.getSummDriverId?this.state.getSummDriverId.name:"",'"'),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Дата"),a.createElement(ue.Z,null,"Кто назначил"),a.createElement(ue.Z,null,"Сумма"),a.createElement(ue.Z,null,"Комментарий"),a.createElement(ue.Z,null,"Тип"))),a.createElement(me.Z,null,this.state.statSumm.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.date_time),a.createElement(ue.Z,null,e.user_name),a.createElement(ue.Z,null,e.price),a.createElement(ue.Z,null,e.comment),a.createElement(ue.Z,null,parseInt(e.order_id)>0?"Довоз":"Доп выплата"))})))))),a.createElement(G.Z,{open:this.state.modalDialogStatSummMain,onClose:function(){e.setState({modalDialogStatSummMain:!1,getSummDriverId:null})},fullWidth:!0,maxWidth:"md"},a.createElement($.Z,null,'Выплаты "',this.state.getSummDriverId?this.state.getSummDriverId.name:"",'"'),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Заказ"),a.createElement(ue.Z,null,"Дата"),a.createElement(ue.Z,null,"Сумма"),a.createElement(ue.Z,null,"Пользователь"),a.createElement(ue.Z,null,"Тип"))),a.createElement(me.Z,null,this.state.statSummMain.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,0==parseInt(e.order_id)?"":e.order_id),a.createElement(ue.Z,null,e.date_time),a.createElement(ue.Z,null,0==parseInt(e.my_cash)?e.give:e.my_cash),a.createElement(ue.Z,null,0==parseInt(e.order_id)?e.user_name:""),a.createElement(ue.Z,null,0==parseInt(e.order_id)?"Сдал":"С заказа"))})))))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата от",value:this.state.date_start,func:this.changeDate.bind(this,"date_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата до",value:this.state.date_end,func:this.changeDate.bind(this,"date_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Имя"),a.createElement(ue.Z,null,"Вся сумма"),a.createElement(ue.Z,null,"Сумма по налу"),a.createElement(ue.Z,null,"Сумма по безналу"),a.createElement(ue.Z,null,"Кол-во по налу"),a.createElement(ue.Z,null,"Кол-во по безналу"),a.createElement(ue.Z,null,"К сдаче"),a.createElement(ue.Z,null,"Сдал за период"),a.createElement(ue.Z,null,"Довозы"),a.createElement(ue.Z,{style:{display:"none"}},"Ошибки"),a.createElement(ue.Z,null,"-"),a.createElement(ue.Z,null,"Заказы"),a.createElement(ue.Z,null,"Заработал"),a.createElement(ue.Z,null,"Налички на руках"),a.createElement(ue.Z,null),a.createElement(ue.Z,null))),a.createElement(me.Z,null,this.state.drive_stat_full.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,t.full_sum),a.createElement(ue.Z,null,t.full_cash),a.createElement(ue.Z,null,t.full_bank),a.createElement(ue.Z,null,t.count_cash),a.createElement(ue.Z,null,t.count_bank),a.createElement(ue.Z,null,t.sdacha),a.createElement(ue.Z,null,t.give_by_date),a.createElement(ue.Z,null,a.createElement(J.Z,{variant:"contained",onClick:e.getStatDop.bind(e,t),style:{fontWeight:"bolder"}},t.dop_price?t.dop_price:0)),a.createElement(ue.Z,{style:{display:"none"}},t.err_summ),a.createElement(ue.Z,null,t.my_price?t.my_price:0),a.createElement(ue.Z,null,a.createElement(J.Z,{variant:"contained",onClick:e.getStatDopMain.bind(e,t),style:{fontWeight:"bolder"}},t.my_orders?t.my_orders:0)),a.createElement(ue.Z,null,t.my),a.createElement(ue.Z,null,t.ost_cash),a.createElement(ue.Z,null,a.createElement(J.Z,{variant:"contained",onClick:e.giveCash.bind(e,t.driver_id,t.ost_cash)},"Сдать")),a.createElement(ue.Z,null,a.createElement(J.Z,{variant:"contained",onClick:e.getCash.bind(e,t)},"Доп выплата")))})))))),null==this.state.drive_stat_date?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Курьер"),this.state.drive_stat_date.orders.map((function(e,t){return a.createElement(ue.Z,{key:t,colSpan:4,style:{textAlign:"center"}},e.date)}))),a.createElement(pe.Z,null,a.createElement(ue.Z,null),this.state.drive_stat_date.orders.map((function(e,t){return a.createElement(a.Fragment,{key:t},a.createElement(ue.Z,{style:{textAlign:"center"}},"Наличка"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Безнал"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Сдача"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Заработал"))})))),a.createElement(me.Z,null,this.state.drive_stat_date.unic_users.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,{style:{borderRight:"1px solid #eee"}},t.short_name),e.state.drive_stat_date.orders.map((function(e,n){var i=!1,s={};return e.new_users.map((function(n,a){parseInt(n.driver_id)==parseInt(t.driver_id)&&n.date==e.date&&(i=!0,s=n)})),0==i?a.createElement(ue.Z,{key:n,colSpan:4,style:{borderRight:"1px solid #eee"}}):a.createElement(a.Fragment,{key:n},a.createElement(ue.Z,{style:{textAlign:"center"}},s.full_cash),a.createElement(ue.Z,{style:{textAlign:"center"}},s.full_bank),a.createElement(ue.Z,{style:{textAlign:"center"}},s.sdacha),a.createElement(ue.Z,{style:{borderRight:"1px solid #eee",textAlign:"center"}},s.my))})))}))),a.createElement(Nt.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{borderRight:"1px solid #eee"}}),this.state.drive_stat_date.orders.map((function(e,t){return a.createElement(a.Fragment,{key:t},a.createElement(ue.Z,{key:t+"_1",style:{textAlign:"center"}},e.full_cash),a.createElement(ue.Z,{key:t+"_2",style:{textAlign:"center"}},e.full_bank),a.createElement(ue.Z,{key:t+"_3",style:{textAlign:"center"}},e.sdacha),a.createElement(ue.Z,{key:t+"_4",style:{borderRight:"1px solid #eee",textAlign:"center"}},e.my))})))))))))}}]),v}(a.Component);function xn(){return a.createElement(yn,null)}n(6771);var wn=n(8044),bn=n(795),kn=n(8061);var In=n(7563);function Dn(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}ft().node,ft().number.isRequired,ft().number.isRequired;var Pn=function(e){(0,m.Z)(y,e);var t,n,i,p,E,_,g,Z,v=(g=y,Z=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(g);if(Z){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function y(e){var t;return(0,l.Z)(this,y),t=v.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:In.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),(0,h.Z)((0,c.Z)(t),"changeAddr",(function(e){t.setState({typeDel:e.target.value})})),t.state={module:"concenter",module_name:"",is_load:!1,modalDialog:!1,modalDialogDel:!1,cities:[],city_id:1,date:Dn(new Date),point_list:[],need_point_list:[],point_id:0,indexTab:0,orders:[],ordersRender:[],showOrder:null,radiogroup_options:[{id:"0",label:"Решили отредактировать заказ",value:0},{id:"1",label:"Не устраивает время ожидания",value:0},{id:"2",label:"Изменились планы",value:0},{id:"3",label:"Недостаточно средств",value:0},{id:"4",label:"Другое",value:0}],textDel:"",typeDel:-1,number:"",addr:""},t}return(0,o.Z)(y,[{key:"componentDidMount",value:(_=(0,r.Z)(f().mark((function e(){var t,n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,n=t.points.filter((function(e,n){return parseInt(e.city_id)==parseInt(t.cities[0].id)})),this.setState({module_name:t.module_info.name,cities:t.cities,point_list:t.points,need_point_list:n,point_id:parseInt(n[0].id)}),document.title=t.module_info.name,setTimeout((function(){a.getOrders()}),300);case 7:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"changeCity",value:function(e){var t=this;this.setState({number:"",addr:""});var n=e.target.value,a=this.state.point_list.filter((function(e,t){return parseInt(e.city_id)==parseInt(n)}));this.setState({city_id:n,need_point_list:a,point_id:parseInt(a[0].id),indexTab:0}),setTimeout((function(){t.getOrders()}),300)}},{key:"changePoint",value:(E=(0,r.Z)(f().mark((function e(t,n){var a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({point_id:t,indexTab:n}),setTimeout((function(){a.getOrders()}),300);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"getOrders",value:(p=(0,r.Z)(f().mark((function e(){var t,n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point_id,date:this.state.date},e.next=3,this.getData("get_orders",t);case 3:n=e.sent,console.log(n),this.setState({orders:n.orders}),setTimeout((function(){a.filterNumber()}),300);case 7:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"btnGetOrders",value:function(){this.setState({number:"",addr:""}),this.getOrders()}},{key:"showOrder",value:(i=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={point_id:this.state.point_id,order_id:t},e.next=3,this.getData("get_order_new",n);case 3:a=e.sent,console.log(a),this.setState({modalDialog:!0,showOrder:a});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"closeOrder",value:function(){this.setState({modalDialogDel:!0})}},{key:"closeOrderTrue",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("4"==(t=this.state.radiogroup_options.find((function(e){return e.id==i.state.typeDel}))).id&&(t.label=this.state.textDel),!confirm("Отменить заказ #"+this.state.showOrder.order.order_id)){e.next=8;break}return n={typeCreate:"center",order_id:this.state.showOrder.order.order_id,point_id:this.state.showOrder.order.point_id,ans:t.label},e.next=6,this.getData("close_order_center",n);case 6:!0===(a=e.sent).st?(this.setState({modalDialogDel:!1,modalDialog:!1}),this.getOrders()):alert(a.text);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"fakeUser",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0,t=parseInt(this.state.showOrder.order.check_pos)>=0?parseInt(this.state.showOrder.order.check_pos)<=100?1:2:0,0!=parseInt(t)){e.next=5;break}return alert("Создать обращение не возможно"),e.abrupt("return");case 5:if(1!=parseInt(t)){e.next=16;break}if(!((n=prompt("Комментарий к ситуации","")).length>0)){e.next=15;break}return a={text:n,point_id:parseInt(this.state.showOrder.order.point_id),order_id:parseInt(this.state.showOrder.order.order_id)},e.next=11,this.getData("fake_user",a);case 11:1==(i=e.sent).st?(alert("Обращение зафиксировано"),this.setState({modalDialog:!1})):alert(i.text),e.next=16;break;case 15:alert("надо указать комментарий");case 16:if(2!=parseInt(t)){e.next=29;break}if(!confirm("Курьер, предположительно, находиться далеко от клиента, точно оформить довоз ?")){e.next=29;break}if(!((s=prompt("Комментарий к ситуации","")).length>0)){e.next=28;break}return r={text:s,point_id:parseInt(this.state.showOrder.order.point_id),order_id:parseInt(this.state.showOrder.order.order_id)},e.next=24,this.getData("fake_user",r);case 24:1==(l=e.sent).st?(alert("Обращение зафиксировано"),this.setState({modalDialog:!1})):alert(l.text),e.next=29;break;case 28:alert("надо указать комментарий");case 29:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeText",value:function(e){this.setState({textDel:e.target.value})}},{key:"changeDate",value:function(e){var t=this;this.setState({number:"",addr:""}),this.setState({date:Dn(e)}),setTimeout((function(){t.getOrders()}),300)}},{key:"changeNumber",value:function(e){var t=this,n=e.target.value;isNaN(n)||(this.setState({number:n}),setTimeout((function(){t.filterNumber()}),300))}},{key:"changeAddrSt",value:function(e){var t=this,n=e.target.value;this.setState({addr:n}),setTimeout((function(){t.filterNumber()}),300)}},{key:"filterNumber",value:function(){var e=this,t=this.state.orders;this.state.number.length>0&&(t=t.filter((function(t){return-1!==t.number.indexOf(e.state.number)}))),this.state.addr.length>0&&(t=t.filter((function(t){return-1!==(t.street+" "+t.home).toLowerCase().indexOf(e.state.addr.toLowerCase())}))),this.setState({ordersRender:t})}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),this.state.showOrder?a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{style:{textAlign:"center"}},"Заказ #",this.state.showOrder.order.order_id),a.createElement(Q.Z,null,a.createElement(D.ZP,{container:!0,spacing:0},a.createElement(D.ZP,{item:!0,xs:12},a.createElement("span",null,this.state.showOrder.order.type_order,": ",this.state.showOrder.order.type_order_addr_new)),1==parseInt(this.state.showOrder.order.type_order_)&&0==parseInt(this.state.showOrder.order.fake_dom)?a.createElement(D.ZP,{item:!0,xs:12},a.createElement("b",null,"Домофон не работает")):null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement("span",null,this.state.showOrder.order.time_order_name,": ",this.state.showOrder.order.time_order)),this.state.showOrder.order.number.length>1?a.createElement(D.ZP,{item:!0,xs:12},a.createElement("b",null,"Телефон: "),a.createElement("span",null,this.state.showOrder.order.number)):null,this.state.showOrder.order.delete_reason.length>0?a.createElement(D.ZP,{item:!0,xs:12},a.createElement("span",{style:{color:"red"}},"Удален: ",this.state.showOrder.order.date_time_delete)):null,this.state.showOrder.order.delete_reason.length>0?a.createElement(D.ZP,{item:!0,xs:12},a.createElement("span",{style:{color:"red"}},this.state.showOrder.order.delete_reason)):null,1==parseInt(this.state.showOrder.order.is_preorder)?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("span",null,this.state.showOrder.order.text_time,this.state.showOrder.order.time_to_client)),a.createElement(D.ZP,{item:!0,xs:12},a.createElement("span",null,this.state.showOrder.order.textTime)),null==this.state.showOrder.order.promo_name||0==this.state.showOrder.order.promo_name.length?null:a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement("b",null,"Промокод: "),a.createElement("span",null,this.state.showOrder.order.promo_name)),a.createElement(D.ZP,{item:!0,xs:12},a.createElement("span",{className:"noSpace"},this.state.showOrder.order.promo_text))),null==this.state.showOrder.order.comment||0==this.state.showOrder.order.comment.length?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("b",null,"Комментарий: "),a.createElement("span",null,this.state.showOrder.order.comment)),null==this.state.showOrder.order.sdacha||0==parseInt(this.state.showOrder.order.sdacha)?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("b",null,"Сдача: "),a.createElement("span",null,this.state.showOrder.order.sdacha)),a.createElement(D.ZP,{item:!0,xs:12},a.createElement("b",null,"Сумма заказа: "),a.createElement("span",null,this.state.showOrder.order.sum_order," р")),null!=this.state.showOrder.order.check_pos_drive&&this.state.showOrder.order.check_pos_drive?a.createElement(D.ZP,{item:!0,xs:12},a.createElement("b",null,"Довоз оформлен: "),a.createElement("span",null,this.state.showOrder.order.check_pos_drive.comment)):null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement(ce.Z,{size:"small",style:{marginTop:15}},a.createElement(me.Z,null,this.state.showOrder.order_items.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.name),a.createElement(ue.Z,null,e.count),a.createElement(ue.Z,null,e.price," р"))}))),a.createElement(Nt.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{fontWeight:"bold",color:"#000"}},"Сумма закза"),a.createElement(ue.Z,null),a.createElement(ue.Z,{style:{fontWeight:"bold",color:"#000"}},this.state.showOrder.order.sum_order," р"))))),a.createElement(T.Z,{style:{width:"100%"}},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null)},a.createElement(x.Z,null,"Расформировка")),a.createElement(N.Z,null,a.createElement(ce.Z,{size:"small",style:{marginTop:15}},a.createElement(me.Z,null,this.state.showOrder.order_items_.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.name),a.createElement(ue.Z,{style:{backgroundColor:parseInt(e.ready)>0?"#6ab04c":"#eb4d4b"}}))})))))))),0==parseInt(this.state.showOrder.order.is_delete)&&6!==parseInt(this.state.showOrder.order.status_order)?a.createElement(q.Z,{style:{justifyContent:"flex-end",padding:"15px 0px"}},a.createElement(wn.Z,{disableElevation:!0,disableRipple:!0,variant:"contained",className:"BtnBorderOther",style:{marginRight:24}},a.createElement(J.Z,{variant:"contained",className:"BtnCardMain CardInCardItem",onClick:this.closeOrder.bind(this)},"Отменить заказ"))):null,1==parseInt(this.state.showOrder.order.type_order_)&&parseInt(this.state.showOrder.order.status_order)>4&&parseInt(this.state.showOrder.order.check_pos)>=0?a.createElement(q.Z,{style:{justifyContent:"flex-end",padding:"15px 0px"}},a.createElement(wn.Z,{disableElevation:!0,disableRipple:!0,variant:"contained",className:"BtnBorderOther",style:{marginRight:24}},a.createElement(J.Z,{variant:"contained",className:"BtnCardMain CardInCardItemYellow",onClick:this.fakeUser.bind(this)},"Клиент не вышел на связь"))):null):null,this.state.showOrder?a.createElement(G.Z,{open:this.state.modalDialogDel,onClose:function(){e.setState({modalDialogDel:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,{style:{textAlign:"center"}},"Отмена заказа ",this.state.showOrder.order.order_id),a.createElement(Q.Z,null,a.createElement(ge.Z,{component:"fieldset"},a.createElement(kn.Z,{name:"typeDel",value:this.state.typeDel,onChange:this.changeAddr},this.state.radiogroup_options.map((function(e,t){return a.createElement(ye.Z,{key:t,value:e.id,control:a.createElement(bn.Z,null),label:e.label})})))),a.createElement(L.Z,{onFocus:function(){e.setState({typeDel:"4"})},value:this.state.textDel,onChange:this.changeText.bind(this),margin:"dense",id:"name",label:"Причина отмены",type:"text",fullWidth:!0})),a.createElement(q.Z,{style:{paddingBottom:24}},a.createElement(wn.Z,{disableElevation:!0,disableRipple:!0,variant:"contained",className:"BtnBorderOther",style:{marginRight:24}},a.createElement(J.Z,{variant:"contained",className:"BtnCardMain CardInCardItem",onClick:function(){e.setState({delOrder:!1})}},"К заказу")),a.createElement(wn.Z,{disableElevation:!0,disableRipple:!0,variant:"contained",className:"BtnBorderOther",style:{marginRight:24}},a.createElement(J.Z,{variant:"contained",className:"BtnCardMain CardInCardItem",onClick:this.closeOrderTrue.bind(this)},"Отменить заказ")))):null,a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.cities,value:this.state.city_id,func:this.changeCity.bind(this),label:"Город"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата",value:this.state.date,func:this.changeDate.bind(this)})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Номер телефона",value:this.state.number,func:this.changeNumber.bind(this)})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Адрес",value:this.state.addr,func:this.changeAddrSt.bind(this)})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.btnGetOrders.bind(this)},"Обновить")),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(Et.Z,{value:this.state.indexTab},this.state.need_point_list.map((function(t,n){return a.createElement(_t.Z,(0,s.Z)({key:n,label:t.name,onClick:e.changePoint.bind(e,t.id,n)},(i=parseInt(t.id),{id:"simple-tab-".concat(i),"aria-controls":"simple-tabpanel-".concat(i)})));var i})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Заказ"),a.createElement(ue.Z,null,"Оформил"),a.createElement(ue.Z,null,"Номер клиента"),a.createElement(ue.Z,null,"Адрес доставки"),a.createElement(ue.Z,null,"Время открытия заказа"),a.createElement(ue.Z,null,"Ко времени"),a.createElement(ue.Z,null,"Закрыт на кухне"),a.createElement(ue.Z,null,"Получен клиентом"),a.createElement(ue.Z,null,"До просрочки"),a.createElement(ue.Z,null,"Время обещ"),a.createElement(ue.Z,null,"Тип"),a.createElement(ue.Z,null,"Статус"),a.createElement(ue.Z,null,"Сумма"),a.createElement(ue.Z,null,"Оплата"),a.createElement(ue.Z,null,"Водитель"))),a.createElement(me.Z,null,this.state.ordersRender.map((function(t,n){return a.createElement(pe.Z,{key:n,style:1==parseInt(t.is_delete)?{backgroundColor:"red",color:"#fff",fontWeight:"bold"}:{}},a.createElement(ue.Z,{style:parseInt(t.dist)>=0?{backgroundColor:"yellow",color:"#000",cursor:"pointer",fontWeight:"inherit"}:{color:"inherit",cursor:"pointer",fontWeight:"inherit"},onClick:e.showOrder.bind(e,t.id)},t.id),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.type_user),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.number),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.street," ",t.home),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.date_time_order),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit",backgroundColor:1==parseInt(t.is_preorder)?"#bababa":"inherit"}},t.need_time),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},"00:00:00"==t.give_data_time?"":t.give_data_time),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.close_order),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.to_time),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},"0"==t.unix_time_to_client||1==parseInt(t.is_preorder)?"":t.unix_time_to_client),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.type_order),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.status),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.order_price),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.type_pay),a.createElement(ue.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.driver))})))))))}}]),y}(a.Component);function Sn(){return a.createElement(Pn,null)}n(7709);var Cn=n(9669),Tn=n.n(Cn);var An=n(7563),Nn=function(e){(0,m.Z)(_,e);var t,n,i,s,p,E=(s=_,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(s);if(p){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function _(e){var t;return(0,l.Z)(this,_),t=E.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:An.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"socialnetwork",module_name:"",is_load:!1,cityList:[],city_id:0,dataInfo:null,file:null},t}return(0,o.Z)(_,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,cityList:t.cities,city_id:t.cities[0].id}),document.title=t.module_info.name,setTimeout((function(){n.updateData()}),50);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"changeCity",value:function(e){var t=this,n=e.target.value;this.setState({city_id:n,dataInfo:null,file:null}),setTimeout((function(){t.updateData()}),50)}},{key:"updateData",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={city_id:this.state.city_id},e.next=3,this.getData("get_data",t);case 3:n=e.sent,this.setState({dataInfo:n,file:null});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"changeData",value:function(e,t){var n=t.target.value,a=this.state.dataInfo;a[[e]]=n,this.setState({dataInfo:a})}},{key:"saveData",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={city_id:this.state.city_id,vk:this.state.dataInfo.vk,inst:this.state.dataInfo.inst,ok:this.state.dataInfo.ok,tg:this.state.dataInfo.tg,fb:this.state.dataInfo.fb,file1:this.state.file?this.state.file.name:""},e.next=3,this.getData("save_data",t);case 3:e.sent,this.state.file&&(setTimeout((function(){a.setState({is_load:!0})}),350),(n=new FormData).append("file",this.state.file,this.state.file.name),Tn().post("https://jacochef.ru/api/files/v2/upload/upload.php",n).then((function(e){console.log(e),a.setState({is_load:!1,file:null})})).catch((function(e){console.log(e)})));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleFileInput",value:function(e){var t=e.target.files[0];console.log(t),this.setState({file:t})}},{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:6,sm:6},a.createElement(Ae,{data:this.state.cityList,value:this.state.city_id,func:this.changeCity.bind(this),label:"Город"})),null==this.state.dataInfo?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Вконтакте",value:this.state.dataInfo?this.state.dataInfo.vk:"",func:this.changeData.bind(this,"vk")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Инстаграм",value:this.state.dataInfo?this.state.dataInfo.inst:"",func:this.changeData.bind(this,"inst")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Одноклассники",value:this.state.dataInfo?this.state.dataInfo.ok:"",func:this.changeData.bind(this,"ok")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Телеграм",value:this.state.dataInfo?this.state.dataInfo.tg:"",func:this.changeData.bind(this,"tg")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Facebook",value:this.state.dataInfo?this.state.dataInfo.fb:"",func:this.changeData.bind(this,"fb")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{type:"file",label:"",func:this.handleFileInput.bind(this)})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:this.saveData.bind(this)},"Обновить данные"))))))}}]),_}(a.Component);function On(){return a.createElement(Nn,null)}n(9364);var Rn=n(7563),Mn=function(e){(0,m.Z)(_,e);var t,n,i,s,p,E=(s=_,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(s);if(p){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function _(e){var t;return(0,l.Z)(this,_),t=E.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Rn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"cat_work",module_name:"",is_load:!1,cats:[],modalDialog:!1,modalDialogNew:!1,nameCat:"",editText:"",nameCatNew:"",editTextNew:"",config:{readonly:!1},showCat:null},t}return(0,o.Z)(_,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,cats:t.cats}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"openCat",value:function(e){this.setState({modalDialog:!0,showCat:e,nameCat:e.name,editText:e.text})}},{key:"save",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={cat_id:this.state.showCat.id,name:this.state.nameCat,text:document.getElementById("EditorEdit").value},e.next=3,this.getData("save_edit",t);case 3:if(!1!==(n=e.sent).st){e.next=8;break}alert(n.text),e.next=14;break;case 8:return this.setState({modalDialog:!1,showCat:null,nameCat:""}),document.getElementById("EditorEdit").value="",e.next=12,this.getData("get_all");case 12:n=e.sent,this.setState({cats:n.cats});case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"saveNew",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={name:this.state.nameCatNew,text:document.getElementById("EditorNew").value},e.next=3,this.getData("save_new",t);case 3:if(!1!==(n=e.sent).st){e.next=8;break}alert(n.text),e.next=14;break;case 8:return this.setState({modalDialogNew:!1,editTextNew:"",nameCatNew:""}),document.getElementById("EditorNew").value="",e.next=12,this.getData("get_all");case 12:n=e.sent,this.setState({cats:n.cats});case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),this.state.showCat?a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,showCat:null,editText:"",nameCat:""})}},a.createElement($.Z,null,'Категория уборки "',this.state.showCat.name,'"'),a.createElement(Q.Z,{style:{paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.nameCat,func:function(t){e.setState({nameCat:t.target.value})},label:"Название категории"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(ze,{id:"EditorEdit",text:this.state.showCat.text})))),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:this.save.bind(this)},"Сохранить"))):null,a.createElement(G.Z,{open:this.state.modalDialogNew,onClose:function(){e.setState({modalDialogNew:!1,editTextNew:"",nameCatNew:""})}},a.createElement($.Z,null,"Новая категория уборки"),a.createElement(Q.Z,{style:{paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.nameCatNew,func:function(t){e.setState({nameCatNew:t.target.value})},label:"Название категории"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(ze,{id:"EditorNew",text:""})))),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:this.saveNew.bind(this)},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(J.Z,{variant:"contained",color:"primary",onClick:function(){e.setState({modalDialogNew:!0})}},"Добавить категорию")),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Z.Z,{style:{width:"100%"}},this.state.cats.map((function(t,n){return a.createElement(v.ZP,{button:!0,key:n,onClick:e.openCat.bind(e,t)},a.createElement(y.Z,{primary:t.name}))}))))))}}]),_}(a.Component);function zn(){return a.createElement(Mn,null)}n(1819);var Fn=n(6307);var Ln=n(7563),Bn=function(e){(0,m.Z)(_,e);var t,n,i,s,p,E=(s=_,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(s);if(p){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function _(e){var t;return(0,l.Z)(this,_),t=E.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Ln.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"app_work_point",module_name:"",is_load:!1,points:[],point_id:0,apps:[],app_id:0,allList:[],allListRender:[],thisList:[]},t}return(0,o.Z)(_,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,points:t.points,point_id:t.points[0].id,apps:t.apps,app_id:t.apps[0].id}),document.title=t.module_info.name,setTimeout((function(){n.getWorks()}),300);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"changeApp",value:function(e){var t=this;this.setState({app_id:e.target.value}),setTimeout((function(){t.getWorks()}),300)}},{key:"getWorks",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point_id,app_id:this.state.app_id},e.next=3,this.getData("get_works",t);case 3:n=e.sent,console.log(n),this.setState({allList:n.all_work,thisList:n.this_work}),setTimeout((function(){a.checkList()}),300);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"checkList",value:function(){var e=this.state.allList;this.state.thisList.map((function(t){var n=[];e.map((function(e){parseInt(e.id)!=parseInt(t.id)&&n.push(e)})),e=n})),this.setState({allListRender:e})}},{key:"add",value:function(e,t){var n=this,a=this.state.thisList,i=this.state.allList,s=a.find((function(t,n){return parseInt(t.id)==parseInt(e)})),r=i.find((function(t,n){return parseInt(t.id)==parseInt(e)}));s||a.push((0,h.Z)({id:e,name:t,time_min:0,dop_time:0},"time_min",r.time_min)),this.setState({thisList:a}),setTimeout((function(){n.checkList()}),300)}},{key:"del",value:function(e,t){var n=this,a=[];this.state.thisList.map((function(t,n){parseInt(t.id)!=parseInt(e)&&a.push(t)})),this.setState({thisList:a}),setTimeout((function(){n.checkList()}),300)}},{key:"save",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={point_id:this.state.point_id,app_id:this.state.app_id,items:this.state.thisList},n=null,this.state.thisList.map((function(e,t){0==e.dop_time.length&&(n=e)})),console.log(n),!n){e.next=7;break}return alert('У позиции "'+n.name+'" не указано доп время'),e.abrupt("return");case 7:return e.next=9,this.getData("save",t);case 9:a=e.sent,console.log(a),alert(a.text);case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeDopTime",value:function(e,t){var n=t.target.value,a=this.state.thisList;isNaN(n)&&""!=n||(a[e].dop_time=""==n?"":parseInt(n),this.setState({thisList:a}))}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.points,value:this.state.point_id,func:function(t){e.setState({point_id:t.target.value})},label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.apps,value:this.state.app_id,func:this.changeApp.bind(this),label:"Должность"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.getWorks.bind(this)},"Обновить данные")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Z.Z,{style:{width:"100%"}},this.state.allListRender.map((function(t,n){return a.createElement(v.ZP,{key:n,style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(y.Z,{primary:t.name}),a.createElement(Fn.Z,{onClick:e.add.bind(e,t.id,t.name)}))})))),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Наименование"),a.createElement(ue.Z,null,"Основное время"),a.createElement(ue.Z,null,"Доп время (в минутах)"),a.createElement(ue.Z,null,a.createElement(Ue.Z,null)))),a.createElement(me.Z,null,this.state.thisList.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,t.time_min," мин."),a.createElement(ue.Z,null,a.createElement(Ne,{value:t.dop_time,func:e.changeDopTime.bind(e,n),label:""})),a.createElement(ue.Z,null,a.createElement(Ue.Z,{onClick:e.del.bind(e,t.id,t.name),style:{cursor:"pointer"}})))}))))),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.save.bind(this)},"Сохранить"))))}}]),_}(a.Component);function Un(){return a.createElement(Bn,null)}n(5673);var Wn=n(7563),jn=function(e){(0,m.Z)(w,e);var t,n,i,s,p,E,_,g,x=(_=w,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(_);if(g){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function w(e){var t;return(0,l.Z)(this,w),t=x.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Wn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"app_work",module_name:"",is_load:!1,items:[],items_min:[],modalDialog:!1,modalDialogNew:!1,dows:[{id:1,name:"Понедельник"},{id:2,name:"Вторник"},{id:3,name:"Среда"},{id:4,name:"Четверг"},{id:5,name:"Пятница"},{id:6,name:"Суббота"},{id:7,name:"Воскресенье"},{id:10,name:"Другое"},{id:11,name:"Каждый день"},{id:12,name:"Каждый день в конце смены"},{id:13,name:"Ручное добавление"},{id:14,name:"После выполнение уборки"}],types:[{id:0,name:"Другое"},{id:1,name:"Только 1 активная"},{id:2,name:"Добавление без ограничений"}],itemsEdit:null,nameWork:"",itemsNew:null,chengeItem1:null,chengeItemNew1:null},t}return(0,o.Z)(w,[{key:"componentDidMount",value:(E=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:(t=e.sent).items.map((function(e,a){t.items[a].dow_name=n.state.dows.find((function(t){return parseInt(t.id)==parseInt(e.dow)})).name})),this.setState({module_name:t.module_info.name,items:t.items,items_min:t.items_min}),document.title=t.module_info.name;case 6:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"openCat",value:function(e){this.setState({modalDialog:!0,showCat:e,nameCat:e.name,editText:e.text})}},{key:"saveEdit",value:(p=(0,r.Z)(f().mark((function e(){var t,n,a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={work:this.state.itemsEdit.item,times_add:this.state.itemsEdit.times_add,times_close:this.state.itemsEdit.times_close},e.next=3,this.getData("save_edit",t);case 3:if(n=e.sent,console.log(n),!1!==n.st){e.next=9;break}alert(n.text),e.next=15;break;case 9:return this.setState({modalDialog:!1,itemsEdit:null,nameWork:""}),e.next=12,this.getData("get_all");case 12:(a=e.sent).items.map((function(e,t){a.items[t].dow_name=i.state.dows.find((function(t){return parseInt(t.id)==parseInt(e.dow)})).name})),this.setState({items:a.items,items_min:a.items_min});case 15:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"saveNew",value:(s=(0,r.Z)(f().mark((function e(){var t,n,a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={work:this.state.itemsNew.item,times_add:this.state.itemsNew.times_add,times_close:this.state.itemsNew.times_close},e.next=3,this.getData("save_new",t);case 3:if(n=e.sent,console.log(n),!1!==n.st){e.next=9;break}alert(n.text),e.next=15;break;case 9:return this.setState({modalDialogNew:!1,itemsNew:null}),e.next=12,this.getData("get_all");case 12:(a=e.sent).items.map((function(e,t){a.items[t].dow_name=i.state.dows.find((function(t){return parseInt(t.id)==parseInt(e.dow)})).name})),this.setState({items:a.items,items_min:a.items_min});case 15:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"openWork",value:(i=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:t},e.next=3,this.getData("get_one",n);case 3:a=e.sent,console.log(a),this.setState({itemsEdit:a,modalDialog:!0,nameWork:a.item.name,chengeItem1:this.state.items_min.find((function(e,t){return parseInt(e.id)==parseInt(a.item.work_id)}))});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"openNewWork",value:(n=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all_for_new");case 2:t=e.sent,console.log(t),this.setState({itemsNew:t,modalDialogNew:!0});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"chengeItem",value:function(e,t){var n=t.target.value,a=this.state.itemsEdit;a.item[[e]]=n,"dow"==e&&12==n&&(a.times_add=[{time_action:"19:00"}],a.times_close="23:00"),this.setState({itemsEdit:a})}},{key:"chengeItem1",value:function(e,t,n){var a=this.state.itemsEdit;a.item[[e]]=n.id,this.setState({itemsEdit:a,chengeItem1:n})}},{key:"chengeItemNew",value:function(e,t){var n=t.target.value,a=this.state.itemsNew;a.item[[e]]=n,"dow"==e&&12==n&&(a.times_add=[{time_action:"19:00"}],a.times_close="23:00"),this.setState({itemsNew:a})}},{key:"chengeItemNew1",value:function(e,t,n){var a=this.state.itemsNew;a.item[[e]]=n.id,this.setState({itemsNew:a,chengeItemNew1:n})}},{key:"chengeTime",value:function(e,t){var n=t.target.value,a=this.state.itemsEdit;a.times_add[e].time_action=n,this.setState({itemsEdit:a})}},{key:"chengeTimeNew",value:function(e,t){var n=t.target.value,a=this.state.itemsNew;a.times_add[e].time_action=n,this.setState({itemsNew:a})}},{key:"delTime",value:function(e){var t=this.state.itemsEdit,n=[];t.times_add.map((function(t,a){parseInt(a)!=parseInt(e)&&n.push(t)})),t.times_add=n,this.setState({itemsEdit:t})}},{key:"delTimeNew",value:function(e){var t=this.state.itemsNew,n=[];t.times_add.map((function(t,a){parseInt(a)!=parseInt(e)&&n.push(t)})),t.times_add=n,this.setState({itemsNew:t})}},{key:"addTime",value:function(e){var t=document.getElementById("timePikerNew").value,n=this.state.itemsEdit;""!=t&&(n.times_add.push({time_action:t}),this.setState({itemsEdit:n}))}},{key:"addTimeNew",value:function(e){var t=document.getElementById("timePikerNew").value,n=this.state.itemsNew;""!=t&&(n.times_add.push({time_action:t}),this.setState({itemsNew:n}))}},{key:"chengeTimeClose",value:function(e){var t=e.target.value,n=this.state.itemsEdit;n.times_close=t,this.setState({itemsEdit:n})}},{key:"chengeTimeCloseNew",value:function(e){var t=e.target.value,n=this.state.itemsNew;n.times_close=t,this.setState({itemsNew:n})}},{key:"changeCheck",value:(t=(0,r.Z)(f().mark((function e(t,n,a){var i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=this.state.items)[t][[n]]=a.target.checked?1:0,s={type:n,value:a.target.checked?1:0,id:i[t].id},e.next=5,this.getData("save_check",s);case 5:e.sent,this.setState({items:i});case 7:case"end":return e.stop()}}),e,this)}))),function(e,n,a){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{open:this.state.is_load,style:{zIndex:99}},a.createElement(j.Z,{color:"inherit"})),this.state.itemsEdit?a.createElement(G.Z,{open:this.state.modalDialog,maxWidth:"md",onClose:function(){e.setState({modalDialog:!1,itemsEdit:null,nameWork:""})}},a.createElement($.Z,null,'Уборка "',this.state.nameWork,'"'),a.createElement(Q.Z,{style:{paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.itemsEdit.item.name,func:this.chengeItem.bind(this,"name"),label:"Название уборки"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.itemsEdit.cats,value:this.state.itemsEdit.item.type_new,func:this.chengeItem.bind(this,"type_new"),label:"Категория уборки"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.itemsEdit.item.time_min,func:this.chengeItem.bind(this,"time_min"),label:"Время уборки (в минутах)"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.itemsEdit.item.max_count,func:this.chengeItem.bind(this,"max_count"),label:"Количество активаций"})),a.createElement(D.ZP,{item:!0,xs:12,sm:9},a.createElement(Ne,{multiline:!0,maxRows:2,value:this.state.itemsEdit.item.description,func:this.chengeItem.bind(this,"description"),label:"Описание (для внутренного использования)"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.itemsEdit.apps,value:this.state.itemsEdit.item.app_id,func:this.chengeItem.bind(this,"app_id"),label:"Должность"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.dows,value:this.state.itemsEdit.item.dow,func:this.chengeItem.bind(this,"dow"),label:"День недели"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.types,value:this.state.itemsEdit.item.type_time,func:this.chengeItem.bind(this,"type_time"),label:"Тип добавления"})),14!=parseInt(this.state.itemsEdit.item.dow)?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Te,{data:this.state.items_min,value:this.state.chengeItem1,func:this.chengeItem1.bind(this,"work_id"),multiple:!1,label:"Если эта уборка завершена"})))),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Z.Z,null,a.createElement(v.ZP,{style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(y.Z,{primary:"Время добавления уборки"})),this.state.itemsEdit.times_add.map((function(t,n){return a.createElement(v.ZP,{key:n,style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(Oe,{label:"",value:t.time_action,func:e.chengeTime.bind(e,n)}),a.createElement(Ue.Z,{style:{cursor:"pointer"},onClick:e.delTime.bind(e,n)}))})),a.createElement(v.ZP,{style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(Oe,{id:"timePikerNew",label:"",value:"00:00",onBlur:this.addTime.bind(this)})))),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Z.Z,null,a.createElement(v.ZP,{style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(y.Z,{primary:"Время автоматического удаления"})),a.createElement(v.ZP,{style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(Oe,{label:"",value:this.state.itemsEdit.times_close,func:this.chengeTimeClose.bind(this)})))))),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:this.saveEdit.bind(this)},"Сохранить"))):null,this.state.itemsNew?a.createElement(G.Z,{open:this.state.modalDialogNew,maxWidth:"md",onClose:function(){e.setState({modalDialogNew:!1})}},a.createElement($.Z,null,"Новая уборка"),a.createElement(Q.Z,{style:{paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.itemsNew.item.name,func:this.chengeItemNew.bind(this,"name"),label:"Название уборки"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.itemsNew.cats,value:this.state.itemsNew.item.type_new,func:this.chengeItemNew.bind(this,"type_new"),label:"Категория уборки"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{value:this.state.itemsNew.item.time_min,func:this.chengeItemNew.bind(this,"time_min"),label:"Время уборки (в минутах)"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.itemsNew.item.max_count,func:this.chengeItemNew.bind(this,"max_count"),label:"Количество активаций"})),a.createElement(D.ZP,{item:!0,xs:12,sm:9},a.createElement(Ne,{multiline:!0,maxRows:2,value:this.state.itemsNew.item.description,func:this.chengeItemNew.bind(this,"description"),label:"Описание (для внутренного использования)"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.itemsNew.apps,value:this.state.itemsNew.item.app_id,func:this.chengeItemNew.bind(this,"app_id"),label:"Должность"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.dows,value:this.state.itemsNew.item.dow,func:this.chengeItemNew.bind(this,"dow"),label:"День недели"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.types,value:this.state.itemsNew.item.type_time,func:this.chengeItemNew.bind(this,"type_time"),label:"Тип добавления"})),14!=parseInt(this.state.itemsNew.item.dow)?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Te,{data:this.state.items_min,value:this.state.chengeItemNew1,func:this.chengeItemNew1.bind(this,"work_id"),multiple:!1,label:"Если эта уборка завершена"})))),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Z.Z,null,a.createElement(v.ZP,{style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(y.Z,{primary:"Время добавления уборки"})),this.state.itemsNew.times_add.map((function(t,n){return a.createElement(v.ZP,{key:n,style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(Oe,{label:"",value:t.time_action,func:e.chengeTimeNew.bind(e,n)}),a.createElement(Ue.Z,{style:{cursor:"pointer"},onClick:e.delTimeNew.bind(e,n)}))})),a.createElement(v.ZP,{style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(Oe,{id:"timePikerNew",label:"",value:"00:00",onBlur:this.addTimeNew.bind(this)})))),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Z.Z,null,a.createElement(v.ZP,{style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(y.Z,{primary:"Время автоматического удаления"})),a.createElement(v.ZP,{style:{borderBottom:"1px solid #e5e5e5"}},a.createElement(Oe,{label:"",value:this.state.itemsNew.times_close,func:this.chengeTimeCloseNew.bind(this)})))))),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:this.saveNew.bind(this)},"Сохранить"))):null,a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(J.Z,{variant:"contained",color:"primary",onClick:this.openNewWork.bind(this)},"Добавить уборку")),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Работа"),a.createElement(ue.Z,null,"Должность"),a.createElement(ue.Z,null,"Время"),a.createElement(ue.Z,null,"День недели"),a.createElement(ue.Z,null,"Время открытия"),a.createElement(ue.Z,null,"Время автоматического удаления"),a.createElement(ue.Z,null,"Не удалять в конце смены"),a.createElement(ue.Z,null,"Обязательна к выполнению в особый день"),a.createElement(ue.Z,null,a.createElement(Ke.Z,null)))),a.createElement(me.Z,null,this.state.items.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,{onClick:e.openWork.bind(e,t.id),style:{color:"#c03",cursor:"pointer",fontWeight:"bold"}},t.work_name),a.createElement(ue.Z,null,t.app_name),a.createElement(ue.Z,null,t.time_min?t.time_min+"мин.":""),a.createElement(ue.Z,null,t.dow_name),a.createElement(ue.Z,null,t.times_open),a.createElement(ue.Z,null,t.times_close),a.createElement(ue.Z,null,a.createElement(Me,{value:1==parseInt(t.is_not_del),func:e.changeCheck.bind(e,n,"is_not_del"),label:""})),a.createElement(ue.Z,null,a.createElement(Me,{value:1==parseInt(t.is_need),func:e.changeCheck.bind(e,n,"is_need"),label:""})),a.createElement(ue.Z,null,a.createElement(Me,{value:1==parseInt(t.is_active),func:e.changeCheck.bind(e,n,"is_active"),label:""})))})))))))}}]),w}(a.Component);function Vn(){return a.createElement(jn,null)}n(312);var Yn=n(7563);function Xn(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}ft().node,ft().number.isRequired,ft().number.isRequired;var Hn=function(e){(0,m.Z)(g,e);var t,n,i,p,E,_=(p=g,E=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(p);if(E){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function g(e){var t;return(0,l.Z)(this,g),t=_.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Yn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"app_work_show",module_name:"",is_load:!1,items:[],items_min:[],showItems:[],modalDialog:!1,modalDialogNew:!1,activeTab:0,dows:[{id:1,name:"Понедельник"},{id:2,name:"Вторник"},{id:3,name:"Среда"},{id:4,name:"Четверг"},{id:5,name:"Пятница"},{id:6,name:"Суббота"},{id:7,name:"Воскресенье"},{id:10,name:"Другое"},{id:11,name:"Каждый день"},{id:12,name:"Каждый день в конце смены"},{id:13,name:"Ручное добавление"},{id:14,name:"После выполнение уборки"}],types:[{id:0,name:"Другое"},{id:1,name:"Только 1 активная"},{id:2,name:"Добавление без ограничений"}],itemsEdit:null,nameWork:"",itemsNew:null,chengeItem1:null,chengeItemNew1:null,points:[],point_id:""},t}return(0,o.Z)(g,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_points");case 2:t=e.sent,this.setState({points:t,point_id:t[0].id}),setTimeout((function(){n.getWorks()}),300);case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getWorks",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point_id},e.next=3,this.getData("get_all",t);case 3:(n=e.sent).items.map((function(e,t){n.items[t].dow_name=i.state.dows.find((function(t){return parseInt(t.id)==parseInt(e.dow)})).name})),0==(a=parseInt(this.state.activeTab))&&(a=5),1==a&&(a=6),2==a&&(a=21),this.setState({module_name:n.module_info.name,items:n.items,showItems:n.items.filter((function(e){return parseInt(e.app_id)==parseInt(a)})),items_min:n.items_min}),document.title=n.module_info.name;case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"openWork",value:(t=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:t,point_id:this.state.point_id},e.next=3,this.getData("get_one",n);case 3:a=e.sent,console.log(a),this.setState({itemsEdit:a,modalDialog:!0});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"changeTab",value:function(e,t){var n=parseInt(t);0==t&&(n=5),1==t&&(n=6),2==t&&(n=21),this.setState({activeTab:t,showItems:this.state.items.filter((function(e){return parseInt(e.app_id)==parseInt(n)}))})}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ae,{data:this.state.points,value:this.state.point_id,func:function(t){e.setState({point_id:t.target.value})},label:"Точка"})),this.state.itemsEdit?a.createElement(G.Z,{open:this.state.modalDialog,maxWidth:"md",onClose:function(){e.setState({modalDialog:!1,itemsEdit:null,nameWork:""})}},a.createElement($.Z,null,'Уборка "',this.state.itemsEdit.item.name,'"'),a.createElement(Q.Z,null,a.createElement(D.ZP,{container:!0,spacing:0},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(x.Z,null,this.state.itemsEdit.item.cat_name)),0==this.state.itemsEdit.item.show_time?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement(x.Z,null,"Время за уборку: ",this.state.itemsEdit.item.time_min," мин.")),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(x.Z,null,"Описание процесса уборки: ")),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(x.Z,{dangerouslySetInnerHTML:{__html:this.state.itemsEdit.item.text_work}}))))):null,a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(fe.Z,null,a.createElement(Et.Z,{value:this.state.activeTab,onChange:this.changeTab.bind(this)},a.createElement(_t.Z,(0,s.Z)({label:"Повар"},Xn(0))),a.createElement(_t.Z,(0,s.Z)({label:"Кассир"},Xn(1))),a.createElement(_t.Z,(0,s.Z)({label:"Кухонный работник"},Xn(2)))))),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Работа"),a.createElement(ue.Z,null,"День недели"),a.createElement(ue.Z,null,"Время открытия"),a.createElement(ue.Z,null,"Время автоматического удаления"))),a.createElement(me.Z,null,this.state.showItems.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,{onClick:e.openWork.bind(e,t.id),style:{color:"#c03",cursor:"pointer",fontWeight:"bold"}},t.work_name),a.createElement(ue.Z,null,t.dow_name," ",t.need_work_name),a.createElement(ue.Z,null,t.times_open),a.createElement(ue.Z,null,t.times_close))})))))))}}]),g}(a.Component);function Jn(){return a.createElement(Hn,null)}n(1702),n(8152);var Gn=n(7563);function qn(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}var Qn=function(e){(0,m.Z)(E,e);var t,n,i,s,p=(i=E,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(i);if(s){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function E(e){var t;return(0,l.Z)(this,E),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"chartnewusers",null),(0,h.Z)((0,c.Z)(t),"chartorders",null),(0,h.Z)((0,c.Z)(t),"chartavgsumm",null),(0,h.Z)((0,c.Z)(t),"chartcountpos",null),(0,h.Z)((0,c.Z)(t),"chartnewusersD",null),(0,h.Z)((0,c.Z)(t),"chartordersD",null),(0,h.Z)((0,c.Z)(t),"chartavgsummD",null),(0,h.Z)((0,c.Z)(t),"chartcountposD",null),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Gn.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"site_stat_marc",module_name:"",is_load:!1,is_show_adv:!1,show_stat_roll:!1,show_stat_set:!1,show_stat_pizza:!1,choosePoint:[],points:[],rangeDate:[qn(new Date),qn(new Date)],date_start:qn(new Date),date_end:qn(new Date),promoName:"",newUsersTable:[],countOrdersTable:[],avgSumm:[],countPos:[],fakeUsers:[],roll_stat:[],set_stat:[],pizza_stat:[],typesShow:[{id:1,name:"Итоговый результат"},{id:2,name:"График по месяцам"},{id:3,name:"График по дням"}],typeShow:1,colors:[6788249,168986,6460442,16711680,4636102,16758465,6788249,168986,6460442,16711680,4636102,16758465]},t}return(0,o.Z)(E,[{key:"componentDidMount",value:(n=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,points:t.points}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"changeChekBox",value:function(e,t){this.setState((0,h.Z)({},e,t.target.checked))}},{key:"show",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={points:this.state.choosePoint,dateStart:this.state.date_start,dateEnd:this.state.date_end,typeShow:this.state.typeShow,promoName:this.state.promoName,advData:this.state.advData},e.next=3,this.getData("show",t);case 3:n=e.sent,console.log(n),1==parseInt(this.state.typeShow)&&this.setState({newUsersTable:n.new_users,countOrdersTable:n.count_orders,avgSumm:n.avg_summ,countPos:n.count_pos,fakeUsers:n.fake_users,roll_stat:n.roll_stat,set_stat:n.set_stat,pizza_stat:n.pizza_stat}),2==parseInt(this.state.typeShow)&&(this.renderGraphNewUsers(n.new_users),this.renderGraphOrders(n.count_orders),this.renderGraphAvgSumm(n.avg_summ),this.renderCountPos(n.count_pos)),3==parseInt(this.state.typeShow)&&(this.renderGraphNewUsersD(n.new_users),this.renderGraphOrdersD(n.count_orders),this.renderGraphAvgSummD(n.avg_summ),this.renderCountPosD(n.count_pos));case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"renderGraphNewUsers",value:function(e){this.chartnewusers&&this.chartnewusers.dispose();var t=am5.Root.new("chartnewusers");this.chartnewusers=t,t.setThemes([am5themes_Animated.new(t)]);var n=t.container.children.push(am5xy.XYChart.new(t,{panY:!1,wheelY:"zoomX",layout:t.verticalLayout})),a=[],i=[],s=[];e.site.map((function(e){var t=e.date.split("-");a.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})})),e.center.map((function(e){var t=e.date.split("-");i.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})})),e.all.map((function(e){var t=e.date.split("-");s.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})}));var r=n.yAxes.push(am5xy.ValueAxis.new(t,{extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{})})),l=n.xAxes.push(am5xy.DateAxis.new(t,{baseInterval:{timeUnit:"month",count:1},startLocation:.5,endLocation:.5,renderer:am5xy.AxisRendererX.new(t,{minGridDistance:30})}));function o(e,a,i){var s=n.series.push(am5xy.SmoothedXLineSeries.new(t,{name:e,xAxis:l,yAxis:r,valueYField:a,valueXField:"date",tooltip:am5.Tooltip.new(t,{}),maskBullets:!1}));s.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:s.get("fill")})})})),s.strokes.template.set("strokeWidth",2),"Всего"==e&&s.strokes.template.set("strokeWidth",8),s.get("tooltip").label.set("text","[bold]{name}[/]\n{valueX.formatDate()}: {valueY}"),s.data.setAll(i)}l.get("dateFormats").day="MM/dd",l.get("periodChangeDateFormats").day="MM/dd",o("Сайт","value",a),o("Контакт-центр","value",i),o("Всего","value",s),n.set("cursor",am5xy.XYCursor.new(t,{behavior:"zoomXY",xAxis:l})),l.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]})),r.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]}))}},{key:"renderGraphNewUsersD",value:function(e){this.chartnewusersD&&this.chartnewusersD.dispose();var t=am5.Root.new("chartnewusersD");this.chartnewusersD=t,t.setThemes([am5themes_Animated.new(t)]);var n=t.container.children.push(am5xy.XYChart.new(t,{panY:!1,wheelY:"zoomX",layout:t.verticalLayout})),a=[],i=[],s=[];e.site.map((function(e){var t=e.date_new.split("-");a.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})})),e.center.map((function(e){var t=e.date_new.split("-");i.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})})),e.all.map((function(e){var t=e.date_new.split("-");s.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})}));var r=n.yAxes.push(am5xy.ValueAxis.new(t,{extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{})})),l=n.xAxes.push(am5xy.DateAxis.new(t,{baseInterval:{timeUnit:"day",count:1},startLocation:.5,endLocation:.5,renderer:am5xy.AxisRendererX.new(t,{})}));function o(e,a,i){var s=n.series.push(am5xy.SmoothedXLineSeries.new(t,{name:e,xAxis:l,yAxis:r,valueYField:a,valueXField:"date",tooltip:am5.Tooltip.new(t,{}),maskBullets:!1}));s.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:s.get("fill")})})})),s.strokes.template.set("strokeWidth",2),"Всего"==e&&s.strokes.template.set("strokeWidth",8),s.get("tooltip").label.set("text","[bold]{name}[/]\n{valueX.formatDate()}: {valueY}"),s.data.setAll(i)}l.get("dateFormats").day="MM/dd",l.get("periodChangeDateFormats").day="MM/dd",o("Сайт","value",a),o("Контакт-центр","value",i),o("Всего","value",s),n.set("cursor",am5xy.XYCursor.new(t,{behavior:"zoomXY",xAxis:l})),l.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]})),r.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]}))}},{key:"renderGraphOrders",value:function(e){this.chartorders&&this.chartorders.dispose();var t=am5.Root.new("chartorders");this.chartorders=t,t.setThemes([am5themes_Animated.new(t)]);var n=t.container.children.push(am5xy.XYChart.new(t,{panY:!1,wheelY:"zoomX",layout:t.verticalLayout})),a=[],i=[],s=[],r=[];e.all.map((function(e){var t=e.date_new.split("-");a.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})})),e.pic.map((function(e){var t=e.date_new.split("-");i.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})})),e.dev.map((function(e){var t=e.date_new.split("-");s.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})})),e.hall.map((function(e){var t=e.date_new.split("-");r.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})}));var l=n.yAxes.push(am5xy.ValueAxis.new(t,{extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{})})),o=n.xAxes.push(am5xy.DateAxis.new(t,{baseInterval:{timeUnit:"month",count:1},startLocation:.5,endLocation:.5,renderer:am5xy.AxisRendererX.new(t,{minGridDistance:30})}));function c(e,a,i){var s=n.series.push(am5xy.SmoothedXLineSeries.new(t,{name:e,xAxis:o,yAxis:l,valueYField:a,valueXField:"date",tooltip:am5.Tooltip.new(t,{}),maskBullets:!1}));s.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:s.get("fill")})})})),s.strokes.template.set("strokeWidth",2),"Всего"==e&&s.strokes.template.set("strokeWidth",8),s.get("tooltip").label.set("text","[bold]{name}[/]\n{valueX.formatDate()}: {valueY}"),s.data.setAll(i)}o.get("dateFormats").day="MM/dd",o.get("periodChangeDateFormats").day="MM/dd",c("Всего","value",a),c("Самовывозов","value",i),c("Доставок","value",s),c("Зал","value",r),n.set("cursor",am5xy.XYCursor.new(t,{behavior:"zoomXY",xAxis:o})),o.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]})),l.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]}))}},{key:"renderGraphOrdersD",value:function(e){this.chartordersD&&this.chartordersD.dispose();var t=am5.Root.new("chartordersD");this.chartordersD=t,t.setThemes([am5themes_Animated.new(t)]),t.dateFormatter.setAll({dateFormat:"yyyy-MM-dd",dateFields:["valueX","openValueX"]});var n=t.container.children.push(am5xy.XYChart.new(t,{panY:!1,wheelY:"zoomX",layout:t.verticalLayout})),a=[],i=[],s=[],r=[];e.all.map((function(e){var t=e.date_new.split("-");a.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})})),e.pic.map((function(e){var t=e.date_new.split("-");i.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})})),e.dev.map((function(e){var t=e.date_new.split("-");s.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})})),e.hall.map((function(e){var t=e.date_new.split("-");r.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})}));var l=n.yAxes.push(am5xy.ValueAxis.new(t,{extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{})})),o=n.xAxes.push(am5xy.DateAxis.new(t,{baseInterval:{timeUnit:"day",count:1},startLocation:.5,endLocation:.5,renderer:am5xy.AxisRendererX.new(t,{})}));o.get("dateFormats").day="MM/dd",o.get("periodChangeDateFormats").day="MM/dd";var c=n.yAxes.push(am5xy.CategoryAxis.new(t,{categoryField:"category",extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{inversed:!0})}));function m(e,a,i){var s=n.series.push(am5xy.SmoothedXLineSeries.new(t,{name:e,xAxis:o,yAxis:l,valueYField:a,strokeWidth:5,valueXField:"date",tooltip:am5.Tooltip.new(t,{}),maskBullets:!1}));s.strokes.template.set("strokeWidth",2),"Всего"==e&&s.strokes.template.set("strokeWidth",8),s.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:s.get("fill")})})})),s.get("tooltip").label.set("text","[bold]{name}[/]\n{valueX.formatDate()}: {valueY}"),s.data.setAll(i)}var u=this.state.colors;m("Всего","value",a),m("Самовывозов","value",i),m("Доставок","value",s),m("Зал","value",r),this.state.is_show_adv&&e.adv_data.length>"1"&&function(e,a,i){var s=[];i.map((function(e,t){i[t].name=e.category,i[t].promo=""!=e.promo||e.promo.length>0?"\nПромокод: "+e.promo:"",i[t].columnSettings.fill=am5.color(u[t]),s.push({category:e.category})})),c.data.setAll(s);var r=null,l={xAxis:o,yAxis:c,openValueXField:"fromDate",valueXField:"toDate",categoryYField:"category",sequencedInterpolation:!0};i.map((function(e,a){l.fill=am5.color(u[a]),(r=n.series.push(am5xy.ColumnSeries.new(t,l))).columns.template.setAll({templateField:"columnSettings",strokeOpacity:0,tooltipText:"[bold]{category}[/]\n{description}\n{openValueX.formatDate('yyyy-MM-dd')} - {valueX.formatDate('yyyy-MM-dd')}{promo}"}),r.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:r.get("fill")})})}))})),r.columns.template.setAll({opacity:.5}),r.data.processor=am5.DataProcessor.new(t,{dateFields:["fromDate","toDate"],dateFormat:"yyyy-MM-dd HH:mm"}),r.data.setAll(i)}(0,0,e.adv_data),n.set("cursor",am5xy.XYCursor.new(t,{behavior:"zoomXY",xAxis:o})),o.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]})),l.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]}))}},{key:"renderGraphAvgSumm",value:function(e){this.chartavgsumm&&this.chartavgsumm.dispose();var t=am5.Root.new("chartavgsumm");this.chartavgsumm=t,t.setThemes([am5themes_Animated.new(t)]);var n=t.container.children.push(am5xy.XYChart.new(t,{panY:!1,wheelY:"zoomX",layout:t.verticalLayout})),a=[],i=[],s=[],r=[];e.all.map((function(e){var t=e.date_new.split("-");a.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})})),e.pic.map((function(e){var t=e.date_new.split("-");i.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})})),e.dev.map((function(e){var t=e.date_new.split("-");s.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})})),e.hall.map((function(e){var t=e.date_new.split("-");r.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})}));var l=n.yAxes.push(am5xy.ValueAxis.new(t,{extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{})})),o=n.xAxes.push(am5xy.DateAxis.new(t,{baseInterval:{timeUnit:"month",count:1},startLocation:.5,endLocation:.5,renderer:am5xy.AxisRendererX.new(t,{minGridDistance:30})}));function c(e,a,i){var s=n.series.push(am5xy.SmoothedXLineSeries.new(t,{name:e,xAxis:o,yAxis:l,valueYField:a,strokeWidth:5,valueXField:"date",tooltip:am5.Tooltip.new(t,{}),maskBullets:!1}));s.strokes.template.set("strokeWidth",2),"Всего"==e&&s.strokes.template.set("strokeWidth",8),s.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:s.get("fill")})})})),s.get("tooltip").label.set("text","[bold]{name}[/]\n{valueX.formatDate()}: {valueY}"),s.data.setAll(i)}o.get("dateFormats").day="MM/dd",o.get("periodChangeDateFormats").day="MM/dd",c("Всего","value",a),c("Самовывозов","value",i),c("Доставок","value",s),c("Зал","value",r),n.set("cursor",am5xy.XYCursor.new(t,{behavior:"zoomXY",xAxis:o})),o.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]})),l.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]}))}},{key:"renderGraphAvgSummD",value:function(e){this.chartavgsummD&&this.chartavgsummD.dispose();var t=am5.Root.new("chartavgsummD");this.chartavgsummD=t,t.setThemes([am5themes_Animated.new(t)]),t.dateFormatter.setAll({dateFormat:"yyyy-MM-dd",dateFields:["valueX","openValueX"]});var n=t.container.children.push(am5xy.XYChart.new(t,{panY:!1,wheelY:"zoomX",layout:t.verticalLayout})),a=[],i=[],s=[],r=[];e.all.map((function(e){var t=e.date_new.split("-");a.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})})),e.pic.map((function(e){var t=e.date_new.split("-");i.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})})),e.dev.map((function(e){var t=e.date_new.split("-");s.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})})),e.hall.map((function(e){var t=e.date_new.split("-");r.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})}));var l=n.yAxes.push(am5xy.ValueAxis.new(t,{extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{})})),o=n.xAxes.push(am5xy.DateAxis.new(t,{baseInterval:{timeUnit:"day",count:1},startLocation:.5,endLocation:.5,renderer:am5xy.AxisRendererX.new(t,{})}));o.get("dateFormats").day="MM/dd",o.get("periodChangeDateFormats").day="MM/dd";var c=n.yAxes.push(am5xy.CategoryAxis.new(t,{categoryField:"category",extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{inversed:!0})}));function m(e,a,i){var s=n.series.push(am5xy.SmoothedXLineSeries.new(t,{name:e,xAxis:o,yAxis:l,valueYField:a,strokeWidth:5,valueXField:"date",tooltip:am5.Tooltip.new(t,{}),maskBullets:!1}));s.strokes.template.set("strokeWidth",2),"Всего"==e&&s.strokes.template.set("strokeWidth",8),s.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:s.get("fill")})})})),s.get("tooltip").label.set("text","[bold]{name}[/]\n{valueX.formatDate()}: {valueY}"),s.data.setAll(i)}var u=this.state.colors;m("Всего","value",a),m("Самовывозов","value",i),m("Доставок","value",s),m("Зал","value",r),this.state.is_show_adv&&e.adv_data.length>"1"&&function(e,a,i){var s=[];i.map((function(e,t){i[t].name=e.category,i[t].promo=""!=e.promo||e.promo.length>0?"\nПромокод: "+e.promo:"",i[t].columnSettings.fill=am5.color(u[t]),s.push({category:e.category})})),c.data.setAll(s);var r=null,l={xAxis:o,yAxis:c,openValueXField:"fromDate",valueXField:"toDate",categoryYField:"category",sequencedInterpolation:!0};i.map((function(e,a){l.fill=am5.color(u[a]),(r=n.series.push(am5xy.ColumnSeries.new(t,l))).columns.template.setAll({templateField:"columnSettings",strokeOpacity:0,tooltipText:"[bold]{category}[/]\n{description}\n{openValueX.formatDate('yyyy-MM-dd')} - {valueX.formatDate('yyyy-MM-dd')}{promo}"}),r.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:r.get("fill")})})}))})),r.columns.template.setAll({opacity:.5}),r.data.processor=am5.DataProcessor.new(t,{dateFields:["fromDate","toDate"],dateFormat:"yyyy-MM-dd HH:mm"}),r.data.setAll(i)}(0,0,e.adv_data),n.set("cursor",am5xy.XYCursor.new(t,{behavior:"zoomXY",xAxis:o})),o.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]})),l.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]}))}},{key:"renderCountPos",value:function(e){this.chartcountpos&&this.chartcountpos.dispose();var t=am5.Root.new("chartcountpos");this.chartcountpos=t,t.setThemes([am5themes_Animated.new(t)]);var n=t.container.children.push(am5xy.XYChart.new(t,{panY:!1,wheelY:"zoomX",layout:t.verticalLayout})),a=[],i=[];e.count_pizza.map((function(e){var t=e.date_new.split("-");a.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})})),e.count_rolls.map((function(e){var t=e.date_new.split("-");i.push({date:new Date(t[0],parseInt(t[1])-1,1).getTime(),value:parseInt(e.count)})}));var s=n.yAxes.push(am5xy.ValueAxis.new(t,{extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{})})),r=n.xAxes.push(am5xy.DateAxis.new(t,{baseInterval:{timeUnit:"month",count:1},startLocation:.5,endLocation:.5,renderer:am5xy.AxisRendererX.new(t,{minGridDistance:30})}));function l(e,a,i){var l=n.series.push(am5xy.SmoothedXLineSeries.new(t,{name:e,xAxis:r,yAxis:s,valueYField:a,valueXField:"date",tooltip:am5.Tooltip.new(t,{}),maskBullets:!1}));l.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:l.get("fill")})})})),l.strokes.template.set("strokeWidth",2),l.get("tooltip").label.set("text","[bold]{name}[/]\n{valueX.formatDate()}: {valueY}"),l.data.setAll(i)}r.get("dateFormats").day="MM/dd",r.get("periodChangeDateFormats").day="MM/dd",l("Роллов","value",i),l("Пиццы","value",a),n.set("cursor",am5xy.XYCursor.new(t,{behavior:"zoomXY",xAxis:r})),r.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]})),s.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]}))}},{key:"renderCountPosD",value:function(e){this.chartcountposD&&this.chartcountposD.dispose();var t=am5.Root.new("chartcountposD");this.chartcountposD=t,t.setThemes([am5themes_Animated.new(t)]),t.dateFormatter.setAll({dateFormat:"yyyy-MM-dd",dateFields:["valueX","openValueX"]});var n=t.container.children.push(am5xy.XYChart.new(t,{panY:!1,wheelY:"zoomX",layout:t.verticalLayout})),a=[],i=[];e.count_pizza.map((function(e){var t=e.date_new.split("-");a.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})})),e.count_rolls.map((function(e){var t=e.date_new.split("-");i.push({date:new Date(t[0],parseInt(t[1])-1,parseInt(t[2])).getTime(),value:parseInt(e.count)})}));var s=n.yAxes.push(am5xy.ValueAxis.new(t,{extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{})})),r=n.xAxes.push(am5xy.DateAxis.new(t,{baseInterval:{timeUnit:"day",count:1},startLocation:.5,endLocation:.5,renderer:am5xy.AxisRendererX.new(t,{})}));r.get("dateFormats").day="MM/dd",r.get("periodChangeDateFormats").day="MM/dd";var l=n.yAxes.push(am5xy.CategoryAxis.new(t,{categoryField:"category",extraTooltipPrecision:1,renderer:am5xy.AxisRendererY.new(t,{inversed:!0})}));function o(e,a,i){var l=n.series.push(am5xy.SmoothedXLineSeries.new(t,{name:e,xAxis:r,yAxis:s,valueYField:a,strokeWidth:5,valueXField:"date",tooltip:am5.Tooltip.new(t,{}),maskBullets:!1}));l.strokes.template.set("strokeWidth",2),"Всего"==e&&l.strokes.template.set("strokeWidth",8),l.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:l.get("fill")})})})),l.get("tooltip").label.set("text","[bold]{name}[/]\n{valueX.formatDate()}: {valueY}"),l.data.setAll(i)}var c=this.state.colors;o("Роллов","value",i),o("Пиццы","value",a),this.state.is_show_adv&&e.adv_data.length>"1"&&function(e,a,i){var s=[];i.map((function(e,t){i[t].name=e.category,i[t].promo=""!=e.promo||e.promo.length>0?"\nПромокод: "+e.promo:"",i[t].columnSettings.fill=am5.color(c[t]),s.push({category:e.category})})),l.data.setAll(s);var o=null,m={xAxis:r,yAxis:l,openValueXField:"fromDate",valueXField:"toDate",categoryYField:"category",sequencedInterpolation:!0};i.map((function(e,a){m.fill=am5.color(c[a]),(o=n.series.push(am5xy.ColumnSeries.new(t,m))).columns.template.setAll({templateField:"columnSettings",strokeOpacity:0,tooltipText:"[bold]{category}[/]\n{description}\n{openValueX.formatDate('yyyy-MM-dd')} - {valueX.formatDate('yyyy-MM-dd')}{promo}"}),o.bullets.push((function(){return am5.Bullet.new(t,{sprite:am5.Circle.new(t,{radius:2,fill:o.get("fill")})})}))})),o.columns.template.setAll({opacity:.5}),o.data.processor=am5.DataProcessor.new(t,{dateFields:["fromDate","toDate"],dateFormat:"yyyy-MM-dd HH:mm"}),o.data.setAll(i)}(0,0,e.adv_data),n.set("cursor",am5xy.XYCursor.new(t,{behavior:"zoomXY",xAxis:r})),r.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]})),s.set("tooltip",am5.Tooltip.new(t,{themeTags:["axis"]}))}},{key:"changeDateRange",value:function(e,t){this.setState((0,h.Z)({},e,qn(t)))}},{key:"showStat",value:function(e){var t;switch(e){case"roll":t=!this.state.show_stat_roll,this.setState({show_stat_roll:t});break;case"set":t=!this.state.show_stat_set,this.setState({show_stat_set:t});break;case"pizza":t=!this.state.show_stat_pizza,this.setState({show_stat_pizza:t})}}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата от",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Te,{data:this.state.points,value:this.state.choosePoint,func:function(t,n){e.setState({choosePoint:n})},multiple:!0,label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:6,sm:3},a.createElement(Ne,{value:this.state.promoName,func:function(t){e.setState({promoName:t.target.value})},label:"Промокод"})),a.createElement(D.ZP,{item:!0,xs:6,sm:3},a.createElement(Ae,{data:this.state.typesShow,value:this.state.typeShow,func:function(t){e.setState({typeShow:t.target.value})},label:"Как показать"})),a.createElement(D.ZP,{item:!0,xs:12,sm:1},a.createElement(Me,{label:"Показать акции",value:this.state.is_show_adv,func:this.changeChekBox.bind(this,"is_show_adv")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.show.bind(this)},"Обновить данные")),1!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Новые клиенты итог"),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},"Всего"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Контакт-центр"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Сайт"))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.newUsersTable.all?this.state.newUsersTable.all:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.newUsersTable.center?this.state.newUsersTable.center:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.newUsersTable.site?this.state.newUsersTable.site:0)))))),1!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Заказы итог"),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},"Всего"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Доставок"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Зал"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Самовывоз"))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.countOrdersTable.all?this.state.countOrdersTable.all:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.countOrdersTable.dev?this.state.countOrdersTable.dev:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.countOrdersTable.hall?this.state.countOrdersTable.hall:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.countOrdersTable.pic?this.state.countOrdersTable.pic:0)))))),1!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Средний чек итог"),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},"Всего"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Доставка"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Зал"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Самовывоз"))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.avgSumm.all?this.state.avgSumm.all:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.avgSumm.dev?this.state.avgSumm.dev:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.avgSumm.hall?this.state.avgSumm.hall:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.avgSumm.pic?this.state.avgSumm.pic:0)))))),1!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Позиций итог"),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},"Роллов"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Пиццы"))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.countPos.count_rolls?this.state.countPos.count_rolls:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.countPos.count_pizza?this.state.countPos.count_pizza:0)))))),1!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Ушедшие клиенты"),a.createElement("h5",{style:{textAlign:"center"}},"ушли - заказывали за 90 дней до указанного периода и больше не заказывали"),a.createElement("h5",{style:{textAlign:"center"}},"вернулись - не заказывали 90 дней до указанного периода, сделали заказ в указанный период"),a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},"Ушли"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Вернулись"))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.fakeUsers.lost_users?this.state.fakeUsers.lost_users:0),a.createElement(ue.Z,{style:{textAlign:"center"}},this.state.fakeUsers.ret_users?this.state.fakeUsers.ret_users:0))))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{style:{marginTop:20,marginBottom:200},item:!0,xs:12,sm:4},a.createElement("h2",{style:{textAlign:"center"}},"Рейтинг роллов "),a.createElement("h5",{style:{textAlign:"center",cursor:"pointer"},onClick:this.showStat.bind(this,"roll")},"Показать/Скрыть"),1!=this.state.show_stat_roll?null:a.createElement(de.Z,{style:{marginTop:20},component:fe.Z},a.createElement(ce.Z,null,a.createElement(me.Z,null,this.state.roll_stat.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.name),a.createElement(ue.Z,{style:{textAlign:"center"}},e.count))})))))),a.createElement(D.ZP,{style:{marginTop:20,marginBottom:200},item:!0,xs:12,sm:4},a.createElement("h2",{style:{textAlign:"center"}},"Рейтинг сетов"),a.createElement("h5",{style:{textAlign:"center",cursor:"pointer"},onClick:this.showStat.bind(this,"set")},"Показать/Скрыть"),1!=this.state.show_stat_set?null:a.createElement(de.Z,{style:{marginTop:20},component:fe.Z},a.createElement(ce.Z,null,a.createElement(me.Z,null,this.state.set_stat.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.name),a.createElement(ue.Z,{style:{textAlign:"center"}},e.count))})))))),a.createElement(D.ZP,{style:{marginTop:20,marginBottom:200},item:!0,xs:12,sm:4},a.createElement("h2",{style:{textAlign:"center"}},"Рейтинг Пиццы"),a.createElement("h5",{style:{textAlign:"center",cursor:"pointer"},onClick:this.showStat.bind(this,"pizza")},"Показать/Скрыть"),1!=this.state.show_stat_pizza?null:a.createElement(de.Z,{style:{marginTop:20},component:fe.Z},a.createElement(ce.Z,null,a.createElement(me.Z,null,this.state.pizza_stat.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,e.name),a.createElement(ue.Z,{style:{textAlign:"center"}},e.count))})))))))),2!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Новые клиенты по месяцам"),a.createElement("div",{id:"chartnewusers",style:{width:"100%",height:"500px"}})),2!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Заказы по месяцам"),a.createElement("div",{id:"chartorders",style:{width:"100%",height:"500px"}})),2!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Средний чек по месяцам"),a.createElement("div",{id:"chartavgsumm",style:{width:"100%",height:"500px"}})),2!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Позиций по месяцам"),a.createElement("div",{id:"chartcountpos",style:{width:"100%",height:"500px"}})),3!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Новые клиенты по дням"),a.createElement("div",{id:"chartnewusersD",style:{width:"100%",height:"500px"}})),3!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Заказы по дням"),a.createElement("div",{id:"chartordersD",style:{width:"100%",height:"500px"}})),3!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Средний чек по дням"),a.createElement("div",{id:"chartavgsummD",style:{width:"100%",height:"500px"}})),3!=this.state.typeShow?null:a.createElement(D.ZP,{item:!0,xs:12},a.createElement("h2",{style:{textAlign:"center"}},"Позиций по дням"),a.createElement("div",{id:"chartcountposD",style:{width:"100%",height:"500px"}}))))}}]),E}(a.Component);function Kn(){return a.createElement(Qn,null)}n(3325);var $n=n(7563);function ea(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}var ta=function(e){(0,m.Z)(Z,e);var t,n,i,s,p,E,_,g=(E=Z,_=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(E);if(_){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function Z(e){var t;return(0,l.Z)(this,Z),t=g.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$n.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"advertising_company",module_name:"",description:"",promo:"",is_load:!1,adv_actual:[],adv_old:[],modalDialog:!1,modalDialogNew:!1,rangeDate:[ea(new Date),ea(new Date)],date_start:ea(new Date),date_end:ea(new Date),point_id:0,points:[],choosePoint:[],points_filter:[],is_active:1,id:0,nameCat:"",editText:"",name:"",editTextNew:"",showItem:null},t}return(0,o.Z)(Z,[{key:"componentDidMount",value:(p=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,adv_actual:t.adv_actual,adv_old:t.adv_old,points:t.points,points_filter:t.points,point_id:t.points[0].id}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"openCat",value:function(e){this.setState({modalDialog:!0,showItem:!0,name:e.name,date_start:e.date_start,date_end:e.date_end,is_active:e.is_active,id:e.id,description:e.description,choosePoint:e.choosePoint,promo:e.promo})}},{key:"save",value:(s=(0,r.Z)(f().mark((function e(){var t,n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={id:this.state.id,points:this.state.choosePoint,name:this.state.name,date_start:this.state.date_start,date_end:this.state.date_end,is_active:this.state.is_active},(0,h.Z)(t,"id",this.state.id),(0,h.Z)(t,"description",this.state.description),(0,h.Z)(t,"promo",this.state.promo),n=t,e.next=3,this.getData("save_edit",n);case 3:if(!1!==(a=e.sent).st){e.next=8;break}alert(a.text),e.next=13;break;case 8:return this.setState({modalDialog:!1,name:"",date_start:ea(new Date),date_end:ea(new Date)}),e.next=11,this.getData("get_adv_point",{point_id:this.state.point_id});case 11:a=e.sent,this.setState({adv_actual:a.adv_actual,adv_old:a.adv_old});case 13:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"saveNew",value:(i=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={points:this.state.choosePoint,name:this.state.name,date_start:this.state.date_start,date_end:this.state.date_end,is_active:this.state.is_active,description:this.state.description,promo:this.state.promo},e.next=3,this.getData("save_new",t);case 3:if(!1!==(n=e.sent).st){e.next=8;break}alert(n.text),e.next=13;break;case 8:return this.setState({modalDialogNew:!1,name:"",date_start:ea(new Date),date_end:ea(new Date)}),e.next=11,this.getData("get_adv_point",{point_id:this.state.point_id});case 11:n=e.sent,this.setState({adv_actual:n.adv_actual,adv_old:n.adv_old});case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"changeChekBox",value:function(e,t){this.setState((0,h.Z)({},e,t.target.checked))}},{key:"changeDateRange",value:function(e,t){this.setState((0,h.Z)({},e,ea(t)))}},{key:"changePoint",value:function(e){var t=this;this.setState({point_id:e.target.value}),setTimeout((function(){t.getAdvList()}),50)}},{key:"getAdvList",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point_id},e.next=3,this.getData("get_adv_point",t);case 3:n=e.sent,this.setState({adv_actual:n.adv_actual,adv_old:n.adv_old});case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"delAdv",value:(t=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={point_id:this.state.point_id},!confirm("Вы действительно хотите удалить рекламную компанию?")){e.next=10;break}return e.next=4,this.getData("delete_adv",{id:t});case 4:return e.sent.st||alert("При удалении произошла ошибка"),e.next=8,this.getData("get_adv_point",n);case 8:a=e.sent,this.setState({adv_actual:a.adv_actual,adv_old:a.adv_old});case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),this.state.showItem?a.createElement(G.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,description:"",name:"",promo:"",choosePoint:[],date_start:ea(new Date),date_end:ea(new Date)})}},a.createElement($.Z,null,'Компания "',this.state.name,'"'),a.createElement(Q.Z,{style:{paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.name,func:function(t){e.setState({name:t.target.value})},label:"Название акции"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Re,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Re,{label:"Дата от",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Te,{data:this.state.points,value:this.state.choosePoint,func:function(t,n){e.setState({choosePoint:n})},multiple:!0,label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.description,func:function(t){e.setState({description:t.target.value})},label:"Описание"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.promo,func:function(t){e.setState({promo:t.target.value})},label:"Промокод"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Показать акцию",value:1==this.state.is_active,func:this.changeChekBox.bind(this,"is_active")})))),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:this.save.bind(this)},"Сохранить"))):null,a.createElement(G.Z,{open:this.state.modalDialogNew,onClose:function(){e.setState({modalDialogNew:!1,description:"",name:"",promo:"",choosePoint:[],date_start:ea(new Date),date_end:ea(new Date)})}},a.createElement($.Z,null,"Новая акция"),a.createElement(Q.Z,{style:{paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.name,func:function(t){e.setState({name:t.target.value})},label:"Название компании"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Re,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Re,{label:"Дата от",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Te,{data:this.state.points,value:this.state.choosePoint,func:function(t,n){e.setState({choosePoint:n})},multiple:!0,label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.description,func:function(t){e.setState({description:t.target.value})},label:"Описание"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(Ne,{value:this.state.promo,func:function(t){e.setState({promo:t.target.value})},label:"Промокод"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Показать акцию",value:1==this.state.is_active,func:this.changeChekBox.bind(this,"is_active")})))),a.createElement(q.Z,null,a.createElement(J.Z,{color:"primary",onClick:this.saveNew.bind(this)},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(J.Z,{variant:"contained",color:"primary",onClick:function(){e.setState({modalDialogNew:!0})}},"Добавить акцию")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.points_filter,value:this.state.point_id,func:this.changePoint.bind(this),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h2",{style:{textAlign:"center"}},"Актвные")),a.createElement(de.Z,{component:fe.Z,style:{marginTop:10}},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}},"#"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Название"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Дата начало"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Дата окончания"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Точки"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Промокод"),a.createElement(ue.Z,{style:{textAlign:"center"}}))),a.createElement(me.Z,null,this.state.adv_actual?this.state.adv_actual.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,{style:{textAlign:"center"}},n+1," "),a.createElement(ue.Z,{style:{textAlign:"center",cursor:"pointer"},onClick:e.openCat.bind(e,t)},t.name," "),a.createElement(ue.Z,{style:{textAlign:"center"}},t.date_start," "),a.createElement(ue.Z,{style:{textAlign:"center"}},t.date_end," "),a.createElement(ue.Z,{style:{textAlign:"center"}},t.choosePoint.map((function(e,t){return a.createElement(a.Fragment,{key:t}," ",e.name," ")}))),a.createElement(ue.Z,{style:{textAlign:"center"}},t.promo," "),a.createElement(ue.Z,{style:{textAlign:"center"}}," ",a.createElement(Ue.Z,{onClick:e.delAdv.bind(e,t.id)})," "))})):null)))),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(D.ZP,{container:!0},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h2",{style:{textAlign:"center"}},"Не Актвные")),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(de.Z,{component:fe.Z,style:{marginTop:10}},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{textAlign:"center"}}),a.createElement(ue.Z,{style:{textAlign:"center"}},"Название"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Дата начало"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Дата окончания"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Точки"),a.createElement(ue.Z,{style:{textAlign:"center"}},"Промокод"),a.createElement(ue.Z,{style:{textAlign:"center"}}))),a.createElement(me.Z,null,this.state.adv_old?this.state.adv_old.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,{style:{textAlign:"center"}},n+1," "),a.createElement(ue.Z,{style:{textAlign:"center",cursor:"pointer"},onClick:e.openCat.bind(e,t)},t.name," "),a.createElement(ue.Z,{style:{textAlign:"center"}},t.date_start," "),a.createElement(ue.Z,{style:{textAlign:"center"}},t.date_end," "),a.createElement(ue.Z,{style:{textAlign:"center"}},t.choosePoint.map((function(e,t){return a.createElement(a.Fragment,{key:t}," ",e.name," ")}))),a.createElement(ue.Z,{style:{textAlign:"center"}},t.promo," "),a.createElement(ue.Z,{style:{textAlign:"center"}}," ",a.createElement(Ue.Z,{onClick:e.delAdv.bind(e,t.id)})," "))})):null))))))))}}]),Z}(a.Component);function na(){return a.createElement(ta,null)}n(2885);var aa=n(7563);function ia(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}var sa=function(e){(0,m.Z)(g,e);var t,n,i,s,p,E,_=(p=g,E=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(p);if(E){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function g(e){var t;return(0,l.Z)(this,g),t=_.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:aa.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"ras_bill_and_cook",module_name:"",is_load:!1,points:[],point:0,rev_list:[],rev:0,cats:[],date_end:ia(new Date)},t}return(0,o.Z)(g,[{key:"componentDidMount",value:(s=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({points:t.points,point:t.points[0].id,module_name:t.module_info.name}),document.title=t.module_info.name,setTimeout((function(){n.changePoint({target:{value:t.points[0].id}})}),300);case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"updateData",value:(i=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point,date_start:this.state.rev,date_end:this.state.date_end},e.next=3,this.getData("show",t);case 3:n=e.sent,console.log(n),this.setState({cats:n.cats});case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"changePoint",value:(n=(0,r.Z)(f().mark((function e(t){var n,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.value,a={point_id:n},e.next=4,this.getData("get_rev_list",a);case 4:i=e.sent,this.setState({point:n,rev_list:i,rev:i[0].id});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"changeRev",value:(t=(0,r.Z)(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.target.value,this.setState({rev:n});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"changeDate",value:function(e){this.setState({date_end:ia(e)})}},{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.rev_list,value:this.state.rev,func:this.changeRev.bind(this),label:"Ревизия"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Re,{label:"Дата до",value:this.state.date_end,func:this.changeDate.bind(this)})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),a.createElement(D.ZP,{item:!0,xs:12},this.state.cats.map((function(e,t){return a.createElement(T.Z,{key:t},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null)},a.createElement(x.Z,null,e.name)),a.createElement(N.Z,null,e.cats.map((function(e,t){return a.createElement(T.Z,{key:t},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null)},a.createElement(x.Z,null,e.name)),a.createElement(N.Z,null,a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{width:"5%"}},"#"),a.createElement(ue.Z,{style:{width:"20%"}},"Товар"),a.createElement(ue.Z,{style:{width:"20%"}},"Ревизия"),a.createElement(ue.Z,{style:{width:"15%"}},"Кол-во по накладным"),a.createElement(ue.Z,{style:{width:"15%"}},"Кол-во по продажам"),a.createElement(ue.Z,{style:{width:"15%"}},"Разница"),a.createElement(ue.Z,{style:{width:"10%"}},"Ед. измер"))),a.createElement(me.Z,null,e.items.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,null,t+1),a.createElement(ue.Z,null,e.name),a.createElement(ue.Z,null,e.count_rev),a.createElement(ue.Z,null,e.count_bill),a.createElement(ue.Z,null,e.count_ras),a.createElement(ue.Z,null,e.count_res),a.createElement(ue.Z,null,e.ei_name))}))))))}))))})))))}}]),g}(a.Component);function ra(){return a.createElement(sa,null)}n(9839);var la=n(7563),oa=function(e){(0,m.Z)(S,e);var t,n,i,s,p,E,_,g,w,b,k,I,P=(k=S,I=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(k);if(I){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function S(e){var t;return(0,l.Z)(this,S),t=P.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return 1==a&&t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:la.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){setTimeout((function(){t.setState({is_load:!1})}),300),console.log(e)}))})),t.state={module:"sklad_items_module",module_name:"",is_load:!1,cats:[],allItems:[],vendor_items:[],modalItemEdit:!1,modalItemNew:!1,itemEdit:null,itemName:"",checkArtDialog:!1,checkArtList:[],freeItems:[],searchItem:""},t}return(0,o.Z)(S,[{key:"componentDidMount",value:(b=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,console.log(t),this.setState({module_name:t.module_info.name,cats:t.cats,freeItems:t.items_free}),document.title=t.module_info.name;case 6:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"changeCity",value:(w=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={city:t.target.value},e.next=3,this.getData("get_vendors",n);case 3:a=e.sent,this.setState({vendors:a,city:t.target.value});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"changeSort",value:function(e,t){var n=this;this.state.vendor_items.map((function(a,i){parseInt(a.item_id)==parseInt(e)&&(n.state.vendor_items[i].sort=t.target.value)})),this.setState({vendor_items:this.state.vendor_items})}},{key:"changeItem",value:function(e,t){var n=this.state.itemEdit;n.item[e]="two_user"==e||"w_item"==e||"w_trash"==e||"w_pf"==e||"is_show"==e?!0===t.target.checked?1:0:t.target.value,this.setState({itemEdit:n})}},{key:"showEditItem",value:(g=(0,r.Z)(f().mark((function e(t){var n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={item_id:t},e.next=3,this.getData("get_one",n);case 3:a=e.sent,this.setState({modalItemEdit:!0,itemEdit:a,itemName:a.item.name});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"saveEditItem",value:(_=(0,r.Z)(f().mark((function e(){var t,n,a,i=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:0,n={id:this.state.itemEdit.item.id,item:this.state.itemEdit,storages:this.state.itemEdit.this_storages,main_item_id:0==parseInt(t)?this.state.itemEdit.item.id:parseInt(t)},e.next=4,this.getData("saveEditItem",n);case 4:if(!1!==(a=e.sent).st){e.next=9;break}alert(a.text),e.next=14;break;case 9:return this.setState({modalItemEdit:!1,itemEdit:null,checkArtDialog:!1,checkArtList:[]}),e.next=12,this.getData("get_all");case 12:a=e.sent,this.setState({cats:a.cats,freeItems:a.items_free});case 14:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"saveNewItem",value:(E=(0,r.Z)(f().mark((function e(){var t,n,a,i=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:0,n={id:this.state.itemEdit.item.id,item:this.state.itemEdit,storages:this.state.itemEdit.this_storages,main_item_id:0==parseInt(t)?this.state.itemEdit.item.id:parseInt(t)},e.next=4,this.getData("saveNewItem",n);case 4:if(!1!==(a=e.sent).st){e.next=9;break}alert(a.text),e.next=14;break;case 9:return this.setState({modalItemNew:!1,itemEdit:null,checkArtDialog:!1,checkArtList:[]}),e.next=12,this.getData("get_all");case 12:a=e.sent,this.setState({cats:a.cats,freeItems:a.items_free});case 14:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"checkArt",value:(p=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={id:this.state.itemEdit.item.id,art:this.state.itemEdit.item.art},e.next=3,this.getData("checkArt",t);case 3:!1===(n=e.sent).st?this.setState({checkArtDialog:!0,checkArtList:n.data}):this.saveEditItem(0);case 5:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"checkArtNew",value:(s=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={id:this.state.itemEdit.item.id,art:this.state.itemEdit.item.art},e.next=3,this.getData("checkArt",t);case 3:!1===(n=e.sent).st?(n.data.push({id:-1,name:this.state.itemEdit.item.name}),this.setState({checkArtDialog:!0,checkArtList:n.data})):this.saveNewItem(0);case 5:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"chooseArt",value:function(e){!0===this.state.modalItemNew?this.saveNewItem(e):this.saveEditItem(e)}},{key:"openModalItemNew",value:(i=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all_for_new");case 2:t=e.sent,console.log(t),this.setState({modalItemNew:!0,itemEdit:t});case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"saveItem",value:(n=(0,r.Z)(f().mark((function e(t,n,a){var i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={item_id:t,type:n,value:a},e.next=3,this.getData("saveItem",i,!1);case 3:if(!1!==(s=e.sent).st){e.next=8;break}alert(s.text),e.next=13;break;case 8:return this.setState({modalItemNew:!1,modalItemEdit:!1,itemEdit:null,checkArtDialog:!1,checkArtList:[]}),e.next=11,this.getData("get_all");case 11:s=e.sent,this.setState({cats:s.cats,freeItems:s.items_free});case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,a){return n.apply(this,arguments)})},{key:"changeTableItem",value:function(e,t,n){if(1==parseInt(t)){var a=n.target.checked,i=this.state.cats;i.map((function(t,n){t.cats.map((function(t,s){t.items.map((function(t,r){parseInt(t.id)==parseInt(e)&&(i[n].cats[s].items[r].show_in_rev=1==a?1:0)}))}))})),this.setState({cats:i}),this.saveItem(e,"show_in_rev",1==a?1:0)}if(3==parseInt(t)){var s=n.target.value,r=this.state.cats;r.map((function(t,n){t.cats.map((function(t,a){t.items.map((function(t,i){parseInt(t.id)==parseInt(e)&&(r[n].cats[a].items[i].handle_price=s)}))}))})),this.setState({cats:r}),this.saveItem(e,"handle_price",s)}if(2==parseInt(t)){var l=n.target.value,o=this.state.freeItems;o.map((function(t,n){parseInt(t.id)==parseInt(e)&&(o[n].show_in_rev=1==l?1:0)})),this.setState({freeItems:o}),this.saveItem(e,"show_in_rev",1==l?1:0)}if(4==parseInt(t)){var c=n.target.value,m=this.state.freeItems;m.map((function(t,n){parseInt(t.id)==parseInt(e)&&(m[n].handle_price=c)})),this.setState({freeItems:m}),this.saveItem(e,"handle_price",c)}}},{key:"search",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={item:this.state.searchItem},e.next=3,this.getData("get_all_search",t);case 3:n=e.sent,console.log(n),this.setState({cats:n.cats,freeItems:n.items_free});case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{onClose:function(){e.setState({checkArtDialog:!1,checkArtList:[]})},open:this.state.checkArtDialog},a.createElement($.Z,null,"Такой код 1с уже задан у следующих позиций:"),a.createElement(Z.Z,{sx:{pt:0}},this.state.checkArtList.map((function(t,n){return a.createElement(v.ZP,{button:!0,onClick:e.chooseArt.bind(e,t.id),key:n},a.createElement(y.Z,{primary:t.name}))})))),a.createElement(G.Z,{open:this.state.modalItemEdit,fullWidth:!0,maxWidth:"md",onClose:function(){e.setState({modalItemEdit:!1,itemEdit:null,checkArtDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.createElement($.Z,null,"Редактирвоание товара ",this.state.itemName),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},this.state.itemEdit?a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Название товара",value:this.state.itemEdit.item.name,func:this.changeItem.bind(this,"name")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.itemEdit.pf_list,value:this.state.itemEdit.item.pf_id,func:this.changeItem.bind(this,"pf_id"),label:"Заготовка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Название товара для поставщика",value:this.state.itemEdit.item.name_for_vendor,func:this.changeItem.bind(this,"name_for_vendor")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Код для 1с",value:this.state.itemEdit.item.art,func:this.changeItem.bind(this,"art")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Максимальное количество заказов в месяц (0 - без ограничений)",value:this.state.itemEdit.item.max_count_in_m,func:this.changeItem.bind(this,"max_count_in_m")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.itemEdit.cats,value:this.state.itemEdit.item.cat_id,func:this.changeItem.bind(this,"cat_id"),label:"Категория"})))),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Количество в упаковке",value:this.state.itemEdit.item.pq,func:this.changeItem.bind(this,"pq")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.itemEdit.ed_izmer,value:this.state.itemEdit.item.ed_izmer_id,func:this.changeItem.bind(this,"ed_izmer_id"),label:"Ед измер"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.itemEdit.apps,value:this.state.itemEdit.item.app_id,func:this.changeItem.bind(this,"app_id"),label:"Должность на кухне"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время приготовления ММ:SS (15:20)",value:this.state.itemEdit.item.time_min,func:this.changeItem.bind(this,"time_min")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Дополнительное время ММ:SS (15:20)",value:this.state.itemEdit.item.time_dop_min,func:this.changeItem.bind(this,"time_dop_min")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время разгрузки ММ:SS.iiii (00:20.004)",value:this.state.itemEdit.item.time_min_other,func:this.changeItem.bind(this,"time_min_other")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"% потерь",value:this.state.itemEdit.item.los_percent,func:this.changeItem.bind(this,"los_percent")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"% заявки",value:this.state.itemEdit.item.percent,func:this.changeItem.bind(this,"percent")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"% повышения ценника",value:this.state.itemEdit.item.vend_percent,func:this.changeItem.bind(this,"vend_percent")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{label:"Вес заготовки",value:1==parseInt(this.state.itemEdit.item.w_pf),func:this.changeItem.bind(this,"w_pf")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{label:"Вес отхода",value:1==parseInt(this.state.itemEdit.item.w_trash),func:this.changeItem.bind(this,"w_trash")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{label:"Вес товара",value:1==parseInt(this.state.itemEdit.item.w_item),func:this.changeItem.bind(this,"w_item")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{label:"Два сотрудника",value:1==parseInt(this.state.itemEdit.item.two_user),func:this.changeItem.bind(this,"two_user")})),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(Te,{label:"Места хранения",multiple:!0,data:this.state.itemEdit.storages,value:this.state.itemEdit.this_storages,func:function(t,n){var a=e.state.itemEdit;a.this_storages=n,e.setState({itemEdit:a})}})),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(Me,{label:"Активность",value:1==parseInt(this.state.itemEdit.item.is_show),func:this.changeItem.bind(this,"is_show")}))):null)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.checkArt.bind(this),color:"primary"},"Сохранить"))),a.createElement(G.Z,{open:this.state.modalItemNew,fullWidth:!0,maxWidth:"md",onClose:function(){e.setState({modalItemNew:!1,itemEdit:null,checkArtDialog:!1})}},a.createElement($.Z,null,"Новый товар"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},this.state.itemEdit?a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Название товара",value:this.state.itemEdit.item.name,func:this.changeItem.bind(this,"name")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.itemEdit.pf_list,value:this.state.itemEdit.item.pf_id,func:this.changeItem.bind(this,"pf_id"),label:"Заготовка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Название товара для поставщика",value:this.state.itemEdit.item.name_for_vendor,func:this.changeItem.bind(this,"name_for_vendor")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Код для 1с",value:this.state.itemEdit.item.art,func:this.changeItem.bind(this,"art")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Максимальное количество заказов в месяц (0 - без ограничений)",value:this.state.itemEdit.item.max_count_in_m,func:this.changeItem.bind(this,"max_count_in_m")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.itemEdit.cats,value:this.state.itemEdit.item.cat_id,func:this.changeItem.bind(this,"cat_id"),label:"Категория"})))),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Количество в упаковке",value:this.state.itemEdit.item.pq,func:this.changeItem.bind(this,"pq")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.itemEdit.ed_izmer,value:this.state.itemEdit.item.ed_izmer_id,func:this.changeItem.bind(this,"ed_izmer_id"),label:"Ед измер"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.itemEdit.apps,value:this.state.itemEdit.item.app_id,func:this.changeItem.bind(this,"app_id"),label:"Должность на кухне"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время приготовления ММ:SS (15:20)",value:this.state.itemEdit.item.time_min,func:this.changeItem.bind(this,"time_min")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Дополнительное время ММ:SS (15:20)",value:this.state.itemEdit.item.time_dop_min,func:this.changeItem.bind(this,"time_dop_min")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время разгрузки ММ:SS.iiii (00:20.004)",value:this.state.itemEdit.item.time_min_other,func:this.changeItem.bind(this,"time_min_other")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"% потерь",value:this.state.itemEdit.item.los_percent,func:this.changeItem.bind(this,"los_percent")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"% заявки",value:this.state.itemEdit.item.percent,func:this.changeItem.bind(this,"percent")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"% повышения ценника",value:this.state.itemEdit.item.vend_percent,func:this.changeItem.bind(this,"vend_percent")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{label:"Вес заготовки",value:1==parseInt(this.state.itemEdit.item.w_pf),func:this.changeItem.bind(this,"w_pf")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{label:"Вес отхода",value:1==parseInt(this.state.itemEdit.item.w_trash),func:this.changeItem.bind(this,"w_trash")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{label:"Вес товара",value:1==parseInt(this.state.itemEdit.item.w_item),func:this.changeItem.bind(this,"w_item")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{label:"Два сотрудника",value:1==parseInt(this.state.itemEdit.item.two_user),func:this.changeItem.bind(this,"two_user")})),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(Te,{label:"Места хранения",multiple:!0,data:this.state.itemEdit.storages,value:this.state.itemEdit.this_storages,func:function(t,n){var a=e.state.itemEdit;a.this_storages=n,e.setState({itemEdit:a})}}))):null)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.checkArtNew.bind(this),color:"primary"},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{onClick:this.openModalItemNew.bind(this),variant:"contained"},"Добавить товар")),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Поиск",value:this.state.searchItem,func:function(t){e.setState({searchItem:t.target.value})},onBlur:this.search.bind(this)})),a.createElement(D.ZP,{item:!0,xs:12},this.state.cats.map((function(t,n){return a.createElement(T.Z,{key:n},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null)},a.createElement(x.Z,null,t.name)),a.createElement(N.Z,null,t.cats.map((function(t,n){return a.createElement(T.Z,{key:n},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null)},a.createElement(x.Z,null,t.name)),a.createElement(N.Z,{style:{width:"100%",overflow:"scroll"}},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{width:"2%"}},"id"),a.createElement(ue.Z,{style:{width:"2%"}}),a.createElement(ue.Z,{style:{width:"3%"}},"Ревизия"),a.createElement(ue.Z,{style:{width:"15%"}},"Товар"),a.createElement(ue.Z,{style:{width:"10%"}},"% потерь"),a.createElement(ue.Z,{style:{width:"10%"}},"% заявки"),a.createElement(ue.Z,{style:{width:"15%"}},"Заготовка"),a.createElement(ue.Z,{style:{width:"5%"}},"Ед. измер"),a.createElement(ue.Z,{style:{width:"9%"}},"Место хранения"),a.createElement(ue.Z,{style:{width:"9%",minWidth:150}},"Моя цена"))),a.createElement(me.Z,null,t.items.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.id),a.createElement(ue.Z,null,1==parseInt(t.is_show)?a.createElement(Ke.Z,null):a.createElement($e.Z,null)),a.createElement(ue.Z,null,a.createElement(Me,{label:"",value:1==parseInt(t.show_in_rev),func:e.changeTableItem.bind(e,t.id,1)})),a.createElement(ue.Z,{style:{cursor:"pointer"},onClick:e.showEditItem.bind(e,t.id)},t.name),a.createElement(ue.Z,null,t.los_percent," %"),a.createElement(ue.Z,null,t.percent," %"),a.createElement(ue.Z,null,t.pf_name),a.createElement(ue.Z,null,t.ei_name),a.createElement(ue.Z,null,t.storage_name),a.createElement(ue.Z,null,a.createElement(Ne,{label:"",value:t.handle_price,func:e.changeTableItem.bind(e,t.id,3)})))}))))))}))))})),0==this.state.freeItems.length?null:a.createElement(T.Z,null,a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null)},a.createElement(x.Z,null,"Без категории")),a.createElement(N.Z,{style:{width:"100%",overflow:"scroll"}},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{width:"2%"}},"id"),a.createElement(ue.Z,{style:{width:"2%"}}),a.createElement(ue.Z,{style:{width:"3%"}},"Ревизия"),a.createElement(ue.Z,{style:{width:"15%"}},"Товар"),a.createElement(ue.Z,{style:{width:"10%"}},"% потерь"),a.createElement(ue.Z,{style:{width:"10%"}},"% заявки"),a.createElement(ue.Z,{style:{width:"15%"}},"Заготовка"),a.createElement(ue.Z,{style:{width:"5%"}},"Ед. измер"),a.createElement(ue.Z,{style:{width:"9%"}},"Место хранения"),a.createElement(ue.Z,{style:{width:"9%",minWidth:150}},"Моя цена"))),a.createElement(me.Z,null,this.state.freeItems.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.id),a.createElement(ue.Z,null,1==parseInt(t.is_show)?a.createElement(Ke.Z,null):a.createElement($e.Z,null)),a.createElement(ue.Z,null,a.createElement(Me,{label:"",value:1==parseInt(t.show_in_rev),func:e.changeTableItem.bind(e,t.id,2)})),a.createElement(ue.Z,{style:{cursor:"pointer"},onClick:e.showEditItem.bind(e,t.id)},t.name),a.createElement(ue.Z,null,t.los_percent," %"),a.createElement(ue.Z,null,t.percent," %"),a.createElement(ue.Z,null,t.pf_name),a.createElement(ue.Z,null,t.ei_name),a.createElement(ue.Z,null,t.storage_name),a.createElement(ue.Z,null,a.createElement(Ne,{label:"",value:t.handle_price,func:e.changeTableItem.bind(e,t.id,4)})))})))))))))}}]),S}(a.Component);function ca(){return a.createElement(oa,null)}n(6751);var ma=n(5436);var ua=n(7563),da=function(e){(0,m.Z)(v,e);var t,n,i,s,p,E,_,g,Z=(_=v,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(_);if(g){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function v(e){var t;return(0,l.Z)(this,v),t=Z.call(this,e),(0,h.Z)((0,c.Z)(t),"dropzoneOptions",{autoProcessQueue:!1,autoQueue:!0,maxFiles:1,timeout:0,parallelUploads:10,acceptedFiles:"image/jpeg,image/png",addRemoveLinks:!0,url:"https://jacochef.ru/src/img/users/upload.php"}),(0,h.Z)((0,c.Z)(t),"myDropzone",null),(0,h.Z)((0,c.Z)(t),"isInit",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return 1==a&&t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:ua.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){setTimeout((function(){t.setState({is_load:!1})}),300),console.log(e)}))})),t.state={module:"site_user_manager",module_name:"",is_load:!1,cats:[],allItems:[],vendor_items:[],modalItemEdit:!1,modalItemNew:!1,itemEdit:null,itemName:"",checkArtDialog:!1,checkArtList:[],freeItems:[],point_list:[],point_list_render:[],point_id:0,app_list:[],app_id:-1,users:[],editUser:null,modalUserEdit:!1,modalUserNew:!1,textDel:"",delModal:!1,graphModal:!1,graphType:0},t}return(0,o.Z)(v,[{key:"componentDidMount",value:(E=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,point_list:t.points,app_list:t.apps}),setTimeout((function(){n.changeSort("point_id",{target:{value:t.points[0].id}})}),500),document.title=t.module_info.name;case 6:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"changeSort",value:function(e,t){var n=this;this.setState((0,h.Z)({},e,t.target.value)),setTimeout((function(){n.getUsers()}),300)}},{key:"getUsers",value:(p=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point_id,app_id:this.state.app_id},e.next=3,this.getData("getUsers",t);case 3:n=e.sent,this.setState({users:n});case 5:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"openEditUser",value:(s=(0,r.Z)(f().mark((function e(t){var n,a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={user_id:t},e.next=3,this.getData("getUser",n);case 3:a=e.sent,this.setState({editUser:a,modalUserEdit:!0}),setTimeout((function(){i.sortPoint(),i.myDropzone=new ma.Z("#for_img_edit",i.dropzoneOptions)}),300);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"openNewUser",value:(i=(0,r.Z)(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("getAllForNew");case 2:t=e.sent,this.setState({editUser:t,modalUserNew:!0}),setTimeout((function(){n.sortPoint(),n.myDropzone=new ma.Z("#for_img_new",n.dropzoneOptions)}),300);case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"changeItem",value:function(e,t){var n,a,i,s,r=this,l=this.state.editUser;l.user[e]="birthday"==e?(a=""+((n=new Date(t)).getMonth()+1),i=""+n.getDate(),s=n.getFullYear(),a.length<2&&(a="0"+a),i.length<2&&(i="0"+i),[s,a,i].join("-")):"acc_to_kas"==e?!0===t.target.checked?1:0:t.target.value,this.setState({editUser:l}),"city_id"==e&&setTimeout((function(){r.sortPoint()}),300)}},{key:"sortPoint",value:function(){var e,t=this.state.editUser.user.city_id,n=this.state.editUser.point_list;e=-1==parseInt(t)?n:n.filter((function(e){return parseInt(e.city_id)==parseInt(t)||-1==parseInt(e.city_id)})),this.setState({point_list_render:e})}},{key:"saveEditUser",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!1,this.state.app_list.map((function(e,n){parseInt(i.state.editUser.user.app_id)==parseInt(e.id)&&1==parseInt(e.is_graph)&&0==parseInt(i.state.graphType)&&(t=!0)})),!0!==t){e.next=5;break}return this.setState({graphModal:!0}),e.abrupt("return");case 5:if(0!=parseInt(this.state.editUser.user.app_id)||0!=this.state.textDel.length){e.next=8;break}return this.setState({delModal:!0}),e.abrupt("return");case 8:return this.myDropzone.files.length>0&&!1===this.isInit&&(this.isInit=!0,this.myDropzone.on("sending",(function(e,t,n){var a=i.state.editUser.user.id,s=e.name.split(".");s=(s=s[s.length-1]).toLowerCase(),n.append("filetype","user_"+a+"."+s),n.append("filename","user_"+a),i.getOrientation(e,(function(e){n.append("orientation",e)}))})),this.myDropzone.on("queuecomplete",(function(e){var t=!1;i.myDropzone.files.map((function(e,n){"error"==e.status&&(t=!0)})),t?alert("Ошибка при загрузке фотографии"):(i.setState({modalUserEdit:!1,editUser:null}),i.isInit=!1,i.getUsers())}))),n={user:this.state.editUser,textDel:this.state.textDel,graphType:this.state.graphType},e.next=12,this.getData("saveEditUser",n);case 12:!1===(a=e.sent).st?alert(a.text):0==this.myDropzone.files.length?(this.isInit=!1,this.setState({modalUserEdit:!1,editUser:null}),this.getUsers()):this.myDropzone.processQueue();case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"saveNewUser",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!1,n=!1,this.state.app_list.map((function(e,a){parseInt(r.state.editUser.user.app_id)==parseInt(e.id)&&(1==parseInt(e.is_graph)&&(n=!0),1==parseInt(e.is_graph)&&0==parseInt(r.state.graphType)&&(t=!0))})),!0!==n||0!=this.myDropzone.files.length){e.next=6;break}return alert("Необходимо фотография сотрудника"),e.abrupt("return");case 6:return this.myDropzone.files.length>0&&!1===this.isInit&&(this.isInit=!0,this.myDropzone.on("sending",(function(e,t,n){var a=r.state.editUser.user.id,i=e.name.split(".");i=(i=i[i.length-1]).toLowerCase(),n.append("filetype","user_"+a+"."+i),n.append("filename","user_"+a),r.getOrientation(e,(function(e){n.append("orientation",e)}))})),this.myDropzone.on("queuecomplete",(function(e){var t=!1;r.myDropzone.files.map((function(e,n){"error"==e.status&&(t=!0)})),t?alert("Ошибка при загрузке фотографии"):(r.setState({modalUserNew:!1,editUser:null}),r.isInit=!1,r.getUsers())}))),a={user:this.state.editUser,graphType:!0===t?1:0},e.next=10,this.getData("saveNewUser",a);case 10:!1===(i=e.sent).st?alert(i.text):(!1===i.sms&&alert("Ошибка в отправке смс"),0==this.myDropzone.files.length?(this.isInit=!1,this.setState({modalUserEdit:!1,editUser:null}),this.getUsers()):((s=this.state.editUser).user.id=i.user_id,this.setState({editUser:s}),setTimeout((function(){r.myDropzone.processQueue()}),300)));case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getOrientation",value:function(e,t){var n=new FileReader;n.onload=function(e){var n=new DataView(e.target.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var a=n.byteLength,i=2;i<a;){var s=n.getUint16(i,!1);if(i+=2,65505==s){if(1165519206!=n.getUint32(i+=2,!1))return t(-1);var r=18761==n.getUint16(i+=6,!1);i+=n.getUint32(i+4,r);var l=n.getUint16(i,r);i+=2;for(var o=0;o<l;o++)if(274==n.getUint16(i+12*o,r))return t(n.getUint16(i+12*o+8,r))}else{if(65280!=(65280&s))break;i+=n.getUint16(i,!1)}}return t(-1)},n.readAsArrayBuffer(e.slice(0,65536))}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(W.Z,{style:{zIndex:99},open:this.state.is_load},a.createElement(j.Z,{color:"inherit"})),a.createElement(G.Z,{open:this.state.delModal,onClose:function(){e.setState({delModal:!1,textDel:""})}},a.createElement($.Z,null,"Причина увольнения"),a.createElement(Q.Z,null,a.createElement(K.Z,null,"Увольнение происходит не сразу, а в полночь"),a.createElement(D.ZP,{container:!0,spacing:3,style:{paddingBottom:10,paddingTop:20}},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(Ne,{label:"Причина увольнения",value:this.state.textDel,func:function(t){e.setState({textDel:t.target.value})}})))),a.createElement(q.Z,{style:{display:"flex",justifyContent:"space-between"}},a.createElement(J.Z,{variant:"contained",onClick:this.saveEditUser.bind(this)},"Уволить"),a.createElement(J.Z,{onClick:function(){e.setState({delModal:!1,textDel:""})}},"Отмена"))),a.createElement(G.Z,{open:this.state.graphModal,onClose:function(){e.setState({graphModal:!1,graphType:0})}},a.createElement($.Z,null,"С какого периода применить изменения ?"),a.createElement(Q.Z,null,a.createElement(D.ZP,{container:!0,spacing:3,style:{paddingBottom:10,paddingTop:20}},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:function(){e.setState({graphType:1}),e.saveEditUser()},style:{width:"100%"}},"С текущего периода")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:function(){e.setState({graphType:2}),e.saveEditUser()},style:{width:"100%"}},"Со следующего периода")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:function(){e.setState({graphType:-1}),e.saveEditUser()},style:{width:"100%"}},"Без изменений"))))),a.createElement(G.Z,{open:this.state.modalUserEdit,fullWidth:!0,maxWidth:"md",onClose:function(){e.setState({modalUserEdit:!1,editUser:null})}},a.createElement($.Z,null,"Редактирвоание сотрудника"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},this.state.editUser&&this.state.modalUserEdit?a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Фамилия",value:this.state.editUser.user.fam,func:this.changeItem.bind(this,"fam")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Имя",value:this.state.editUser.user.name,func:this.changeItem.bind(this,"name")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Отчество",value:this.state.editUser.user.otc,func:this.changeItem.bind(this,"otc")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Номер телефона",value:this.state.editUser.user.login,func:this.changeItem.bind(this,"login")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Re,{label:"Дата рождения",value:this.state.editUser.user.birthday,func:this.changeItem.bind(this,"birthday")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement("img",{src:"https://storage.yandexcloud.net/user-img/max-img/"+this.state.editUser.user.img_name+"?"+this.state.editUser.user.img_update,style:{maxWidth:300,maxHeight:300}})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement("div",{className:"dropzone",id:"for_img_edit",style:{width:"100%",minHeight:150}})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Код авторизации (4 цифры)",value:this.state.editUser.user.auth_code,func:this.changeItem.bind(this,"auth_code")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"ИНН",value:this.state.editUser.user.inn,func:this.changeItem.bind(this,"inn")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Me,{label:"Работает официально",value:1==parseInt(this.state.editUser.user.acc_to_kas),func:this.changeItem.bind(this,"acc_to_kas")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.editUser.appointment,value:this.state.editUser.user.app_id,func:this.changeItem.bind(this,"app_id"),label:"Должность"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.editUser.cities,value:this.state.editUser.user.city_id,func:this.changeItem.bind(this,"city_id"),label:"Город"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.point_list_render,value:this.state.editUser.user.point_id,func:this.changeItem.bind(this,"point_id"),label:"Точка"})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{minWidth:125}},"Дата"),a.createElement(ue.Z,null,"Кто обновлял"),a.createElement(ue.Z,null,"Имя"),a.createElement(ue.Z,null,"Телефон"),a.createElement(ue.Z,null,"Код авторизации"),a.createElement(ue.Z,null,"ИНН"),a.createElement(ue.Z,null,"Должность"),a.createElement(ue.Z,null,"Город"),a.createElement(ue.Z,null,"Точка"))),a.createElement(me.Z,null,this.state.editUser.user.history.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,{style:{minWidth:125}},e.date_time_update),a.createElement(ue.Z,null,e.update_name),a.createElement(ue.Z,null,e.name),a.createElement(ue.Z,null,e.login),a.createElement(ue.Z,null,e.auth_code),a.createElement(ue.Z,null,e.inn),a.createElement(ue.Z,null,e.app_name),a.createElement(ue.Z,null,e.city_name),a.createElement(ue.Z,null,e.point_name))}))))))))):null)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.saveEditUser.bind(this),color:"primary"},"Сохранить"))),a.createElement(G.Z,{open:this.state.modalUserNew,fullWidth:!0,maxWidth:"md",onClose:function(){e.setState({modalUserNew:!1,editUser:null})}},a.createElement($.Z,null,"Новый сотрудник"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},this.state.editUser&&this.state.modalUserNew?a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Фамилия",value:this.state.editUser.user.fam,func:this.changeItem.bind(this,"fam")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Имя",value:this.state.editUser.user.name,func:this.changeItem.bind(this,"name")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Отчество",value:this.state.editUser.user.otc,func:this.changeItem.bind(this,"otc")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Номер телефона",value:this.state.editUser.user.login,func:this.changeItem.bind(this,"login")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Re,{label:"Дата рождения",value:this.state.editUser.user.birthday,func:this.changeItem.bind(this,"birthday")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement("img",{src:"https://storage.yandexcloud.net/user-img/max-img/"+this.state.editUser.user.img_name+"?"+this.state.editUser.user.img_update,style:{maxWidth:300,maxHeight:300}})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement("div",{className:"dropzone",id:"for_img_new",style:{width:"100%",minHeight:150}})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Код авторизации (4 цифры)",value:this.state.editUser.user.auth_code,func:this.changeItem.bind(this,"auth_code")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"ИНН",value:this.state.editUser.user.inn,func:this.changeItem.bind(this,"inn")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Me,{label:"Работает официально",value:1==parseInt(this.state.editUser.user.acc_to_kas),func:this.changeItem.bind(this,"acc_to_kas")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.editUser.appointment,value:this.state.editUser.user.app_id,func:this.changeItem.bind(this,"app_id"),label:"Должность"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.editUser.cities,value:this.state.editUser.user.city_id,func:this.changeItem.bind(this,"city_id"),label:"Город"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.point_list_render,value:this.state.editUser.user.point_id,func:this.changeItem.bind(this,"point_id"),label:"Точка"}))))))):null)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.saveNewUser.bind(this),color:"primary"},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.point_list,value:this.state.point_id,func:this.changeSort.bind(this,"point_id"),label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.app_list,value:this.state.app_id,func:this.changeSort.bind(this,"app_id"),label:"Должность"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{onClick:this.openNewUser.bind(this),variant:"contained"},"Добавить сотрудника")),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(de.Z,{component:fe.Z},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"#"),a.createElement(ue.Z,null,"Фото"),a.createElement(ue.Z,null,"Телефон"),a.createElement(ue.Z,null,"Имя"),a.createElement(ue.Z,null,"Должность"))),a.createElement(me.Z,null,this.state.users.map((function(t,n){return a.createElement(pe.Z,{key:n,onClick:e.openEditUser.bind(e,t.id)},a.createElement(ue.Z,null,n+1),a.createElement(ue.Z,null,null===t.img_name?null:a.createElement("img",{src:"https://storage.yandexcloud.net/user-img/min-img/"+t.img_name+"?"+t.img_update,style:{maxWidth:100,maxHeight:100}})),a.createElement(ue.Z,null,t.login),a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,t.app_name))}))))))))}}]),v}(a.Component);function ha(){return a.createElement(da,null)}n(7331);var pa=n(7563);function fa(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}var Ea=function(e){(0,m.Z)(E,e);var t,n,i,s,p=(i=E,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(i);if(s){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function E(e){var t;return(0,l.Z)(this,E),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:pa.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),t.state={module:"promo_items_stat",module_name:"",is_load:!1,date_start:fa(new Date),date_end:fa(new Date),point_list:[],choosePoint:[],stats:[],chooseItem:null,items_list:[],promoName:""},t}return(0,o.Z)(E,[{key:"componentDidMount",value:(n=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,point_list:t.points,stats:t.stats,items_list:t.items}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getStat",value:(t=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={choosePoint:this.state.choosePoint,date_start:this.state.date_start,date_end:this.state.date_end,promoName:this.state.promoName,chooseItem:this.state.chooseItem},e.next=3,this.getData("get_all",t);case 3:n=e.sent,console.log(t),console.log(n),this.setState({stats:n.stats});case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"choosePoint",value:function(e,t){this.setState({choosePoint:t})}},{key:"chooseData",value:function(e,t,n){this.setState((0,h.Z)({},e,"promoName"!=e&&"chooseItem"!=e?fa(t):"chooseItem"==e?n:t))}},{key:"chooseDataNew",value:function(e,t,n){var a,i;"promoName"==e&&this.setState((a={},(0,h.Z)(a,e,t.target.value),(0,h.Z)(a,"chooseItem",t.target.value.length>0?null:this.state.chooseItem),a)),"chooseItem"==e&&this.setState((i={},(0,h.Z)(i,e,n),(0,h.Z)(i,"promoName",n?"":this.state.promoName),i))}},{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(W.Z,{open:this.state.is_load,style:{zIndex:99}},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:2},a.createElement(Te,{data:this.state.point_list,value:this.state.choosePoint,func:this.choosePoint.bind(this),multiple:!0,label:"Точка"})),a.createElement(D.ZP,{item:!0,xs:12,sm:2},a.createElement(Re,{label:"Дата от",value:this.state.date_start,func:this.chooseData.bind(this,"date_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:2},a.createElement(Re,{label:"Дата до",value:this.state.date_end,func:this.chooseData.bind(this,"date_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{value:this.state.promoName,func:this.chooseDataNew.bind(this,"promoName"),label:"Промокод"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Te,{data:this.state.items_list,value:this.state.chooseItem,func:this.chooseDataNew.bind(this,"chooseItem"),multiple:!1,label:"Товар"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.getStat.bind(this)},"Обновить")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null,"Кол-во"))),a.createElement(me.Z,null,this.state.stats?this.state.stats.map((function(e,t){return a.createElement(pe.Z,{key:t},a.createElement(ue.Z,{style:{textAlign:"left"}},e.name," "),a.createElement(ue.Z,{style:{textAlign:"left"}},e.count," "))})):null)))))}}]),E}(a.Component);function _a(){return a.createElement(Ea,null)}n(3692);var ga=n(7070),Za=n(5265),va=n(5670),ya=n(6568),xa=n(3055),wa=n(9986);function ba(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,d.Z)(e);if(t){var i=(0,d.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,u.Z)(this,n)}}var ka=n(7563),Ia=function(e){(0,m.Z)(n,e);var t=ba(n);function n(){return(0,l.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"render",value:function(){var e=this;return a.createElement(ce.Z,{size:"small",style:{marginBottom:50}},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{colSpan:5,style:{textAlign:"center"}},this.props.title)),a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null,"Количество"),a.createElement(ue.Z,null),a.createElement(ue.Z,null,"Сортировка"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,this.props.data.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(Ne,{label:"",value:t.count,func:e.props.changeData.bind(e,e.props.type,e.props.arr,"count",n)})),a.createElement(ue.Z,null,t.ei_name),a.createElement(ue.Z,{style:{maxWidth:100}},a.createElement(Ne,{label:"",value:t.sort,func:e.props.changeData.bind(e,e.props.type,e.props.arr,"sort",n)})),a.createElement(ue.Z,null,a.createElement(Ue.Z,{onClick:e.props.delItem.bind(e,e.props.type,e.props.arr,n),style:{cursor:"pointer"}})))}))))}}]),n}(a.Component),Da=function(e){(0,m.Z)(_,e);var t,n,i,s,u,d,p,E=ba(_);function _(e){var t;return(0,l.Z)(this,_),t=E.call(this,e),(0,h.Z)((0,c.Z)(t),"dropzoneOptions",{autoProcessQueue:!1,autoQueue:!0,maxFiles:1,timeout:0,parallelUploads:10,acceptedFiles:"image/jpeg,image/png",addRemoveLinks:!0,url:"https://jacochef.ru/src/img/site_img/upload_img_new.php"}),(0,h.Z)((0,c.Z)(t),"myDropzoneOld",null),(0,h.Z)((0,c.Z)(t),"myDropzoneNew",null),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return 1==a&&t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:ka.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){setTimeout((function(){t.setState({is_load:!1})}),300),console.log(e)}))})),t.state={module:"site_items",module_name:"",is_load:!1,allItems:[],vendor_items:[],modalItemEdit:!1,modalItemNew:!1,itemEdit:null,itemName:"",checkArtDialog:!1,checkArtList:[],freeItems:[],point_list:[],point_list_render:[],point_id:0,app_list:[],app_id:-1,users:[],modalUserEdit:!1,modalUserNew:!1,textDel:"",delModal:!1,graphModal:!1,graphType:0,editItem:null,item_rec:null,item_pf:null,item_items_all:[],modalEdit:!1,modalNew:!1,types:[{id:1,name:"Позиция (ролл)"},{id:2,name:"Набор (сет)"},{id:3,name:"Доп (палочки / соевый / ...)"},{id:4,name:"Напиток"}],cats:[],cat_list:[],ItemTab:"1",anchorEl:null,openMenu:!1,openMenuType:null,openMenuitem:null,rec_stage_1:[],rec_stage_2:[],rec_stage_3:[],pf_stage_1:[],pf_stage_2:[],pf_stage_3:[],item_items:[],myDropzoneOld:null,myDropzoneNew:null,is_snack:!1,textSnack:"",searchPf:"",item_pf_render:[],searchItems:"",item_items_render:[]},t}return(0,o.Z)(_,[{key:"componentDidMount",value:(p=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,cats:t.cats,cat_list:t.cat_list}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"getItems",value:(d=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({cats:t.cats,cat_list:t.cat_list});case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"openItem",value:(u=(0,r.Z)(f().mark((function e(t){var n,a,i,s,r,l,o,c,m,u=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:t.id},e.next=3,this.getData("get_one",n);case 3:a=e.sent,i=[],s=[],r=[],l=[],o=[],c=[],m=[],a.item_rec.stage_1&&a.item_rec.stage_1.map((function(e){l.push({item_id:e.rec_id,name:e.name,count:e.count,sort:e.sort,ei_name:e.ei_name})})),a.item_rec.stage_2&&a.item_rec.stage_2.map((function(e){o.push({item_id:e.rec_id,name:e.name,count:e.count,sort:e.sort,ei_name:e.ei_name})})),a.item_rec.stage_3&&a.item_rec.stage_3.map((function(e){c.push({item_id:e.rec_id,name:e.name,count:e.count,sort:e.sort,ei_name:e.ei_name})})),a.item_pf.stage_1&&a.item_pf.stage_1.map((function(e){i.push({item_id:e.pf_id,name:e.name,count:e.count,sort:e.sort,ei_name:e.ei_name})})),a.item_pf.stage_2&&a.item_pf.stage_2.map((function(e){s.push({item_id:e.pf_id,name:e.name,count:e.count,sort:e.sort,ei_name:e.ei_name})})),a.item_pf.stage_3&&a.item_pf.stage_3.map((function(e){r.push({item_id:e.pf_id,name:e.name,count:e.count,sort:e.sort,ei_name:e.ei_name})})),a.item_items.this_items&&a.item_items.this_items.map((function(e){m.push({item_id:e.item_id,name:e.name,count:e.count,is_add:parseInt(e.is_add)})})),this.setState({editItem:a.item,item_rec:a.item_rec,item_pf:a.item_pf,item_pf_render:a.item_pf.all,item_items_all:a.item_items.all_items,item_items_render:a.item_items.all_items,rec_stage_1:l,rec_stage_2:o,rec_stage_3:c,pf_stage_1:i,pf_stage_2:s,pf_stage_3:r,item_items:m,modalEdit:!0}),setTimeout((function(){u.myDropzoneOld=new ma.Z("#for_img_edit_old",u.dropzoneOptions),u.myDropzoneNew=new ma.Z("#for_img_edit_new",u.dropzoneOptions)}),300);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"openNew",value:(s=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r,l,o,c=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all_for_new");case 2:t=e.sent,n=[],a=[],i=[],s=[],r=[],l=[],o=[],this.setState({editItem:t.item,item_rec:t.item_rec,item_pf:t.item_pf,item_pf_render:t.item_pf.all,item_items_all:t.item_items.all_items,item_items_render:t.item_items.all_items,rec_stage_1:s,rec_stage_2:r,rec_stage_3:l,pf_stage_1:n,pf_stage_2:a,pf_stage_3:i,item_items:o,modalNew:!0}),setTimeout((function(){c.myDropzoneOld=new ma.Z("#for_img_edit_old",c.dropzoneOptions),c.myDropzoneNew=new ma.Z("#for_img_edit_new",c.dropzoneOptions)}),300);case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"changeItem",value:function(e,t){var n=this.state.editItem;if("category_id"==e){var a=t.target.value,i=1,s=n.stol;4==parseInt(a)&&(i=2,s=-1),6==parseInt(a)&&(i=4,s=0),7==parseInt(a)&&(i=3,s=0),n.type=i,n.stol=s}n[e]="is_show"==e||"show_site"==e||"show_program"==e||"is_new"==e||"is_hit"==e?!0===t.target.checked?1:0:t.target.value,this.setState({editItem:n})}},{key:"closeMenu",value:function(){this.setState({anchorEl:null,openMenu:!1,openMenuType:null,openMenuitem:null})}},{key:"openMenu",value:function(e,t,n){this.setState({anchorEl:n.currentTarget,openMenu:!0,openMenuType:e,openMenuitem:t})}},{key:"chooseStage",value:function(e){var t=this;if("rec"==this.state.openMenuType){var n=!1,a=1==e?this.state.rec_stage_1:2==e?this.state.rec_stage_2:3==e?this.state.rec_stage_3:[];(a=a||[]).map((function(e){parseInt(t.state.openMenuitem.id)==parseInt(e.item_id)&&(n=!0)})),n||(a.push({item_id:this.state.openMenuitem.id,name:this.state.openMenuitem.name,count:0,sort:0,ei_name:this.state.openMenuitem.ei_name}),1==e&&this.setState({rec_stage_1:a}),2==e&&this.setState({rec_stage_2:a}),3==e&&this.setState({rec_stage_3:a}))}if("pf"==this.state.openMenuType){var i=!1,s=1==e?this.state.pf_stage_1:2==e?this.state.pf_stage_2:3==e?this.state.pf_stage_3:[];(s=s||[]).map((function(e){parseInt(t.state.openMenuitem.id)==parseInt(e.item_id)&&(i=!0)})),i||(s.push({item_id:this.state.openMenuitem.id,name:this.state.openMenuitem.name,count:0,sort:0,ei_name:this.state.openMenuitem.ei_name}),1==e&&this.setState({pf_stage_1:s}),2==e&&this.setState({pf_stage_2:s}),3==e&&this.setState({pf_stage_3:s}))}this.closeMenu()}},{key:"forwardItem",value:function(e){var t=!1,n=this.state.item_items;(n=n||[]).map((function(n){parseInt(e.id)==parseInt(n.item_id)&&(t=!0)})),t||(n.push({item_id:e.id,name:e.name,count:1,is_add:0}),this.setState({item_items:n}))}},{key:"changeData",value:function(e,t,n,a,i){if("rec"==e){var s="rec_stage_1"==t?this.state.rec_stage_1:"rec_stage_2"==t?this.state.rec_stage_2:"rec_stage_3"==t?this.state.rec_stage_3:[];s[a][n]=i.target.value,"rec_stage_1"==t&&this.setState({rec_stage_1:s}),"rec_stage_2"==t&&this.setState({rec_stage_2:s}),"rec_stage_3"==t&&this.setState({rec_stage_3:s})}if("pf"==e){var r="pf_stage_1"==t?this.state.pf_stage_1:"pf_stage_2"==t?this.state.pf_stage_2:"pf_stage_3"==t?this.state.pf_stage_3:[];r[a][n]=i.target.value,"pf_stage_1"==t&&this.setState({pf_stage_1:r}),"pf_stage_2"==t&&this.setState({pf_stage_2:r}),"pf_stage_3"==t&&this.setState({pf_stage_3:r})}if("item"==e){var l=this.state.item_items;l[a][n]="is_add"==n?!0===i.target.checked?1:0:i.target.value,this.setState({item_items:l})}}},{key:"delItem",value:function(e,t,n){if("rec"==e){var a="rec_stage_1"==t?this.state.rec_stage_1:"rec_stage_2"==t?this.state.rec_stage_2:"rec_stage_3"==t?this.state.rec_stage_3:[];a.splice(n,1),a=a||[],"rec_stage_1"==t&&this.setState({rec_stage_1:a}),"rec_stage_2"==t&&this.setState({rec_stage_2:a}),"rec_stage_3"==t&&this.setState({rec_stage_3:a})}if("pf"==e){var i="pf_stage_1"==t?this.state.pf_stage_1:"pf_stage_2"==t?this.state.pf_stage_2:"pf_stage_3"==t?this.state.pf_stage_3:[];i.splice(n,1),i=i||[],"pf_stage_1"==t&&this.setState({pf_stage_1:i}),"pf_stage_2"==t&&this.setState({pf_stage_2:i}),"pf_stage_3"==t&&this.setState({pf_stage_3:i})}if("item"==e){var s=this.state.item_items;s.splice(n,1),s=s||[],this.setState({item_items:s})}}},{key:"saveImg",value:function(e,t,n,a){e.on("sending",(function(e,i,s){var r=e.name.split(".");r=(r=r[r.length-1]).toLowerCase(),s.append("filetype","user_"+n+"."+r),s.append("filename","user_"+n),s.append("typeFile",a),s.append("name",t)})),e.on("queuecomplete",(function(t){var n=!1;e.files.map((function(e,t){"error"==e.status&&(n=!0)})),n&&alert("Ошибка при загрузке фотографии "+a)}))}},{key:"saveEditItem",value:(i=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r,l=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.myDropzoneOld.files.length>0&&(t=this.state.editItem.name,n=this.state.editItem.id,this.myDropzoneOld.on("sending",(function(e,a,i){var s=e.name.split(".");s=(s=s[s.length-1]).toLowerCase(),i.append("typeFile","old"),i.append("name",t),i.append("id",n)})),this.myDropzoneOld.on("queuecomplete",(function(e){var t=!1,n=l.myDropzoneNew;l.myDropzoneOld.files.map((function(e,a){"error"==e.status&&(t=!0),"success"==e.status&&n.files[0]&&"success"==n.files[0].status&&(l.setState({modalEdit:!1,editItem:null,ItemTab:"1"}),l.getItems())})),t&&alert("Ошибка при загрузке фотографии old")}))),this.myDropzoneNew.files.length>0&&(a=this.state.editItem.name,i=this.state.editItem.id,this.myDropzoneNew.on("sending",(function(e,t,n){var s=e.name.split(".");s=(s=s[s.length-1]).toLowerCase(),n.append("typeFile","new"),n.append("name",a),n.append("id",i)})),this.myDropzoneNew.on("queuecomplete",(function(e){var t=!1,n=l.myDropzoneOld;l.myDropzoneNew.files.map((function(e,a){"error"==e.status&&(t=!0),"success"==e.status&&n.files[0]&&"success"==n.files[0].status&&(l.setState({modalEdit:!1,editItem:null,ItemTab:"1"}),l.getItems())})),t&&alert("Ошибка при загрузке фотографии new")}))),s={item:this.state.editItem,rec_stage_1:this.state.rec_stage_1,rec_stage_2:this.state.rec_stage_2,rec_stage_3:this.state.rec_stage_3,pf_stage_1:this.state.pf_stage_1,pf_stage_2:this.state.pf_stage_2,pf_stage_3:this.state.pf_stage_3,item_items:this.state.item_items},e.next=5,this.getData("saveEditItem",s);case 5:!1===(r=e.sent).st?alert(r.text):(this.openSnack("Данные обновлены"),this.myDropzoneOld.files.length>0&&this.myDropzoneOld.processQueue(),this.myDropzoneNew.files.length>0&&this.myDropzoneNew.processQueue());case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"saveNewItem",value:(n=(0,r.Z)(f().mark((function e(){var t,n,a,i,s,r,l=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={item:this.state.editItem,rec_stage_1:this.state.rec_stage_1,rec_stage_2:this.state.rec_stage_2,rec_stage_3:this.state.rec_stage_3,pf_stage_1:this.state.pf_stage_1,pf_stage_2:this.state.pf_stage_2,pf_stage_3:this.state.pf_stage_3,item_items:this.state.item_items},e.next=3,this.getData("saveNewItem",t);case 3:n=e.sent,console.log(n),!1===n.st?alert(n.text):(this.openSnack("Данные обновлены"),this.myDropzoneOld.files.length>0&&(a=this.state.editItem.name,i=n.id,this.myDropzoneOld.on("sending",(function(e,t,n){var s=e.name.split(".");s=(s=s[s.length-1]).toLowerCase(),n.append("typeFile","old"),n.append("name",a),n.append("id",i)})),this.myDropzoneOld.on("queuecomplete",(function(e){var t=!1,n=l.myDropzoneNew;l.myDropzoneOld.files.map((function(e,a){"error"==e.status&&(t=!0),"success"==e.status&&n.files[0]&&"success"==n.files[0].status&&(l.setState({modalNew:!1,editItem:null,ItemTab:"1"}),l.getItems())})),t&&alert("Ошибка при загрузке фотографии old")}))),this.myDropzoneNew.files.length>0&&(s=this.state.editItem.name,r=n.id,this.myDropzoneNew.on("sending",(function(e,t,n){var a=e.name.split(".");a=(a=a[a.length-1]).toLowerCase(),n.append("typeFile","new"),n.append("name",s),n.append("id",r)})),this.myDropzoneNew.on("queuecomplete",(function(e){var t=!1,n=l.myDropzoneOld;l.myDropzoneNew.files.map((function(e,a){"error"==e.status&&(t=!0),"success"==e.status&&n.files[0]&&"success"==n.files[0].status&&(l.setState({modalNew:!1,editItem:null,ItemTab:"1"}),l.getItems())})),t&&alert("Ошибка при загрузке фотографии new")}))),this.myDropzoneOld.files.length>0&&this.myDropzoneOld.processQueue(),this.myDropzoneNew.files.length>0&&this.myDropzoneNew.processQueue());case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"changeTab",value:function(e,t){var n=this;this.setState({myDropzoneOld:this.myDropzoneOld.files,myDropzoneNew:this.myDropzoneNew.files}),this.setState({ItemTab:t}),1==parseInt(t)&&setTimeout((function(){if(n.myDropzoneOld=new ma.Z("#for_img_edit_old",n.dropzoneOptions),n.myDropzoneNew=new ma.Z("#for_img_edit_new",n.dropzoneOptions),n.state.myDropzoneOld[0]){var e={name:n.state.myDropzoneOld[0].name,size:n.state.myDropzoneOld[0].size,type:n.state.myDropzoneOld[0].type,status:n.state.myDropzoneOld[0].status,url:n.state.myDropzoneOld[0].dataURL,dataURL:n.state.myDropzoneOld[0].dataURL};n.myDropzoneOld.emit("addedfile",e),n.myDropzoneOld.emit("thumbnail",e,n.state.myDropzoneOld[0].dataURL),n.myDropzoneOld.files.push(n.state.myDropzoneOld[0])}if(n.state.myDropzoneNew[0]){var t={name:n.state.myDropzoneNew[0].name,size:n.state.myDropzoneNew[0].size,type:n.state.myDropzoneNew[0].type,status:n.state.myDropzoneNew[0].status,url:n.state.myDropzoneNew[0].dataURL,dataURL:n.state.myDropzoneNew[0].dataURL};n.myDropzoneNew.emit("addedfile",t),n.myDropzoneNew.emit("thumbnail",t,n.state.myDropzoneNew[0].dataURL),n.myDropzoneNew.files.push(n.state.myDropzoneNew[0])}}),300)}},{key:"closeSnack",value:function(){this.setState({is_snack:!1,textSnack:""})}},{key:"openSnack",value:function(e){this.setState({is_snack:!0,textSnack:e})}},{key:"searchPf",value:function(e){var t=this.state.item_pf.all,n=e.target.value;this.setState({searchPf:n});var a=[];t.map((function(e){-1!==e.name.toLowerCase().indexOf(n.toLowerCase())&&a.push(e)})),this.setState({item_pf_render:a})}},{key:"searchItems",value:function(e){var t=this.state.item_items_all,n=e.target.value;this.setState({searchItems:n});var a=[];t.map((function(e){-1!==e.name.toLowerCase().indexOf(n.toLowerCase())&&a.push(e)})),this.setState({item_items_render:a})}},{key:"closeEdit",value:function(){this.setState({modalEdit:!1,editItem:null,ItemTab:"1"}),this.getItems()}},{key:"closeNew",value:function(){this.setState({modalNew:!1,editItem:null,ItemTab:"1"}),this.getItems()}},{key:"changeSort",value:function(e,t,n){var a=n.target.value,i=this.state.cats;i[e].items[t].sort=a,this.setState({cats:i})}},{key:"saveSort",value:(t=(0,r.Z)(f().mark((function e(t,n){var a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:t,sort:n.target.value},e.next=3,this.getData("saveSort",a);case 3:e.sent;case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this,t=a.createElement(a.Fragment,null,a.createElement(b.Z,{size:"small","aria-label":"close",color:"inherit",onClick:this.closeSnack.bind(this)},a.createElement(Ue.Z,{fontSize:"small"})));return a.createElement(a.Fragment,null,a.createElement(W.Z,{open:this.state.is_load,style:{zIndex:999}},a.createElement(j.Z,{color:"inherit"})),a.createElement(wa.Z,{anchorOrigin:{vertical:"top",horizontal:"center"},open:this.state.is_snack,autoHideDuration:6e3,onClose:this.closeSnack.bind(this),message:this.state.textSnack,action:t}),a.createElement(G.Z,{open:this.state.modalEdit,fullWidth:!0,maxWidth:"md",onClose:this.closeEdit.bind(this)},a.createElement($.Z,null,"Редактирвоание товара"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},this.state.editItem&&this.state.modalEdit?a.createElement(a.Fragment,null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(va.ZP,{value:this.state.ItemTab},a.createElement(gt.Z,{sx:{borderBottom:1,borderColor:"divider"}},a.createElement(ya.Z,{onChange:this.changeTab.bind(this),variant:"fullWidth"},a.createElement(_t.Z,{label:"Основные",value:"1"}),a.createElement(_t.Z,{label:"Рецепты",value:"2"}),a.createElement(_t.Z,{label:"Заготовки",value:"3"}),a.createElement(_t.Z,{label:"Позиции",value:"4"}))),a.createElement(xa.Z,{value:"1"},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Название",value:this.state.editItem.name,func:this.changeItem.bind(this,"name")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Короткое название (20 сим.)",value:this.state.editItem.short_name,func:this.changeItem.bind(this,"short_name")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.types,value:this.state.editItem.type,func:this.changeItem.bind(this,"type"),disabled:!0,label:"Тип"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.cat_list,value:this.state.editItem.category_id,func:this.changeItem.bind(this,"category_id"),label:"Категория"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Код из 1с",value:this.state.editItem.art,func:this.changeItem.bind(this,"art")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Стол",value:this.state.editItem.stol,func:this.changeItem.bind(this,"stol")})),6==parseInt(this.state.editItem.category_id)?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Объем",value:this.state.editItem.weight,func:this.changeItem.bind(this,"weight")})):a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Вес",value:this.state.editItem.weight,func:this.changeItem.bind(this,"weight")})),14!=parseInt(this.state.editItem.category_id)?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Кол-во кусочков",value:this.state.editItem.count_part,func:this.changeItem.bind(this,"count_part")})):a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Размер пиццы",value:this.state.editItem.size_pizza,func:this.changeItem.bind(this,"size_pizza")})))),2!=parseInt(this.state.editItem.type)?a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Белки",value:this.state.editItem.protein,func:this.changeItem.bind(this,"protein")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Жиры",value:this.state.editItem.fat,func:this.changeItem.bind(this,"fat")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Углеводы",value:this.state.editItem.carbohydrates,func:this.changeItem.bind(this,"carbohydrates")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Энергетическая ценность",value:this.state.editItem.kkal,func:this.changeItem.bind(this,"kkal")})))):null,2!=parseInt(this.state.editItem.type)?a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время на 1 этап (ММ:СС)",value:this.state.editItem.time_stage_1,func:this.changeItem.bind(this,"time_stage_1")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время на 2 этап (ММ:СС)",value:this.state.editItem.time_stage_2,func:this.changeItem.bind(this,"time_stage_2")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время на 3 этап (ММ:СС)",value:this.state.editItem.time_stage_3,func:this.changeItem.bind(this,"time_stage_3")})))):null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(x.Z,null,"Картинка соотношением сторон (3:2) (пример: 600х400) только JPG")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},this.state.editItem.img_new.length>0?a.createElement("img",{src:"https://storage.yandexcloud.net/site-img/"+this.state.editItem.img_new+"600х400.jpg?"+this.state.editItem.img_new_update,style:{maxWidth:300,maxHeight:300}}):a.createElement("div",{style:{maxWidth:300,maxHeight:300}})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement("div",{className:"dropzone",id:"for_img_edit_old",style:{width:"100%",minHeight:150}})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(x.Z,null,"Картинка соотношением сторон (1:1) (пример: 600х600) только JPG")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},this.state.editItem.img_app.length>0?a.createElement("img",{src:"https://storage.yandexcloud.net/site-img/"+this.state.editItem.img_app+"600х600.jpg?"+this.state.editItem.img_new_update,style:{maxWidth:300,maxHeight:300}}):a.createElement("div",{style:{maxWidth:300,maxHeight:300}})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement("div",{className:"dropzone",id:"for_img_edit_new",style:{width:"100%",minHeight:150}})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(Ne,{label:"Состав",value:this.state.editItem.tmp_desc,func:this.changeItem.bind(this,"tmp_desc")})),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(Ne,{label:"Маркейтинговое описание",value:this.state.editItem.marc_desc,func:this.changeItem.bind(this,"marc_desc")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Новинка",value:1==parseInt(this.state.editItem.is_new),func:this.changeItem.bind(this,"is_new"),style:{justifyContent:"center"}})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Хит",value:1==parseInt(this.state.editItem.is_hit),func:this.changeItem.bind(this,"is_hit"),style:{justifyContent:"center"}})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Me,{label:"Активность",value:1==parseInt(this.state.editItem.is_show),func:this.changeItem.bind(this,"is_show"),style:{justifyContent:"center"}})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Me,{label:"На сайте",value:1==parseInt(this.state.editItem.show_site),func:this.changeItem.bind(this,"show_site"),style:{justifyContent:"center"}})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Me,{label:"На складе",value:1==parseInt(this.state.editItem.show_program),func:this.changeItem.bind(this,"show_program"),style:{justifyContent:"center"}})))))),a.createElement(xa.Z,{value:"2"},a.createElement(D.ZP,{container:!0,spacing:3},this.state.item_rec?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,this.state.item_rec.all.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(ga.Z,{onClick:e.openMenu.bind(e,"rec",t)})))}))))):null,this.state.item_rec?a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(Ia,{title:"1 этап",type:"rec",arr:"rec_stage_1",data:this.state.rec_stage_1,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)}),a.createElement(Ia,{title:"2 этап",type:"rec",arr:"rec_stage_2",data:this.state.rec_stage_2,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)}),a.createElement(Ia,{title:"3 этап",type:"rec",arr:"rec_stage_3",data:this.state.rec_stage_3,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)})):null)),a.createElement(xa.Z,{value:"3"},a.createElement(D.ZP,{container:!0,spacing:3},this.state.item_pf?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{colSpan:2},a.createElement(Ne,{label:"Поиск",value:this.state.searchPf,func:this.searchPf.bind(this)}))),this.state.item_pf_render.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(ga.Z,{onClick:e.openMenu.bind(e,"pf",t)})))}))))):null,this.state.item_rec?a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(Ia,{title:"1 этап",type:"pf",arr:"pf_stage_1",data:this.state.pf_stage_1,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)}),a.createElement(Ia,{title:"2 этап",type:"pf",arr:"pf_stage_2",data:this.state.pf_stage_2,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)}),a.createElement(Ia,{title:"3 этап",type:"pf",arr:"pf_stage_3",data:this.state.pf_stage_3,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)})):null)),a.createElement(xa.Z,{value:"4"},a.createElement(D.ZP,{container:!0,spacing:3},this.state.item_pf?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{colSpan:2},a.createElement(Ne,{label:"Поиск",value:this.state.searchItems,func:this.searchItems.bind(this)}))),this.state.item_items_render.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(tt.Z,{onClick:e.forwardItem.bind(e,t),style:{cursor:"pointer"}})))}))))):null,this.state.item_rec?a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{colSpan:5,style:{textAlign:"center"}},this.props.title)),a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null,"Количество"),a.createElement(ue.Z,null,"Авт. добавление"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,this.state.item_items.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(Ne,{label:"",value:t.count,func:e.changeData.bind(e,"item","item_items","count",n)})),a.createElement(ue.Z,null,a.createElement(Me,{label:"",value:1==parseInt(t.is_add),func:e.changeData.bind(e,"item","item_items","is_add",n)})),a.createElement(ue.Z,null,a.createElement(Ue.Z,{onClick:e.delItem.bind(e,"item","",n),style:{cursor:"pointer"}})))}))))):null))))),a.createElement(Za.Z,{anchorEl:this.state.anchorEl,open:this.state.openMenu,onClose:this.closeMenu.bind(this)},a.createElement(_e.Z,{onClick:this.chooseStage.bind(this,1)},"1 этап"),a.createElement(_e.Z,{onClick:this.chooseStage.bind(this,2)},"2 этап"),a.createElement(_e.Z,{onClick:this.chooseStage.bind(this,3)},"3 этап")))):null)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.saveEditItem.bind(this),color:"primary"},"Сохранить"))),a.createElement(G.Z,{open:this.state.modalNew,fullWidth:!0,maxWidth:"md",onClose:this.closeNew.bind(this)},a.createElement($.Z,null,"Новый товар"),a.createElement(Q.Z,{style:{paddingBottom:10,paddingTop:10}},a.createElement(D.ZP,{container:!0,spacing:3},this.state.editItem&&this.state.modalNew?a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(va.ZP,{value:this.state.ItemTab},a.createElement(gt.Z,{sx:{borderBottom:1,borderColor:"divider"}},a.createElement(ya.Z,{onChange:this.changeTab.bind(this),variant:"fullWidth"},a.createElement(_t.Z,{label:"Основные",value:"1"}),a.createElement(_t.Z,{label:"Рецепты",value:"2"}),a.createElement(_t.Z,{label:"Заготовки",value:"3"}),a.createElement(_t.Z,{label:"Позиции",value:"4"}))),a.createElement(xa.Z,{value:"1"},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Название",value:this.state.editItem.name,func:this.changeItem.bind(this,"name")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ne,{label:"Короткое название (20 сим.)",value:this.state.editItem.short_name,func:this.changeItem.bind(this,"short_name")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.types,value:this.state.editItem.type,func:this.changeItem.bind(this,"type"),disabled:!0,label:"Тип"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ae,{data:this.state.cat_list,value:this.state.editItem.category_id,func:this.changeItem.bind(this,"category_id"),label:"Категория"})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Код из 1с",value:this.state.editItem.art,func:this.changeItem.bind(this,"art")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Стол",value:this.state.editItem.stol,func:this.changeItem.bind(this,"stol")})),6==parseInt(this.state.editItem.category_id)?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Объем",value:this.state.editItem.weight,func:this.changeItem.bind(this,"weight")})):a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Вес",value:this.state.editItem.weight,func:this.changeItem.bind(this,"weight")})),14!=parseInt(this.state.editItem.category_id)?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Кол-во кусочков",value:this.state.editItem.count_part,func:this.changeItem.bind(this,"count_part")})):a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Размер пиццы",value:this.state.editItem.size_pizza,func:this.changeItem.bind(this,"size_pizza")})))),2!=parseInt(this.state.editItem.type)?a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Белки",value:this.state.editItem.protein,func:this.changeItem.bind(this,"protein")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Жиры",value:this.state.editItem.fat,func:this.changeItem.bind(this,"fat")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Углеводы",value:this.state.editItem.carbohydrates,func:this.changeItem.bind(this,"carbohydrates")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Ne,{label:"Энергетическая ценность",value:this.state.editItem.kkal,func:this.changeItem.bind(this,"kkal")})))):null,2!=parseInt(this.state.editItem.type)?a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время на 1 этап (ММ:СС)",value:this.state.editItem.time_stage_1,func:this.changeItem.bind(this,"time_stage_1")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время на 2 этап (ММ:СС)",value:this.state.editItem.time_stage_2,func:this.changeItem.bind(this,"time_stage_2")})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Ne,{label:"Время на 3 этап (ММ:СС)",value:this.state.editItem.time_stage_3,func:this.changeItem.bind(this,"time_stage_3")})))):null,a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(x.Z,null,"Картинка соотношением сторон (3:2) (пример: 600х400) только JPG")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},this.state.editItem.img_new.length>0?a.createElement("img",{src:"https://storage.yandexcloud.net/site-img/"+this.state.editItem.img_new+"600х400.jpg?"+this.state.editItem.img_new_update,style:{maxWidth:300,maxHeight:300}}):a.createElement("div",{style:{maxWidth:300,maxHeight:300}})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement("div",{className:"dropzone",id:"for_img_edit_old",style:{width:"100%",minHeight:150}})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(x.Z,null,"Картинка соотношением сторон (1:1) (пример: 600х600) только JPG")),a.createElement(D.ZP,{item:!0,xs:12,sm:6},this.state.editItem.img_app.length>0?a.createElement("img",{src:"https://storage.yandexcloud.net/site-img/"+this.state.editItem.img_app+"600х600.jpg?"+this.state.editItem.img_new_update,style:{maxWidth:300,maxHeight:300}}):a.createElement("div",{style:{maxWidth:300,maxHeight:300}})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement("div",{className:"dropzone",id:"for_img_edit_new",style:{width:"100%",minHeight:150}})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(Ne,{label:"Состав",value:this.state.editItem.tmp_desc,func:this.changeItem.bind(this,"tmp_desc")})),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(Ne,{label:"Маркейтинговое описание",value:this.state.editItem.marc_desc,func:this.changeItem.bind(this,"marc_desc")})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Новинка",value:1==parseInt(this.state.editItem.is_new),func:this.changeItem.bind(this,"is_new"),style:{justifyContent:"center"}})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Me,{label:"Хит",value:1==parseInt(this.state.editItem.is_hit),func:this.changeItem.bind(this,"is_hit"),style:{justifyContent:"center"}})))),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Me,{label:"Активность",value:1==parseInt(this.state.editItem.is_show),func:this.changeItem.bind(this,"is_show"),style:{justifyContent:"center"}})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Me,{label:"На сайте",value:1==parseInt(this.state.editItem.show_site),func:this.changeItem.bind(this,"show_site"),style:{justifyContent:"center"}})),a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(Me,{label:"На складе",value:1==parseInt(this.state.editItem.show_program),func:this.changeItem.bind(this,"show_program"),style:{justifyContent:"center"}})))))),a.createElement(xa.Z,{value:"2"},a.createElement(D.ZP,{container:!0,spacing:3},this.state.item_rec?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,this.state.item_rec.all.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(ga.Z,{onClick:e.openMenu.bind(e,"rec",t)})))}))))):null,this.state.item_rec?a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(Ia,{title:"1 этап",type:"rec",arr:"rec_stage_1",data:this.state.rec_stage_1,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)}),a.createElement(Ia,{title:"2 этап",type:"rec",arr:"rec_stage_2",data:this.state.rec_stage_2,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)}),a.createElement(Ia,{title:"3 этап",type:"rec",arr:"rec_stage_3",data:this.state.rec_stage_3,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)})):null)),a.createElement(xa.Z,{value:"3"},a.createElement(D.ZP,{container:!0,spacing:3},this.state.item_pf?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{colSpan:2},a.createElement(Ne,{label:"Поиск",value:this.state.searchPf,func:this.searchPf.bind(this)}))),this.state.item_pf_render.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(ga.Z,{onClick:e.openMenu.bind(e,"pf",t)})))}))))):null,this.state.item_rec?a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(Ia,{title:"1 этап",type:"pf",arr:"pf_stage_1",data:this.state.pf_stage_1,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)}),a.createElement(Ia,{title:"2 этап",type:"pf",arr:"pf_stage_2",data:this.state.pf_stage_2,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)}),a.createElement(Ia,{title:"3 этап",type:"pf",arr:"pf_stage_3",data:this.state.pf_stage_3,changeData:this.changeData.bind(this),delItem:this.delItem.bind(this)})):null)),a.createElement(xa.Z,{value:"4"},a.createElement(D.ZP,{container:!0,spacing:3},this.state.item_pf?a.createElement(D.ZP,{item:!0,xs:12,sm:4},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{colSpan:2},a.createElement(Ne,{label:"Поиск",value:this.state.searchItems,func:this.searchItems.bind(this)}))),this.state.item_items_render.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(tt.Z,{onClick:e.forwardItem.bind(e,t),style:{cursor:"pointer"}})))}))))):null,this.state.item_rec?a.createElement(D.ZP,{item:!0,xs:12,sm:8},a.createElement(ce.Z,{size:"small"},a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{colSpan:5,style:{textAlign:"center"}},this.props.title)),a.createElement(pe.Z,null,a.createElement(ue.Z,null,"Название"),a.createElement(ue.Z,null,"Количество"),a.createElement(ue.Z,null,"Авт. добавление"),a.createElement(ue.Z,null))),a.createElement(me.Z,null,this.state.item_items.map((function(t,n){return a.createElement(pe.Z,{key:n},a.createElement(ue.Z,null,t.name),a.createElement(ue.Z,null,a.createElement(Ne,{label:"",value:t.count,func:e.changeData.bind(e,"item","item_items","count",n)})),a.createElement(ue.Z,null,a.createElement(Me,{label:"",value:1==parseInt(t.is_add),func:e.changeData.bind(e,"item","item_items","is_add",n)})),a.createElement(ue.Z,null,a.createElement(Ue.Z,{onClick:e.delItem.bind(e,"item","",n),style:{cursor:"pointer"}})))}))))):null))))),a.createElement(Za.Z,{anchorEl:this.state.anchorEl,open:this.state.openMenu,onClose:this.closeMenu.bind(this)},a.createElement(_e.Z,{onClick:this.chooseStage.bind(this,1)},"1 этап"),a.createElement(_e.Z,{onClick:this.chooseStage.bind(this,2)},"2 этап"),a.createElement(_e.Z,{onClick:this.chooseStage.bind(this,3)},"3 этап"))):null)),a.createElement(q.Z,null,a.createElement(J.Z,{onClick:this.saveNewItem.bind(this),color:"primary"},"Сохранить"))),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement(J.Z,{onClick:this.openNew.bind(this),color:"primary",variant:"contained"},"Новый товар")),a.createElement(D.ZP,{item:!0,xs:12},0==this.state.cats.length?null:this.state.cats.map((function(t,n){return a.createElement(T.Z,{key:n},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null)},a.createElement(x.Z,null,t.name)),a.createElement(N.Z,{style:{width:"100%",overflow:"scroll"}},a.createElement(ce.Z,null,a.createElement(he.Z,null,a.createElement(pe.Z,null,a.createElement(ue.Z,{style:{width:"2%"}},"id"),a.createElement(ue.Z,{style:{width:"38%"}},"Название"),a.createElement(ue.Z,{style:{width:"15%"}},"Сортировка"),a.createElement(ue.Z,{style:{width:"15%"}},"Активность"),a.createElement(ue.Z,{style:{width:"15%"}},"Сайт"),a.createElement(ue.Z,{style:{width:"15%"}},"Склад"))),a.createElement(me.Z,null,t.items.map((function(t,i){return a.createElement(pe.Z,{key:i},a.createElement(ue.Z,null,t.id),a.createElement(ue.Z,{onClick:e.openItem.bind(e,t)},t.name),a.createElement(ue.Z,null,a.createElement(Ne,{label:"",value:t.sort,func:e.changeSort.bind(e,n,i),onBlur:e.saveSort.bind(e,t.id)})),a.createElement(ue.Z,null,1==parseInt(t.is_show)?a.createElement(Ke.Z,null):a.createElement($e.Z,null)),a.createElement(ue.Z,null,1==parseInt(t.show_site)?a.createElement(Ke.Z,null):a.createElement($e.Z,null)),a.createElement(ue.Z,null,1==parseInt(t.show_program)?a.createElement(Ke.Z,null):a.createElement($e.Z,null)))}))))))})))))}}]),_}(a.Component);function Pa(){return a.createElement(Da,null)}n(2603);var Sa=n(7563);function Ca(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}var Ta=function(e){(0,m.Z)(_,e);var t,n,i,s,p,E=(s=_,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(s);if(p){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function _(e){var t;return(0,l.Z)(this,_),t=E.call(this,e),(0,h.Z)((0,c.Z)(t),"map",null),(0,h.Z)((0,c.Z)(t),"heatmap",null),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Sa.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"hot_map",module_name:"",is_load:!1,cities:[],city_id:"",date_start:Ca(new Date),date_end:Ca(new Date),time_start:"00:00",time_end:"23:59",statAllCount:"",statTrueCount:"",is_new:0},t}return(0,o.Z)(_,[{key:"componentDidMount",value:(i=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({cities:t.cities,city_id:t.cities[0].id,module_name:t.module_info.name}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"changeCity",value:function(e){var t=e.target.value;this.setState({city_id:t}),setTimeout((function(){}),50)}},{key:"updateData",value:(n=(0,r.Z)(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={city_id:this.state.city_id,date_start:this.state.date_start,date_end:this.state.date_end,time_start:this.state.time_start,time_end:this.state.time_end,is_new:this.state.is_new},e.next=3,this.getData("get_orders",t);case 3:n=e.sent,console.log(n),this.getOrders(n.points,n.all_points);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getOrders",value:function(e,t){var n=this,a=[];if(t.map((function(e){a.push([parseFloat(e[0]),parseFloat(e[1])])})),this.map){this.map.geoObjects.removeAll(),this.heatmap.destroy(),this.map.setCenter([e[0].home.latitude,e[0].home.longitude]);var i=[{.1:"rgba(128, 255, 0, 0.7)",.2:"rgba(255, 255, 0, 0.8)",.7:"rgba(234, 72, 58, 0.9)",1:"rgba(162, 36, 25, 1)"},{.1:"rgba(162, 36, 25, 0.7)",.2:"rgba(234, 72, 58, 0.8)",.7:"rgba(255, 255, 0, 0.9)",1:"rgba(128, 255, 0, 1)"}],s=[5,10,20,30],r=[.4,.6,.8,1];ymaps.modules.require(["Heatmap"],(function(e){new e(a,{gradient:i[0],radius:s[1],opacity:r[2]}).setMap(n.map)})),e.map((function(e,t){var a=new ymaps.GeoObject({geometry:{type:"Point",coordinates:[e.home.latitude,e.home.longitude]}},{preset:"islands#blackDotIcon",iconColor:"black"});n.map.geoObjects.add(a);var i=[];e.zone.map((function(e,t){i.push(JSON.parse(e.zone))}));for(var s=[],r=0;r<i.length;r++)s[r]=new ymaps.Polygon([i[r]],{hintContent:""},{fillColor:"rgba(187, 0, 37, 0)",strokeColor:"rgb(187, 0, 37)",strokeWidth:5}),n.map.geoObjects.add(s[r])}));var l=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:[],fillRule:"nonZero"}},{fillColor:"#00FF00",strokeColor:"#0000FF",opacity:.5,strokeWidth:5,strokeStyle:"shortdash"});this.map.geoObjects.add(l),l.editor.startDrawing()}else ymaps.ready((function(){n.map=new ymaps.Map("map",{center:[e[0].home.latitude,e[0].home.longitude],zoom:11},{searchControlProvider:"yandex#search"});var t=[{.1:"rgba(128, 255, 0, 0.7)",.2:"rgba(255, 255, 0, 0.8)",.7:"rgba(234, 72, 58, 0.9)",1:"rgba(162, 36, 25, 1)"},{.1:"rgba(162, 36, 25, 0.7)",.2:"rgba(234, 72, 58, 0.8)",.7:"rgba(255, 255, 0, 0.9)",1:"rgba(128, 255, 0, 1)"}],i=[5,10,20,30],s=[.4,.6,.8,1];ymaps.modules.require(["Heatmap"],(function(e){n.heatmap=new e(a,{gradient:t[0],radius:i[1],opacity:s[2]}),n.heatmap.setMap(n.map)})),e.map((function(e,t){var a=new ymaps.GeoObject({geometry:{type:"Point",coordinates:[e.home.latitude,e.home.longitude]}},{preset:"islands#blackDotIcon",iconColor:"black"});n.map.geoObjects.add(a);var i=[];e.zone.map((function(e,t){i.push(JSON.parse(e.zone))}));for(var s=[],r=0;r<i.length;r++)s[r]=new ymaps.Polygon([i[r]],{hintContent:""},{fillColor:"rgba(187, 0, 37, 0)",strokeColor:"rgb(187, 0, 37)",strokeWidth:5}),n.map.geoObjects.add(s[r])}));var r=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:[],fillRule:"nonZero"}},{fillColor:"#00FF00",strokeColor:"#0000FF",opacity:.5,strokeWidth:5,strokeStyle:"shortdash"});n.map.geoObjects.add(r),r.editor.startDrawing()}))}},{key:"getCount",value:(t=(0,r.Z)(f().mark((function e(){var t,n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this.map.geoObjects.each((function(e){t=t.concat(e.geometry.getCoordinates())})),n={city_id:this.state.city_id,date_start:this.state.date_start,date_end:this.state.date_end,time_start:this.state.time_start,time_end:this.state.time_end,is_new:this.state.is_new,zone:t[t.length-1]},e.next=5,this.getData("getCount",n);case 5:a=e.sent,this.setState({statAllCount:a.all_count,statTrueCount:a.true+" ( "+a.true_percent+"% ) "}),console.log(a);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeDateRange",value:function(e,t){this.setState((0,h.Z)({},e,Ca(t)))}},{key:"changeData",value:function(e,t){var n;n="is_new"==e?1==t.target.checked?1:0:t.target.value,this.setState((0,h.Z)({},e,n))}},{key:"render",value:function(){return a.createElement(a.Fragment,null,a.createElement(W.Z,{open:this.state.is_load,style:{zIndex:99}},a.createElement(j.Z,{color:"inherit"})),a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("h1",null,this.state.module_name)),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(Ae,{data:this.state.cities,value:this.state.city_id,func:this.changeCity.bind(this),label:"Город"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Me,{value:1==this.state.is_new,func:this.changeData.bind(this,"is_new"),label:"Только новые клиенты"})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(J.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Oe,{label:"Время от",value:this.state.time_start,func:this.changeData.bind(this,"time_start")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Re,{label:"Дата до",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:3},a.createElement(Oe,{label:"Время до",value:this.state.time_end,func:this.changeData.bind(this,"time_end")})),a.createElement(D.ZP,{item:!0,xs:12,sm:6},a.createElement(J.Z,{variant:"contained",onClick:this.getCount.bind(this)},"Подсчитать количество")),a.createElement(D.ZP,{item:!0,xs:12},a.createElement(D.ZP,{container:!0,spacing:3},a.createElement(D.ZP,{item:!0,xs:6},a.createElement(x.Z,null,"Заказов в зоне: ",this.state.statTrueCount)),a.createElement(D.ZP,{item:!0,xs:6},a.createElement(x.Z,null,"Всего заказов в городе: ",this.state.statAllCount)))),a.createElement(D.ZP,{item:!0,xs:12,sm:12},a.createElement("div",{id:"map",name:"map",style:{width:"100%",height:700,paddingTop:10}}))))}}]),_}(a.Component);function Aa(){return a.createElement(Ta,null)}var Na=n(7563),Oa=(0,R.Z)({palette:{primary:{main:"#c03"},def:{main:"#353b48",secondary:"#fff"}}}),Ra=function(e){(0,m.Z)(E,e);var t,n,i,p=(n=E,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(n);if(i){var a=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,a)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function E(e){var t;return(0,l.Z)(this,E),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Na.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(console.log(e),!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"header",open:!1,menu:[],full_menu:[],left:!1},t}return(0,o.Z)(E,[{key:"componentDidMount",value:(t=(0,r.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({menu:t.info.left_menu,full_menu:t.info.full_menu});case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleDrawerOpen",value:function(){this.setState({open:!0})}},{key:"handleDrawerClose",value:function(){this.setState({open:!1})}},{key:"logOut",value:function(){localStorage.removeItem("token"),setTimeout((function(){window.location.pathname="/"}),300)}},{key:"render",value:function(){var e=this;return a.createElement(a.Fragment,null,a.createElement(_.Z,null,a.createElement(g.Z,null,a.createElement(b.Z,{edge:"start",color:"inherit","aria-label":"open drawer",onClick:this.handleDrawerOpen.bind(this)},a.createElement(P.Z,null)),a.createElement(x.Z,{component:"h1",variant:"h6",color:"inherit",noWrap:!0,style:{flexGrow:1}},"Dashboard"),a.createElement(b.Z,{color:"inherit"},a.createElement(k.Z,{badgeContent:4,color:"secondary"},a.createElement(C.Z,null))))),a.createElement(a.Fragment,null,a.createElement(U.Z,{anchor:"left",open:this.state.open,onClose:function(){e.setState({open:!1})},onOpen:function(){e.setState({open:!0})}},a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:10}},a.createElement(B.Z,{size:"small",options:this.state.full_menu,getOptionLabel:function(e){return e.name},onChange:function(e,t){t&&(window.location.pathname="/"+t.key_query+"/")},style:{width:300},renderInput:function(e){return a.createElement(L.Z,(0,s.Z)({},e,{label:"Поиск",variant:"outlined"}))}}),a.createElement(b.Z,{onClick:this.handleDrawerClose.bind(this)},a.createElement(S.Z,null))),a.createElement(w.Z,null),this.state.menu.map((function(e,t){return a.createElement(T.Z,{key:t},a.createElement(A.Z,{expandIcon:a.createElement(O.Z,null),"aria-controls":"panel1a-content",id:"panel1a-header"},a.createElement(x.Z,null,e.parent.name)),a.createElement(N.Z,null,a.createElement(Z.Z,{style:{width:"100%"}},e.chaild.map((function(e,t){return a.createElement(v.ZP,{button:!0,key:t},a.createElement(z.rU,{to:"/"+e.key_query+"/"},a.createElement(y.Z,{primary:e.name})))})))))})),a.createElement(T.Z,null,a.createElement(A.Z,{onClick:this.logOut.bind(this)},a.createElement(x.Z,null,"Выйти из аккаунта"))))))}}]),E}(a.Component);function Ma(e){var t=e.code,n=e.children;return a.createElement(F.AW,{render:function(e){var a=e.staticContext;return a&&(a.status=t),n}})}function za(){var e=(0,F.TH)(),t=!0;return"/auth/"!=e.pathname&&"/auth"!=e.pathname&&"/registration/"!=e.pathname&&"/registration"!=e.pathname||(t=!1),a.createElement(M.Z,{theme:Oa},a.createElement("div",null,t?a.createElement(a.Fragment,null,a.createElement(E.ZP,null),a.createElement(Ra,null)):null,a.createElement("main",{style:{flexGrow:1,overflow:"auto"}},a.createElement(I.Z,{maxWidth:!1,style:{marginTop:80}},a.createElement(F.Z5,null,a.createElement(F.AW,{path:"/",exact:!0,element:a.createElement(X,null)}),a.createElement(F.AW,{path:"/auth",exact:!0,element:a.createElement(ne,null)}),a.createElement(F.AW,{path:"/registration",exact:!0,element:a.createElement(oe,null)}),a.createElement(F.AW,{path:"/live_orders",exact:!0,element:a.createElement(Be,null)}),a.createElement(F.AW,{path:"/events",exact:!0,element:a.createElement(Ve,null)}),a.createElement(F.AW,{path:"/ras_by_bill",exact:!0,element:a.createElement(Je,null)}),a.createElement(F.AW,{path:"/category_items",exact:!0,element:a.createElement(Qe,null)}),a.createElement(F.AW,{path:"/vendor_module",exact:!0,element:a.createElement(it,null)}),a.createElement(F.AW,{path:"/vendor_item_price",exact:!0,element:a.createElement(lt,null)}),a.createElement(F.AW,{path:"/tender",exact:!0,element:a.createElement(dt,null)}),a.createElement(F.AW,{path:"/revizion",exact:!0,element:a.createElement(Tt,null)}),a.createElement(F.AW,{path:"/revizion/new",exact:!0,element:a.createElement(At,null)}),a.createElement(F.AW,{path:"/work_schedule",exact:!0,element:a.createElement(qt,null)}),a.createElement(F.AW,{path:"/site_sale_2",exact:!0,element:a.createElement(hn,null)}),a.createElement(F.AW,{path:"/site_sale_2/new",exact:!0,element:a.createElement(un,null)}),a.createElement(F.AW,{path:"/site_sale_2/edit/:promoId",exact:!0,element:a.createElement(dn,null)}),a.createElement(F.AW,{path:"/site_sale_2/stat",exact:!0,element:a.createElement(pn,null)}),a.createElement(F.AW,{path:"/site_sale_2/stat_list",exact:!0,element:a.createElement(fn,null)}),a.createElement(F.AW,{path:"/drive_map_stat_all",exact:!0,element:a.createElement(gn,null)}),a.createElement(F.AW,{path:"/driver_stat",exact:!0,element:a.createElement(xn,null)}),a.createElement(F.AW,{path:"/concenter",exact:!0,element:a.createElement(Sn,null)}),a.createElement(F.AW,{path:"/socialnetwork",exact:!0,element:a.createElement(On,null)}),a.createElement(F.AW,{path:"/cat_work",exact:!0,element:a.createElement(zn,null)}),a.createElement(F.AW,{path:"/app_work_point",exact:!0,element:a.createElement(Un,null)}),a.createElement(F.AW,{path:"/app_work",exact:!0,element:a.createElement(Vn,null)}),a.createElement(F.AW,{path:"/app_work_show",exact:!0,element:a.createElement(Jn,null)}),a.createElement(F.AW,{path:"/site_stat_marc",exact:!0,element:a.createElement(Kn,null)}),a.createElement(F.AW,{path:"/advertising_company",exact:!0,element:a.createElement(na,null)}),a.createElement(F.AW,{path:"/ras_bill_and_cook",exact:!0,element:a.createElement(ra,null)}),a.createElement(F.AW,{path:"/sklad_items_module",exact:!0,element:a.createElement(ca,null)}),a.createElement(F.AW,{path:"/site_user_manager",exact:!0,element:a.createElement(ha,null)}),a.createElement(F.AW,{path:"/promo_items_stat",exact:!0,element:a.createElement(_a,null)}),a.createElement(F.AW,{path:"/site_items",exact:!0,element:a.createElement(Pa,null)}),a.createElement(F.AW,{path:"/hot_map",exact:!0,element:a.createElement(Aa,null)}),a.createElement(F.AW,{component:function(){return a.createElement(Ma,{code:404},a.createElement(D.ZP,{container:!0,className:"Contact mainContainer MuiGrid-spacing-xs-3",style:{marginTop:64}},a.createElement(D.ZP,{item:!0,xs:12},a.createElement(x.Z,{variant:"h5",component:"h1"},"404 Страница не найдена"))))}}))))))}var Fa=document.getElementById("app");(0,i.s)(Fa).render(a.createElement(z.VK,null,a.createElement(za,null)))},3325:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},5369:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},5673:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},1819:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},312:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},7943:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},9364:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},134:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},6771:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},3208:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},1574:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},3758:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},1715:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},2603:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},7993:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},7331:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},2885:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},7122:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},4010:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},521:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},3692:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},5584:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},1702:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},6751:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},9839:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},7709:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},7887:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},5986:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},5537:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)},4220:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)}},e=>{e.O(0,[216],(()=>(5320,e(e.s=5320)))),e.O()}]);
//# sourceMappingURL=main.3016b478cae0e684d82d.js.map