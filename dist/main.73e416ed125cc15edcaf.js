"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[179],{9754:(e,t,a)=>{var n=a(7294),i=a(745),s=(a(5369),a(7462)),r=a(5861),o=a(5671),l=a(3144),c=a(7326),m=a(136),u=a(6215),d=a(1120),h=a(4942),p=a(4687),_=a.n(p),f=a(6720),g=a(3720),E=a(4386),y=a(2440),Z=a(799),v=a(9334),b=a(2658),x=a(7720),w=a(6867),D=a(1303),I=a(6089),k=a(5725),P=a(326),S=a(9572),T=a(5817),C=a(9941),A=a(7425),j=a(5092),L=a(3508),O=a(4345),z=a(5974),R=a(9711),F=a(6974),M=a(5116),N=a(1174),W=a(5159),$=(a(521),a(5987)),J=a(2642),B=a(4666),Y=a(8979),q=a(7750),Q=a(6408),K=a(7645),U=a(5697),V=a.n(U),G=a(20),H=a(2640),X=a(1508),ee=a(9573),te=a(8732),ae=a(6926),ne=a(7896),ie=a(6011),se=a(3694),re=a(594),oe=a(4567),le=a(9062),ce=a(4172),me=a(2004),ue=a(7097),de=a(7233),he=a(6501),pe=a(6406),_e=["children","value","index"];function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,d.Z)(e);if(t){var i=(0,d.Z)(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return(0,u.Z)(this,a)}}var ge=a(7563);function Ee(e){var t=e.children,a=e.value,i=e.index,r=(0,$.Z)(e,_e);return n.createElement("div",(0,s.Z)({role:"tabpanel",hidden:a!==i,id:"simple-tabpanel-".concat(i),"aria-labelledby":"simple-tab-".concat(i)},r),a===i&&n.createElement(X.Z,{sx:{p:3}},t))}function ye(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}Ee.propTypes={children:V().node,index:V().number.isRequired,value:V().number.isRequired};var Ze=function(e){(0,m.Z)(f,e);var t,a,i,u,d,p=fe(f);function f(e){var t;return(0,o.Z)(this,f),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:ge.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"revizion",module_name:"",is_load:!1,points:[],point:"0",revList:[],chooseRev:"",search:"",items:[],pf:[],rec:[],items_b:[],pf_b:[],rec_b:[],all_data:[],chooseTab:0},t}return(0,l.Z)(f,[{key:"componentDidMount",value:(d=(0,r.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({points:t.point_list,point:1==t.point_list.length?t.point_list[0].id:"0",module_name:t.module_info.name,all_data:t.get_data_for_new_rev}),document.title=t.module_info.name,setTimeout((function(){}),100);case 6:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"changePoint",value:function(e){var t=this,a=e.target.value;this.setState({point:a,search:""}),setTimeout((function(){t.getRevList()}),50)}},{key:"changeRev",value:function(e){var t=this,a=e.target.value;this.setState({chooseRev:a,search:""}),setTimeout((function(){t.getDataRev()}),300)}},{key:"search",value:(u=(0,r.Z)(_().mark((function e(t){var a,n,i,s;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.state.point,this.state.showReady,this.state,s=t.target.value.toLowerCase(),a=this.state.items_b.filter((function(e){return e.name.toLowerCase().includes(s)})),n=this.state.rec_b.filter((function(e){return e.name.toLowerCase().includes(s)})),i=this.state.pf_b.filter((function(e){return e.name.toLowerCase().includes(s)})),this.setState({items:a,rec:n,pf:i,search:s});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"updateData",value:(i=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={rev_id:this.state.chooseRev,point_id:this.state.point},e.next=3,this.getData("get_data_rev",t);case 3:a=e.sent,this.setState({items:a.item,rec:a.rec,pf:a.pf,items_b:a.item,rec_b:a.rec,pf_b:a.pf});case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getRevList",value:(a=(0,r.Z)(_().mark((function e(){var t,a,n=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point},e.next=3,this.getData("get_rev_list",t);case 3:a=e.sent,this.setState({revList:a,chooseRev:a.length>0?a[0].id:""}),a.length>0&&setTimeout((function(){n.getDataRev()}),300);case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getDataRev",value:(t=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point,rev_id:this.state.chooseRev},e.next=3,this.getData("get_data_rev",t);case 3:a=e.sent,this.setState({items:a.item,rec:a.rec,pf:a.pf,items_b:a.item,rec_b:a.rec,pf_b:a.pf});case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(k.ZP,{container:!0,spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,this.state.module_name)),n.createElement(k.ZP,{item:!0,xs:12},n.createElement(R.OL,{to:"/revizion/new"},"Новая ревизия")),n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(pe.$S,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(pe.$S,{data:this.state.revList,value:this.state.chooseRev,func:this.changeRev.bind(this),label:"Ревизия"})),n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(pe.rZ,{func:this.search.bind(this),label:"Поиск",value:this.state.search})),n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(J.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),n.createElement(k.ZP,{item:!0,xs:12,sm:12,id:"revTable"},n.createElement(G.Z,{value:this.state.chooseTab,onChange:function(t,a){e.setState({chooseTab:a})},textColor:"primary",indicatorColor:"primary",centered:!0},n.createElement(H.Z,(0,s.Z)({label:"Товары"},ye(0))),n.createElement(H.Z,(0,s.Z)({label:"Заготовки"},ye(1)))),n.createElement(Ee,{value:this.state.chooseTab,index:0},n.createElement(ne.Z,{component:he.Z},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"Товар"),n.createElement(ae.Z,null,"Объем"))),n.createElement(te.Z,null,this.state.items.map((function(e,t){return n.createElement(se.Z,{key:t},n.createElement(ae.Z,null,e.name),n.createElement(ae.Z,null,e.value," ",e.ei_name))})))))),n.createElement(Ee,{value:this.state.chooseTab,index:1},n.createElement(ne.Z,{component:he.Z},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"Заготовка"),n.createElement(ae.Z,null,"Объем"))),n.createElement(te.Z,null,this.state.pf.map((function(e,t){return n.createElement(se.Z,{key:t},n.createElement(ae.Z,null,e.name),n.createElement(ae.Z,null,e.value," ",e.ei_name))})))))))))}}]),f}(n.Component),ve=function(e){(0,m.Z)(a,e);var t=fe(a);function a(e){var n;return(0,o.Z)(this,a),(n=t.call(this,e)).state={item:n.props.item,pf:n.props.pf,change:n.props.change,type:n.props.type},n}return(0,l.Z)(a,[{key:"componentWillMount",value:function(){}},{key:"componentDidMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.change!==t.change||this.state.change!==e.change}},{key:"render",value:function(){var e=this;return n.createElement(C.Z,null,n.createElement(A.Z,{expandIcon:n.createElement(L.Z,null)},n.createElement(b.Z,{style:{width:"60%"}},this.state.item.name," "),n.createElement(b.Z,{style:{width:"40%"}},this.state.item.value," ",this.state.item.ei_name," ")),"item"!=this.state.type?null:n.createElement(j.Z,null,this.state.item.counts.map((function(t,a){return n.createElement(k.ZP,{container:!0,spacing:3,key:a,style:{paddingTop:10,paddingBottom:10}},n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(pe.$S,{data:e.state.item.size,value:t.need_pq,func:e.props.func.bind(e,"item",e.props.itemKey,"need_pq",a),label:"Объем упаковки"})),n.createElement(k.ZP,{item:!0,xs:0==a?12:9,sm:5},n.createElement(M.Z,{value:t.value,onChange:e.props.func.bind(e,"item",e.props.itemKey,"value",a),fullWidth:!0,variant:"outlined",size:"small",label:"Количество"})),0==a?null:n.createElement(k.ZP,{item:!0,xs:3,sm:1},n.createElement(J.Z,{onClick:e.props.clear.bind(e,"item",e.props.itemKey,a),variant:"contained"}," ",n.createElement(re.Z,null)," ")))})),n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(J.Z,{variant:"contained",onClick:this.props.copy.bind(this,"item",this.props.itemKey)},"Дублировать"))),"pf"!=this.state.type?null:n.createElement(j.Z,null,n.createElement(k.ZP,{item:!0,sm:5},n.createElement(M.Z,{value:this.state.pf.value,onChange:this.props.func.bind(this,"pf",this.props.itemKey,"value",0),fullWidth:!0,variant:"outlined",size:"small",label:"Количество"}))))}}]),a}(n.Component),be=function(e){(0,m.Z)(d,e);var t,a,i,u=fe(d);function d(e){var t;return(0,o.Z)(this,d),t=u.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:ge.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"revizion",module_name:"",is_load:!1,points:[],point:"0",revList:[],chooseRev:"",storages:[],items:[],rec:[],pf:[],chooseTab:0,modalDialog:!1,open:!1},t}return(0,l.Z)(d,[{key:"componentDidMount",value:(i=(0,r.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({points:t.point_list,point:1==t.point_list.length?t.point_list[0].id:"0",module_name:t.module_info.name}),document.title=t.module_info.name,setTimeout((function(){}),100);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"changePoint",value:function(e){var t=this,a=e.target.value;this.setState({point:a}),setTimeout((function(){t.getDataRev()}),300)}},{key:"getDataRev",value:(a=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point},e.next=3,this.getData("get_data_for_new_rev",t);case 3:a=e.sent,this.setState({storages:a.storages,items:a.items,rec:a.rec,pf:a.pf});case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"saveData",value:function(e,t,a,n,i){if(console.log("saveData"),"item"==e){var s=this.state.items;s[t].counts[n][[a]]=i.target.value;var r=0;s[t].counts.map((function(e,t){r+=parseFloat(e.need_pq)*parseFloat(e.value)})),s[t].value=r,s[t].change++,this.setState({items:s})}if("pf"==e){var o=this.state.pf;o[t].value=i.target.value,o[t].change++,this.setState({pf:o}),console.log("pf",o)}}},{key:"checkData",value:function(){console.log("checkData");var e=this.state.items,t=this.state.pf;e.map((function(e,t){0!=e.value&&(e.is_show=0)})),t.map((function(e,t){0!=e.value&&(e.is_show=0)})),this.setState({items:e,pf:t}),this.setState({modalDialog:!0,titleDialog:"Ты уверен в правильности этих позиций ?"})}},{key:"copyData",value:function(e,t){if("item"==e){var a=this.state.items;a[t].counts.push({need_pq:a[t].counts[0].need_pq,value:0}),a[t].change++,this.setState({items:a})}}},{key:"clearData",value:function(e,t,a){if("item"==e){var n=this.state.items,i=[];n[t].counts.map((function(e,t){t!=a&&i.push(e)})),n[t].counts=i;var s=0;n[t].counts.map((function(e,t){s+=parseFloat(e.need_pq)*parseFloat(e.value)})),n[t].value=s,n[t].change++,this.setState({items:n})}}},{key:"saveRev",value:(t=(0,r.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={point_id:this.state.point,item:this.state.item,rec:this.state.rec,pf:this.state.pf},console.log("saveRev ",t);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(k.ZP,{container:!0,spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,"Новая ревизии")),n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(pe.$S,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(J.Z,{variant:"contained",onClick:this.checkData.bind(this)},"Сохранить")),n.createElement(k.ZP,{item:!0,xs:12,sm:12,id:"revTable"},n.createElement(G.Z,{value:this.state.chooseTab,onChange:function(t,a){e.setState({chooseTab:a})},textColor:"primary",indicatorColor:"primary",centered:!0},n.createElement(H.Z,(0,s.Z)({label:"Товары"},ye(0))),n.createElement(H.Z,(0,s.Z)({label:"Заготовки"},ye(1)))),n.createElement("div",{style:0==this.state.chooseTab?{display:"block"}:{display:"none"}},this.state.items.map((function(t,a){return 0==parseInt(t.is_show)?null:n.createElement(ve,{key:a,type:"item",itemKey:a,item:t,change:t.change,func:e.saveData.bind(e),copy:e.copyData.bind(e),clear:e.clearData.bind(e)})}))),n.createElement("div",{style:1==this.state.chooseTab?{display:"block"}:{display:"none"}},this.state.pf.map((function(t,a){return 0==parseInt(t.is_show)?null:n.createElement(ve,{key:a,type:"pf",itemKey:a,item:t,pf:t,change:t.change,func:e.saveData.bind(e),copy:e.copyData.bind(e),clear:e.clearData.bind(e)})}))))),n.createElement(n.Fragment,null,n.createElement(W.Z,{anchor:"left",open:this.state.open,onClose:function(){e.setState({open:!1})},onOpen:function(){e.setState({open:!0})}},n.createElement(y.Z,{style:{width:"100%"}},this.state.storages.map((function(e,t){return n.createElement(Z.ZP,{button:!0,key:t},n.createElement(v.Z,{primary:e.name}))}))))),0==this.state.storages.length?null:n.createElement(he.Z,{sx:{position:"fixed",bottom:0,left:0,right:0},elevation:3},n.createElement(ce.Z,{showLabels:!0},n.createElement(me.Z,{onClick:function(t,a){e.setState({open:!0})},label:"Recents",icon:n.createElement(ue.Z,null)}),n.createElement(me.Z,{onClick:this.checkData.bind(this),label:"Save",icon:n.createElement(de.Z,null)}))),n.createElement(B.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.createElement(K.Z,{id:"alert-dialog-title"},this.state.titleDialog),n.createElement(q.Z,{style:{paddingBottom:10,paddingTop:10}},n.createElement(Q.Z,{id:"alert-dialog-description"},n.createElement(k.ZP,{container:!0,spacing:3},"Не все поля заполнены ")),n.createElement(k.ZP,{container:!0,spacing:3},n.createElement(k.ZP,{item:!0},"Позиция "),n.createElement(k.ZP,{item:!0},"Кол-во "),n.createElement(k.ZP,{item:!0},"Ед. измер. "))),n.createElement(Y.Z,null,n.createElement(J.Z,{color:"primary"},"Хорошо"),n.createElement(J.Z,{color:"primary"},"Сохранить"))))}}]),d}(n.Component);function xe(){return n.createElement(Ze,null)}function we(){return n.createElement(be,null)}a(5584);var De=a(3887),Ie=a(7036),ke=a(7598),Pe=a(6278);function Se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,d.Z)(e);if(t){var i=(0,d.Z)(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return(0,u.Z)(this,a)}}var Te=function(e){(0,m.Z)(a,e);var t=Se(a);function a(e){var n;return(0,o.Z)(this,a),(n=t.call(this,e)).state={},n}return(0,l.Z)(a,[{key:"render",value:function(){return n.createElement(n.Fragment,null,n.createElement(b.Z,null,this.props.label),n.createElement(Pe.ZP,{format:"YYYY-MM-DD",multiple:!0,sort:!0,style:{width:"100%"},label:this.props.label,value:this.props.value,onChange:this.props.func}))}}]),a}(n.PureComponent),Ce=a(7563);function Ae(e){var t=new Date(e),a=""+(t.getMonth()+1),n=""+t.getDate(),i=t.getFullYear();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),[i,a,n].join("-")}function je(e){var t=new Date(e),a=""+(t.getMonth()+1),n=""+t.getDate(),i=t.getFullYear();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),[n,a,i].join(".")}function Le(e){var t=new Date(e),a=""+(t.getMonth()+1),n=""+t.getDate();t.getFullYear(),n.length<2&&(n="0"+n);var i="";switch(parseInt(a)){case 1:i="Января";break;case 2:i="Февраля";break;case 3:i="Марта";break;case 4:i="Апреля";break;case 5:i="Мая";break;case 6:i="Июня";break;case 7:i="Июля";break;case 8:i="Августа";break;case 9:i="Сентября";break;case 10:i="Октября";break;case 11:i="Ноября";break;case 12:i="Декабря"}return[n,i].join(" ")}var Oe=function(e){(0,m.Z)(s,e);var t,a,i=Se(s);function s(e){var t;return(0,o.Z)(this,s),t=i.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Ce.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1}),t.click=!1}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,modalText:"",points:[],point:0,cities:[],city:0,modalDialog:!1,modalLink:"",where_promo_list:[{id:1,name:"Создать"},{id:2,name:"Создать и показать"},{id:3,name:"Отправить на почту"},{id:4,name:"Отправить в смс"},{id:5,name:"Рассылка смс"},{id:6,name:"Отправить в ЛК (через 8)"},{id:7,name:"Создать сертификат(ы)"},{id:8,name:"Отправить через бота ВК"}],promo_action_list:[],sale_list:[{id:1,name:"На товары"},{id:2,name:"На категории"},{id:3,name:"На все меню (кроме допов и закусок)"}],promo_conditions_list:[{id:1,name:"В корзине есть определенные товар(ы)"},{id:2,name:"В корзине набрана определенная сумма"}],promo_sale_list:[],type_sale_list:[{id:1,name:"В рублях"},{id:2,name:"В процентах"}],date_promo_list:[{id:1,name:"В определенные даты"},{id:2,name:"14 дней с 10:00 до 21:40"},{id:3,name:"14 дней с 00:00 до 23:59"},{id:4,name:"30 дней с 10:00 до 21:40"},{id:5,name:"30 дней с 00:00 до 23:59"}],type_order_list:[{id:1,name:"Все"},{id:2,name:"Доставка"},{id:3,name:"Самовывоз"},{id:4,name:"Зал"}],where_order_list:[{id:1,name:"В городе"},{id:2,name:"На точке"}],promo_prizw_vk:"Привет!\r\nПоздравляем 🎉\r\nПромокод --promo-- на --position--, действует до --endDate--. Активировать можно при заказе на доставку, самовывоз и в кафе.\r\n\r\nОбратите внимание, что за подарочную позицию надо будет заплатить 1 руб, это необходимое условие для получения приза. В промокод не входят соевый соус, имбирь и васаби.\r\n\r\nЗаказы принимаем на сайте --site--\r\n\r\nРежим работы: с 10:00 до 21:30\r\nАдреса наших кафе:\r\n--addrCity--",spamNameSMS:"",auto_text:!0,where_promo:1,promo_name:"",generate_new:!1,count_action:1,promo_action:1,type_sale:3,promo_sale:1,sale_type:2,promo_conditions:2,price_start:0,price_end:0,date_promo:1,date_start:Ae(new Date),date_end:Ae(new Date),rangeDate:[Ae(new Date),Ae(new Date)],time_start:"10:00",time_end:"21:30",promo_length:5,promo_count:1,day_1:!0,day_2:!0,day_3:!0,day_4:!0,day_5:!0,day_6:!0,day_7:!0,type_order:1,where_order:1,numberList:"",promo_desc_true:"",promo_desc_false:"",textSMS:"",addItem:null,addItemCount:1,addItemPrice:1,addItemAllPrice:0,itemsAdd:[],itemsAddPrice:[],items:[],cats:[],saleCat:[],saleItem:[],priceItem:null,conditionItems:[],testDate:[],createdPromo:[]},t}return(0,l.Z)(s,[{key:"componentDidMount",value:(a=(0,r.Z)(_().mark((function e(){var t,a,n,i,s,r,o=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all_for_new");case 2:t=e.sent,a=new Date,i=a.getFullYear(),s=a.getMonth()+1,r=a.getDate(),n=i+"-"+(parseInt(s)>9?s:"0"+s)+"-"+(parseInt(r)>9?r:"0"+r),this.setState({points:t.points,cities:t.cities,module_name:t.module_info.name,promo_action_list:t.promo_action_list,promo_sale_list:t.promo_sale_list,date_start:n,date_end:n,items:t.items,cats:t.cats}),document.title=t.module_info.name,setTimeout((function(){o.generateTextDescFalse(),o.generateTextDescTrue()}),300);case 12:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"save",value:(t=(0,r.Z)(_().mark((function e(){var t,a,n,i,s,r,o,l=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.click){e.next=30;break}return this.click=!0,this.setState({createdPromo:[]}),0,t=2==parseInt(this.state.sale_type)?this.state.promo_sale_list.find((function(e){return parseInt(e.id)==parseInt(l.state.promo_sale)})).name:parseInt(this.state.promo_sale),a=[],this.state.conditionItems.map((function(e){a.push(e.id)})),n=[],this.state.saleItem.map((function(e){n.push(e.id)})),i=[],this.state.saleCat.map((function(e){i.push(e.id)})),s=[],this.state.testDate.map((function(e){s.push(new Date(e).toISOString().split("T")[0])})),s=s.join(","),r={spamNameSMS:this.state.spamNameSMS,promo_vk_prize:this.state.promo_prizw_vk,cert_text:this.state.cert_text,addr:this.state.numberList,where_promo:this.state.where_promo,promo_count:this.state.promo_count,promo_len:this.state.promo_length,promo_name:this.state.promo_name,generate:this.state.generate_new?1:0,promo_in_count:this.state.count_action,promo_action:this.state.promo_action,promo_type_sale:this.state.type_sale,count_promo:t,promo_type:this.state.sale_type,promo_conditions:this.state.promo_conditions,promo_summ:this.state.price_start,promo_summ_to:this.state.price_end,promo_when:this.state.date_promo,date_start:this.state.date_start,date_end:this.state.date_end,time_start:this.state.time_start,time_end:this.state.time_end,day_1:this.state.day_1?1:0,day_2:this.state.day_2?1:0,day_3:this.state.day_3?1:0,day_4:this.state.day_4?1:0,day_5:this.state.day_5?1:0,day_6:this.state.day_6?1:0,day_7:this.state.day_7?1:0,promo_type_order:this.state.type_order,promo_where:this.state.where_order,numberList:this.state.numberList,promo_city:this.state.city,promo_point:this.state.point,about_promo_text:this.state.promo_desc_true,condition_promo_text:this.state.promo_desc_false,textSMS:this.state.textSMS,promo_items:JSON.stringify(n),promo_cat:JSON.stringify(i),promo_items_add:JSON.stringify(this.state.itemsAdd),promo_items_sale:JSON.stringify(this.state.itemsAddPrice),promo_conditions_items:JSON.stringify(a),date_between:s},e.next=17,this.getData("save_new_promo",r);case 17:if(o=e.sent,console.log(o),0!=o.st){e.next=23;break}return this.setState({modalDialog:!0,modalText:o.text_err}),setTimeout((function(){l.click=!1}),300),e.abrupt("return");case 23:this.setState({createdPromo:o.promo_text}),1!=parseInt(this.state.where_promo)&&8!=parseInt(this.state.where_promo)||this.setState({modalDialog:!0,modalText:"Создано"}),2==parseInt(this.state.where_promo)&&this.setState({modalDialog:!0,modalText:"Промокоды: "+o.promo_text.join(", ")}),3==parseInt(this.state.where_promo)&&this.setState({modalDialog:!0,modalText:o.text}),4!=parseInt(this.state.where_promo)&&5!=parseInt(this.state.where_promo)&&6!=parseInt(this.state.where_promo)||this.setState({modalDialog:!0,modalText:o.text}),7==parseInt(this.state.where_promo)&&this.setState({modalDialog:!0,modalText:o.text,modalLink:o.link}),setTimeout((function(){l.click=!1}),300);case 30:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeData",value:function(e,t){var a=this;if(this.setState((0,h.Z)({},e,t.target.value)),"date_promo"==e&&(2==t.target.value||3==t.target.value)){var n=new Date,i=new Date;i.setDate(i.getDate()+14),this.setState({rangeDate:[Ae(n),Ae(i)],date_start:Ae(n),date_end:Ae(i),time_start:2==t.target.value?"10:00":"00:00",time_end:2==t.target.value?"21:40":"23:59"})}if("date_promo"==e&&(4==t.target.value||5==t.target.value)){var s=new Date,r=new Date;r.setDate(r.getDate()+30),this.setState({rangeDate:[Ae(s),Ae(r)],date_start:Ae(s),date_end:Ae(r),time_start:4==t.target.value?"10:00":"00:00",time_end:4==t.target.value?"21:40":"23:59"})}setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDataCheck",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,t.target.checked)),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDateRange",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,Ae(t))),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDataData",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,t)),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"generateTextDescTrue",value:function(){var e=this;if(this.state.auto_text){var t=this.state.promo_action,a="";if(1==parseInt(t)){var n=this.state.type_sale,i=this.state.sale_type,s=0;if(s=2==parseInt(this.state.sale_type)?s=this.state.promo_sale_list.find((function(t){return parseInt(t.id)==parseInt(e.state.promo_sale)})).name:parseInt(this.state.promo_sale),1==parseInt(n)){var r=this.state.saleItem,o="";r.map((function(e,t){o+=e.name+", "})),a="скидку на "+(o=o.substring(0,o.length-2))+" в размере "+s+(1==parseInt(i)?"руб.":"%")}2==parseInt(n)&&(r=this.state.saleCat,o="",r.map((function(e,t){o+=e.name+", "})),a="скидку на "+(o=o.substring(0,o.length-2))+" в размере "+s+(1==parseInt(i)?"руб.":"%")),3==parseInt(n)&&(a="скидку на всё меню, кроме напитков, соусов, приправ и палочек, в размере "+s+(1==parseInt(i)?"руб.":"%"))}if(2==parseInt(t)){var l="";this.state.itemsAdd.map((function(e,t){0==parseInt(e.price)?l+="бесплатную "+e.name+" "+e.count+"шт. за "+e.price+"руб., ":l+=e.name+" "+e.count+"шт. за "+e.price+"руб., "})),l=l.substring(0,l.length-2),a=1==this.state.itemsAdd.length?"позицию "+l:"позиции "+l}3==parseInt(t)&&(l="",this.state.itemsAddPrice.map((function(e,t){l+=e.name+" по "+e.price+"руб., "})),l=l.substring(0,l.length-2),a=this.state.itemsAddPrice.length-1==1?"позицию "+l:"позиции "+l);var c="Промокод --promo_name--, действует до "+Le(this.state.date_end)+". Заказывай на jacofood.ru!";this.setState({promo_desc_true:a,textSMS:c,cert_text:a})}}},{key:"generateTextDescFalse",value:function(){var e=this;if(this.state.auto_text){var t="",a="";if(console.log(this.state.testDate),this.state.testDate.length>0){var n=[];this.state.testDate.map((function(e){n.push(new Date(e).toISOString().split("T")[0])})),a="(кроме ",n.map((function(e){a+=Le(e)+", "})),a=(a=a.slice(0,-1)).slice(0,-1),a+=")",console.log("text",a)}1==parseInt(this.state.where_order)&&0!=parseInt(this.state.city)&&(t=" в г. "+this.state.cities.find((function(t){return parseInt(t.id)==parseInt(e.state.city)})).name),2==parseInt(this.state.where_order)&&0!=parseInt(this.state.point)&&(t=" в г. "+this.state.points.find((function(t){return parseInt(t.id)==parseInt(e.state.point)})).name);var i="Промокод действует c "+je(this.state.date_start)+" до "+je(this.state.date_end)+" с "+this.state.time_start+" до "+this.state.time_end+" "+a+t;this.setState({promo_desc_false:i})}}},{key:"addItemAdd",value:function(){var e=this,t=this.state.itemsAdd;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.addItem.id)}))){var a=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.addItem.id)}));t.push({item_id:this.state.addItem.id,name:a.name,count:this.state.addItemCount,price:this.state.addItemPrice});var n=0;t.map((function(e){n+=parseInt(e.price)})),this.setState({itemsAdd:t,addItemAllPrice:n})}setTimeout((function(){e.generateTextDescFalse(),e.generateTextDescTrue()}),300)}},{key:"delItemAdd",value:function(e){var t=this,a=this.state.itemsAdd.filter((function(t){return parseInt(t.item_id)!=parseInt(e.item_id)})),n=0;a.map((function(e){n+=parseInt(e.price)})),this.setState({itemsAdd:a,addItemAllPrice:n}),setTimeout((function(){t.generateTextDescFalse(),t.generateTextDescTrue()}),300)}},{key:"priceItemAdd",value:function(){var e=this,t=this.state.itemsAddPrice;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.priceItem.id)}))){var a=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.priceItem.id)}));t.push({id:this.state.priceItem.id,name:a.name,price:this.state.addItemCount}),this.setState({itemsAddPrice:t})}setTimeout((function(){e.generateTextDescFalse(),e.generateTextDescTrue()}),300)}},{key:"delItemPrice",value:function(e){var t=this,a=this.state.itemsAddPrice.filter((function(t){return parseInt(t.item_id)!=parseInt(e.item_id)}));a.map((function(e){parseInt(e.price)})),this.setState({itemsAddPrice:a}),setTimeout((function(){t.generateTextDescFalse(),t.generateTextDescTrue()}),300)}},{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(B.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,modalLink:""})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.createElement(K.Z,{id:"alert-dialog-title"},"Результат операции"),n.createElement(q.Z,{style:{paddingBottom:10,paddingTop:10}},n.createElement(b.Z,null,this.state.modalText),n.createElement("br",null),n.createElement(b.Z,null,"Созданыне промокоды: ",this.state.createdPromo.join(", ")),n.createElement("br",null),""==this.state.modalLink?null:n.createElement("a",{href:this.state.modalLink,style:{color:"red"}},"Скачать")),n.createElement(Y.Z,null,n.createElement(J.Z,{color:"primary",onClick:function(){e.setState({modalDialog:!1})}},"Хорошо"))),n.createElement(k.ZP,{container:!0},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,this.state.module_name)),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},!0===this.state.generate_new?null:n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.promo_name,func:this.changeData.bind(this,"promo_name"),label:"Название промокода"})),!1===this.state.generate_new?null:n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.promo_length,func:this.changeData.bind(this,"promo_length"),label:"Длина промокода"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.IA,{value:this.state.generate_new,func:this.changeDataCheck.bind(this,"generate_new"),label:"Сгенерировать"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.count_action,func:this.changeData.bind(this,"count_action"),label:"Количество активаций"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.promo_count,func:this.changeData.bind(this,"promo_count"),label:"Количество промокодов"}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.promo_action_list,value:this.state.promo_action,func:this.changeData.bind(this,"promo_action"),label:"Промокод дает:"}))),1!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.sale_list,value:this.state.type_sale,func:this.changeData.bind(this,"type_sale"),label:"Скидка"})),1!==parseInt(this.state.type_sale)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:9},n.createElement(pe.e_,{data:this.state.items,value:this.state.saleItem,func:function(t,a){e.changeDataData("saleItem",a)},multiple:!0,label:"Товары"})),2!==parseInt(this.state.type_sale)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:9},n.createElement(pe.e_,{data:this.state.cats,value:this.state.saleCat,func:function(t,a){e.changeDataData("saleCat",a)},multiple:!0,label:"Категории"})),1==parseInt(this.state.sale_type)?n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.promo_sale,func:this.changeData.bind(this,"promo_sale"),label:"Размер скидки"})):n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.promo_sale_list,value:this.state.promo_sale,func:this.changeData.bind(this,"promo_sale"),label:"Размер скидки"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.type_sale_list,value:this.state.sale_type,func:this.changeData.bind(this,"sale_type"),label:"Какая скидка"}))),2!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.e_,{data:this.state.items,value:this.state.addItem,func:function(t,a){e.changeDataData("addItem",a)},label:"Позиция"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.addItemCount,func:this.changeData.bind(this,"addItemCount"),label:"Количество"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.addItemPrice,func:this.changeData.bind(this,"addItemPrice"),label:"Цена за все"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(J.Z,{variant:"contained",onClick:this.addItemAdd.bind(this)},"Добавить"))),2!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"Позиция"),n.createElement(ae.Z,null,"Количество"),n.createElement(ae.Z,null,"Цена за все"),n.createElement(ae.Z,null))),n.createElement(te.Z,null,this.state.itemsAdd.map((function(t,a){return n.createElement(se.Z,{key:a},n.createElement(ae.Z,null,t.name),n.createElement(ae.Z,null,t.count),n.createElement(ae.Z,null,t.price),n.createElement(ae.Z,null," ",n.createElement(re.Z,{onClick:e.delItemAdd.bind(e,t),style:{cursor:"pointer"}})," "))}))),n.createElement(De.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null),n.createElement(ae.Z,null),n.createElement(ae.Z,null,this.state.addItemAllPrice),n.createElement(ae.Z,null)))))),3!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.e_,{data:this.state.items,value:this.state.priceItem,func:function(t,a){e.changeDataData("priceItem",a)},label:"Позиция"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.addItemCount,func:this.changeData.bind(this,"addItemCount"),label:"Цена за 1 ед"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(J.Z,{variant:"contained",onClick:this.priceItemAdd.bind(this)},"Добавить"))),3!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"Позиция"),n.createElement(ae.Z,null,"Цена за 1 ед"),n.createElement(ae.Z,null))),n.createElement(te.Z,null,this.state.itemsAddPrice.map((function(t,a){return n.createElement(se.Z,{key:a},n.createElement(ae.Z,null,t.name),n.createElement(ae.Z,null,t.price),n.createElement(ae.Z,null," ",n.createElement(re.Z,{onClick:e.delItemPrice.bind(e,t),style:{cursor:"pointer"}})," "))})))))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.promo_conditions_list,value:this.state.promo_conditions,func:this.changeData.bind(this,"promo_conditions"),label:"Условие"})),1!==parseInt(this.state.promo_conditions)?null:n.createElement(n.Fragment,null,n.createElement(k.ZP,{item:!0,xs:12,sm:8},n.createElement(pe.e_,{data:this.state.items,value:this.state.conditionItems,func:function(t,a){e.changeDataData("conditionItems",a)},multiple:!0,label:"Товары"}))),2!==parseInt(this.state.promo_conditions)?null:n.createElement(n.Fragment,null,n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.price_start,func:this.changeData.bind(this,"price_start"),label:"Сумма от"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.price_end,func:this.changeData.bind(this,"price_end"),label:"Сумма до"})))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.date_promo_list,value:this.state.date_promo,func:this.changeData.bind(this,"date_promo"),label:"Когда работает промокод"}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.Qe,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.Qe,{label:"Дата до",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.w0,{label:"Время от",value:this.state.time_start,func:this.changeData.bind(this,"time_start")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.w0,{label:"Время до",value:this.state.time_end,func:this.changeData.bind(this,"time_end")}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(Te,{multiple:!1,label:"Кроме дат",value:this.state.testDate,func:this.changeDataData.bind(this,"testDate")}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{marginTop:20},spacing:3},n.createElement(pe.IA,{value:this.state.day_1,func:this.changeDataCheck.bind(this,"day_1"),label:"Понедельник"}),n.createElement(pe.IA,{value:this.state.day_2,func:this.changeDataCheck.bind(this,"day_2"),label:"Вторник"}),n.createElement(pe.IA,{value:this.state.day_3,func:this.changeDataCheck.bind(this,"day_3"),label:"Среда"}),n.createElement(pe.IA,{value:this.state.day_4,func:this.changeDataCheck.bind(this,"day_4"),label:"Четверг"}),n.createElement(pe.IA,{value:this.state.day_5,func:this.changeDataCheck.bind(this,"day_5"),label:"Пятница"}),n.createElement(pe.IA,{value:this.state.day_6,func:this.changeDataCheck.bind(this,"day_6"),label:"Суббота"}),n.createElement(pe.IA,{value:this.state.day_7,func:this.changeDataCheck.bind(this,"day_7"),label:"Воскресенье"})),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.type_order_list,value:this.state.type_order,func:this.changeData.bind(this,"type_order"),label:"Тип заказа"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.where_order_list,value:this.state.where_order,func:this.changeData.bind(this,"where_order"),label:"Где работает"})),1!==parseInt(this.state.where_order)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.cities,value:this.state.city,func:this.changeData.bind(this,"city"),label:"Город"})),2!==parseInt(this.state.where_order)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.points,value:this.state.point,func:this.changeData.bind(this,"point"),label:"Точка"}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.where_promo_list,value:this.state.where_promo,func:this.changeData.bind(this,"where_promo"),label:"Что сделать с промокодом"})),1==parseInt(this.state.where_promo)||2==parseInt(this.state.where_promo)?null:5==parseInt(this.state.where_promo)?n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement("span",null,"Список номеров для рассылки"),n.createElement(ke.Z,{"aria-label":"empty textarea",placeholder:"",minRows:3,value:this.state.numberList,onChange:this.changeData.bind(this,"numberList"),label:"Куда отправить",style:{width:"100%"}})):n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.numberList,func:this.changeData.bind(this,"numberList"),label:"Куда отправить"}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},8!==parseInt(this.state.where_promo)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("span",null,"Текст расссылки"),n.createElement(ke.Z,{"aria-label":"empty textarea",placeholder:"",minRows:3,value:this.state.promo_prizw_vk,onChange:this.changeData.bind(this,"promo_prizw_vk"),style:{width:"100%"}})),5==parseInt(this.state.where_promo)?n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.spamNameSMS,func:this.changeData.bind(this,"spamNameSMS"),label:"Наименование рассылки"})):null,4==parseInt(this.state.where_promo)||5==parseInt(this.state.where_promo)?n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.textSMS,func:this.changeData.bind(this,"textSMS"),label:"Текст СМС ( --promo_name-- )"})):null,7==parseInt(this.state.where_promo)?n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.cert_text,func:this.changeData.bind(this,"cert_text"),label:"Текст для описания сертификата"})):null,n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.IA,{value:this.state.auto_text,func:this.changeDataCheck.bind(this,"auto_text"),label:"Авто-текст"})),n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.promo_desc_true,func:this.changeData.bind(this,"promo_desc_true"),label:"Описание промокода после активации (Промокод дает: )"})),n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.promo_desc_false,func:this.changeData.bind(this,"promo_desc_false"),label:"Условие промокода, когда условия не соблюдены"}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"end",style:{paddingTop:50},spacing:3},n.createElement(J.Z,{variant:"contained",onClick:this.save.bind(this)},"Сохранить"))))}}]),s}(n.Component),ze=function(e){(0,m.Z)(s,e);var t,a,i=Se(s);function s(e){var t;return(0,o.Z)(this,s),t=i.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Ce.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1}),t.click=!1}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,modalText:"",points:[],point:0,cities:[],city:0,modalDialog:!1,modalLink:"",where_promo_list:[{id:1,name:"Создать"},{id:2,name:"Создать и показать"},{id:3,name:"Отправить на почту"},{id:4,name:"Отправить в смс"},{id:5,name:"Рассылка смс"},{id:6,name:"Отправить в ЛК (через 8)"},{id:7,name:"Создать сертификат(ы)"}],promo_action_list:[],sale_list:[{id:1,name:"На товары"},{id:2,name:"На категории"},{id:3,name:"На все меню (кроме допов и закусок)"}],promo_conditions_list:[{id:1,name:"В корзине есть определенные товар(ы)"},{id:2,name:"В корзине набрана определенная сумма"}],promo_sale_list:[],type_sale_list:[{id:1,name:"В рублях"},{id:2,name:"В процентах"}],date_promo_list:[{id:1,name:"В определенные даты"},{id:2,name:"14 дней с 10:00 до 21:40"},{id:3,name:"14 дней с 00:00 до 23:59"},{id:4,name:"30 дней с 10:00 до 21:40"},{id:5,name:"30 дней с 00:00 до 23:59"}],type_order_list:[{id:1,name:"Все"},{id:2,name:"Доставка"},{id:3,name:"Самовывоз"},{id:4,name:"Зал"}],where_order_list:[{id:1,name:"В городе"},{id:2,name:"На точке"}],auto_text:!1,where_promo:1,promo_name:"",generate_new:!1,count_action:1,promo_action:1,type_sale:3,promo_sale:1,sale_type:2,promo_conditions:2,price_start:0,price_end:0,date_promo:1,date_start:Ae(new Date),date_end:Ae(new Date),rangeDate:[Ae(new Date),Ae(new Date)],time_start:"10:00",time_end:"21:30",promo_length:5,promo_count:1,day_1:!0,day_2:!0,day_3:!0,day_4:!0,day_5:!0,day_6:!0,day_7:!0,type_order:1,where_order:1,numberList:"",promo_desc_true:"",promo_desc_false:"",textSMS:"",addItem:1,addItemCount:1,addItemPrice:1,addItemAllPrice:0,itemsAdd:[],itemsAddPrice:[],items:[],cats:[],saleCat:[],saleItem:[],priceItem:1,conditionItems:[],testDate:[]},t}return(0,l.Z)(s,[{key:"componentDidMount",value:(a=(0,r.Z)(_().mark((function e(){var t,a,n,i=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={promo_id:this.props.promoId},e.next=3,this.getData("get_all_for_edit",t);case 3:a=e.sent,n=[],a.promo.promo_conditions_items.length>4&&(a.promo.promo_conditions_items=JSON.parse(a.promo.promo_conditions_items,!0),a.promo.promo_conditions_items.map((function(e){var t=a.items.find((function(t){return parseInt(t.id)==parseInt(e)}));n.push(t)}))),setTimeout((function(){console.log("conditionItems",n),console.log("items",a.items);var e=[];a.limit.map((function(t){e.push(new Date(t.date))})),i.setState({points:a.points,cities:a.cities,module_name:a.module_info.name,promo_action_list:a.promo_action_list,promo_sale_list:a.promo_sale_list,date_start:a.promo.date1,date_end:a.promo.date2,time_start:a.promo.time1,time_end:a.promo.time2,rangeDate:[a.promo.date1,a.promo.date2],items:a.items,cats:a.cats,day_1:1==parseInt(a.promo.d1),day_2:1==parseInt(a.promo.d2),day_3:1==parseInt(a.promo.d3),day_4:1==parseInt(a.promo.d4),day_5:1==parseInt(a.promo.d5),day_6:1==parseInt(a.promo.d6),day_7:1==parseInt(a.promo.d7),count_action:a.promo.count,promo_name:a.promo.name,price_start:a.promo.promo_summ,price_end:a.promo.promo_summ_to,conditionItems:n,promo_conditions:n.length>0?1:2,point:a.promo.point_id,city:a.promo.city_id,where_order:parseInt(a.promo.city_id)>0?1:parseInt(a.promo.point_id)>0?2:1,type_order:a.promo.type_order,promo_desc_true:a.promo.coment,promo_desc_false:a.promo.condition_text,promo_id:a.promo.id,testDate:e})}),300),document.title=a.module_info.name,setTimeout((function(){i.generateTextDescFalse(),i.generateTextDescTrue()}),300);case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"save",value:(t=(0,r.Z)(_().mark((function e(){var t,a,n,i,s,r,o=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.click){e.next=16;break}return this.click=!0,t=[],this.state.conditionItems.map((function(e){t.push(e.id)})),a=[],n=[],i=[],this.state.testDate.map((function(e){i.push(new Date(e).toISOString().split("T")[0])})),i=i.join(","),s={promo_id:this.state.promo_id,cert_text:this.state.cert_text,addr:this.state.numberList,where_promo:this.state.where_promo,promo_count:this.state.promo_count,promo_len:this.state.promo_length,promo_name:this.state.promo_name,generate:this.state.generate_new?1:0,promo_in_count:this.state.count_action,promo_action:this.state.promo_action,promo_type_sale:this.state.type_sale,promo_type:this.state.sale_type,promo_conditions:this.state.promo_conditions,promo_summ:this.state.price_start,promo_summ_to:this.state.price_end,promo_when:this.state.date_promo,date_start:this.state.date_start,date_end:this.state.date_end,time_start:this.state.time_start,time_end:this.state.time_end,day_1:this.state.day_1?1:0,day_2:this.state.day_2?1:0,day_3:this.state.day_3?1:0,day_4:this.state.day_4?1:0,day_5:this.state.day_5?1:0,day_6:this.state.day_6?1:0,day_7:this.state.day_7?1:0,promo_type_order:this.state.type_order,promo_where:this.state.where_order,numberList:this.state.numberList,promo_city:this.state.city,promo_point:this.state.point,about_promo_text:this.state.promo_desc_true,condition_promo_text:this.state.promo_desc_false,textSMS:this.state.textSMS,promo_items:JSON.stringify(a),promo_cat:JSON.stringify(n),promo_items_add:JSON.stringify(this.state.itemsAdd),promo_items_sale:JSON.stringify(this.state.itemsAddPrice),promo_conditions_items:JSON.stringify(t),date_between:i},e.next=12,this.getData("save_edit_promo",s);case 12:r=e.sent,console.log(r),this.setState({modalDialog:!0,modalText:r.text}),setTimeout((function(){o.click=!1}),300);case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeData",value:function(e,t){var a=this;if(this.setState((0,h.Z)({},e,t.target.value)),"date_promo"==e&&(2==t.target.value||3==t.target.value)){var n=new Date,i=new Date;i.setDate(i.getDate()+14),this.setState({rangeDate:[Ae(n),Ae(i)],date_start:Ae(n),date_end:Ae(i),time_start:2==t.target.value?"10:00":"00:00",time_end:2==t.target.value?"21:40":"23:59"})}if("date_promo"==e&&(4==t.target.value||5==t.target.value)){var s=new Date,r=new Date;r.setDate(r.getDate()+30),this.setState({rangeDate:[Ae(s),Ae(r)],date_start:Ae(s),date_end:Ae(r),time_start:4==t.target.value?"10:00":"00:00",time_end:4==t.target.value?"21:40":"23:59"})}setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDataCheck",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,t.target.checked)),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDateRange",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,Ae(t))),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDataData",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,t)),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"generateTextDescTrue",value:function(){var e=this;if(this.state.auto_text){var t=this.state.promo_action,a="";if(1==parseInt(t)){var n=this.state.type_sale,i=this.state.promo_sale_list.find((function(t){return parseInt(t.id)==parseInt(e.state.promo_sale)})).name,s=this.state.sale_type;if(1==parseInt(n)){var r=this.state.saleItem,o="";r.map((function(e,t){o+=e.name+", "})),a="скидку на "+(o=o.substring(0,o.length-2))+" в размере "+i+(1==parseInt(s)?"руб.":"%")}2==parseInt(n)&&(r=this.state.saleCat,o="",r.map((function(e,t){o+=e.name+", "})),a="скидку на "+(o=o.substring(0,o.length-2))+" в размере "+i+(1==parseInt(s)?"руб.":"%")),3==parseInt(n)&&(a="скидку на всё меню, кроме напитков, соусов, приправ и палочек, в размере "+i+(1==parseInt(s)?"руб.":"%"))}if(2==parseInt(t)){var l="";this.state.itemsAdd.map((function(e,t){0==parseInt(e.price)?l+="бесплатную "+e.name+" "+e.count+"шт. за "+e.price+"руб., ":l+=e.name+" "+e.count+"шт. за "+e.price+"руб., "})),l=l.substring(0,item.length-2),a=1==this.state.itemsAdd.length?"позицию "+l:"позиции "+l}3==parseInt(t)&&(l="",this.state.promo_items_sale.map((function(e,t){l+=e.name+" по "+e.price+"руб., "})),l=l.substring(0,l.length-2),a=this.state.promo_items_sale.length-1==1?"позицию "+l:"позиции "+l);var c="Промокод --promo_name--, действует до "+Le(this.state.date_end)+". Заказывай на jacofood.ru!";this.setState({promo_desc_true:a,textSMS:c,cert_text:a})}}},{key:"generateTextDescFalse",value:function(){var e=this;if(this.state.auto_text){var t="";1==parseInt(this.state.where_order)&&0!=parseInt(this.state.city)&&(t=" в г. "+this.state.cities.find((function(t){return parseInt(t.id)==parseInt(e.state.city)})).name),2==parseInt(this.state.where_order)&&0!=parseInt(this.state.point)&&(t=" в г. "+this.state.points.find((function(t){return parseInt(t.id)==parseInt(e.state.point)})).name);var a="Промокод действует c "+je(this.state.date_start)+" до "+je(this.state.date_end)+" с "+this.state.time_start+" до "+this.state.time_end+t;this.setState({promo_desc_false:a})}}},{key:"addItemAdd",value:function(){var e=this,t=this.state.itemsAdd;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.addItem)}))){var a=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.addItem)}));t.push({item_id:this.state.addItem,name:a.name,count:this.state.addItemCount,price:this.state.addItemPrice});var n=0;t.map((function(e){n+=parseInt(e.price)})),this.setState({itemsAdd:t,addItemAllPrice:n})}}},{key:"priceItemAdd",value:function(){var e=this,t=this.state.itemsAddPrice;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.priceItem)}))){var a=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.priceItem)}));t.push({id:this.state.priceItem,name:a.name,price:this.state.addItemCount}),this.setState({itemsAddPrice:t})}}},{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(B.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,modalLink:""})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.createElement(K.Z,{id:"alert-dialog-title"},"Результат операции"),n.createElement(q.Z,{style:{paddingBottom:10,paddingTop:10}},n.createElement(b.Z,null,this.state.modalText),n.createElement("br",null),""==this.state.modalLink?null:n.createElement("a",{href:this.state.modalLink,style:{color:"red"}},"Скачать")),n.createElement(Y.Z,null,n.createElement(J.Z,{color:"primary",onClick:function(){e.setState({modalDialog:!1})}},"Хорошо"))),n.createElement(k.ZP,{container:!0},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,this.state.module_name)),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(b.Z,null,"Промокод: ",this.state.promo_name)),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.count_action,func:this.changeData.bind(this,"count_action"),label:"Количество активаций"}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.promo_conditions_list,value:this.state.promo_conditions,func:this.changeData.bind(this,"promo_conditions"),label:"Условие"})),1!==parseInt(this.state.promo_conditions)?null:n.createElement(n.Fragment,null,n.createElement(k.ZP,{item:!0,xs:12,sm:8},n.createElement(pe.e_,{data:this.state.items,value:this.state.conditionItems,func:function(t,a){e.changeDataData("conditionItems",a)},multiple:!0,label:"Товары"}))),2!==parseInt(this.state.promo_conditions)?null:n.createElement(n.Fragment,null,n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.price_start,func:this.changeData.bind(this,"price_start"),label:"Сумма от"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.price_end,func:this.changeData.bind(this,"price_end"),label:"Сумма до"})))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.date_promo_list,value:this.state.date_promo,func:this.changeData.bind(this,"date_promo"),label:"Когда работает промокод"}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.Qe,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.Qe,{label:"Дата до",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.w0,{label:"Время от",value:this.state.time_start,func:this.changeData.bind(this,"time_start")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.w0,{label:"Время до",value:this.state.time_end,func:this.changeData.bind(this,"time_end")}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(Te,{multiple:!1,label:"Кроме дат",value:this.state.testDate,func:this.changeDataData.bind(this,"testDate")}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{marginTop:20},spacing:3},n.createElement(pe.IA,{value:this.state.day_1,func:this.changeDataCheck.bind(this,"day_1"),label:"Понедельник"}),n.createElement(pe.IA,{value:this.state.day_2,func:this.changeDataCheck.bind(this,"day_2"),label:"Вторник"}),n.createElement(pe.IA,{value:this.state.day_3,func:this.changeDataCheck.bind(this,"day_3"),label:"Среда"}),n.createElement(pe.IA,{value:this.state.day_4,func:this.changeDataCheck.bind(this,"day_4"),label:"Четверг"}),n.createElement(pe.IA,{value:this.state.day_5,func:this.changeDataCheck.bind(this,"day_5"),label:"Пятница"}),n.createElement(pe.IA,{value:this.state.day_6,func:this.changeDataCheck.bind(this,"day_6"),label:"Суббота"}),n.createElement(pe.IA,{value:this.state.day_7,func:this.changeDataCheck.bind(this,"day_7"),label:"Воскресенье"})),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.type_order_list,value:this.state.type_order,func:this.changeData.bind(this,"type_order"),label:"Тип заказа"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.where_order_list,value:this.state.where_order,func:this.changeData.bind(this,"where_order"),label:"Где работает"})),1!==parseInt(this.state.where_order)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.cities,value:this.state.city,func:this.changeData.bind(this,"city"),label:"Город"})),2!==parseInt(this.state.where_order)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.points,value:this.state.point,func:this.changeData.bind(this,"point"),label:"Точка"}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.promo_desc_true,func:this.changeData.bind(this,"promo_desc_true"),label:"Описание промокода после активации (Промокод дает: )"})),n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.promo_desc_false,func:this.changeData.bind(this,"promo_desc_false"),label:"Условие промокода, когда условия не соблюдены"}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"end",style:{paddingTop:50},spacing:3},n.createElement(J.Z,{variant:"contained",onClick:this.save.bind(this)},"Сохранить"))))}}]),s}(n.Component),Re=function(e){(0,m.Z)(u,e);var t,a,i,s=Se(u);function u(e){var t;return(0,o.Z)(this,u),t=s.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Ce.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1})}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,modalText:"",modalDialog:!1,modalLink:"",city_list:[],city_id:0,promoName:"",findPromoList:[]},t}return(0,l.Z)(u,[{key:"componentDidMount",value:(i=(0,r.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,city_list:t.all_city_list}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"showPromoList",value:(a=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={city_id:this.state.city_id,promo_name:this.state.promoName},e.next=3,this.getData("search_promo",t);case 3:a=e.sent,console.log(a),this.setState({findPromoList:a});case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"delPromo",value:(t=(0,r.Z)(_().mark((function e(t){var a,n=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("Удалить промокод ?")){e.next=7;break}return a={promo_id:t},e.next=5,this.getData("remove_promo",a);case 5:e.sent,setTimeout((function(){n.showPromoList()}),300);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(B.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,modalLink:""})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.createElement(K.Z,{id:"alert-dialog-title"},"Результат операции"),n.createElement(q.Z,{style:{paddingBottom:10,paddingTop:10}},n.createElement(b.Z,null,this.state.modalText),n.createElement("br",null),""==this.state.modalLink?null:n.createElement("a",{href:this.state.modalLink,style:{color:"red"}},"Скачать")),n.createElement(Y.Z,null,n.createElement(J.Z,{color:"primary",onClick:function(){e.setState({modalDialog:!1})}},"Хорошо"))),n.createElement(k.ZP,{container:!0},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,this.state.module_name)),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12},n.createElement(R.OL,{to:"/site_sale_2/new",style:{zIndex:10}},n.createElement(J.Z,{variant:"contained"},"Новый промокод")),n.createElement(R.OL,{to:"/site_sale_2/stat",style:{zIndex:10,marginLeft:20}},n.createElement(J.Z,{variant:"contained"},"Статистика")),n.createElement(R.OL,{to:"/site_sale_2/stat_list",style:{zIndex:10,marginLeft:20}},n.createElement(J.Z,{variant:"contained"},"Выписанные промокоды"))),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.city_list,value:this.state.city_id,func:function(t){e.setState({city_id:t.target.value})},label:"Город"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.promoName,func:function(t){e.setState({promoName:t.target.value})},label:"Промокод"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(J.Z,{variant:"contained",onClick:this.showPromoList.bind(this)},"Найти"))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"Промокод"),n.createElement(ae.Z,null,"Город"),n.createElement(ae.Z,null,"Было кол-во"),n.createElement(ae.Z,null,"Ост. кол-во"),n.createElement(ae.Z,null,"Дата окончания"),n.createElement(ae.Z,null,"Описание"),n.createElement(ae.Z,null))),n.createElement(te.Z,null,this.state.findPromoList.map((function(t,a){return n.createElement(se.Z,{key:a},n.createElement(ae.Z,null,n.createElement(R.OL,{to:"/site_sale_2/edit/"+t.id,style:{zIndex:10}},t.name)),n.createElement(ae.Z,null,0==parseInt(t.city_id)?"Все города":t.city_name),n.createElement(ae.Z,null,t.def_count),n.createElement(ae.Z,null,t.count),n.createElement(ae.Z,null,t.date2),n.createElement(ae.Z,null,t.coment),n.createElement(ae.Z,null," ",n.createElement(re.Z,{style:{cursor:"pointer"},onClick:e.delPromo.bind(e,t.id)})," "))}))))))))}}]),u}(n.Component),Fe=function(e){(0,m.Z)(s,e);var t,a,i=Se(s);function s(e){var t;return(0,o.Z)(this,s),t=i.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Ce.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1})}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,spam_list:[],spam_id:0,findPromoList:[],spam_list_data:[],spam_list_data_stat:{true:0,all:0,percent:0}},t}return(0,l.Z)(s,[{key:"componentDidMount",value:(a=(0,r.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_spam_list");case 2:t=e.sent,console.log(t),this.setState({module_name:t.module_info.name,spam_list:t.spam_list}),document.title=t.module_info.name;case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"show",value:(t=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={spam_id:this.state.spam_id},e.next=3,this.getData("get_spam_data",t);case 3:a=e.sent,console.log(a),this.setState({spam_list_data:a.spam_list,spam_list_data_stat:a.stat});case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeSpam",value:function(e){var t=this;this.setState({spam_id:e.target.value}),setTimeout((function(){t.show()}),300)}},{key:"render",value:function(){return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(k.ZP,{container:!0},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,this.state.module_name)),n.createElement(k.ZP,{container:!0,direction:"row",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.spam_list,value:this.state.spam_id,func:this.changeSpam.bind(this),label:"Рассылка"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(J.Z,{variant:"contained",onClick:this.show.bind(this)},"Обновить"))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:6},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"Всего"),n.createElement(ae.Z,null,"Использовали"),n.createElement(ae.Z,null,"%"))),n.createElement(te.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,this.state.spam_list_data_stat.all),n.createElement(ae.Z,null,this.state.spam_list_data_stat.true),n.createElement(ae.Z,null,this.state.spam_list_data_stat.percent))))),n.createElement(k.ZP,{item:!0,xs:6},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"#"),n.createElement(ae.Z,null,"Номер"),n.createElement(ae.Z,null,"Ост активаций"))),n.createElement(te.Z,null,this.state.spam_list_data.map((function(e,t){return n.createElement(se.Z,{key:t},n.createElement(ae.Z,null,t+1),n.createElement(ae.Z,null,e.number),n.createElement(ae.Z,null,e.count))}))))))))}}]),s}(n.Component),Me=function(e){(0,m.Z)(u,e);var t,a,i,s=Se(u);function u(e){var t;return(0,o.Z)(this,u),t=s.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:Ce.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1})}),300)}))})),t.state={module:"site_sale_2",module_name:"",is_load:!1,date_start:Ae(new Date),date_end:Ae(new Date),rangeDate:[Ae(new Date),Ae(new Date)],promo_list:[]},t}return(0,l.Z)(u,[{key:"componentDidMount",value:(i=(0,r.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_spam_list");case 2:t=e.sent,console.log(t),this.setState({module_name:t.module_info.name,spam_list:t.spam_list}),document.title=t.module_info.name;case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"show",value:(a=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={spam_id:this.state.spam_id},e.next=3,this.getData("get_spam_data",t);case 3:a=e.sent,console.log(a),this.setState({spam_list_data:a.spam_list,spam_list_data_stat:a.stat});case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getUsers",value:(t=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={dateStart:this.state.date_start,dateEnd:this.state.date_end},e.next=3,this.getData("get_promo_users",t);case 3:a=e.sent,this.setState({promo_list:a.promo_list});case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeDateRange",value:function(e){var t=e[0]?Ae(e[0]):"",a=e[1]?Ae(e[1]):"";this.setState({rangeDate:[t,a],date_start:t,date_end:a})}},{key:"render",value:function(){return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(k.ZP,{container:!0},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,this.state.module_name)),n.createElement(k.ZP,{container:!0,direction:"row",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:6,className:"MyDaterange"},n.createElement(pe.lp,{startText:"Дата от",endText:"Дата до",value:this.state.rangeDate,func:this.changeDateRange.bind(this)})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(J.Z,{variant:"contained",onClick:this.getUsers.bind(this)},"Обновить"))),n.createElement(k.ZP,{item:!0,xs:12,sm:12,style:{marginTop:20}},this.state.promo_list.map((function(e,t){return n.createElement(C.Z,{key:t,style:{width:"100%"}},n.createElement(A.Z,{expandIcon:n.createElement(L.Z,null)},n.createElement(b.Z,null,e.name)),n.createElement(j.Z,null,n.createElement(ee.Z,{size:"small",style:{marginTop:15}},n.createElement(te.Z,null,e.promo_list.map((function(e,t){return n.createElement(se.Z,{key:t,style:{backgroundColor:1==parseInt(e.is_delete)?"#c03":"white",color:1==parseInt(e.is_delete)?"white":"black"}},n.createElement(ae.Z,{style:{color:"inherit"}},t+1),n.createElement(ae.Z,{style:{color:"inherit",backgroundColor:0==parseInt(e.count)?"green":"#c03"}},e.name),n.createElement(ae.Z,{style:{color:"inherit"}},e.coment),n.createElement(ae.Z,{style:{color:"inherit"}},0==parseInt(e.count)?n.createElement(Ie.Z,null):n.createElement(re.Z,null)))}))))))})))))}}]),u}(n.Component);function Ne(){return n.createElement(Oe,null)}function We(){var e=(0,F.UO)().promoId;return n.createElement(ze,{promoId:e})}function $e(){return n.createElement(Re,null)}function Je(){return n.createElement(Fe,null)}function Be(){return n.createElement(Me,null)}function Ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,d.Z)(e);if(t){var i=(0,d.Z)(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return(0,u.Z)(this,a)}}a(7639);var qe=a(7563);function Qe(e){var t=new Date(e),a=""+(t.getMonth()+1),n=""+t.getDate(),i=t.getFullYear();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),[i,a,n].join("-")}function Ke(e){var t=new Date(e),a=""+(t.getMonth()+1),n=""+t.getDate(),i=t.getFullYear();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),[n,a,i].join(".")}function Ue(e){var t=new Date(e),a=""+(t.getMonth()+1),n=""+t.getDate();t.getFullYear(),n.length<2&&(n="0"+n);var i="";switch(parseInt(a)){case 1:i="Января";break;case 2:i="Февраля";break;case 3:i="Марта";break;case 4:i="Апреля";break;case 5:i="Мая";break;case 6:i="Июня";break;case 7:i="Июля";break;case 8:i="Августа";break;case 9:i="Сентября";break;case 10:i="Октября";break;case 11:i="Ноября";break;case 12:i="Декабря"}return[n,i].join(" ")}var Ve=function(e){(0,m.Z)(s,e);var t,a,i=Ye(s);function s(e){var t;return(0,o.Z)(this,s),t=i.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:qe.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1}),t.click=!1}),300)}))})),t.state={module:"site_sale_min",module_name:"",is_load:!1,modalText:"",points:[],point:"",cities:[],city:0,modalDialog:!1,modalLink:"",where_promo_list:[{id:4,name:"Отправить в смс"}],promo_action_list:[],sale_list:[{id:3,name:"На все меню (кроме допов и закусок)"}],promo_conditions_list:[{id:1,name:"В корзине есть определенные товар(ы)"},{id:2,name:"В корзине набрана определенная сумма"}],promo_sale_list:[],type_sale_list:[{id:1,name:"В рублях"},{id:2,name:"В процентах"}],date_promo_list:[{id:4,name:"30 дней с 10:00 до 21:40"}],type_order_list:[{id:1,name:"Все"},{id:2,name:"Доставка"},{id:3,name:"Самовывоз"},{id:4,name:"Зал"}],where_order_list:[{id:1,name:"В городе"},{id:2,name:"На точке"}],promo_prizw_vk:"Привет!\r\nПоздравляем 🎉\r\nПромокод --promo-- на --position--, действует до --endDate--. Активировать можно при заказе на доставку, самовывоз и в кафе.\r\n\r\nОбратите внимание, что за подарочную позицию надо будет заплатить 1 руб, это необходимое условие для получения приза. В промокод не входят соевый соус, имбирь и васаби.\r\n\r\nЗаказы принимаем на сайте --site--\r\n\r\nРежим работы: с 10:00 до 21:30\r\nАдреса наших кафе:\r\n--addrCity--",spamNameSMS:"",auto_text:!0,where_promo:4,promo_name:"",generate_new:!0,count_action:1,promo_action:1,type_sale:3,promo_sale:0,sale_type:2,promo_conditions:2,price_start:0,price_end:0,date_promo:4,date_start:Qe(new Date),date_end:Qe(new Date),rangeDate:[Qe(new Date),Qe(new Date)],time_start:"10:00",time_end:"21:40",promo_length:5,promo_count:1,day_1:!0,day_2:!0,day_3:!0,day_4:!0,day_5:!0,day_6:!0,day_7:!0,type_order:1,where_order:2,numberList:"",promo_desc_true:"",promo_desc_false:"",textSMS:"",addItem:null,addItemCount:1,addItemPrice:1,addItemAllPrice:0,itemsAdd:[],itemsAddPrice:[],items:[],cats:[],saleCat:[],saleItem:[],priceItem:null,conditionItems:[],testDate:[],createdPromo:[],order_id:""},t}return(0,l.Z)(s,[{key:"componentDidMount",value:(a=(0,r.Z)(_().mark((function e(){var t,a,n,i=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all_for_new_min");case 2:t=e.sent,a=new Date,(n=new Date).setDate(n.getDate()+30),this.setState({points:t.points,cities:t.cities,module_name:t.module_info.name,promo_action_list:t.promo_action_list,promo_sale_list:t.promo_sale_list,rangeDate:[Qe(a),Qe(n)],date_start:Qe(a),date_end:Qe(n),items:t.items,cats:t.cats}),document.title=t.module_info.name,setTimeout((function(){i.generateTextDescFalse(),i.generateTextDescTrue()}),300);case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"save",value:(t=(0,r.Z)(_().mark((function e(){var t,a,n,i,s,r,o,l=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.click){e.next=30;break}return this.click=!0,this.setState({createdPromo:[]}),0,t=2==parseInt(this.state.sale_type)?this.state.promo_sale_list.find((function(e){return parseInt(e.id)==parseInt(l.state.promo_sale)})).name:parseInt(this.state.promo_sale),a=[],this.state.conditionItems.map((function(e){a.push(e.id)})),n=[],this.state.saleItem.map((function(e){n.push(e.id)})),i=[],this.state.saleCat.map((function(e){i.push(e.id)})),s=[],this.state.testDate.map((function(e){s.push(new Date(e).toISOString().split("T")[0])})),s=s.join(","),r={spamNameSMS:this.state.spamNameSMS,promo_vk_prize:this.state.promo_prizw_vk,cert_text:this.state.cert_text,addr:this.state.numberList,where_promo:this.state.where_promo,promo_count:this.state.promo_count,promo_len:this.state.promo_length,promo_name:this.state.promo_name,generate:this.state.generate_new?1:0,promo_in_count:this.state.count_action,promo_action:this.state.promo_action,promo_type_sale:this.state.type_sale,count_promo:t,promo_type:this.state.sale_type,promo_conditions:this.state.promo_conditions,promo_summ:this.state.price_start,promo_summ_to:this.state.price_end,promo_when:this.state.date_promo,date_start:this.state.date_start,date_end:this.state.date_end,time_start:this.state.time_start,time_end:this.state.time_end,day_1:this.state.day_1?1:0,day_2:this.state.day_2?1:0,day_3:this.state.day_3?1:0,day_4:this.state.day_4?1:0,day_5:this.state.day_5?1:0,day_6:this.state.day_6?1:0,day_7:this.state.day_7?1:0,promo_type_order:this.state.type_order,promo_where:this.state.where_order,numberList:this.state.numberList,promo_city:this.state.city,promo_point:this.state.point,about_promo_text:this.state.promo_desc_true,condition_promo_text:this.state.promo_desc_false,textSMS:this.state.textSMS,promo_items:JSON.stringify(n),promo_cat:JSON.stringify(i),promo_items_add:JSON.stringify(this.state.itemsAdd),promo_items_sale:JSON.stringify(this.state.itemsAddPrice),promo_conditions_items:JSON.stringify(a),date_between:s,order_id:this.state.order_id},e.next=17,this.getData("save_new_promo_min",r);case 17:if(o=e.sent,console.log(o),0!=o.st){e.next=23;break}return this.setState({modalDialog:!0,modalText:o.text_err}),setTimeout((function(){l.click=!1}),300),e.abrupt("return");case 23:this.setState({createdPromo:o.promo_text}),1!=parseInt(this.state.where_promo)&&8!=parseInt(this.state.where_promo)||this.setState({modalDialog:!0,modalText:"Создано"}),2==parseInt(this.state.where_promo)&&this.setState({modalDialog:!0,modalText:"Промокоды: "+o.promo_text.join(", ")}),3==parseInt(this.state.where_promo)&&this.setState({modalDialog:!0,modalText:o.text}),4!=parseInt(this.state.where_promo)&&5!=parseInt(this.state.where_promo)&&6!=parseInt(this.state.where_promo)||this.setState({modalDialog:!0,modalText:o.text}),7==parseInt(this.state.where_promo)&&this.setState({modalDialog:!0,modalText:o.text,modalLink:o.link}),setTimeout((function(){l.click=!1}),300);case 30:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeData",value:function(e,t){var a=this;if(this.setState((0,h.Z)({},e,t.target.value)),"date_promo"==e&&(2==t.target.value||3==t.target.value)){var n=new Date,i=new Date;i.setDate(i.getDate()+14),this.setState({rangeDate:[Qe(n),Qe(i)],date_start:Qe(n),date_end:Qe(i),time_start:2==t.target.value?"10:00":"00:00",time_end:2==t.target.value?"21:40":"23:59"})}if("date_promo"==e&&(4==t.target.value||5==t.target.value)){var s=new Date,r=new Date;r.setDate(r.getDate()+30),this.setState({rangeDate:[Qe(s),Qe(r)],date_start:Qe(s),date_end:Qe(r),time_start:4==t.target.value?"10:00":"00:00",time_end:4==t.target.value?"21:40":"23:59"})}setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDataCheck",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,t.target.checked)),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDateRange",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,Qe(t))),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDataData",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,t)),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"generateTextDescTrue",value:function(){var e=this;if(this.state.auto_text){var t=this.state.promo_action,a="";if(1==parseInt(t)){var n=this.state.type_sale,i=this.state.sale_type,s=0;if(s=2==parseInt(this.state.sale_type)?s=this.state.promo_sale_list.find((function(t){return parseInt(t.id)==parseInt(e.state.promo_sale)})).name:parseInt(this.state.promo_sale),1==parseInt(n)){var r=this.state.saleItem,o="";r.map((function(e,t){o+=e.name+", "})),a="скидку на "+(o=o.substring(0,o.length-2))+" в размере "+s+(1==parseInt(i)?"руб.":"%")}2==parseInt(n)&&(r=this.state.saleCat,o="",r.map((function(e,t){o+=e.name+", "})),a="скидку на "+(o=o.substring(0,o.length-2))+" в размере "+s+(1==parseInt(i)?"руб.":"%")),3==parseInt(n)&&(a="скидку на всё меню, кроме напитков, соусов, приправ и палочек, в размере "+s+(1==parseInt(i)?"руб.":"%"))}if(2==parseInt(t)){var l="";this.state.itemsAdd.map((function(e,t){0==parseInt(e.price)?l+="бесплатную "+e.name+" "+e.count+"шт. за "+e.price+"руб., ":l+=e.name+" "+e.count+"шт. за "+e.price+"руб., "})),l=l.substring(0,l.length-2),a=1==this.state.itemsAdd.length?"позицию "+l:"позиции "+l}3==parseInt(t)&&(l="",this.state.itemsAddPrice.map((function(e,t){l+=e.name+" по "+e.price+"руб., "})),l=l.substring(0,l.length-2),a=this.state.itemsAddPrice.length-1==1?"позицию "+l:"позиции "+l);var c="Промокод --promo_name--, действует до "+Ue(this.state.date_end)+". Заказывай на jacofood.ru!";this.setState({promo_desc_true:a,textSMS:c,cert_text:a})}}},{key:"generateTextDescFalse",value:function(){var e=this;if(this.state.auto_text){var t="",a="";if(console.log(this.state.testDate),this.state.testDate.length>0){var n=[];this.state.testDate.map((function(e){n.push(new Date(e).toISOString().split("T")[0])})),a="(кроме ",n.map((function(e){a+=Ue(e)+", "})),a=(a=a.slice(0,-1)).slice(0,-1),a+=")",console.log("text",a)}1==parseInt(this.state.where_order)&&0!=parseInt(this.state.city)&&""!=this.state.city&&(t=" в г. "+this.state.cities.find((function(t){return parseInt(t.id)==parseInt(e.state.city)})).name),2==parseInt(this.state.where_order)&&0!=parseInt(this.state.point)&&(t=" в г. "+this.state.points.find((function(t){return parseInt(t.id)==parseInt(e.state.point)})).name);var i="Промокод действует c "+Ke(this.state.date_start)+" до "+Ke(this.state.date_end)+" с "+this.state.time_start+" до "+this.state.time_end+" "+a+t;this.setState({promo_desc_false:i})}}},{key:"addItemAdd",value:function(){var e=this,t=this.state.itemsAdd;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.addItem.id)}))){var a=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.addItem.id)}));t.push({item_id:this.state.addItem.id,name:a.name,count:this.state.addItemCount,price:this.state.addItemPrice});var n=0;t.map((function(e){n+=parseInt(e.price)})),this.setState({itemsAdd:t,addItemAllPrice:n})}setTimeout((function(){e.generateTextDescFalse(),e.generateTextDescTrue()}),300)}},{key:"delItemAdd",value:function(e){var t=this,a=this.state.itemsAdd.filter((function(t){return parseInt(t.item_id)!=parseInt(e.item_id)})),n=0;a.map((function(e){n+=parseInt(e.price)})),this.setState({itemsAdd:a,addItemAllPrice:n}),setTimeout((function(){t.generateTextDescFalse(),t.generateTextDescTrue()}),300)}},{key:"priceItemAdd",value:function(){var e=this,t=this.state.itemsAddPrice;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.priceItem.id)}))){var a=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.priceItem.id)}));t.push({id:this.state.priceItem.id,name:a.name,price:this.state.addItemCount}),this.setState({itemsAddPrice:t})}setTimeout((function(){e.generateTextDescFalse(),e.generateTextDescTrue()}),300)}},{key:"delItemPrice",value:function(e){var t=this,a=this.state.itemsAddPrice.filter((function(t){return parseInt(t.item_id)!=parseInt(e.item_id)}));a.map((function(e){parseInt(e.price)})),this.setState({itemsAddPrice:a}),setTimeout((function(){t.generateTextDescFalse(),t.generateTextDescTrue()}),300)}},{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(B.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,modalLink:""})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.createElement(K.Z,{id:"alert-dialog-title"},"Результат операции"),n.createElement(q.Z,{style:{paddingBottom:10,paddingTop:10}},n.createElement(b.Z,null,this.state.modalText)),n.createElement(Y.Z,null,n.createElement(J.Z,{color:"primary",onClick:function(){e.setState({modalDialog:!1})}},"Хорошо"))),n.createElement(k.ZP,{container:!0},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,"Новый промокод контакт-центр")),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{disabled:!0,value:this.state.promo_length,func:this.changeData.bind(this,"promo_length"),label:"Длина промокода"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.IA,{disabled:!0,value:this.state.generate_new,func:this.changeDataCheck.bind(this,"generate_new"),label:"Сгенерировать"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{disabled:!0,value:this.state.count_action,func:this.changeData.bind(this,"count_action"),label:"Количество активаций"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{disabled:!0,value:this.state.promo_count,func:this.changeData.bind(this,"promo_count"),label:"Количество промокодов"}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.promo_action_list,value:this.state.promo_action,func:this.changeData.bind(this,"promo_action"),label:"Промокод дает:"}))),1!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.sale_list,value:this.state.type_sale,func:this.changeData.bind(this,"type_sale"),label:"Скидка"})),1!==parseInt(this.state.type_sale)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:9},n.createElement(pe.e_,{data:this.state.items,value:this.state.saleItem,func:function(t,a){e.changeDataData("saleItem",a)},multiple:!0,label:"Товары"})),2!==parseInt(this.state.type_sale)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:9},n.createElement(pe.e_,{data:this.state.cats,value:this.state.saleCat,func:function(t,a){e.changeDataData("saleCat",a)},multiple:!0,label:"Категории"})),1==parseInt(this.state.sale_type)?n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.promo_sale,func:this.changeData.bind(this,"promo_sale"),label:"Размер скидки"})):n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.promo_sale_list,value:this.state.promo_sale,func:this.changeData.bind(this,"promo_sale"),label:"Размер скидки"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.type_sale_list,value:this.state.sale_type,func:this.changeData.bind(this,"sale_type"),label:"Какая скидка"}))),2!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.e_,{data:this.state.items,value:this.state.addItem,func:function(t,a){e.changeDataData("addItem",a)},label:"Позиция"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.addItemCount,func:this.changeData.bind(this,"addItemCount"),label:"Количество"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.addItemPrice,func:this.changeData.bind(this,"addItemPrice"),label:"Цена за все"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(J.Z,{variant:"contained",onClick:this.addItemAdd.bind(this)},"Добавить"))),2!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"Позиция"),n.createElement(ae.Z,null,"Количество"),n.createElement(ae.Z,null,"Цена за все"),n.createElement(ae.Z,null))),n.createElement(te.Z,null,this.state.itemsAdd.map((function(t,a){return n.createElement(se.Z,{key:a},n.createElement(ae.Z,null,t.name),n.createElement(ae.Z,null,t.count),n.createElement(ae.Z,null,t.price),n.createElement(ae.Z,null," ",n.createElement(re.Z,{onClick:e.delItemAdd.bind(e,t),style:{cursor:"pointer"}})," "))}))),n.createElement(De.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null),n.createElement(ae.Z,null),n.createElement(ae.Z,null,this.state.addItemAllPrice),n.createElement(ae.Z,null)))))),3!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.e_,{data:this.state.items,value:this.state.priceItem,func:function(t,a){e.changeDataData("priceItem",a)},label:"Позиция"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.addItemCount,func:this.changeData.bind(this,"addItemCount"),label:"Цена за 1 ед"})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(J.Z,{variant:"contained",onClick:this.priceItemAdd.bind(this)},"Добавить"))),3!==parseInt(this.state.promo_action)?null:n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"Позиция"),n.createElement(ae.Z,null,"Цена за 1 ед"),n.createElement(ae.Z,null))),n.createElement(te.Z,null,this.state.itemsAddPrice.map((function(t,a){return n.createElement(se.Z,{key:a},n.createElement(ae.Z,null,t.name),n.createElement(ae.Z,null,t.price),n.createElement(ae.Z,null," ",n.createElement(re.Z,{onClick:e.delItemPrice.bind(e,t),style:{cursor:"pointer"}})," "))})))))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.promo_conditions_list,value:this.state.promo_conditions,func:this.changeData.bind(this,"promo_conditions"),label:"Условие"})),1!==parseInt(this.state.promo_conditions)?null:n.createElement(n.Fragment,null,n.createElement(k.ZP,{item:!0,xs:12,sm:8},n.createElement(pe.e_,{data:this.state.items,value:this.state.conditionItems,func:function(t,a){e.changeDataData("conditionItems",a)},multiple:!0,label:"Товары"}))),2!==parseInt(this.state.promo_conditions)?null:n.createElement(n.Fragment,null,n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.price_start,func:this.changeData.bind(this,"price_start"),label:"Сумма от"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.price_end,func:this.changeData.bind(this,"price_end"),label:"Сумма до"})))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.$S,{data:this.state.date_promo_list,value:this.state.date_promo,func:this.changeData.bind(this,"date_promo"),label:"Когда работает промокод"}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.Qe,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.Qe,{label:"Дата до",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.w0,{label:"Время от",value:this.state.time_start,func:this.changeData.bind(this,"time_start")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.w0,{label:"Время до",value:this.state.time_end,func:this.changeData.bind(this,"time_end")}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.points,value:this.state.point,func:this.changeData.bind(this,"point"),label:"Точка"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.order_id,func:this.changeData.bind(this,"order_id"),label:"Номер заказа"}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.where_promo_list,value:this.state.where_promo,func:this.changeData.bind(this,"where_promo"),label:"Что сделать с промокодом"})),1==parseInt(this.state.where_promo)||2==parseInt(this.state.where_promo)?null:5==parseInt(this.state.where_promo)?n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement("span",null,"Список номеров для рассылки"),n.createElement(ke.Z,{"aria-label":"empty textarea",placeholder:"",minRows:3,value:this.state.numberList,onChange:this.changeData.bind(this,"numberList"),label:"Куда отправить",style:{width:"100%"}})):n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.numberList,func:this.changeData.bind(this,"numberList"),label:"Куда отправить"}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},8!==parseInt(this.state.where_promo)?null:n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("span",null,"Текст расссылки"),n.createElement(ke.Z,{"aria-label":"empty textarea",placeholder:"",minRows:3,value:this.state.promo_prizw_vk,onChange:this.changeData.bind(this,"promo_prizw_vk"),style:{width:"100%"}})),5==parseInt(this.state.where_promo)?n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.spamNameSMS,func:this.changeData.bind(this,"spamNameSMS"),label:"Наименование рассылки"})):null,4==parseInt(this.state.where_promo)||5==parseInt(this.state.where_promo)?n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.textSMS,func:this.changeData.bind(this,"textSMS"),label:"Текст СМС ( --promo_name-- )"})):null,7==parseInt(this.state.where_promo)?n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.cert_text,func:this.changeData.bind(this,"cert_text"),label:"Текст для описания сертификата"})):null,n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.IA,{value:this.state.auto_text,func:this.changeDataCheck.bind(this,"auto_text"),label:"Авто-текст"})),n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.promo_desc_true,func:this.changeData.bind(this,"promo_desc_true"),label:"Описание промокода после активации (Промокод дает: )"})),n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement(pe.rZ,{value:this.state.promo_desc_false,func:this.changeData.bind(this,"promo_desc_false"),label:"Условие промокода, когда условия не соблюдены"}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"end",style:{paddingTop:50},spacing:3},n.createElement(J.Z,{variant:"contained",onClick:this.save.bind(this)},"Сохранить"))))}}]),s}(n.Component),Ge=function(e){(0,m.Z)(s,e);var t,a,i=Ye(s);function s(e){var t;return(0,o.Z)(this,s),t=i.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:qe.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1}),t.click=!1}),300)}))})),t.state={module:"site_sale_min",module_name:"",is_load:!1,modalText:"",points:[],point:0,cities:[],city:0,modalDialog:!1,modalLink:"",where_promo_list:[{id:1,name:"Создать"},{id:2,name:"Создать и показать"},{id:3,name:"Отправить на почту"},{id:4,name:"Отправить в смс"},{id:5,name:"Рассылка смс"},{id:6,name:"Отправить в ЛК (через 8)"},{id:7,name:"Создать сертификат(ы)"}],promo_action_list:[],sale_list:[{id:1,name:"На товары"},{id:2,name:"На категории"},{id:3,name:"На все меню (кроме допов и закусок)"}],promo_conditions_list:[{id:1,name:"В корзине есть определенные товар(ы)"},{id:2,name:"В корзине набрана определенная сумма"}],promo_sale_list:[],type_sale_list:[{id:1,name:"В рублях"},{id:2,name:"В процентах"}],date_promo_list:[{id:1,name:"В определенные даты"},{id:2,name:"14 дней с 10:00 до 21:40"},{id:3,name:"14 дней с 00:00 до 23:59"},{id:4,name:"30 дней с 10:00 до 21:40"},{id:5,name:"30 дней с 00:00 до 23:59"}],type_order_list:[{id:1,name:"Все"},{id:2,name:"Доставка"},{id:3,name:"Самовывоз"},{id:4,name:"Зал"}],where_order_list:[{id:1,name:"В городе"},{id:2,name:"На точке"}],auto_text:!1,where_promo:1,promo_name:"",generate_new:!1,count_action:1,promo_action:1,type_sale:3,promo_sale:1,sale_type:2,promo_conditions:2,price_start:0,price_end:0,date_promo:1,date_start:Qe(new Date),date_end:Qe(new Date),rangeDate:[Qe(new Date),Qe(new Date)],time_start:"10:00",time_end:"21:30",promo_length:5,promo_count:1,day_1:!0,day_2:!0,day_3:!0,day_4:!0,day_5:!0,day_6:!0,day_7:!0,type_order:1,where_order:1,numberList:"",promo_desc_true:"",promo_desc_false:"",textSMS:"",addItem:1,addItemCount:1,addItemPrice:1,addItemAllPrice:0,itemsAdd:[],itemsAddPrice:[],items:[],cats:[],saleCat:[],saleItem:[],priceItem:1,conditionItems:[],testDate:[]},t}return(0,l.Z)(s,[{key:"componentDidMount",value:(a=(0,r.Z)(_().mark((function e(){var t,a,n,i=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={promo_id:this.props.promoId},e.next=3,this.getData("get_all_for_edit",t);case 3:a=e.sent,n=[],a.promo.promo_conditions_items.length>4&&(a.promo.promo_conditions_items=JSON.parse(a.promo.promo_conditions_items,!0),a.promo.promo_conditions_items.map((function(e){var t=a.items.find((function(t){return parseInt(t.id)==parseInt(e)}));n.push(t)}))),setTimeout((function(){console.log("conditionItems",n),console.log("items",a.items);var e=[];a.limit.map((function(t){e.push(new Date(t.date))})),i.setState({points:a.points,cities:a.cities,module_name:a.module_info.name,promo_action_list:a.promo_action_list,promo_sale_list:a.promo_sale_list,date_start:a.promo.date1,date_end:a.promo.date2,time_start:a.promo.time1,time_end:a.promo.time2,rangeDate:[a.promo.date1,a.promo.date2],items:a.items,cats:a.cats,day_1:1==parseInt(a.promo.d1),day_2:1==parseInt(a.promo.d2),day_3:1==parseInt(a.promo.d3),day_4:1==parseInt(a.promo.d4),day_5:1==parseInt(a.promo.d5),day_6:1==parseInt(a.promo.d6),day_7:1==parseInt(a.promo.d7),count_action:a.promo.count,promo_name:a.promo.name,price_start:a.promo.promo_summ,price_end:a.promo.promo_summ_to,conditionItems:n,promo_conditions:n.length>0?1:2,point:a.promo.point_id,city:a.promo.city_id,where_order:parseInt(a.promo.city_id)>0?1:parseInt(a.promo.point_id)>0?2:1,type_order:a.promo.type_order,promo_desc_true:a.promo.coment,promo_desc_false:a.promo.condition_text,promo_id:a.promo.id,testDate:e})}),300),document.title=a.module_info.name,setTimeout((function(){i.generateTextDescFalse(),i.generateTextDescTrue()}),300);case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"save",value:(t=(0,r.Z)(_().mark((function e(){var t,a,n,i,s,r,o=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.click){e.next=16;break}return this.click=!0,t=[],this.state.conditionItems.map((function(e){t.push(e.id)})),a=[],n=[],i=[],this.state.testDate.map((function(e){i.push(new Date(e).toISOString().split("T")[0])})),i=i.join(","),s={promo_id:this.state.promo_id,cert_text:this.state.cert_text,addr:this.state.numberList,where_promo:this.state.where_promo,promo_count:this.state.promo_count,promo_len:this.state.promo_length,promo_name:this.state.promo_name,generate:this.state.generate_new?1:0,promo_in_count:this.state.count_action,promo_action:this.state.promo_action,promo_type_sale:this.state.type_sale,promo_type:this.state.sale_type,promo_conditions:this.state.promo_conditions,promo_summ:this.state.price_start,promo_summ_to:this.state.price_end,promo_when:this.state.date_promo,date_start:this.state.date_start,date_end:this.state.date_end,time_start:this.state.time_start,time_end:this.state.time_end,day_1:this.state.day_1?1:0,day_2:this.state.day_2?1:0,day_3:this.state.day_3?1:0,day_4:this.state.day_4?1:0,day_5:this.state.day_5?1:0,day_6:this.state.day_6?1:0,day_7:this.state.day_7?1:0,promo_type_order:this.state.type_order,promo_where:this.state.where_order,numberList:this.state.numberList,promo_city:this.state.city,promo_point:this.state.point,about_promo_text:this.state.promo_desc_true,condition_promo_text:this.state.promo_desc_false,textSMS:this.state.textSMS,promo_items:JSON.stringify(a),promo_cat:JSON.stringify(n),promo_items_add:JSON.stringify(this.state.itemsAdd),promo_items_sale:JSON.stringify(this.state.itemsAddPrice),promo_conditions_items:JSON.stringify(t),date_between:i},e.next=12,this.getData("save_edit_promo",s);case 12:r=e.sent,console.log(r),this.setState({modalDialog:!0,modalText:r.text}),setTimeout((function(){o.click=!1}),300);case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeData",value:function(e,t){var a=this;if(this.setState((0,h.Z)({},e,t.target.value)),"date_promo"==e&&(2==t.target.value||3==t.target.value)){var n=new Date,i=new Date;i.setDate(i.getDate()+14),this.setState({rangeDate:[Qe(n),Qe(i)],date_start:Qe(n),date_end:Qe(i),time_start:2==t.target.value?"10:00":"00:00",time_end:2==t.target.value?"21:40":"23:59"})}if("date_promo"==e&&(4==t.target.value||5==t.target.value)){var s=new Date,r=new Date;r.setDate(r.getDate()+30),this.setState({rangeDate:[Qe(s),Qe(r)],date_start:Qe(s),date_end:Qe(r),time_start:4==t.target.value?"10:00":"00:00",time_end:4==t.target.value?"21:40":"23:59"})}setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDataCheck",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,t.target.checked)),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDateRange",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,Qe(t))),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"changeDataData",value:function(e,t){var a=this;this.setState((0,h.Z)({},e,t)),setTimeout((function(){a.generateTextDescFalse(),a.generateTextDescTrue()}),300)}},{key:"generateTextDescTrue",value:function(){var e=this;if(this.state.auto_text){var t=this.state.promo_action,a="";if(1==parseInt(t)){var n=this.state.type_sale,i=this.state.promo_sale_list.find((function(t){return parseInt(t.id)==parseInt(e.state.promo_sale)})).name,s=this.state.sale_type;if(1==parseInt(n)){var r=this.state.saleItem,o="";r.map((function(e,t){o+=e.name+", "})),a="скидку на "+(o=o.substring(0,o.length-2))+" в размере "+i+(1==parseInt(s)?"руб.":"%")}2==parseInt(n)&&(r=this.state.saleCat,o="",r.map((function(e,t){o+=e.name+", "})),a="скидку на "+(o=o.substring(0,o.length-2))+" в размере "+i+(1==parseInt(s)?"руб.":"%")),3==parseInt(n)&&(a="скидку на всё меню, кроме напитков, соусов, приправ и палочек, в размере "+i+(1==parseInt(s)?"руб.":"%"))}if(2==parseInt(t)){var l="";this.state.itemsAdd.map((function(e,t){0==parseInt(e.price)?l+="бесплатную "+e.name+" "+e.count+"шт. за "+e.price+"руб., ":l+=e.name+" "+e.count+"шт. за "+e.price+"руб., "})),l=l.substring(0,item.length-2),a=1==this.state.itemsAdd.length?"позицию "+l:"позиции "+l}3==parseInt(t)&&(l="",this.state.promo_items_sale.map((function(e,t){l+=e.name+" по "+e.price+"руб., "})),l=l.substring(0,l.length-2),a=this.state.promo_items_sale.length-1==1?"позицию "+l:"позиции "+l);var c="Промокод --promo_name--, действует до "+Ue(this.state.date_end)+". Заказывай на jacofood.ru!";this.setState({promo_desc_true:a,textSMS:c,cert_text:a})}}},{key:"generateTextDescFalse",value:function(){var e=this;if(this.state.auto_text){var t="";1==parseInt(this.state.where_order)&&0!=parseInt(this.state.city)&&(t=" в г. "+this.state.cities.find((function(t){return parseInt(t.id)==parseInt(e.state.city)})).name),2==parseInt(this.state.where_order)&&0!=parseInt(this.state.point)&&(t=" в г. "+this.state.points.find((function(t){return parseInt(t.id)==parseInt(e.state.point)})).name);var a="Промокод действует c "+Ke(this.state.date_start)+" до "+Ke(this.state.date_end)+" с "+this.state.time_start+" до "+this.state.time_end+t;this.setState({promo_desc_false:a})}}},{key:"addItemAdd",value:function(){var e=this,t=this.state.itemsAdd;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.addItem)}))){var a=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.addItem)}));t.push({item_id:this.state.addItem,name:a.name,count:this.state.addItemCount,price:this.state.addItemPrice});var n=0;t.map((function(e){n+=parseInt(e.price)})),this.setState({itemsAdd:t,addItemAllPrice:n})}}},{key:"priceItemAdd",value:function(){var e=this,t=this.state.itemsAddPrice;if(!t.find((function(t){return parseInt(t.item_id)==parseInt(e.state.priceItem)}))){var a=this.state.items.find((function(t){return parseInt(t.id)==parseInt(e.state.priceItem)}));t.push({id:this.state.priceItem,name:a.name,price:this.state.addItemCount}),this.setState({itemsAddPrice:t})}}},{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(B.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,modalLink:""})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.createElement(K.Z,{id:"alert-dialog-title"},"Результат операции"),n.createElement(q.Z,{style:{paddingBottom:10,paddingTop:10}},n.createElement(b.Z,null,this.state.modalText),n.createElement("br",null),""==this.state.modalLink?null:n.createElement("a",{href:this.state.modalLink,style:{color:"red"}},"Скачать")),n.createElement(Y.Z,null,n.createElement(J.Z,{color:"primary",onClick:function(){e.setState({modalDialog:!1})}},"Хорошо"))),n.createElement(k.ZP,{container:!0},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,"Редактирование промокода")),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(b.Z,null,"Промокод: ",this.state.promo_name)),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.rZ,{value:this.state.count_action,func:this.changeData.bind(this,"count_action"),label:"Количество активаций"}))),n.createElement(x.Z,{style:{width:"100%",marginTop:20}}),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(pe.Qe,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(pe.Qe,{label:"Дата до",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(pe.w0,{label:"Время от",value:this.state.time_start,func:this.changeData.bind(this,"time_start")})),n.createElement(k.ZP,{item:!0,xs:12,sm:6},n.createElement(pe.w0,{label:"Время до",value:this.state.time_end,func:this.changeData.bind(this,"time_end")}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.cities,value:this.state.city,func:this.changeData.bind(this,"city"),label:"Город"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.points,value:this.state.point,func:this.changeData.bind(this,"point"),label:"Точка"}))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"end",style:{paddingTop:50},spacing:3},n.createElement(J.Z,{variant:"contained",onClick:this.save.bind(this)},"Сохранить"))))}}]),s}(n.Component),He=function(e){(0,m.Z)(u,e);var t,a,i,s=Ye(u);function u(e){var t;return(0,o.Z)(this,u),t=s.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:qe.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1})}),300)}))})),t.state={module:"site_sale_min",module_name:"",is_load:!1,modalText:"",modalDialog:!1,modalLink:"",city_list:[],city_id:"",promoName:"",findPromoList:[]},t}return(0,l.Z)(u,[{key:"componentDidMount",value:(i=(0,r.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,city_list:t.all_city_list}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"showPromoList",value:(a=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={city_id:this.state.city_id,promo_name:this.state.promoName},e.next=3,this.getData("search_promo",t);case 3:a=e.sent,console.log(a),this.setState({findPromoList:a});case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"delPromo",value:(t=(0,r.Z)(_().mark((function e(t){var a,n=this;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("Удалить промокод ?")){e.next=7;break}return a={promo_id:t},e.next=5,this.getData("remove_promo",a);case 5:e.sent,setTimeout((function(){n.showPromoList()}),300);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(B.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,modalLink:""})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},n.createElement(K.Z,{id:"alert-dialog-title"},"Результат операции"),n.createElement(q.Z,{style:{paddingBottom:10,paddingTop:10}},n.createElement(b.Z,null,this.state.modalText),n.createElement("br",null),""==this.state.modalLink?null:n.createElement("a",{href:this.state.modalLink,style:{color:"red"}},"Скачать")),n.createElement(Y.Z,null,n.createElement(J.Z,{color:"primary",onClick:function(){e.setState({modalDialog:!1})}},"Хорошо"))),n.createElement(k.ZP,{container:!0},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,"Промокоды контакт-центр")),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12},n.createElement(R.OL,{to:"/site_sale_min/new",style:{zIndex:10}},n.createElement(J.Z,{variant:"contained"},"Новый промокод")),n.createElement(R.OL,{to:"/site_sale_min/stat_list",style:{zIndex:10,marginLeft:20}},n.createElement(J.Z,{variant:"contained"},"Выписанные промокоды"))),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.$S,{data:this.state.city_list,value:this.state.city_id,func:function(t){e.setState({city_id:t.target.value})},label:"Город"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(pe.rZ,{value:this.state.promoName,func:function(t){e.setState({promoName:t.target.value})},label:"Промокод"})),n.createElement(k.ZP,{item:!0,xs:12,sm:4},n.createElement(J.Z,{variant:"contained",onClick:this.showPromoList.bind(this)},"Найти"))),n.createElement(k.ZP,{container:!0,direction:"row",justifyContent:"center",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12},n.createElement(ee.Z,null,n.createElement(ie.Z,null,n.createElement(se.Z,null,n.createElement(ae.Z,null,"Промокод"),n.createElement(ae.Z,null,"Город"),n.createElement(ae.Z,null,"Было кол-во"),n.createElement(ae.Z,null,"Ост. кол-во"),n.createElement(ae.Z,null,"Дата окончания"),n.createElement(ae.Z,null,"Описание"),n.createElement(ae.Z,null))),n.createElement(te.Z,null,this.state.findPromoList.map((function(t,a){return n.createElement(se.Z,{key:a},n.createElement(ae.Z,null,n.createElement(R.OL,{to:"/site_sale_min/edit/"+t.id,style:{zIndex:10}},t.name)),n.createElement(ae.Z,null,0==parseInt(t.city_id)?"Все города":t.city_name),n.createElement(ae.Z,null,t.def_count),n.createElement(ae.Z,null,t.count),n.createElement(ae.Z,null,t.date2),n.createElement(ae.Z,null,t.coment),n.createElement(ae.Z,null," ",n.createElement(re.Z,{style:{cursor:"pointer"},onClick:e.delPromo.bind(e,t.id)})," "))}))))))))}}]),u}(n.Component),Xe=function(e){(0,m.Z)(u,e);var t,a,i,s=Ye(u);function u(e){var t;return(0,o.Z)(this,u),t=s.call(this,e),(0,h.Z)((0,c.Z)(t),"click",!1),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:qe.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),setTimeout((function(){t.setState({is_load:!1})}),300)}))})),t.state={module:"site_sale_min",module_name:"",is_load:!1,date_start:Qe(new Date),date_end:Qe(new Date),rangeDate:[Qe(new Date),Qe(new Date)],promo_list:[]},t}return(0,l.Z)(u,[{key:"componentDidMount",value:(i=(0,r.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_spam_list");case 2:t=e.sent,console.log(t),this.setState({module_name:t.module_info.name,spam_list:t.spam_list}),document.title=t.module_info.name;case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"show",value:(a=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={spam_id:this.state.spam_id},e.next=3,this.getData("get_spam_data",t);case 3:a=e.sent,console.log(a),this.setState({spam_list_data:a.spam_list,spam_list_data_stat:a.stat});case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getUsers",value:(t=(0,r.Z)(_().mark((function e(){var t,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={dateStart:this.state.date_start,dateEnd:this.state.date_end},e.next=3,this.getData("get_promo_users_min",t);case 3:a=e.sent,console.log(a),this.setState({promo_list:a.promo_list});case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeDateRange",value:function(e,t){this.setState((0,h.Z)({},e,Qe(t)))}},{key:"render",value:function(){return n.createElement(n.Fragment,null,n.createElement(oe.Z,{style:{zIndex:99},open:this.state.is_load},n.createElement(le.Z,{color:"inherit"})),n.createElement(k.ZP,{container:!0},n.createElement(k.ZP,{item:!0,xs:12,sm:12},n.createElement("h1",null,"Выписанные промокоды контакт-центр")),n.createElement(k.ZP,{container:!0,direction:"row",style:{paddingTop:20},spacing:3},n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.Qe,{label:"Дата от",value:this.state.date_start,func:this.changeDateRange.bind(this,"date_start")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(pe.Qe,{label:"Дата до",value:this.state.date_end,func:this.changeDateRange.bind(this,"date_end")})),n.createElement(k.ZP,{item:!0,xs:12,sm:3},n.createElement(J.Z,{variant:"contained",onClick:this.getUsers.bind(this)},"Обновить"))),n.createElement(k.ZP,{item:!0,xs:12,sm:12,style:{marginTop:20}},this.state.promo_list.map((function(e,t){return n.createElement(C.Z,{key:t,style:{width:"100%"}},n.createElement(A.Z,{expandIcon:n.createElement(L.Z,null)},n.createElement(b.Z,null,e.name)),n.createElement(j.Z,null,n.createElement(ee.Z,{size:"small",style:{marginTop:15}},n.createElement(te.Z,null,e.promo_list.map((function(e,t){return n.createElement(se.Z,{key:t,style:{backgroundColor:1==parseInt(e.is_delete)?"#c03":"white",color:1==parseInt(e.is_delete)?"white":"black"}},n.createElement(ae.Z,{style:{color:"inherit"}},t+1),n.createElement(ae.Z,{style:{color:"inherit",backgroundColor:0==parseInt(e.count)?"green":"#c03"}},e.name),n.createElement(ae.Z,{style:{color:"inherit"}},e.coment),n.createElement(ae.Z,{style:{color:"inherit"}},0==parseInt(e.count)?n.createElement(Ie.Z,null):n.createElement(re.Z,null)))}))))))})))))}}]),u}(n.Component);function et(){return n.createElement(Ve,null)}function tt(){var e=(0,F.UO)().promoId;return n.createElement(Ge,{promoId:e})}function at(){return n.createElement(He,null)}function nt(){return n.createElement(Xe,null)}var it=a(7563),st=n.lazy((function(){return a.e(227).then(a.bind(a,7227))})),rt=n.lazy((function(){return Promise.all([a.e(216),a.e(433)]).then(a.bind(a,8433))})),ot=n.lazy((function(){return Promise.all([a.e(216),a.e(546)]).then(a.bind(a,9546))})),lt=n.lazy((function(){return a.e(347).then(a.bind(a,9347))})),ct=n.lazy((function(){return a.e(650).then(a.bind(a,5650))})),mt=n.lazy((function(){return a.e(307).then(a.bind(a,7307))})),ut=n.lazy((function(){return a.e(670).then(a.bind(a,3670))})),dt=n.lazy((function(){return Promise.all([a.e(216),a.e(432)]).then(a.bind(a,432))})),ht=n.lazy((function(){return a.e(669).then(a.bind(a,8669))})),pt=n.lazy((function(){return a.e(66).then(a.bind(a,3066))})),_t=n.lazy((function(){return Promise.all([a.e(216),a.e(223)]).then(a.bind(a,3223))})),ft=n.lazy((function(){return a.e(672).then(a.bind(a,672))})),gt=n.lazy((function(){return a.e(156).then(a.bind(a,2156))})),Et=n.lazy((function(){return Promise.all([a.e(216),a.e(159)]).then(a.bind(a,8159))})),yt=n.lazy((function(){return Promise.all([a.e(216),a.e(964)]).then(a.bind(a,964))})),Zt=n.lazy((function(){return a.e(710).then(a.bind(a,710))})),vt=n.lazy((function(){return Promise.all([a.e(216),a.e(500)]).then(a.bind(a,1500))})),bt=n.lazy((function(){return Promise.all([a.e(216),a.e(630)]).then(a.bind(a,630))})),xt=n.lazy((function(){return a.e(847).then(a.bind(a,7847))})),wt=n.lazy((function(){return Promise.all([a.e(216),a.e(714)]).then(a.bind(a,1714))})),Dt=n.lazy((function(){return a.e(690).then(a.bind(a,9690))})),It=n.lazy((function(){return a.e(421).then(a.bind(a,5421))})),kt=n.lazy((function(){return Promise.all([a.e(216),a.e(31)]).then(a.bind(a,31))})),Pt=n.lazy((function(){return Promise.all([a.e(216),a.e(520)]).then(a.bind(a,7520))})),St=n.lazy((function(){return a.e(104).then(a.bind(a,6104))})),Tt=n.lazy((function(){return Promise.all([a.e(216),a.e(252)]).then(a.bind(a,8252))})),Ct=n.lazy((function(){return a.e(542).then(a.bind(a,5959))})),At=(0,O.Z)({palette:{primary:{main:"#c03"},def:{main:"#353b48",secondary:"#fff"}}}),jt=function(e){(0,m.Z)(f,e);var t,a,i,p=(a=f,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,d.Z)(a);if(i){var n=(0,d.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,u.Z)(this,e)});function f(e){var t;return(0,o.Z)(this,f),t=p.call(this,e),(0,h.Z)((0,c.Z)(t),"getData",(function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:it.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(e){return e.json()})).then((function(e){if(console.log(e),!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"header",open:!1,menu:[],full_menu:[],left:!1},t}return(0,l.Z)(f,[{key:"componentDidMount",value:(t=(0,r.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({menu:t.info.left_menu,full_menu:t.info.full_menu});case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"handleDrawerOpen",value:function(){this.setState({open:!0})}},{key:"handleDrawerClose",value:function(){this.setState({open:!1})}},{key:"logOut",value:function(){localStorage.removeItem("token"),setTimeout((function(){window.location.pathname="/"}),300)}},{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(g.Z,null,n.createElement(E.Z,null,n.createElement(w.Z,{edge:"start",color:"inherit","aria-label":"open drawer",onClick:this.handleDrawerOpen.bind(this)},n.createElement(P.Z,null)),n.createElement(b.Z,{component:"h1",variant:"h6",color:"inherit",noWrap:!0,style:{flexGrow:1}},"Dashboard"),n.createElement(w.Z,{color:"inherit"},n.createElement(D.Z,{badgeContent:4,color:"secondary"},n.createElement(T.Z,null))))),n.createElement(n.Fragment,null,n.createElement(W.Z,{anchor:"left",open:this.state.open,onClose:function(){e.setState({open:!1})},onOpen:function(){e.setState({open:!0})}},n.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:10}},n.createElement(N.Z,{size:"small",options:this.state.full_menu,getOptionLabel:function(e){return e.name},onChange:function(e,t){t&&(window.location.pathname="/"+t.key_query+"/")},style:{width:300},renderInput:function(e){return n.createElement(M.Z,(0,s.Z)({},e,{label:"Поиск",variant:"outlined"}))}}),n.createElement(w.Z,{onClick:this.handleDrawerClose.bind(this)},n.createElement(S.Z,null))),n.createElement(x.Z,null),this.state.menu.map((function(e,t){return n.createElement(C.Z,{key:t},n.createElement(A.Z,{expandIcon:n.createElement(L.Z,null),"aria-controls":"panel1a-content",id:"panel1a-header"},n.createElement(b.Z,null,e.parent.name)),n.createElement(j.Z,null,n.createElement(y.Z,{style:{width:"100%"}},e.chaild.map((function(e,t){return n.createElement(Z.ZP,{button:!0,key:t},n.createElement(R.rU,{to:"/"+e.key_query+"/"},n.createElement(v.Z,{primary:e.name})))})))))})),n.createElement(C.Z,null,n.createElement(A.Z,{onClick:this.logOut.bind(this)},n.createElement(b.Z,null,"Выйти из аккаунта"))))))}}]),f}(n.Component);function Lt(e){var t=e.code,a=e.children;return n.createElement(F.AW,{render:function(e){var n=e.staticContext;return n&&(n.status=t),a}})}function Ot(){var e=(0,F.TH)(),t=!0;return"/auth/"!=e.pathname&&"/auth"!=e.pathname&&"/registration/"!=e.pathname&&"/registration"!=e.pathname||(t=!1),n.createElement(z.Z,{theme:At},n.createElement("div",null,t?n.createElement(n.Fragment,null,n.createElement(f.ZP,null),n.createElement(jt,null)):null,n.createElement("main",{style:{flexGrow:1,overflow:"auto"}},n.createElement(I.Z,{maxWidth:!1,style:{marginTop:80}},n.createElement(n.Suspense,{fallback:n.createElement("div",null,"Loading...")},n.createElement(F.Z5,null,n.createElement(F.AW,{path:"/",exact:!0,element:n.createElement(st,null)}),n.createElement(F.AW,{path:"/auth",exact:!0,element:n.createElement(rt,null)}),n.createElement(F.AW,{path:"/registration",exact:!0,element:n.createElement(ot,null)}),n.createElement(F.AW,{path:"/live_orders",exact:!0,element:n.createElement(lt,null)}),n.createElement(F.AW,{path:"/events",exact:!0,element:n.createElement(ct,null)}),n.createElement(F.AW,{path:"/ras_by_bill",exact:!0,element:n.createElement(mt,null)}),n.createElement(F.AW,{path:"/category_items",exact:!0,element:n.createElement(ut,null)}),n.createElement(F.AW,{path:"/vendor_module",exact:!0,element:n.createElement(dt,null)}),n.createElement(F.AW,{path:"/vendor_item_price",exact:!0,element:n.createElement(ht,null)}),n.createElement(F.AW,{path:"/tender",exact:!0,element:n.createElement(pt,null)}),n.createElement(F.AW,{path:"/revizion",exact:!0,element:n.createElement(xe,null)}),n.createElement(F.AW,{path:"/revizion/new",exact:!0,element:n.createElement(we,null)}),n.createElement(F.AW,{path:"/work_schedule",exact:!0,element:n.createElement(_t,null)}),n.createElement(F.AW,{path:"/site_sale_2",exact:!0,element:n.createElement($e,null)}),n.createElement(F.AW,{path:"/site_sale_2/new",exact:!0,element:n.createElement(Ne,null)}),n.createElement(F.AW,{path:"/site_sale_2/edit/:promoId",exact:!0,element:n.createElement(We,null)}),n.createElement(F.AW,{path:"/site_sale_2/stat",exact:!0,element:n.createElement(Je,null)}),n.createElement(F.AW,{path:"/site_sale_2/stat_list",exact:!0,element:n.createElement(Be,null)}),n.createElement(F.AW,{path:"/drive_map_stat_all",exact:!0,element:n.createElement(ft,null)}),n.createElement(F.AW,{path:"/driver_stat",exact:!0,element:n.createElement(gt,null)}),n.createElement(F.AW,{path:"/concenter",exact:!0,element:n.createElement(Et,null)}),n.createElement(F.AW,{path:"/socialnetwork",exact:!0,element:n.createElement(yt,null)}),n.createElement(F.AW,{path:"/cat_work",exact:!0,element:n.createElement(Zt,null)}),n.createElement(F.AW,{path:"/app_work_point",exact:!0,element:n.createElement(vt,null)}),n.createElement(F.AW,{path:"/app_work",exact:!0,element:n.createElement(bt,null)}),n.createElement(F.AW,{path:"/app_work_show",exact:!0,element:n.createElement(xt,null)}),n.createElement(F.AW,{path:"/site_stat_marc",exact:!0,element:n.createElement(wt,null)}),n.createElement(F.AW,{path:"/advertising_company",exact:!0,element:n.createElement(Dt,null)}),n.createElement(F.AW,{path:"/ras_bill_and_cook",exact:!0,element:n.createElement(It,null)}),n.createElement(F.AW,{path:"/sklad_items_module",exact:!0,element:n.createElement(kt,null)}),n.createElement(F.AW,{path:"/site_user_manager",exact:!0,element:n.createElement(Pt,null)}),n.createElement(F.AW,{path:"/promo_items_stat",exact:!0,element:n.createElement(St,null)}),n.createElement(F.AW,{path:"/site_items",exact:!0,element:n.createElement(Tt,null)}),n.createElement(F.AW,{path:"/hot_map",exact:!0,element:n.createElement(Ct,null)}),n.createElement(F.AW,{path:"/site_sale_min",exact:!0,element:n.createElement(at,null)}),n.createElement(F.AW,{path:"/site_sale_min/new",exact:!0,element:n.createElement(et,null)}),n.createElement(F.AW,{path:"/site_sale_min/edit/:promoId",exact:!0,element:n.createElement(tt,null)}),n.createElement(F.AW,{path:"/site_sale_min/stat_list",exact:!0,element:n.createElement(nt,null)}),n.createElement(F.AW,{component:function(){return n.createElement(Lt,{code:404},n.createElement(k.ZP,{container:!0,className:"Contact mainContainer MuiGrid-spacing-xs-3",style:{marginTop:64}},n.createElement(k.ZP,{item:!0,xs:12},n.createElement(b.Z,{variant:"h5",component:"h1"},"404 Страница не найдена"))))}})))))))}var zt=document.getElementById("app");(0,i.s)(zt).render(n.createElement(R.VK,null,n.createElement(Ot,null)))},6406:(e,t,a)=>{a.d(t,{$S:()=>P,H4:()=>j,IA:()=>A,Qe:()=>C,e_:()=>k,lp:()=>I,rZ:()=>S,w0:()=>T});var n=a(7462),i=a(5671),s=a(3144),r=a(136),o=a(6215),l=a(1120),c=a(7294),m=a(7666),u=a(5305),d=a(6446),h=a(6036),p=a(5116),_=a(3709),f=a(542),g=a(4212),E=a(1174),y=a(6447),Z=a(8523),v=a(6872),b=a(2856),x=a(9349),w=a(7679);a(2658);function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,l.Z)(e);if(t){var i=(0,l.Z)(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return(0,o.Z)(this,a)}}var I=function(e){(0,r.Z)(a,e);var t=D(a);function a(e){var n;return(0,i.Z)(this,a),(n=t.call(this,e)).state={},n}return(0,s.Z)(a,[{key:"render",value:function(){return c.createElement(b._,{dateAdapter:v.Z,locale:Z.Z,size:"small"},c.createElement(w.D,{allowSameDateSelection:!0,showTodayButton:!0,startText:this.props.startText,endText:this.props.endText,value:this.props.value,inputFormat:"yyyy-MM-dd",mask:"____-__-__",onChange:this.props.func,renderInput:function(e,t){return c.createElement(c.Fragment,null,c.createElement(p.Z,(0,n.Z)({style:{width:"100%"}},e)),c.createElement(p.Z,(0,n.Z)({style:{width:"100%"}},t)))}}))}}]),a}(c.PureComponent),k=function(e){(0,r.Z)(a,e);var t=D(a);function a(e){var n;return(0,i.Z)(this,a),(n=t.call(this,e)).state={},n}return(0,s.Z)(a,[{key:"render",value:function(){var e,t=this;return c.createElement(y.Z,{spacing:3},c.createElement(E.Z,{size:"small",disableCloseOnSelect:!0,id:null!==(e=this.props.id)&&void 0!==e?e:null,options:this.props.data,getOptionLabel:function(e){return e.name},value:this.props.value,onChange:this.props.func,filterSelectedOptions:!0,multiple:!(!this.props.multiple||!0!==this.props.multiple),isOptionEqualToValue:function(e,t){return parseInt(e.id)===parseInt(t.id)},renderInput:function(e){return c.createElement(p.Z,(0,n.Z)({},e,{label:t.props.label,placeholder:t.props.placeholder}))}}))}}]),a}(c.PureComponent),P=(c.PureComponent,function(e){(0,r.Z)(a,e);var t=D(a);function a(e){var n;return(0,i.Z)(this,a),(n=t.call(this,e)).state={},n}return(0,s.Z)(a,[{key:"render",value:function(){return c.createElement(d.Z,{fullWidth:!0,variant:"outlined",size:"small"},c.createElement(m.Z,null,this.props.label),c.createElement(h.Z,{value:this.props.value,label:this.props.label,disabled:!(!this.props.disabled&&!0!==this.props.disabled),onChange:this.props.func,multiple:!(!this.props.multiple||!0!==this.props.multiple)},c.createElement(u.Z,{value:""},c.createElement("em",null,"None")),this.props.data.map((function(e,t){return c.createElement(u.Z,{key:t,value:e.id},e.name)}))))}}]),a}(c.PureComponent)),S=function(e){(0,r.Z)(a,e);var t=D(a);function a(e){var n;return(0,i.Z)(this,a),(n=t.call(this,e)).state={type:"text"},n}return(0,s.Z)(a,[{key:"render",value:function(){return c.createElement(p.Z,{label:this.props.label,value:this.props.value,onChange:this.props.func,onBlur:this.props.onBlur?this.props.onBlur:null,disabled:!(!this.props.disabled&&!0!==this.props.disabled),variant:"outlined",size:"small",color:"primary",multiline:!!this.props.multiline&&this.props.multiline,maxRows:this.props.maxRows?this.props.maxRows:1,type:this.props.type?this.props.type:this.state.type,style:{width:"100%"}})}}]),a}(c.PureComponent),T=function(e){(0,r.Z)(a,e);var t=D(a);function a(e){var n;return(0,i.Z)(this,a),(n=t.call(this,e)).state={thisVal:""},n}return(0,s.Z)(a,[{key:"onChange",value:function(e){this.setState({thisVal:e.target.value})}},{key:"onBlur",value:function(){this.setState({thisVal:""}),this.props.onBlur()}},{key:"render",value:function(){return c.createElement(p.Z,{variant:"outlined",size:"small",color:"primary",label:this.props.label,type:"time",id:this.props.id?this.props.id:null,value:this.props.func?this.props.value:this.state.thisVal,style:{width:"100%"},onChange:this.props.func?this.props.func:this.onChange.bind(this),onBlur:this.props.onBlur?this.onBlur.bind(this):null,InputLabelProps:{shrink:!0},step:600,inputProps:{step:600}})}}]),a}(c.PureComponent),C=(c.PureComponent,function(e){(0,r.Z)(a,e);var t=D(a);function a(e){var n;return(0,i.Z)(this,a),(n=t.call(this,e)).state={},n}return(0,s.Z)(a,[{key:"render",value:function(){return c.createElement(b._,{dateAdapter:v.Z,locale:Z.Z},c.createElement(x.M,{multiple:!0,mask:"____-__-__",inputFormat:"yyyy-MM-dd",label:this.props.label,value:(e=this.props.value,t=new Date(e),a=""+(t.getMonth()+1),i=""+t.getDate(),s=t.getFullYear(),a.length<2&&(a="0"+a),i.length<2&&(i="0"+i),[s,a,i].join("-")),onChange:this.props.func,renderInput:function(e){return c.createElement(p.Z,(0,n.Z)({variant:"outlined",size:"small",color:"primary",style:{width:"100%"}},e))}}));var e,t,a,i,s}}]),a}(c.PureComponent)),A=function(e){(0,r.Z)(a,e);var t=D(a);function a(e){var n;return(0,i.Z)(this,a),(n=t.call(this,e)).state={},n}return(0,s.Z)(a,[{key:"render",value:function(){return c.createElement(_.Z,{row:!0,style:this.props.style?this.props.style:{}},c.createElement(f.Z,{control:c.createElement(g.Z,{disabled:!(!this.props.disabled&&!0!==this.props.disabled),checked:this.props.value,onChange:this.props.func,color:"primary"}),label:this.props.label}))}}]),a}(c.PureComponent),j=function(e){(0,r.Z)(a,e);var t=D(a);function a(e){var n;return(0,i.Z)(this,a),(n=t.call(this,e)).state={},n}return(0,s.Z)(a,[{key:"render",value:function(){return c.createElement("tinymce-editor",{apiKey:"r0ihgs4ukfpmudzw7aexxgb88tnx5jw26h1xx9x6409ji3gx",id:this.props.id,menubar:!0,plugins:"advlist autolink lists link image charmap print preview anchor searchreplace visualblocks code fullscreen insertdatetime media table paste code help wordcount",toolbar:"undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"},this.props.text)}}]),a}(c.PureComponent)},5369:(e,t,a)=>{var n=a(4783)(e.id,{locals:!1});e.hot.dispose(n),e.hot.accept(void 0,n)},521:(e,t,a)=>{var n=a(4783)(e.id,{locals:!1});e.hot.dispose(n),e.hot.accept(void 0,n)},5584:(e,t,a)=>{var n=a(4783)(e.id,{locals:!1});e.hot.dispose(n),e.hot.accept(void 0,n)},7639:(e,t,a)=>{var n=a(4783)(e.id,{locals:!1});e.hot.dispose(n),e.hot.accept(void 0,n)}},e=>{e.O(0,[216],(()=>(9754,e(e.s=9754)))),e.O()}]);
//# sourceMappingURL=main.73e416ed125cc15edcaf.js.map