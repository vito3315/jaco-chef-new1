"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[159],{8159:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Q}),r(6771);var n=r(5861),a=r(5671),i=r(3144),s=r(7326),l=r(136),o=r(6215),c=r(1120),d=r(4942),h=r(7462),m=(r(5987),r(4687)),u=r.n(m),p=r(7294),f=r(30),E=r(1822),g=r(986),Z=r(5697),_=r.n(Z),y=r(5293),b=r(214),v=r(3150),w=r(6140),x=r(3030),O=r(8561),k=r(8736),I=r(4896),D=r(8727),C=r(808),S=r(231),P=r(3508),W=r(9620),T=r(2962),N=r(4498),R=r(7745),B=r(399),j=r(1470),A=r(8037),M=r(7888),z=r(3646),F=r(3892),q=r(5705),G=r(6406),L=r(1647);var U=r(7563);function Y(e){var t=new Date(e),r=""+(t.getMonth()+1),n=""+t.getDate(),a=t.getFullYear();return r.length<2&&(r="0"+r),n.length<2&&(n="0"+n),[a,r,n].join("-")}_().node,_().number.isRequired,_().number.isRequired;var J=function(e){(0,l.Z)(K,e);var t,r,m,Z,_,J,Q,$,H=(Q=K,$=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,c.Z)(Q);if($){var r=(0,c.Z)(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return(0,o.Z)(this,e)});function K(e){var t;return(0,a.Z)(this,K),t=H.call(this,e),(0,d.Z)((0,s.Z)(t),"getData",(function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:U.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(r)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e),t.setState({is_load:!1})}))})),(0,d.Z)((0,s.Z)(t),"changeAddr",(function(e){t.setState({typeDel:e.target.value})})),t.state={module:"concenter",module_name:"",is_load:!1,modalDialog:!1,modalDialogDel:!1,cities:[],city_id:1,date:Y(new Date),point_list:[],need_point_list:[],point_id:0,indexTab:0,orders:[],ordersRender:[],showOrder:null,radiogroup_options:[{id:"0",label:"Решили отредактировать заказ",value:0},{id:"1",label:"Не устраивает время ожидания",value:0},{id:"2",label:"Изменились планы",value:0},{id:"3",label:"Недостаточно средств",value:0},{id:"4",label:"Другое",value:0}],textDel:"",typeDel:-1,number:"",addr:""},t}return(0,i.Z)(K,[{key:"componentDidMount",value:(J=(0,n.Z)(u().mark((function e(){var t,r,n=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,r=t.points.filter((function(e,r){return parseInt(e.city_id)==parseInt(t.cities[0].id)})),this.setState({module_name:t.module_info.name,cities:t.cities,point_list:t.points,need_point_list:r,point_id:parseInt(r[0].id)}),document.title=t.module_info.name,setTimeout((function(){n.getOrders()}),300);case 7:case"end":return e.stop()}}),e,this)}))),function(){return J.apply(this,arguments)})},{key:"changeCity",value:function(e){var t=this;this.setState({number:"",addr:""});var r=e.target.value,n=this.state.point_list.filter((function(e,t){return parseInt(e.city_id)==parseInt(r)}));this.setState({city_id:r,need_point_list:n,point_id:parseInt(n[0].id),indexTab:0}),setTimeout((function(){t.getOrders()}),300)}},{key:"changePoint",value:(_=(0,n.Z)(u().mark((function e(t,r){var n=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({point_id:t,indexTab:r}),setTimeout((function(){n.getOrders()}),300);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"getOrders",value:(Z=(0,n.Z)(u().mark((function e(){var t,r,n=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point_id,date:this.state.date},e.next=3,this.getData("get_orders",t);case 3:r=e.sent,console.log(r),this.setState({orders:r.orders}),setTimeout((function(){n.filterNumber()}),300);case 7:case"end":return e.stop()}}),e,this)}))),function(){return Z.apply(this,arguments)})},{key:"btnGetOrders",value:function(){this.setState({number:"",addr:""}),this.getOrders()}},{key:"showOrder",value:(m=(0,n.Z)(u().mark((function e(t){var r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={point_id:this.state.point_id,order_id:t},e.next=3,this.getData("get_order_new",r);case 3:n=e.sent,console.log(n),this.setState({modalDialog:!0,showOrder:n});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"closeOrder",value:function(){this.setState({modalDialogDel:!0})}},{key:"closeOrderTrue",value:(r=(0,n.Z)(u().mark((function e(){var t,r,n,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("4"==(t=this.state.radiogroup_options.find((function(e){return e.id==a.state.typeDel}))).id&&(t.label=this.state.textDel),!confirm("Отменить заказ #"+this.state.showOrder.order.order_id)){e.next=8;break}return r={typeCreate:"center",order_id:this.state.showOrder.order.order_id,point_id:this.state.showOrder.order.point_id,ans:t.label},e.next=6,this.getData("close_order_center",r);case 6:!0===(n=e.sent).st?(this.setState({modalDialogDel:!1,modalDialog:!1}),this.getOrders()):alert(n.text);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"fakeUser",value:(t=(0,n.Z)(u().mark((function e(){var t,r,n,a,i,s,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0,t=parseInt(this.state.showOrder.order.check_pos)>=0?parseInt(this.state.showOrder.order.check_pos)<=100?1:2:0,0!=parseInt(t)){e.next=5;break}return alert("Создать обращение не возможно"),e.abrupt("return");case 5:if(1!=parseInt(t)){e.next=16;break}if(!((r=prompt("Комментарий к ситуации","")).length>0)){e.next=15;break}return n={text:r,point_id:parseInt(this.state.showOrder.order.point_id),order_id:parseInt(this.state.showOrder.order.order_id)},e.next=11,this.getData("fake_user",n);case 11:1==(a=e.sent).st?(alert("Обращение зафиксировано"),this.setState({modalDialog:!1})):alert(a.text),e.next=16;break;case 15:alert("надо указать комментарий");case 16:if(2!=parseInt(t)){e.next=29;break}if(!confirm("Курьер, предположительно, находиться далеко от клиента, точно оформить довоз ?")){e.next=29;break}if(!((i=prompt("Комментарий к ситуации","")).length>0)){e.next=28;break}return s={text:i,point_id:parseInt(this.state.showOrder.order.point_id),order_id:parseInt(this.state.showOrder.order.order_id)},e.next=24,this.getData("fake_user",s);case 24:1==(l=e.sent).st?(alert("Обращение зафиксировано"),this.setState({modalDialog:!1})):alert(l.text),e.next=29;break;case 28:alert("надо указать комментарий");case 29:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"changeText",value:function(e){this.setState({textDel:e.target.value})}},{key:"changeDate",value:function(e){var t=this;this.setState({number:"",addr:""}),this.setState({date:Y(e)}),setTimeout((function(){t.getOrders()}),300)}},{key:"changeNumber",value:function(e){var t=this,r=e.target.value;isNaN(r)||(this.setState({number:r}),setTimeout((function(){t.filterNumber()}),300))}},{key:"changeAddrSt",value:function(e){var t=this,r=e.target.value;this.setState({addr:r}),setTimeout((function(){t.filterNumber()}),300)}},{key:"filterNumber",value:function(){var e=this,t=this.state.orders;this.state.number.length>0&&(t=t.filter((function(t){return-1!==t.number.indexOf(e.state.number)}))),this.state.addr.length>0&&(t=t.filter((function(t){return-1!==(t.street+" "+t.home).toLowerCase().indexOf(e.state.addr.toLowerCase())}))),this.setState({ordersRender:t})}},{key:"render",value:function(){var e=this;return p.createElement(p.Fragment,null,p.createElement(F.Z,{style:{zIndex:99},open:this.state.is_load},p.createElement(q.Z,{color:"inherit"})),this.state.showOrder?p.createElement(W.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},p.createElement(R.Z,{style:{textAlign:"center"}},"Заказ #",this.state.showOrder.order.order_id),p.createElement(N.Z,null,p.createElement(f.ZP,{container:!0,spacing:0},p.createElement(f.ZP,{item:!0,xs:12},p.createElement("span",null,this.state.showOrder.order.type_order,": ",this.state.showOrder.order.type_order_addr_new)),1==parseInt(this.state.showOrder.order.type_order_)?0==parseInt(this.state.showOrder.order.fake_dom)?p.createElement(f.ZP,{item:!0,xs:12},p.createElement("b",{style:{color:"red",fontWeight:900}},"Домофон не работает")):p.createElement(f.ZP,{item:!0,xs:12},p.createElement("b",{style:{color:"green",fontWeight:900}},"Домофон работает")):null,p.createElement(f.ZP,{item:!0,xs:12},p.createElement("span",null,this.state.showOrder.order.time_order_name,": ",this.state.showOrder.order.time_order)),this.state.showOrder.order.number.length>1?p.createElement(f.ZP,{item:!0,xs:12},p.createElement("b",null,"Телефон: "),p.createElement("span",null,this.state.showOrder.order.number)):null,this.state.showOrder.order.delete_reason.length>0?p.createElement(f.ZP,{item:!0,xs:12},p.createElement("span",{style:{color:"red"}},"Удален: ",this.state.showOrder.order.date_time_delete)):null,this.state.showOrder.order.delete_reason.length>0?p.createElement(f.ZP,{item:!0,xs:12},p.createElement("span",{style:{color:"red"}},this.state.showOrder.order.delete_reason)):null,1==parseInt(this.state.showOrder.order.is_preorder)?null:p.createElement(f.ZP,{item:!0,xs:12},p.createElement("span",null,this.state.showOrder.order.text_time,this.state.showOrder.order.time_to_client)),p.createElement(f.ZP,{item:!0,xs:12},p.createElement("span",null,this.state.showOrder.order.textTime)),null==this.state.showOrder.order.promo_name||0==this.state.showOrder.order.promo_name.length?null:p.createElement(p.Fragment,null,p.createElement(f.ZP,{item:!0,xs:12},p.createElement("b",null,"Промокод: "),p.createElement("span",null,this.state.showOrder.order.promo_name)),p.createElement(f.ZP,{item:!0,xs:12},p.createElement("span",{className:"noSpace"},this.state.showOrder.order.promo_text))),null==this.state.showOrder.order.comment||0==this.state.showOrder.order.comment.length?null:p.createElement(f.ZP,{item:!0,xs:12},p.createElement("b",null,"Комментарий: "),p.createElement("span",null,this.state.showOrder.order.comment)),null==this.state.showOrder.order.sdacha||0==parseInt(this.state.showOrder.order.sdacha)?null:p.createElement(f.ZP,{item:!0,xs:12},p.createElement("b",null,"Сдача: "),p.createElement("span",null,this.state.showOrder.order.sdacha)),p.createElement(f.ZP,{item:!0,xs:12},p.createElement("b",null,"Сумма заказа: "),p.createElement("span",null,this.state.showOrder.order.sum_order," р")),null!=this.state.showOrder.order.check_pos_drive&&this.state.showOrder.order.check_pos_drive?p.createElement(f.ZP,{item:!0,xs:12},p.createElement("b",null,"Довоз оформлен: "),p.createElement("span",null,this.state.showOrder.order.check_pos_drive.comment)):null,p.createElement(f.ZP,{item:!0,xs:12},p.createElement(v.Z,{size:"small",style:{marginTop:15}},p.createElement(w.Z,null,this.state.showOrder.order_items.map((function(e,t){return p.createElement(k.Z,{key:t},p.createElement(x.Z,null,e.name),p.createElement(x.Z,null,e.count),p.createElement(x.Z,null,e.price," р"))}))),p.createElement(I.Z,null,p.createElement(k.Z,null,p.createElement(x.Z,{style:{fontWeight:"bold",color:"#000"}},"Сумма закза"),p.createElement(x.Z,null),p.createElement(x.Z,{style:{fontWeight:"bold",color:"#000"}},this.state.showOrder.order.sum_order," р"))))),p.createElement(D.Z,{style:{width:"100%"}},p.createElement(C.Z,{expandIcon:p.createElement(P.Z,null)},p.createElement(L.Z,null,"Расформировка")),p.createElement(S.Z,null,p.createElement(v.Z,{size:"small",style:{marginTop:15}},p.createElement(w.Z,null,this.state.showOrder.order_items_.map((function(e,t){return p.createElement(k.Z,{key:t},p.createElement(x.Z,null,e.name),p.createElement(x.Z,{style:{backgroundColor:parseInt(e.ready)>0?"#6ab04c":"#eb4d4b"}}))})))))))),0==parseInt(this.state.showOrder.order.is_delete)&&6!==parseInt(this.state.showOrder.order.status_order)?p.createElement(T.Z,{style:{justifyContent:"flex-end",padding:"15px 0px"}},p.createElement(g.Z,{disableElevation:!0,disableRipple:!0,variant:"contained",className:"BtnBorderOther",style:{marginRight:24}},p.createElement(E.Z,{variant:"contained",className:"BtnCardMain CardInCardItem",onClick:this.closeOrder.bind(this)},"Отменить заказ"))):null,1==parseInt(this.state.showOrder.order.type_order_)&&parseInt(this.state.showOrder.order.status_order)>4&&parseInt(this.state.showOrder.order.check_pos)>=0?p.createElement(T.Z,{style:{justifyContent:"flex-end",padding:"15px 0px"}},p.createElement(g.Z,{disableElevation:!0,disableRipple:!0,variant:"contained",className:"BtnBorderOther",style:{marginRight:24}},p.createElement(E.Z,{variant:"contained",className:"BtnCardMain CardInCardItemYellow",onClick:this.fakeUser.bind(this)},"Клиент не вышел на связь"))):null):null,this.state.showOrder?p.createElement(W.Z,{open:this.state.modalDialogDel,onClose:function(){e.setState({modalDialogDel:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},p.createElement(R.Z,{style:{textAlign:"center"}},"Отмена заказа ",this.state.showOrder.order.order_id),p.createElement(N.Z,null,p.createElement(M.Z,{component:"fieldset"},p.createElement(j.Z,{name:"typeDel",value:this.state.typeDel,onChange:this.changeAddr},this.state.radiogroup_options.map((function(e,t){return p.createElement(A.Z,{key:t,value:e.id,control:p.createElement(B.Z,null),label:e.label})})))),p.createElement(z.Z,{onFocus:function(){e.setState({typeDel:"4"})},value:this.state.textDel,onChange:this.changeText.bind(this),margin:"dense",id:"name",label:"Причина отмены",type:"text",fullWidth:!0})),p.createElement(T.Z,{style:{paddingBottom:24}},p.createElement(g.Z,{disableElevation:!0,disableRipple:!0,variant:"contained",className:"BtnBorderOther",style:{marginRight:24}},p.createElement(E.Z,{variant:"contained",className:"BtnCardMain CardInCardItem",onClick:function(){e.setState({delOrder:!1})}},"К заказу")),p.createElement(g.Z,{disableElevation:!0,disableRipple:!0,variant:"contained",className:"BtnBorderOther",style:{marginRight:24}},p.createElement(E.Z,{variant:"contained",className:"BtnCardMain CardInCardItem",onClick:this.closeOrderTrue.bind(this)},"Отменить заказ")))):null,p.createElement(f.ZP,{container:!0,spacing:3},p.createElement(f.ZP,{item:!0,xs:12,sm:12},p.createElement("h1",null,this.state.module_name)),p.createElement(f.ZP,{item:!0,xs:12,sm:3},p.createElement(G.$S,{data:this.state.cities,value:this.state.city_id,func:this.changeCity.bind(this),label:"Город"})),p.createElement(f.ZP,{item:!0,xs:12,sm:3},p.createElement(G.Qe,{label:"Дата",value:this.state.date,func:this.changeDate.bind(this)})),p.createElement(f.ZP,{item:!0,xs:12,sm:3},p.createElement(G.rZ,{label:"Номер телефона",value:this.state.number,func:this.changeNumber.bind(this)})),p.createElement(f.ZP,{item:!0,xs:12,sm:3},p.createElement(G.rZ,{label:"Адрес",value:this.state.addr,func:this.changeAddrSt.bind(this)})),p.createElement(f.ZP,{item:!0,xs:12,sm:3},p.createElement(E.Z,{variant:"contained",onClick:this.btnGetOrders.bind(this)},"Обновить")),p.createElement(f.ZP,{item:!0,xs:12},p.createElement(y.Z,{value:this.state.indexTab},this.state.need_point_list.map((function(t,r){return p.createElement(b.Z,(0,h.Z)({key:r,label:t.name,onClick:e.changePoint.bind(e,t.id,r)},(n=parseInt(t.id),{id:"simple-tab-".concat(n),"aria-controls":"simple-tabpanel-".concat(n)})));var n})))),p.createElement(f.ZP,{item:!0,xs:12},p.createElement(v.Z,{size:"small"},p.createElement(O.Z,null,p.createElement(k.Z,null,p.createElement(x.Z,null,"Заказ"),p.createElement(x.Z,null,"Оформил"),p.createElement(x.Z,null,"Номер клиента"),p.createElement(x.Z,null,"Адрес доставки"),p.createElement(x.Z,null,"Время открытия заказа"),p.createElement(x.Z,null,"Ко времени"),p.createElement(x.Z,null,"Закрыт на кухне"),p.createElement(x.Z,null,"Получен клиентом"),p.createElement(x.Z,null,"До просрочки"),p.createElement(x.Z,null,"Время обещ"),p.createElement(x.Z,null,"Тип"),p.createElement(x.Z,null,"Статус"),p.createElement(x.Z,null,"Сумма"),p.createElement(x.Z,null,"Оплата"),p.createElement(x.Z,null,"Водитель"))),p.createElement(w.Z,null,this.state.ordersRender.map((function(t,r){return p.createElement(k.Z,{key:r,style:1==parseInt(t.is_delete)?{backgroundColor:"red",color:"#fff",fontWeight:"bold"}:{}},p.createElement(x.Z,{style:parseInt(t.dist)>=0?{backgroundColor:"yellow",color:"#000",cursor:"pointer",fontWeight:"inherit"}:{color:"inherit",cursor:"pointer",fontWeight:"inherit"},onClick:e.showOrder.bind(e,t.id)},t.id),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.type_user),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.number),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.street," ",t.home),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.date_time_order),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit",backgroundColor:1==parseInt(t.is_preorder)?"#bababa":"inherit"}},t.need_time),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},"00:00:00"==t.give_data_time?"":t.give_data_time),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.close_order),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.to_time),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},"0"==t.unix_time_to_client||1==parseInt(t.is_preorder)?"":t.unix_time_to_client),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.type_order),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.status),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.order_price),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.type_pay),p.createElement(x.Z,{style:{color:"inherit",fontWeight:"inherit"}},t.driver))})))))))}}]),K}(p.Component);function Q(){return p.createElement(J,null)}},6771:(e,t,r)=>{var n=r(4783)(e.id,{locals:!1});e.hot.dispose(n),e.hot.accept(void 0,n)}}]);
//# sourceMappingURL=159.521c24d0b51130ec95be.js.map