"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[672],{672:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C}),n(3208);var o=n(5861),i=n(5671),a=n(3144),r=n(7326),s=n(136),c=n(6215),l=n(1120),u=n(4942),p=n(4687),d=n.n(p),m=n(7294),h=n(30),f=n(1822),y=n(3892),g=n(5705),v=n(6406);var x=n(7563),_=function(e){(0,s.Z)(k,e);var t,n,p,_,C=(p=k,_=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,l.Z)(p);if(_){var n=(0,l.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,c.Z)(this,e)});function k(e){var t;return(0,i.Z)(this,k),t=C.call(this,e),(0,u.Z)((0,r.Z)(t),"map",null),(0,u.Z)((0,r.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:x.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"drive_map_stat_all",module_name:"",is_load:!1,points:[],point:"0",drivers:[]},t}return(0,a.Z)(k,[{key:"componentDidMount",value:(n=(0,o.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({points:t.point_list,point:t.point_list[0].id,module_name:t.module_info.name}),document.title=t.module_info.name,setTimeout((function(){}),100);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"changePoint",value:function(e){var t=this,n=e.target.value;this.setState({point:n}),setTimeout((function(){t.updateData()}),50)}},{key:"updateData",value:(t=(0,o.Z)(d().mark((function e(){var t,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point},e.next=3,this.getData("get_orders",t);case 3:n=e.sent,this.getOrders(n.orders,n.home,n.drivers),this.setState({drivers:n.drivers}),console.log(n.drivers);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getOrders",value:function(e,t,n){var o=this,i=new ymaps.ObjectManager;if(this.map){this.map.setCenter([t.latitude,t.longitude]);var a={type:"FeatureCollection",features:[]};a.features.push({type:"Feature",id:0,options:{preset:"islands#blackDotIcon",iconColor:"black"},geometry:{type:"Point",coordinates:[t.latitude,t.longitude]}}),e.map((function(e){a.features.push({type:"Feature",id:e.id,options:{preset:6==parseInt(e.status_order)?"islands#blueCircleDotIconWithCaption":"islands#circleDotIcon",iconColor:e.point_color?e.point_color:e.color},properties:{iconCaption:e.point_text},geometry:{type:"Point",coordinates:[e.xy.latitude,e.xy.longitude]}})})),i.add(a),n.map((function(e){e.positions.map((function(t,n){t.xy=JSON.parse(t.xy,!0),a.features.push({type:"Feature",id:t.id,options:{preset:"islands#stretchyIcon",iconColor:e.color},properties:{iconContent:n},geometry:{type:"Point",coordinates:[t.xy[0],t.xy[1]]}})}))})),i.add(a),this.map.geoObjects.removeAll(),this.map.geoObjects.add(i)}else ymaps.ready((function(){o.map=new ymaps.Map("map",{center:[t.latitude,t.longitude],zoom:11},{searchControlProvider:"yandex#search"});var a=new ymaps.GeoObject({geometry:{type:"Point",coordinates:[t.latitude,t.longitude]}},{preset:"islands#blackDotIcon",iconColor:"black"});o.map.geoObjects.add(a);var r={type:"FeatureCollection",features:[]};e.map((function(e){r.features.push({type:"Feature",id:e.id,options:{preset:6==parseInt(e.status_order)?"islands#blueCircleDotIconWithCaption":"islands#circleDotIcon",iconColor:e.point_color?e.point_color:e.color},properties:{iconCaption:e.point_text},geometry:{type:"Point",coordinates:[e.xy.latitude,e.xy.longitude]}})})),i.add(r),n.map((function(e){e.positions.map((function(t,n){t.xy=JSON.parse(t.xy,!0),r.features.push({type:"Feature",id:t.id,options:{preset:"islands#stretchyIcon",iconColor:e.color},properties:{iconContent:n},geometry:{type:"Point",coordinates:[t.xy[0],t.xy[1]]}})}))})),i.add(r),o.map.geoObjects.add(i)}))}},{key:"render",value:function(){return m.createElement(m.Fragment,null,m.createElement(y.Z,{open:this.state.is_load,style:{zIndex:99}},m.createElement(g.Z,{color:"inherit"})),m.createElement(h.ZP,{container:!0,spacing:3},m.createElement(h.ZP,{item:!0,xs:12,sm:12},m.createElement("h1",null,this.state.module_name)),m.createElement(h.ZP,{item:!0,xs:6,sm:6},m.createElement(v.$S,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),m.createElement(h.ZP,{item:!0,xs:6,sm:6},m.createElement(f.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),m.createElement(h.ZP,{item:!0,xs:12,sm:12},this.state.drivers.map((function(e,t){return m.createElement("div",{key:t,style:{display:"flex",flexDirection:"row",alignItems:"center"}},m.createElement("div",{style:{width:50,height:20,backgroundColor:e.color}}),m.createElement("div",null,e.driver_name))}))),m.createElement(h.ZP,{item:!0,xs:12,sm:12},m.createElement("div",{id:"map",name:"map",style:{width:"100%",height:700,paddingTop:10}}))))}}]),k}(m.Component);function C(){return m.createElement(_,null)}},3208:(e,t,n)=>{var o=n(4783)(e.id,{locals:!1});e.hot.dispose(o),e.hot.accept(void 0,o)}}]);
//# sourceMappingURL=672.142ee470441dcba4477a.js.map