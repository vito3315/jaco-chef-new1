{"version":3,"file":"672.142ee470441dcba4477a.js","mappings":"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","sources":["webpack://package.json/./src/components/drive_map_stat_all/drive_map_stat_all.component.jsx","webpack://package.json/./src/components/drive_map_stat_all/drive_map_stat_all.style.scss"],"sourcesContent":["import React from 'react';\n\nimport Grid from '@mui/material/Grid';\nimport Button from '@mui/material/Button';\n\nimport Backdrop from '@mui/material/Backdrop';\nimport CircularProgress from '@mui/material/CircularProgress';\n\nimport { MySelect } from '../../stores/elements';\n\nconst queryString = require('query-string');\n\nclass DriveMapStatAll_ extends React.Component {\n  map = null;\n\n  constructor(props) {\n    super(props);\n        \n    this.state = {\n      module: 'drive_map_stat_all',\n      module_name: '',\n      is_load: false,\n      \n      points: [],\n      point: '0',\n      drivers: []\n    };\n  }\n  \n  async componentDidMount(){\n    \n    let data = await this.getData('get_all');\n    \n    this.setState({\n      points: data.point_list,\n      point: data.point_list[0].id,\n      module_name: data.module_info.name\n    })\n    \n    document.title = data.module_info.name;\n    \n    setTimeout( () => {\n      //this.updateData();\n    }, 100 )\n  }\n  \n  getData = (method, data = {}) => {\n    \n    this.setState({\n      is_load: true\n    })\n    \n    return fetch('https://jacochef.ru/api/index_new.php', {\n      method: 'POST',\n      headers: {\n        'Content-Type':'application/x-www-form-urlencoded'},\n      body: queryString.stringify({\n        method: method, \n        module: this.state.module,\n        version: 2,\n        login: localStorage.getItem('token'),\n        data: JSON.stringify( data )\n      })\n    }).then(res => res.json()).then(json => {\n      \n      if( json.st === false && json.type == 'redir' ){\n        window.location.pathname = '/';\n        return;\n      }\n      \n      if( json.st === false && json.type == 'auth' ){\n        window.location.pathname = '/auth';\n        return;\n      }\n      \n      setTimeout( () => {\n        this.setState({\n          is_load: false\n        })\n      }, 300 )\n      \n      return json;\n    })\n    .catch(err => { \n      console.log( err )\n    });\n  }\n   \n  changePoint(event){\n    let data = event.target.value;\n    \n    this.setState({\n      point: data\n    })\n    \n    setTimeout( () => {\n      this.updateData();\n    }, 50 )\n  }\n  \n  async updateData(){\n    let data = {\n      point_id: this.state.point,\n    };\n    \n    let res = await this.getData('get_orders', data);\n    \n    this.getOrders(res.orders, res.home, res.drivers)\n\n    this.setState({\n      drivers: res.drivers\n    })\n\n    console.log( res.drivers )\n  }\n  \n  getOrders(orders, home, drivers){\n    let objectManager = new ymaps.ObjectManager();\n    \n    if( !this.map ){\n      ymaps.ready(() => {\n        this.map = new ymaps.Map('map', {\n          center: [home.latitude, home.longitude],\n          zoom: 11\n        }, {\n          searchControlProvider: 'yandex#search'\n        })\n        \n        //дом\n        let myGeoObject = new ymaps.GeoObject({\n          geometry: {\n            type: \"Point\",\n            coordinates: [home.latitude, home.longitude]\n          },\n        }, {\n          preset: 'islands#blackDotIcon', \n          iconColor: 'black'\n        })\n\n        this.map.geoObjects.add(myGeoObject);\n        \n        let json = {\n          \"type\": \"FeatureCollection\",\n          \"features\": []\n        };\n                \n        orders.map( function(item){\n        \n          json.features.push({\n            type: \"Feature\",\n            id: item.id,\n            options: {\n              preset: parseInt(item.status_order) == 6 ? 'islands#blueCircleDotIconWithCaption' : 'islands#circleDotIcon', \n              iconColor: item.point_color ? item.point_color : item.color\n            },\n            properties: {\n              iconCaption: item.point_text,\n            },\n            geometry: {\n              type: \"Point\",\n              coordinates: [item.xy.latitude, item.xy.longitude]\n            },\n          })\n          \n        } )\n        \n        objectManager.add(json);\n\n        drivers.map( function(driver){\n          driver.positions.map( function(pos, key){\n\n            pos['xy'] = JSON.parse(pos['xy'], true);\n\n            json.features.push({\n              type: \"Feature\",\n              id: pos.id,\n              options: {\n                preset: 'islands#stretchyIcon', \n                iconColor: driver.color,\n              },\n              properties: {\n                iconContent: key\n              },\n              geometry: {\n                type: \"Point\",\n                coordinates: [pos['xy'][0], pos['xy'][1]],\n              },\n            })\n\n\n          } )\n        } )\n\n        objectManager.add(json);\n\n        this.map.geoObjects.add(objectManager);\n      });\n    }else{\n\n      // дом в центре карты\n      this.map.setCenter([home.latitude, home.longitude]);\n      \n      let json = {\n        \"type\": \"FeatureCollection\",\n        \"features\": []\n      };\n              \n      //дом\n      json.features.push({\n        type: \"Feature\",\n        id: 0,\n        options: {\n          preset: 'islands#blackDotIcon', \n          iconColor: 'black'\n        },\n        geometry: {\n          type: \"Point\",\n          coordinates: [home.latitude, home.longitude]\n        },\n      })\n      \n      \n      orders.map( function(item){\n        \n        json.features.push({\n          type: \"Feature\",\n          id: item.id,\n          options: {\n            preset: parseInt(item.status_order) == 6 ? 'islands#blueCircleDotIconWithCaption' : 'islands#circleDotIcon', \n            iconColor: item.point_color ? item.point_color : item.color\n          },\n          properties: {\n            iconCaption: item.point_text,\n            //iconCaption: parseInt(item.status_order) == 6 ? item.close_time_ : parseInt(item.is_pred) == 1 ? item.need_time : parseInt(item.is_my) == 1 ? item.time_start_mini : '',\n          },\n          geometry: {\n            type: \"Point\",\n            coordinates: [item.xy.latitude, item.xy.longitude]\n          },\n        })\n        \n      } )\n      \n      objectManager.add(json);\n\n      drivers.map( function(driver){\n        driver.positions.map( function(pos, key){\n\n          pos['xy'] = JSON.parse(pos['xy'], true);\n\n          json.features.push({\n            type: \"Feature\",\n            id: pos.id,\n            options: {\n              preset: 'islands#stretchyIcon', \n              iconColor: driver.color,\n            },\n            properties: {\n              iconContent: key\n            },\n            geometry: {\n              type: \"Point\",\n              coordinates: [pos['xy'][0], pos['xy'][1]],\n            },\n          })\n\n\n        } )\n      } )\n\n      objectManager.add(json);\n\n      this.map.geoObjects.removeAll()\n      this.map.geoObjects.add(objectManager);\n    }\n  }\n\n  render(){\n    return (\n      <>\n        <Backdrop open={this.state.is_load} style={{ zIndex: 99 }}>\n          <CircularProgress color=\"inherit\" />\n        </Backdrop>\n        \n        <Grid container spacing={3}>\n          <Grid item xs={12} sm={12}>\n            <h1>{this.state.module_name}</h1>\n          </Grid>\n          \n          <Grid item xs={6} sm={6}>\n            <MySelect data={this.state.points} value={this.state.point} func={ this.changePoint.bind(this) } label='Точка' />\n          </Grid>\n          <Grid item xs={6} sm={6}>\n            <Button variant=\"contained\" onClick={this.updateData.bind(this)}>Обновить данные</Button>\n          </Grid>\n          \n          <Grid item xs={12} sm={12}>\n            { this.state.drivers.map( (item, key) =>\n              <div key={key} style={{ display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n                <div style={{ width: 50, height: 20, backgroundColor: item.color }}></div>\n                <div>{item.driver_name}</div>\n              </div>\n            ) }\n          </Grid>       \n          \n          <Grid item xs={12} sm={12}>\n            <div id=\"map\" name=\"map\" style={{ width: '100%', height: 700, paddingTop: 10 }} />\n          </Grid>\n        </Grid>\n      </>\n    )\n  }\n}\n\nexport function DriveMapStatAll() {\n  return (\n    <DriveMapStatAll_ />\n  );\n}\n","// extracted by mini-css-extract-plugin\nexport {};\n    if(module.hot) {\n      // 1666076483757\n      var cssReload = require(\"../../../node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"names":["queryString","require","DriveMapStatAll_","props","method","data","setState","is_load","fetch","headers","body","stringify","module","state","version","login","localStorage","getItem","JSON","then","res","json","st","type","setTimeout","window","location","pathname","err","console","log","module_name","points","point","drivers","this","getData","point_list","id","module_info","name","document","title","event","target","value","updateData","point_id","getOrders","orders","home","objectManager","ymaps","ObjectManager","map","setCenter","latitude","longitude","features","push","options","preset","iconColor","geometry","coordinates","item","parseInt","status_order","point_color","color","properties","iconCaption","point_text","xy","add","driver","positions","pos","key","parse","iconContent","geoObjects","removeAll","ready","Map","center","zoom","searchControlProvider","myGeoObject","GeoObject","Backdrop","open","style","zIndex","CircularProgress","Grid","container","spacing","xs","sm","func","changePoint","bind","label","Button","variant","onClick","display","flexDirection","alignItems","width","height","backgroundColor","driver_name","paddingTop","React","DriveMapStatAll","cssReload","hot","dispose","accept","undefined"],"sourceRoot":""}