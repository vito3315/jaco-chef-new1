"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[535],{3535:(e,t,n)=>{n.r(t),n.d(t,{default:()=>F}),n(4859);var s=n(5861),a=n(7326),r=n(4942),i=n(5671),l=n(3144),o=n(136),c=n(6215),u=n(1120),m=n(7462),h=n(4687),p=n.n(h),f=n(7294),d=n(30),Z=n(1822),v=n(3150),E=n(6140),y=n(3030),g=n(3406),_=n(8561),S=n(8736),w=n(1647),k=n(8727),x=n(808),b=n(231),C=n(3508),I=n(9620),O=n(2962),P=n(4498),D=n(7745),J=n(3892),N=n(5705),L=n(9633),T=n(5620),R=n(6406);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(s,arguments,a)}else n=s.apply(this,arguments);return(0,c.Z)(this,n)}}var B=f.forwardRef((function(e,t){return f.createElement(T.Z,(0,m.Z)({elevation:6,ref:t,variant:"filled"},e))})),M=n(7563),q=function(e){(0,o.Z)(n,e);var t=j(n);function n(e){var s;return(0,i.Z)(this,n),(s=t.call(this,e)).state={points:[],point:[]},s}return(0,l.Z)(n,[{key:"componentDidUpdate",value:function(e){this.props.points&&this.props.points!==e.points&&this.setState({points:this.props.points})}},{key:"choosePoint",value:function(e,t){this.setState({point:t})}},{key:"save",value:function(){this.props.save(this.state.point),this.setState({points:this.props.points?this.props.points:[]}),this.props.onClose()}},{key:"onClose",value:function(){this.setState({points:this.props.points?this.props.points:[]}),this.props.onClose()}},{key:"render",value:function(){return f.createElement(I.Z,{open:this.props.open,onClose:this.onClose.bind(this),fullWidth:!0,maxWidth:"xs"},f.createElement(D.Z,null,"Где применить"),f.createElement(P.Z,{style:{paddingBottom:10,paddingTop:10}},f.createElement(d.ZP,{item:!0,xs:12,sm:4},f.createElement(R.e_,{label:"Точки",multiple:!0,data:this.state.points,value:this.state.point,func:this.choosePoint.bind(this)}))),f.createElement(O.Z,null,f.createElement(Z.Z,{onClick:this.save.bind(this)},"Сохранить")))}}]),n}(f.Component),U=function(e){(0,o.Z)(n,e);var t=j(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"shouldComponentUpdate",value:function(e){return e.it.item_id_rec!==this.props.it.item_id_rec||e.it.vendor_id_rec!==this.props.it.vendor_id_rec}},{key:"render",value:function(){var e=this.props.it,t=[],n=e.items.filter((function(t){return t.id===e.item_id_rec}));n.length>0&&(t=n[0].vendors);var s=t.find((function(t){return t.id===e.vendor_id_rec}));return s=s?s.pq:"",f.createElement(S.Z,{sx:{"& td":{border:0}},hover:!0},f.createElement(y.Z,null,e.id),f.createElement(y.Z,null,e.name),f.createElement(y.Z,null,1===e.items.length?e.items[0].name:f.createElement(R.$S,{data:e.items,value:e.item_id_rec,func:this.props.changeSelect.bind(this,e.id,"item_id_rec",this.props.type)})),f.createElement(y.Z,null,s," ",e.ei_name),f.createElement(y.Z,null,f.createElement(R.$S,{is_none:!1,data:t,value:e.vendor_id_rec,func:this.props.changeSelect.bind(this,e.id,"vendor_id_rec",this.props.type)})))}}]),n}(f.Component),$=function(e){(0,o.Z)(n,e);var t=j(n);function n(e){var s;return(0,i.Z)(this,n),(s=t.call(this,e)).state={items:[],cats:[],freeItems:[],search:""},s}return(0,l.Z)(n,[{key:"componentDidUpdate",value:function(e){if(this.props&&this.props!==e)if(this.state.search){var t=this.state.search,n=JSON.parse(JSON.stringify(this.props.cats)),s=JSON.parse(JSON.stringify(this.props.freeItems));n.map((function(e){var n=[];e.cats.map((function(e){return e.items=e.items.filter((function(e){return e.name.toLowerCase().includes(t.toLowerCase())})),e.items.length||n.push(e),e})),e.cats.length===n.length&&(e.all=0)}));var a=s.filter((function(e){return e.name.toLowerCase().includes(t.toLowerCase())}));this.setState({cats:n,freeItems:a,items:this.props.items})}else this.setState({cats:JSON.parse(JSON.stringify(this.props.cats)),freeItems:JSON.parse(JSON.stringify(this.props.freeItems)),items:this.props.items})}},{key:"search",value:function(e){var t,n,s;e.target.value?(t=null!==(n=e.target.value)&&void 0!==n?n:"",this.setState({search:t})):(t=null!==(s=e.target.innerText)&&void 0!==s?s:"",this.setState({search:t}));var a=this.state.cats,r=this.state.freeItems;if(""!==t||t.length>1){a.map((function(e){var n=[];e.cats.map((function(e){return e.items=e.items.filter((function(e){return e.name.toLowerCase().includes(t.toLowerCase())})),e.items.length||n.push(e),e})),e.cats.length===n.length&&(e.all=0)}));var i=r.filter((function(e){return e.name.toLowerCase().includes(t.toLowerCase())}));this.setState({cats:a,freeItems:i})}else this.setState({cats:JSON.parse(JSON.stringify(this.props.cats)),freeItems:JSON.parse(JSON.stringify(this.props.freeItems))})}},{key:"render",value:function(){var e=this;return console.log("OrderPostRec_Table render"),f.createElement(f.Fragment,null,f.createElement(d.ZP,{item:!0,xs:12,sm:4},f.createElement(R.OU,{label:"Поиск",freeSolo:!0,multiple:!1,data:this.state.items,value:this.state.search,func:this.search.bind(this),onBlur:this.search.bind(this)})),f.createElement(d.ZP,{item:!0,xs:12,sm:4},f.createElement(Z.Z,{variant:"contained",onClick:this.props.openModal.bind(this)},"Сохранить изменения")),f.createElement(d.ZP,{item:!0,xs:12,sm:12,mb:6},this.state.cats.filter((function(e){return 0!==e.all})).map((function(t,n){return f.createElement(k.Z,{key:n},f.createElement(x.Z,{expandIcon:f.createElement(C.Z,null)},f.createElement(w.Z,null,t.name)),f.createElement(b.Z,null,t.cats.filter((function(e){return 0!==e.items.length})).map((function(t,n){return f.createElement(k.Z,{key:n},f.createElement(x.Z,{expandIcon:f.createElement(C.Z,null)},f.createElement(w.Z,null,t.name)),f.createElement(b.Z,{style:{width:"100%",overflow:"scroll"}},f.createElement(g.Z,null,f.createElement(v.Z,null,f.createElement(_.Z,null,f.createElement(S.Z,null,f.createElement(y.Z,{style:{width:"2%"}},"#"),f.createElement(y.Z,{style:{width:"30%"}},"Заготовка"),f.createElement(y.Z,{style:{width:"25%"}},"Товар"),f.createElement(y.Z,{style:{width:"13%"}},"Объем (упак.)"),f.createElement(y.Z,{style:{width:"30%"}},"Поставщик"))),f.createElement(E.Z,null,t.items.map((function(t,n){return f.createElement(U,{key:n,it:t,changeSelect:e.props.changeSelect,type:1})})))))))}))))})),0==this.state.freeItems.length?null:f.createElement(k.Z,null,f.createElement(x.Z,{expandIcon:f.createElement(C.Z,null)},f.createElement(w.Z,null,"Без категории")),f.createElement(b.Z,{style:{width:"100%",overflow:"scroll"}},f.createElement(g.Z,null,f.createElement(v.Z,null,f.createElement(_.Z,null,f.createElement(S.Z,null,f.createElement(y.Z,{style:{width:"2%"}},"#"),f.createElement(y.Z,{style:{width:"30%"}},"Заготовка"),f.createElement(y.Z,{style:{width:"25%"}},"Товар"),f.createElement(y.Z,{style:{width:"13%"}},"Объем (упак.)"),f.createElement(y.Z,{style:{width:"30%"}},"Поставщик"))),f.createElement(E.Z,null,this.state.freeItems.map((function(t,n){return f.createElement(U,{key:n,it:t,changeSelect:e.props.changeSelect,type:2})})))))))))}}]),n}(f.Component),z=function(e){(0,o.Z)(h,e);var t,n,c,u,m=j(h);function h(e){var t;return(0,i.Z)(this,h),t=m.call(this,e),(0,r.Z)((0,a.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:M.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"order_post_rec",module_name:"",is_load:!1,points:[],point:"0",items:[],cats:[],freeItems:[],hist:[],modalDialog:!1,snackbar:!1,st:!1,error:""},t}return(0,l.Z)(h,[{key:"componentDidMount",value:(u=(0,s.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,console.log(t),this.setState({points:t.point_list,point:t.point_list[0].id,module_name:t.module_info.name,cats:t.cats,freeItems:t.items_free,hist:t.hist,items:t.items}),document.title=t.module_info.name;case 6:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"changePoint",value:(c=(0,s.Z)(p().mark((function e(t){var n,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.value,e.next=3,this.getData("get_all",n);case 3:s=e.sent,this.setState({point:n,items:s.items,cats:s.cats,freeItems:s.items_free,hist:s.hist});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"openModal",value:function(){this.setState({modalDialog:!0})}},{key:"findPQ",value:function(e){var t=[],n=e.items.filter((function(t){return t.id===e.item_id_rec}));n.length>0&&(t=n[0].vendors);var s=t.find((function(t){return t.id===e.vendor_id_rec}));return s?s.pq:""}},{key:"changeSelect",value:function(e,t,n,s){var a=this;if(1===n){var r=this.state.cats;r.forEach((function(n){n.cats.forEach((function(n){n.items.forEach((function(n){n.id===e&&(n[t]=s.target.value,"vendor_id_rec"==t&&(n.pq=a.findPQ(n)))}))}))})),this.setState({cats:r})}if(2===n){var i=this.state.freeItems;i.forEach((function(n){n.id===e&&(n[t]=s.target.value)})),this.setState({freeItems:i})}}},{key:"save",value:(n=(0,s.Z)(p().mark((function e(t){var n,s,a=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={items:this.state.cats,items_free:this.state.freeItems,points:t},e.next=3,this.getData("save_edit",n);case 3:(s=e.sent).st?(this.setState({st:!0,snackbar:!0}),setTimeout((function(){a.update()}),300)):this.setState({error:s.text,snackbar:!0});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"update",value:(t=(0,s.Z)(p().mark((function e(){var t,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.point,e.next=3,this.getData("get_all",t);case 3:n=e.sent,this.setState({items:n.items,cats:n.cats,freeItems:n.items_free,hist:n.hist});case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return f.createElement(f.Fragment,null,f.createElement(J.Z,{style:{zIndex:99},open:this.state.is_load},f.createElement(N.Z,{color:"inherit"})),f.createElement(L.Z,{open:this.state.snackbar,autoHideDuration:3e4,anchorOrigin:{vertical:"top",horizontal:"center"},onClose:function(){e.setState({snackbar:!1})}},f.createElement(B,{onClose:function(){e.setState({snackbar:!1})},severity:this.state.st?"success":"error",sx:{width:"100%"}},this.state.st?"Данные успешно сохранены!":"".concat(this.state.error))),f.createElement(q,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},points:this.state.points,save:this.save.bind(this)}),f.createElement(d.ZP,{container:!0,spacing:3},f.createElement(d.ZP,{item:!0,xs:12,sm:12},f.createElement("h1",null,this.state.module_name)),f.createElement(d.ZP,{item:!0,xs:12,sm:4},f.createElement(R.$S,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),f.createElement($,{cats:this.state.cats,freeItems:this.state.freeItems,items:this.state.items,openModal:this.openModal.bind(this),changeSelect:this.changeSelect.bind(this)}),this.state.hist.length?f.createElement(d.ZP,{pb:1,container:!0,justifyContent:"center"},f.createElement(d.ZP,{item:!0,xs:10,sm:6},f.createElement(k.Z,null,f.createElement(x.Z,{expandIcon:f.createElement(C.Z,null),"aria-controls":"panel1a-content"},f.createElement(w.Z,null,"История изменений")),f.createElement(b.Z,null,this.state.hist.map((function(e,t){return f.createElement(k.Z,{key:t},f.createElement(x.Z,null,f.createElement(w.Z,{mr:8},e.date_time),f.createElement(w.Z,null,e.user_name)),f.createElement(b.Z,null,e.items.map((function(e,t){return f.createElement(g.Z,{key:t},f.createElement(v.Z,null,f.createElement(E.Z,null,f.createElement(S.Z,{sx:{"& td":{border:0,paddingTop:0,paddingBottom:0}},hover:!0},f.createElement(y.Z,{style:{width:"30%"}},e.item_name),f.createElement(y.Z,{style:{width:"30%"}},e.pf_name),f.createElement(y.Z,{style:{width:"10%"}},e.pq),f.createElement(y.Z,{style:{width:"30%"}},e.vendor_name)))))}))))})))))):null))}}]),h}(f.Component);function F(){return f.createElement(z,null)}},4859:(e,t,n)=>{var s=n(4783)(e.id,{locals:!1});e.hot.dispose(s),e.hot.accept(void 0,s)}}]);
//# sourceMappingURL=535.25c2da3e32f2ea414526.js.map