"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[670],{3670:(t,e,a)=>{a.r(e),a.d(e,{default:()=>j}),a(134);var n=a(5861),i=a(7326),s=a(4942),r=a(5671),l=a(3144),o=a(136),c=a(6215),m=a(1120),u=a(4687),d=a.n(u),h=a(7294),p=a(30),f=a(1822),v=a(326),y=a(8727),g=a(808),Z=a(231),E=a(3508),C=a(3646),M=a(9620),I=a(2962),k=a(4498),_=a(7745),b=a(3150),w=a(6140),x=a(3030),D=a(8736),S=a(3892),N=a(5705),P=a(6406),R=a(1647);function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=(0,m.Z)(t);if(e){var i=(0,m.Z)(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return(0,c.Z)(this,a)}}var V=a(7563),B=function(t){(0,o.Z)(a,t);var e=O(a);function a(t){var n;return(0,r.Z)(this,a),(n=e.call(this,t)).state={newMainCatMy:"",editMainCatMy:"",newMainNameMy:"",editMainNameMy:""},n}return(0,l.Z)(a,[{key:"componentDidUpdate",value:function(t){this.props.event&&this.props.event!==t.event&&this.setState({editMainCatMy:this.props.event.parent_id,editMainNameMy:this.props.event.name})}},{key:"changeNameMain",value:function(t){var e=t.target.value;this.setState({newMainNameMy:e})}},{key:"changeCatMain",value:function(t){var e=t.target.value;this.setState({newMainCatMy:e})}},{key:"changeCatMainEdit",value:function(t){var e=t.target.value;this.setState({editMainCatMy:e})}},{key:"changeNameMainEdit",value:function(t){var e=t.target.value;this.setState({editMainNameMy:e})}},{key:"onClose",value:function(){this.setState({newMainCatMy:"",editMainCatMy:this.props.event?this.props.event.parent_id:"",newMainNameMy:"",editMainNameMy:this.props.event?this.props.event.name:""}),this.props.onClose()}},{key:"render",value:function(){return h.createElement(M.Z,{open:this.props.open,onClose:this.onClose.bind(this),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},h.createElement(_.Z,{id:"alert-dialog-title"},this.props.method),h.createElement(k.Z,{style:{paddingBottom:10,paddingTop:10}},h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(P.$S,{label:"Главная категория",data:this.props.data,value:"Редактирование категории"===this.props.method?this.state.editMainCatMy:this.state.newMainCatMy,func:"Редактирование категории"===this.props.method?this.changeCatMainEdit.bind(this):this.changeCatMain.bind(this)})),h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(C.Z,{label:"Название категории",size:"small",variant:"outlined",style:{width:"100%"},color:"primary",value:"Редактирование категории"===this.props.method?this.state.editMainNameMy:this.state.newMainNameMy,onChange:"Редактирование категории"===this.props.method?this.changeNameMainEdit.bind(this):this.changeNameMain.bind(this)})))),h.createElement(I.Z,null,h.createElement(f.Z,{onClick:"Редактирование категории"===this.props.method?this.props.saveEditCat.bind(this,this.state.editMainNameMy,this.state.editMainCatMy):this.props.saveCat.bind(this,this.state.newMainNameMy,this.state.newMainCatMy),color:"primary"},"Сохранить")))}}]),a}(h.Component),T=function(t){(0,o.Z)(C,t);var e,a,c,m,u=O(C);function C(t){var e;return(0,r.Z)(this,C),e=u.call(this,t),(0,s.Z)((0,i.Z)(e),"getData",(function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:V.stringify({method:t,module:e.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(t){return t.json()})).then((function(t){if(!1!==t.st||"redir"!=t.type){if(!1!==t.st||"auth"!=t.type)return setTimeout((function(){e.setState({is_load:!1})}),300),t;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(t){console.log(t),e.setState({is_load:!1})}))})),e.state={module:"category_items",module_name:"",is_load:!1,modalDialog:!1,modalDialog2:!1,method:null,data:null,allCats:[],allItems:[],thisValItems:[],thisDataItems:[],thisCatId:0},e}return(0,l.Z)(C,[{key:"componentDidMount",value:(m=(0,n.Z)(d().mark((function t(){var e;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getData("get_all");case 2:e=t.sent,this.setState({module_name:e.module_info.name,allCats:e.cats,allItems:e.items}),document.title=e.module_info.name;case 5:case"end":return t.stop()}}),t,this)}))),function(){return m.apply(this,arguments)})},{key:"onOpen",value:function(t,e,a){a.stopPropagation(),this.setState({modalDialog:!0,method:t,data:e})}},{key:"addItems",value:function(t){var e=this.state.allItems.filter((function(e){return parseInt(e.cat_id)==parseInt(t)})),a=this.state.allItems.filter((function(t){return 0==parseInt(t.cat_id)}));this.setState({modalDialog2:!0,thisValItems:e,thisDataItems:a,thisCatId:t})}},{key:"saveItems",value:(c=(0,n.Z)(d().mark((function t(){var e,a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={cat_id:this.state.thisCatId,items:this.state.thisValItems},t.next=3,this.getData("save_items_cat",e);case 3:a=t.sent,this.setState({allCats:a.cats,allItems:a.items,modalDialog2:!1,thisValItems:[],thisDataItems:[],thisCatId:0});case 5:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"saveCat",value:(a=(0,n.Z)(d().mark((function t(e,a){var n,i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={name:e,cat_id:a},t.next=3,this.getData("save_cat",n);case 3:if(!1!==(i=t.sent).st){t.next=7;break}return alert(i.text),t.abrupt("return");case 7:this.setState({allCats:i.cats,modalDialog:!1});case 8:case"end":return t.stop()}}),t,this)}))),function(t,e){return a.apply(this,arguments)})},{key:"saveEditCat",value:(e=(0,n.Z)(d().mark((function t(e,a){var n,i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={name:e,cat_id:a,id:this.state.event.id},t.next=3,this.getData("edit_cat",n);case 3:if(!1!==(i=t.sent).st){t.next=7;break}return alert(i.text),t.abrupt("return");case 7:this.setState({allCats:i.cats,modalDialog:!1});case 8:case"end":return t.stop()}}),t,this)}))),function(t,a){return e.apply(this,arguments)})},{key:"render",value:function(){var t=this;return h.createElement(h.Fragment,null,h.createElement(S.Z,{style:{zIndex:99},open:this.state.is_load},h.createElement(N.Z,{color:"inherit"})),h.createElement(B,{open:this.state.modalDialog,onClose:function(){t.setState({modalDialog:!1})},data:this.state.allCats.filter((function(t){return-1==parseInt(t.parent_id)||!t.parent_id})),saveCat:this.saveCat.bind(this),saveEditCat:this.saveEditCat.bind(this),method:this.state.method,event:this.state.data}),h.createElement(M.Z,{open:this.state.modalDialog2,onClose:function(){t.setState({modalDialog2:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},h.createElement(_.Z,null,"Позиции категории"),h.createElement(k.Z,{style:{paddingBottom:10,paddingTop:10}},h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(P.e_,{label:"Выбранные позиции",multiple:!0,func:function(e,a){t.setState({thisValItems:a})},data:this.state.thisDataItems,value:this.state.thisValItems})))),h.createElement(I.Z,null,h.createElement(f.Z,{onClick:this.saveItems.bind(this),color:"primary"},"Сохранить"))),h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement("h1",null,this.state.module_name)),h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(f.Z,{onClick:function(){return t.setState({modalDialog:!0,method:"Новая категория"})}},"Создать категорию")),h.createElement(p.ZP,{item:!0,xs:12,sm:12,style:{paddingBottom:"10px"}},this.state.allCats.map((function(e,a){return-1!=parseInt(e.parent_id)?null:h.createElement(y.Z,{key:a},h.createElement(g.Z,{expandIcon:h.createElement(E.Z,null),"aria-controls":"panel1a-content"},h.createElement(v.Z,{style:{marginRight:10},onClick:t.onOpen.bind(t,"Редактирование категории",e)}),h.createElement(R.Z,null,e.name)),h.createElement(Z.Z,null,t.state.allCats.map((function(n,i){return parseInt(e.id)!=parseInt(n.parent_id)?null:h.createElement(y.Z,{key:a+"_"+i},h.createElement(g.Z,{expandIcon:h.createElement(E.Z,null),"aria-controls":"panel1a-content"},h.createElement(v.Z,{style:{marginRight:10},onClick:t.onOpen.bind(t,"Редактирование категории",n)}),h.createElement(R.Z,null,n.name)),h.createElement(Z.Z,null,h.createElement(b.Z,null,h.createElement(w.Z,null,h.createElement(D.Z,null,h.createElement(x.Z,null,h.createElement(f.Z,{onClick:t.addItems.bind(t,parseInt(n.id))},"Добавить"))),t.state.allItems.filter((function(t){return parseInt(t.cat_id)==parseInt(n.id)})).map((function(t,e){return h.createElement(D.Z,{key:a+"_"+i+"_"+e},h.createElement(x.Z,null,t.name))}))))))}))))})))))}}]),C}(h.Component);function j(){return h.createElement(T,null)}},134:(t,e,a)=>{var n=a(4783)(t.id,{locals:!1});t.hot.dispose(n),t.hot.accept(void 0,n)}}]);
//# sourceMappingURL=670.ea90623fa59680b952c3.js.map