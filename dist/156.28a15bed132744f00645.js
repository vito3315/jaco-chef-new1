"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[156],{2156:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R}),n(1574);var a=n(5861),l=n(5671),r=n(3144),i=n(7326),s=n(136),c=n(6215),m=n(1120),u=n(4942),o=n(4687),d=n.n(o),h=n(7294),p=n(30),Z=n(1822),E=n(3150),g=n(6140),_=n(4896),f=n(3030),v=n(3406),y=n(8561),S=n(8736),k=n(5722),D=n(9620),x=n(2962),b=n(4498),w=n(7745),I=n(3892),C=n(5705),P=n(6406);var A=n(7563);function M(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),l=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[l,n,a].join("-")}var T=function(e){(0,s.Z)(F,e);var t,n,o,T,R,G,B,W,j=(B=F,W=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,m.Z)(B);if(W){var n=(0,m.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,c.Z)(this,e)});function F(e){var t;return(0,l.Z)(this,F),t=j.call(this,e),(0,u.Z)((0,i.Z)(t),"click",!1),(0,u.Z)((0,i.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:A.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){console.log(e)}))})),t.state={module:"driver_stat",module_name:"",is_load:!1,points:[],point:"0",date_start:M(new Date),date_end:M(new Date),rangeDate:[M(new Date),M(new Date)],modalDialog:!1,drive_stat_full:[],drive_stat_date:null,summ:0,choose_driver_id:0,check_cash:0,getSumm:0,modalDialogGetSumm:!1,getSummDriverId:null,getSummComment:"",modalDialogStatSumm:!1,modalDialogStatSummMain:!1,statSumm:[],statSummMain:[]},t}return(0,r.Z)(F,[{key:"componentDidMount",value:(G=(0,a.Z)(d().mark((function e(){var t,n=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,console.log(t),this.setState({points:t.points,point:t.points[0].id,module_name:t.module_info.name}),document.title=t.module_info.name,setTimeout((function(){n.updateData()}),50);case 7:case"end":return e.stop()}}),e,this)}))),function(){return G.apply(this,arguments)})},{key:"updateData",value:(R=(0,a.Z)(d().mark((function e(){var t,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={point_id:this.state.point,date_start:this.state.date_start,date_end:this.state.date_end},e.next=3,this.getData("get_data",t);case 3:n=e.sent,console.log(n),this.setState({drive_stat_full:n.drive_stat_full,drive_stat_date:n.stat_drive_date});case 6:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"changeDate",value:function(e,t){this.setState((0,u.Z)({},e,M(t)))}},{key:"changePoint",value:function(e){var t=e.target.value;this.setState({point:t})}},{key:"giveCash",value:function(e,t){this.setState({modalDialog:!0,choose_driver_id:e,check_cash:t})}},{key:"changeSumm",value:function(e){this.setState({summ:e.target.value})}},{key:"saveGivePrice",value:(T=(0,a.Z)(d().mark((function e(){var t,n,a=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.click){e.next=2;break}return e.abrupt("return");case 2:if(this.click=!0,!(parseInt(this.state.summ)>parseInt(this.state.check_cash))){e.next=7;break}return alert("Нельзя сдать денег больше, чем есть у курьера"),setTimeout((function(){a.click=!1}),300),e.abrupt("return");case 7:return t={point_id:this.state.point,price:this.state.summ,driver_id:this.state.choose_driver_id},e.next=10,this.getData("save_give",t);case 10:n=e.sent,console.log(n),1==n.st?(this.setState({modalDialog:!1,check_cash:0,choose_driver_id:0,summ:0}),this.updateData()):alert(n.text),setTimeout((function(){a.click=!1}),300);case 14:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"getCash",value:function(e){this.setState({modalDialogGetSumm:!0,getSumm:0,getSummDriverId:e,getSummComment:""})}},{key:"saveGetPrice",value:(o=(0,a.Z)(d().mark((function e(){var t,n,a=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.click){e.next=2;break}return e.abrupt("return");case 2:if(this.click=!0,!(parseInt(this.state.getSumm)>1e3)){e.next=7;break}return alert("Нельзя выдать больше 1000р за раз"),setTimeout((function(){a.click=!1}),300),e.abrupt("return");case 7:return t={point_id:this.state.point,price:this.state.getSumm,driver_id:this.state.getSummDriverId.driver_id,comment:this.state.getSummComment},e.next=10,this.getData("save_get",t);case 10:n=e.sent,console.log(n),1==n.st?(this.setState({modalDialogGetSumm:!1,getSumm:0,getSummDriverId:null,getSummComment:""}),this.updateData()):alert(n.text),setTimeout((function(){a.click=!1}),300);case 14:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getStatDop",value:(n=(0,a.Z)(d().mark((function e(t){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={point_id:this.state.point,driver_id:t.driver_id,date_start:this.state.date_start,date_end:this.state.date_end},e.next=3,this.getData("getStatDop",n);case 3:a=e.sent,console.log(a),this.setState({modalDialogStatSumm:!0,statSumm:a,getSummDriverId:t});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getStatDopMain",value:(t=(0,a.Z)(d().mark((function e(t){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={point_id:this.state.point,driver_id:t.driver_id,date_start:this.state.date_start,date_end:this.state.date_end},e.next=3,this.getData("getStatDopMain",n);case 3:a=e.sent,console.log(a),this.setState({modalDialogStatSummMain:!0,statSummMain:a,getSummDriverId:t});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return h.createElement(h.Fragment,null,h.createElement(I.Z,{style:{zIndex:99},open:this.state.is_load},h.createElement(C.Z,{color:"inherit"})),h.createElement(D.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1,check_cash:0,choose_driver_id:0,summ:0})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},h.createElement(w.Z,null,"Какую сумму сдает курьер"),h.createElement(b.Z,{style:{paddingBottom:10,paddingTop:10}},h.createElement(P.rZ,{label:"",value:this.state.summ,func:this.changeSumm.bind(this)})),h.createElement(x.Z,null,h.createElement(Z.Z,{color:"primary",onClick:this.saveGivePrice.bind(this)},"Сохранить"))),h.createElement(D.Z,{open:this.state.modalDialogGetSumm,onClose:function(){e.setState({modalDialogGetSumm:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},h.createElement(w.Z,null,'Дополнительная выплата курьеру "',this.state.getSummDriverId?this.state.getSummDriverId.name:"",'"'),h.createElement(b.Z,{style:{paddingBottom:10,paddingTop:10}},h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(P.rZ,{type:"number",value:this.state.getSumm,func:function(t){e.setState({getSumm:t.target.value})},label:"Сумма"})),h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(P.rZ,{maxRows:2,value:this.state.getSummComment,func:function(t){e.setState({getSummComment:t.target.value})},label:"Комментарий"})))),h.createElement(x.Z,null,h.createElement(Z.Z,{color:"primary",onClick:this.saveGetPrice.bind(this)},"Сохранить"))),h.createElement(D.Z,{open:this.state.modalDialogStatSumm,onClose:function(){e.setState({modalDialogStatSumm:!1,getSummDriverId:null})},fullWidth:!0,maxWidth:"md"},h.createElement(w.Z,null,'Доп выплаты "',this.state.getSummDriverId?this.state.getSummDriverId.name:"",'"'),h.createElement(b.Z,{style:{paddingBottom:10,paddingTop:10}},h.createElement(E.Z,{size:"small"},h.createElement(y.Z,null,h.createElement(S.Z,null,h.createElement(f.Z,null,"Дата"),h.createElement(f.Z,null,"Кто назначил"),h.createElement(f.Z,null,"Сумма"),h.createElement(f.Z,null,"Комментарий"),h.createElement(f.Z,null,"Тип"))),h.createElement(g.Z,null,this.state.statSumm.map((function(e,t){return h.createElement(S.Z,{key:t},h.createElement(f.Z,null,e.date_time),h.createElement(f.Z,null,e.user_name),h.createElement(f.Z,null,e.price),h.createElement(f.Z,null,e.comment),h.createElement(f.Z,null,parseInt(e.order_id)>0?"Довоз":"Доп выплата"))})))))),h.createElement(D.Z,{open:this.state.modalDialogStatSummMain,onClose:function(){e.setState({modalDialogStatSummMain:!1,getSummDriverId:null})},fullWidth:!0,maxWidth:"md"},h.createElement(w.Z,null,'Выплаты "',this.state.getSummDriverId?this.state.getSummDriverId.name:"",'"'),h.createElement(b.Z,{style:{paddingBottom:10,paddingTop:10}},h.createElement(E.Z,{size:"small"},h.createElement(y.Z,null,h.createElement(S.Z,null,h.createElement(f.Z,null,"Заказ"),h.createElement(f.Z,null,"Дата"),h.createElement(f.Z,null,"Сумма"),h.createElement(f.Z,null,"Пользователь"),h.createElement(f.Z,null,"Тип"))),h.createElement(g.Z,null,this.state.statSummMain.map((function(e,t){return h.createElement(S.Z,{key:t},h.createElement(f.Z,null,0==parseInt(e.order_id)?"":e.order_id),h.createElement(f.Z,null,e.date_time),h.createElement(f.Z,null,0==parseInt(e.my_cash)?e.give:e.my_cash),h.createElement(f.Z,null,0==parseInt(e.order_id)?e.user_name:""),h.createElement(f.Z,null,0==parseInt(e.order_id)?"Сдал":"С заказа"))})))))),h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement("h1",null,this.state.module_name)),h.createElement(p.ZP,{item:!0,xs:12,sm:3},h.createElement(P.Qe,{label:"Дата от",value:this.state.date_start,func:this.changeDate.bind(this,"date_start")})),h.createElement(p.ZP,{item:!0,xs:12,sm:3},h.createElement(P.Qe,{label:"Дата до",value:this.state.date_end,func:this.changeDate.bind(this,"date_end")})),h.createElement(p.ZP,{item:!0,xs:12,sm:6},h.createElement(P.$S,{data:this.state.points,value:this.state.point,func:this.changePoint.bind(this),label:"Точка"})),h.createElement(p.ZP,{item:!0,xs:12,sm:6},h.createElement(Z.Z,{variant:"contained",onClick:this.updateData.bind(this)},"Обновить данные")),h.createElement(p.ZP,{item:!0,xs:12},h.createElement(v.Z,{component:k.Z},h.createElement(E.Z,null,h.createElement(y.Z,null,h.createElement(S.Z,null,h.createElement(f.Z,null,"Имя"),h.createElement(f.Z,null,"Вся сумма"),h.createElement(f.Z,null,"Сумма по налу"),h.createElement(f.Z,null,"Сумма по безналу"),h.createElement(f.Z,null,"Кол-во по налу"),h.createElement(f.Z,null,"Кол-во по безналу"),h.createElement(f.Z,null,"К сдаче"),h.createElement(f.Z,null,"Сдал за период"),h.createElement(f.Z,null,"Довозы"),h.createElement(f.Z,{style:{display:"none"}},"Ошибки"),h.createElement(f.Z,null,"-"),h.createElement(f.Z,null,"Заказы"),h.createElement(f.Z,null,"Заработал"),h.createElement(f.Z,null,"Налички на руках"),h.createElement(f.Z,null),h.createElement(f.Z,null))),h.createElement(g.Z,null,this.state.drive_stat_full.map((function(t,n){return h.createElement(S.Z,{key:n},h.createElement(f.Z,null,t.name),h.createElement(f.Z,null,t.full_sum),h.createElement(f.Z,null,t.full_cash),h.createElement(f.Z,null,t.full_bank),h.createElement(f.Z,null,t.count_cash),h.createElement(f.Z,null,t.count_bank),h.createElement(f.Z,null,t.sdacha),h.createElement(f.Z,null,t.give_by_date),h.createElement(f.Z,null,h.createElement(Z.Z,{variant:"contained",onClick:e.getStatDop.bind(e,t),style:{fontWeight:"bolder"}},t.dop_price?t.dop_price:0)),h.createElement(f.Z,{style:{display:"none"}},t.err_summ),h.createElement(f.Z,null,t.my_price?t.my_price:0),h.createElement(f.Z,null,h.createElement(Z.Z,{variant:"contained",onClick:e.getStatDopMain.bind(e,t),style:{fontWeight:"bolder"}},t.my_orders?t.my_orders:0)),h.createElement(f.Z,null,t.my),h.createElement(f.Z,null,t.ost_cash),h.createElement(f.Z,null,h.createElement(Z.Z,{variant:"contained",onClick:e.giveCash.bind(e,t.driver_id,t.ost_cash)},"Сдать")),h.createElement(f.Z,null,h.createElement(Z.Z,{variant:"contained",onClick:e.getCash.bind(e,t)},"Доп выплата")))})))))),null==this.state.drive_stat_date?null:h.createElement(p.ZP,{item:!0,xs:12},h.createElement(v.Z,{component:k.Z},h.createElement(E.Z,null,h.createElement(y.Z,null,h.createElement(S.Z,null,h.createElement(f.Z,null,"Курьер"),this.state.drive_stat_date.orders.map((function(e,t){return h.createElement(f.Z,{key:t,colSpan:4,style:{textAlign:"center"}},e.date)}))),h.createElement(S.Z,null,h.createElement(f.Z,null),this.state.drive_stat_date.orders.map((function(e,t){return h.createElement(h.Fragment,{key:t},h.createElement(f.Z,{style:{textAlign:"center"}},"Наличка"),h.createElement(f.Z,{style:{textAlign:"center"}},"Безнал"),h.createElement(f.Z,{style:{textAlign:"center"}},"Сдача"),h.createElement(f.Z,{style:{textAlign:"center"}},"Заработал"))})))),h.createElement(g.Z,null,this.state.drive_stat_date.unic_users.map((function(t,n){return h.createElement(S.Z,{key:n},h.createElement(f.Z,{style:{borderRight:"1px solid #eee"}},t.short_name),e.state.drive_stat_date.orders.map((function(e,n){var a=!1,l={};return e.new_users.map((function(n,r){parseInt(n.driver_id)==parseInt(t.driver_id)&&n.date==e.date&&(a=!0,l=n)})),0==a?h.createElement(f.Z,{key:n,colSpan:4,style:{borderRight:"1px solid #eee"}}):h.createElement(h.Fragment,{key:n},h.createElement(f.Z,{style:{textAlign:"center"}},l.full_cash),h.createElement(f.Z,{style:{textAlign:"center"}},l.full_bank),h.createElement(f.Z,{style:{textAlign:"center"}},l.sdacha),h.createElement(f.Z,{style:{borderRight:"1px solid #eee",textAlign:"center"}},l.my))})))}))),h.createElement(_.Z,null,h.createElement(S.Z,null,h.createElement(f.Z,{style:{borderRight:"1px solid #eee"}}),this.state.drive_stat_date.orders.map((function(e,t){return h.createElement(h.Fragment,{key:t},h.createElement(f.Z,{key:t+"_1",style:{textAlign:"center"}},e.full_cash),h.createElement(f.Z,{key:t+"_2",style:{textAlign:"center"}},e.full_bank),h.createElement(f.Z,{key:t+"_3",style:{textAlign:"center"}},e.sdacha),h.createElement(f.Z,{key:t+"_4",style:{borderRight:"1px solid #eee",textAlign:"center"}},e.my))})))))))))}}]),F}(h.Component);function R(){return h.createElement(T,null)}},1574:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)}}]);
//# sourceMappingURL=156.28a15bed132744f00645.js.map