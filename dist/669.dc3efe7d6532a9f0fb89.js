"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[669],{8669:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j}),n(5986);var a=n(5861),i=n(5671),r=n(3144),l=n(7326),c=n(136),s=n(6215),o=n(1120),u=n(4942),m=n(4687),d=n.n(m),h=n(7294),p=n(30),f=n(1822),v=n(3150),Z=n(6140),E=n(3030),y=n(3406),_=n(8561),g=n(8736),x=n(5722),k=n(9620),b=n(2962),w=n(4498),S=n(4439),P=n(7745),C=n(3892),D=n(5705),q=n(6406);var I=n(7563),R=function(e){(0,c.Z)(O,e);var t,n,m,R,j,F,T=(j=O,F=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,o.Z)(j);if(F){var n=(0,o.Z)(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return(0,s.Z)(this,e)});function O(e){var t;return(0,i.Z)(this,O),t=T.call(this,e),(0,u.Z)((0,l.Z)(t),"getData",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:I.stringify({method:e,module:t.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(n)})}).then((function(e){return e.json()})).then((function(e){if(!1!==e.st||"redir"!=e.type){if(!1!==e.st||"auth"!=e.type)return setTimeout((function(){t.setState({is_load:!1})}),300),e;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(e){setTimeout((function(){t.setState({is_load:!1})}),300),console.log(e)}))})),t.state={module:"vendor_item_price",module_name:"",is_load:!1,modalDialog:!1,vendors:[],vendor:null,items:[],cities:[],city:"",allCity:!1,isPrioriti:!1},t}return(0,r.Z)(O,[{key:"componentDidMount",value:(R=(0,a.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData("get_all");case 2:t=e.sent,this.setState({module_name:t.module_info.name,cities:t.cities}),document.title=t.module_info.name;case 5:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"changeCity",value:(m=(0,a.Z)(d().mark((function e(t){var n,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={city:t.target.value},e.next=3,this.getData("get_vendors",n);case 3:a=e.sent,this.setState({vendors:a,city:t.target.value,vendor:null,items:[]});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"changeVendor",value:(n=(0,a.Z)(d().mark((function e(t,n){var a,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t.target.value,n),a={city:this.state.city,vendor_id:n.id},e.next=4,this.getData("get_vendor_items",a);case 4:i=e.sent,this.setState({items:i,vendor:n});case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"update",value:function(e,t,n){var a=this.state.items;a.map((function(i,r){parseInt(i.item_id)==parseInt(e)&&(a[r][t]=n.target.value,a[r].price=(parseFloat(a[r].full_price)/parseFloat(a[r].rec_pq)).toFixed(2))})),this.setState({items:a})}},{key:"save",value:(t=(0,a.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=(t={vendor_id:this.state.vendor.id,items:this.state.items,city_id:this.state.city,all_city:!0===this.state.allCity?1:0,is_prioriti:!0===this.state.isPrioriti?1:0}).all_city){e.next=8;break}if(!confirm("Точно сохранить на все города поставщика ?")){e.next=6;break}return e.next=5,this.getData("save_price",t);case 5:e.sent;case 6:e.next=11;break;case 8:return e.next=10,this.getData("save_price",t);case 10:e.sent;case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return h.createElement(h.Fragment,null,h.createElement(C.Z,{style:{zIndex:999},open:this.state.is_load},h.createElement(D.Z,{color:"inherit"})),h.createElement(k.Z,{open:this.state.modalDialog,onClose:function(){e.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},h.createElement(P.Z,{id:"alert-dialog-title"}),h.createElement(w.Z,null,h.createElement(S.Z,{id:"alert-dialog-description"})),h.createElement(b.Z,null,h.createElement(f.Z,{color:"primary"},"Сохранить"))),h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement("h1",null,this.state.module_name)),h.createElement(p.ZP,{item:!0,xs:12,sm:3},h.createElement(q.$S,{data:this.state.cities,value:this.state.city,func:this.changeCity.bind(this),label:"Город"})),h.createElement(p.ZP,{item:!0,xs:12,sm:3},h.createElement(q.e_,{data:this.state.vendors,value:this.state.vendor,func:this.changeVendor.bind(this),multiple:!1,label:"Поставщик"})),h.createElement(p.ZP,{item:!0,xs:12,sm:3},h.createElement(q.IA,{value:this.state.allCity,func:function(t){e.setState({allCity:t.target.checked})},label:"На все города поставщика"})),h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(q.IA,{value:this.state.isPrioriti,func:function(t){e.setState({isPrioriti:t.target.checked})},label:"Приоритетный постащик"})),h.createElement(p.ZP,{item:!0,xs:12},h.createElement(f.Z,{onClick:this.save.bind(this),variant:"contained"},"Сохранить")),h.createElement(p.ZP,{item:!0,xs:12},h.createElement(y.Z,{component:x.Z},h.createElement(v.Z,null,h.createElement(_.Z,null,h.createElement(g.Z,null,h.createElement(E.Z,null,"Позиция"),h.createElement(E.Z,null),h.createElement(E.Z,null,"Комментарий"),h.createElement(E.Z,null,"Цена за упаковку"),h.createElement(E.Z,null,"Объем упаковки"),h.createElement(E.Z,null,"Цена за 1 ед."))),h.createElement(Z.Z,null,this.state.items.map((function(t,n){return h.createElement(g.Z,{key:n},h.createElement(E.Z,null,t.name),h.createElement(E.Z,null,t.name_for_vendor),h.createElement(E.Z,null,h.createElement(q.rZ,{label:"",value:t.comment,func:e.update.bind(e,t.item_id,"comment"),multiline:!0,maxRows:5})),h.createElement(E.Z,null,h.createElement(q.rZ,{label:"",value:t.full_price,func:e.update.bind(e,t.item_id,"full_price")})),h.createElement(E.Z,null,h.createElement(q.$S,{data:t.pqs,value:0==t.rec_pq||"0"==t.rec_pq?"":t.rec_pq,func:e.update.bind(e,t.item_id,"rec_pq"),label:""})),h.createElement(E.Z,null,t.price," / ",t.ei_name))}))))))))}}]),O}(h.Component);function j(){return h.createElement(R,null)}},5986:(e,t,n)=>{var a=n(4783)(e.id,{locals:!1});e.hot.dispose(a),e.hot.accept(void 0,a)}}]);
//# sourceMappingURL=669.dc3efe7d6532a9f0fb89.js.map