"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[670],{3670:(t,e,a)=>{a.r(e),a.d(e,{default:()=>P}),a(134);var n=a(5861),i=a(5671),l=a(3144),s=a(7326),r=a(136),c=a(6215),o=a(1120),m=a(4942),d=a(4687),u=a.n(d),h=a(7294),p=a(30),f=a(1822),y=a(326),g=a(8727),E=a(808),Z=a(231),v=a(3508),C=a(3646),M=a(9620),I=a(2962),_=a(4498),b=a(7745),k=a(3892),w=a(5705),x=a(6406),D=a(1647);var S=a(7563),N=function(t){(0,r.Z)(V,t);var e,a,d,N,P,R,T=(P=V,R=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,o.Z)(P);if(R){var a=(0,o.Z)(this).constructor;t=Reflect.construct(e,arguments,a)}else t=e.apply(this,arguments);return(0,c.Z)(this,t)});function V(t){var e;return(0,i.Z)(this,V),e=T.call(this,t),(0,m.Z)((0,s.Z)(e),"getData",(function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:S.stringify({method:t,module:e.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(a)})}).then((function(t){return t.json()})).then((function(t){if(!1!==t.st||"redir"!=t.type){if(!1!==t.st||"auth"!=t.type)return setTimeout((function(){e.setState({is_load:!1})}),300),t;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(t){console.log(t),e.setState({is_load:!1})}))})),e.state={module:"category_items",module_name:"",is_load:!1,modalDialog:!1,modalDialog2:!1,modalDialog3:!1,newMainCatMy:0,editMainCatMy:0,newMainNameMy:"",editMainNameMy:"",editCat:null,allCats:[],allItems:[],thisValItems:[],thisDataItems:[],thisCatId:0},e}return(0,l.Z)(V,[{key:"componentDidMount",value:(N=(0,n.Z)(u().mark((function t(){var e;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getData("get_all");case 2:e=t.sent,this.setState({module_name:e.module_info.name,allCats:e.cats,allItems:e.items}),document.title=e.module_info.name;case 5:case"end":return t.stop()}}),t,this)}))),function(){return N.apply(this,arguments)})},{key:"createCat",value:function(){this.setState({modalDialog:!0,newMainCatMy:0,newMainNameMy:""})}},{key:"changeCatMain",value:function(t){var e=t.target.value;this.setState({newMainCatMy:e})}},{key:"changeCatMainEdit",value:function(t){var e=t.target.value;this.setState({editMainCatMy:e})}},{key:"changeNameMain",value:function(t){var e=t.target.value;this.setState({newMainNameMy:e})}},{key:"changeNameMainEdit",value:function(t){var e=t.target.value;this.setState({editMainNameMy:e})}},{key:"saveCat",value:(d=(0,n.Z)(u().mark((function t(){var e,a;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={name:this.state.newMainNameMy,cat_id:this.state.newMainCatMy},t.next=3,this.getData("save_cat",e);case 3:if(!1!==(a=t.sent).st){t.next=7;break}return alert(a.text),t.abrupt("return");case 7:this.setState({allCats:a.cats,modalDialog:!1});case 8:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)})},{key:"addItems",value:function(t){var e=this.state.allItems.filter((function(e){return parseInt(e.cat_id)==parseInt(t)})),a=this.state.allItems.filter((function(t){return 0==parseInt(t.cat_id)}));this.setState({modalDialog2:!0,thisValItems:e,thisDataItems:a,thisCatId:t})}},{key:"saveItems",value:(a=(0,n.Z)(u().mark((function t(){var e,a;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={cat_id:this.state.thisCatId,items:this.state.thisValItems},t.next=3,this.getData("save_items_cat",e);case 3:a=t.sent,this.setState({allCats:a.cats,allItems:a.items,modalDialog2:!1,thisValItems:[],thisDataItems:[],thisCatId:0});case 5:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"editCat",value:function(t){this.setState({modalDialog3:!0,editMainCatMy:t.parent_id,editMainNameMy:t.name,editCat:t})}},{key:"saveEditCat",value:(e=(0,n.Z)(u().mark((function t(){var e,a;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={name:this.state.editMainNameMy,cat_id:this.state.editMainCatMy,id:this.state.editCat.id},t.next=3,this.getData("edit_cat",e);case 3:if(!1!==(a=t.sent).st){t.next=7;break}return alert(a.text),t.abrupt("return");case 7:this.setState({allCats:a.cats,modalDialog:!1});case 8:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"render",value:function(){var t=this;return h.createElement(h.Fragment,null,h.createElement(k.Z,{style:{zIndex:99},open:this.state.is_load},h.createElement(w.Z,{color:"inherit"})),h.createElement(M.Z,{open:this.state.modalDialog,onClose:function(){t.setState({modalDialog:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},h.createElement(b.Z,{id:"alert-dialog-title"},"Новая категория"),h.createElement(_.Z,{style:{paddingBottom:10,paddingTop:10}},h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(x.$S,{label:"Главная категория",data:this.state.allCats.filter((function(t){return-1==parseInt(t.parent_id)||!t.parent_id})),value:this.state.newMainCatMy,func:this.changeCatMain.bind(this)})),h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(C.Z,{label:"Название категории",size:"small",variant:"outlined",style:{width:"100%"},color:"primary",value:this.state.newMainNameMy,onChange:this.changeNameMain.bind(this)})))),h.createElement(I.Z,null,h.createElement(f.Z,{onClick:this.saveCat.bind(this),color:"primary"},"Сохранить"))),h.createElement(M.Z,{open:this.state.modalDialog2,onClose:function(){t.setState({modalDialog2:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},h.createElement(b.Z,null,"Позиции категории"),h.createElement(_.Z,{style:{paddingBottom:10,paddingTop:10}},h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(x.e_,{label:"Выбранные позиции",multiple:!0,func:function(e,a){t.setState({thisValItems:a})},data:this.state.thisDataItems,value:this.state.thisValItems})))),h.createElement(I.Z,null,h.createElement(f.Z,{onClick:this.saveItems.bind(this),color:"primary"},"Сохранить"))),h.createElement(M.Z,{open:this.state.modalDialog3,onClose:function(){t.setState({modalDialog3:!1})},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},h.createElement(b.Z,{id:"alert-dialog-title"},"Редактирование категории"),h.createElement(_.Z,{style:{paddingBottom:10,paddingTop:10}},h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(x.$S,{label:"Главная категория",data:this.state.allCats.filter((function(t){return-1==parseInt(t.parent_id)||!t.parent_id})),value:this.state.editMainCatMy,func:this.changeCatMainEdit.bind(this)})),h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(C.Z,{label:"Название категории",size:"small",variant:"outlined",style:{width:"100%"},color:"primary",value:this.state.editMainNameMy,onChange:this.changeNameMainEdit.bind(this)})))),h.createElement(I.Z,null,h.createElement(f.Z,{onClick:this.saveEditCat.bind(this),color:"primary"},"Сохранить"))),h.createElement(p.ZP,{container:!0,spacing:3},h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement("h1",null,this.state.module_name)),h.createElement(p.ZP,{item:!0,xs:12,sm:12},h.createElement(f.Z,{onClick:this.createCat.bind(this)},"Создать категорию")),h.createElement(p.ZP,{item:!0,xs:12,sm:12},this.state.allCats.map((function(e,a){return-1!=parseInt(e.parent_id)?null:h.createElement(g.Z,{key:a},h.createElement(E.Z,{expandIcon:h.createElement(v.Z,null),"aria-controls":"panel1a-content"},h.createElement(y.Z,{style:{marginRight:10},onClick:t.editCat.bind(t,e)}),h.createElement(D.Z,null,e.name)),h.createElement(Z.Z,null,t.state.allCats.map((function(n,i){return parseInt(e.id)!=parseInt(n.parent_id)?null:h.createElement(g.Z,{key:a+"_"+i},h.createElement(E.Z,{expandIcon:h.createElement(v.Z,null),"aria-controls":"panel1a-content"},h.createElement(y.Z,{style:{marginRight:10},onClick:t.editCat.bind(t,n)}),h.createElement(D.Z,null,n.name)),h.createElement(Z.Z,null,t.state.allItems.filter((function(t){return parseInt(t.cat_id)==parseInt(n.id)})).map((function(t,e){return h.createElement(g.Z,{key:a+"_"+i+"_"+e},h.createElement(E.Z,{expandIcon:h.createElement(v.Z,null),"aria-controls":"panel1a-content"},h.createElement(D.Z,null,t.name)))})),h.createElement(f.Z,{onClick:t.addItems.bind(t,parseInt(n.id))},"Добавить")))}))))})))))}}]),V}(h.Component);function P(){return h.createElement(N,null)}},134:(t,e,a)=>{var n=a(4783)(t.id,{locals:!1});t.hot.dispose(n),t.hot.accept(void 0,n)}}]);
//# sourceMappingURL=670.aa7648e9baa0c2dd5e5a.js.map