"use strict";(self.webpackChunkpackage_json=self.webpackChunkpackage_json||[]).push([[31],{31:(t,e,i)=>{i.r(e),i.d(e,{default:()=>q}),i(9839);var a=i(5861),s=i(7326),n=i(4942),r=i(5671),m=i(3144),c=i(136),l=i(6215),h=i(1120),o=i(4687),d=i.n(o),u=i(7294),p=i(30),E=i(1822),f=i(3150),v=i(6140),_=i(3030),Z=i(8561),g=i(8736),I=i(2961),k=i(2450),w=i(8573),b=i(1388),y=i(1702),x=i(9620),S=i(2962),A=i(4498),P=i(7745),D=i(8727),C=i(808),N=i(231),T=i(1647),L=i(3508),z=i(3892),B=i(5705),R=i(6406);function j(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,a=(0,h.Z)(t);if(e){var s=(0,h.Z)(this).constructor;i=Reflect.construct(a,arguments,s)}else i=a.apply(this,arguments);return(0,l.Z)(this,i)}}var M=i(7563),O=function(t){(0,c.Z)(i,t);var e=j(i);function i(t){var a;return(0,r.Z)(this,i),(a=e.call(this,t)).state={itemEdit:null},a}return(0,m.Z)(i,[{key:"componentDidUpdate",value:function(t){var e;this.props.event&&this.props.event.item.name!==(null==t||null===(e=t.event)||void 0===e?void 0:e.item.name)&&this.setState({itemEdit:this.props.event})}},{key:"changeItem",value:function(t,e){console.log(this.state.itemEdit);var i=this.state.itemEdit;i.item[t]=e.target.value,this.setState({itemEdit:i})}},{key:"changeItemChecked",value:function(t,e){var i=this.state.itemEdit;i.item[t]=!0===e.target.checked?1:0,this.setState({itemEdit:i})}},{key:"onClose",value:function(){this.setState({itemEdit:this.props.event?this.props.event:null}),this.props.onClose()}},{key:"render",value:function(){var t=this;return u.createElement(x.Z,{open:this.props.open,fullWidth:!0,maxWidth:"md",onClose:this.onClose.bind(this)},u.createElement(P.Z,null,this.props.method," ",this.props.itemName?this.props.itemName:""),u.createElement(A.Z,{style:{paddingBottom:10,paddingTop:10}},u.createElement(p.ZP,{container:!0,spacing:3},u.createElement(p.ZP,{item:!0,xs:12},u.createElement(p.ZP,{container:!0,spacing:3},u.createElement(p.ZP,{item:!0,xs:12,sm:6},u.createElement(R.rZ,{label:"Название товара",value:this.state.itemEdit?this.state.itemEdit.item.name:"",func:this.changeItem.bind(this,"name")})),u.createElement(p.ZP,{item:!0,xs:12,sm:6},u.createElement(R.e_,{label:"Заготовка",multiple:!1,data:this.state.itemEdit?this.state.itemEdit.pf_list:[],value:this.state.itemEdit?"0"==this.state.itemEdit.item.pf_id?null:this.state.itemEdit.item.pf_id:"",func:function(e,i){var a=t.state.itemEdit;a.item.pf_id=i,t.setState({itemEdit:a})}})),u.createElement(p.ZP,{item:!0,xs:12,sm:6},u.createElement(R.rZ,{label:"Название товара для поставщика",value:this.state.itemEdit?this.state.itemEdit.item.name_for_vendor:"",func:this.changeItem.bind(this,"name_for_vendor")})),u.createElement(p.ZP,{item:!0,xs:12,sm:6},u.createElement(R.rZ,{label:"Код для 1с",value:this.state.itemEdit?this.state.itemEdit.item.art:"",func:this.changeItem.bind(this,"art")})),u.createElement(p.ZP,{item:!0,xs:12,sm:6},u.createElement(R.rZ,{label:"Максимальное количество заказов в месяц (0 - без ограничений)",value:this.state.itemEdit?this.state.itemEdit.item.max_count_in_m:"",func:this.changeItem.bind(this,"max_count_in_m")})),u.createElement(p.ZP,{item:!0,xs:12,sm:6},u.createElement(R.$S,{data:this.state.itemEdit?this.state.itemEdit.cats:[],value:this.state.itemEdit?void 0===this.state.itemEdit.item.cat_id?"":this.state.itemEdit.item.cat_id:"",func:this.changeItem.bind(this,"cat_id"),label:"Категория"})))),u.createElement(p.ZP,{item:!0,xs:12,sm:4},u.createElement(R.rZ,{label:"Количество в упаковке",value:this.state.itemEdit?this.state.itemEdit.item.pq:"",func:this.changeItem.bind(this,"pq")})),u.createElement(p.ZP,{item:!0,xs:12,sm:4},u.createElement(R.$S,{data:this.state.itemEdit?this.state.itemEdit.ed_izmer:[],value:this.state.itemEdit?"0"===this.state.itemEdit.item.ed_izmer_id?"":this.state.itemEdit.item.ed_izmer_id:"",func:this.changeItem.bind(this,"ed_izmer_id"),label:"Ед измер"})),u.createElement(p.ZP,{item:!0,xs:12,sm:4},u.createElement(R.$S,{data:this.state.itemEdit?this.state.itemEdit.apps:[],value:this.state.itemEdit?"0"===this.state.itemEdit.item.app_id?"":this.state.itemEdit.item.app_id:"",func:this.changeItem.bind(this,"app_id"),label:"Должность на кухне"})),u.createElement(p.ZP,{item:!0,xs:12,sm:4},u.createElement(R.rZ,{label:"Время приготовления ММ:SS (15:20)",value:this.state.itemEdit?this.state.itemEdit.item.time_min:"",func:this.changeItem.bind(this,"time_min")})),u.createElement(p.ZP,{item:!0,xs:12,sm:4},u.createElement(R.rZ,{label:"Дополнительное время ММ:SS (15:20)",value:this.state.itemEdit?this.state.itemEdit.item.time_dop_min:"",func:this.changeItem.bind(this,"time_dop_min")})),u.createElement(p.ZP,{item:!0,xs:12,sm:4},u.createElement(R.rZ,{label:"Время разгрузки ММ:SS.iiii (00:20.004)",value:this.state.itemEdit?this.state.itemEdit.item.time_min_other:"",func:this.changeItem.bind(this,"time_min_other")})),u.createElement(p.ZP,{item:!0,xs:12,sm:4},u.createElement(R.rZ,{label:"% потерь",value:this.state.itemEdit?this.state.itemEdit.item.los_percent:"",func:this.changeItem.bind(this,"los_percent")})),u.createElement(p.ZP,{item:!0,xs:12,sm:4},u.createElement(R.rZ,{label:"% заявки",value:this.state.itemEdit?this.state.itemEdit.item.percent:"",func:this.changeItem.bind(this,"percent")})),u.createElement(p.ZP,{item:!0,xs:12,sm:4},u.createElement(R.rZ,{label:"% повышения ценника",value:this.state.itemEdit?this.state.itemEdit.item.vend_percent:"",func:this.changeItem.bind(this,"vend_percent")})),u.createElement(p.ZP,{item:!0,xs:12,sm:3},u.createElement(R.IA,{label:"Вес заготовки",value:!!this.state.itemEdit&&1==parseInt(this.state.itemEdit.item.w_pf),func:this.changeItemChecked.bind(this,"w_pf")})),u.createElement(p.ZP,{item:!0,xs:12,sm:3},u.createElement(R.IA,{label:"Вес отхода",value:!!this.state.itemEdit&&1==parseInt(this.state.itemEdit.item.w_trash),func:this.changeItemChecked.bind(this,"w_trash")})),u.createElement(p.ZP,{item:!0,xs:12,sm:3},u.createElement(R.IA,{label:"Вес товара",value:!!this.state.itemEdit&&1==parseInt(this.state.itemEdit.item.w_item),func:this.changeItemChecked.bind(this,"w_item")})),u.createElement(p.ZP,{item:!0,xs:12,sm:3},u.createElement(R.IA,{label:"Два сотрудника",value:!!this.state.itemEdit&&1==parseInt(this.state.itemEdit.item.two_user),func:this.changeItemChecked.bind(this,"two_user")})),u.createElement(p.ZP,{item:!0,xs:12},u.createElement(R.e_,{label:"Места хранения",multiple:!0,data:this.state.itemEdit?this.state.itemEdit.storages:[],value:this.state.itemEdit?this.state.itemEdit.this_storages:"",func:function(e,i){var a=t.state.itemEdit;a.this_storages=i,t.setState({itemEdit:a})}})),"Редактирование товара"===this.props.method?u.createElement(p.ZP,{item:!0,xs:12},u.createElement(R.IA,{label:"Активность",value:1==parseInt(this.state.itemEdit.item.is_show),func:this.changeItemChecked.bind(this,"is_show")})):null)),u.createElement(S.Z,null,u.createElement(E.Z,{onClick:"Редактирование товара"===this.props.method?this.props.checkArt.bind(this,this.state.itemEdit):this.props.checkArtNew.bind(this,this.state.itemEdit),color:"primary"},"Сохранить")))}}]),i}(u.Component),W=function(t){(0,c.Z)(i,t);var e=j(i);function i(){return(0,r.Z)(this,i),e.apply(this,arguments)}return(0,m.Z)(i,[{key:"shouldComponentUpdate",value:function(t){var e=t.items,i=this.props.items;return!(e.length==i.length&&e.every((function(t,e){return t===i[e]})))}},{key:"render",value:function(){var t=this;return u.createElement(f.Z,null,u.createElement(Z.Z,null,u.createElement(g.Z,null,u.createElement(_.Z,{style:{width:"2%"}},"id"),u.createElement(_.Z,{style:{width:"2%"}}),u.createElement(_.Z,{style:{width:"3%"}},"Ревизия"),u.createElement(_.Z,{style:{width:"15%"}},"Товар"),u.createElement(_.Z,{style:{width:"10%"}},"% потерь"),u.createElement(_.Z,{style:{width:"10%"}},"% заявки"),u.createElement(_.Z,{style:{width:"15%"}},"Заготовка"),u.createElement(_.Z,{style:{width:"5%"}},"Ед. измер"),u.createElement(_.Z,{style:{width:"9%"}},"Место хранения"),u.createElement(_.Z,{style:{width:"9%",minWidth:150}},"Моя цена"))),u.createElement(v.Z,null,this.props.items.map((function(e,i){return u.createElement(g.Z,{key:i},u.createElement(_.Z,null,e.id),u.createElement(_.Z,null,1==parseInt(e.is_show)?u.createElement(I.Z,null):u.createElement(k.Z,null)),u.createElement(_.Z,null,u.createElement(R.IA,{label:"",value:1==parseInt(e.show_in_rev),func:t.props.changeTableItem.bind(t,e.id,t.props.type[0])})),u.createElement(_.Z,{style:{cursor:"pointer"},onClick:t.props.showEditItem.bind(t,e.id,"Редактирование товара")},e.name),u.createElement(_.Z,null,e.los_percent," %"),u.createElement(_.Z,null,e.percent," %"),u.createElement(_.Z,null,e.pf_name),u.createElement(_.Z,null,e.ei_name),u.createElement(_.Z,null,e.storage_name),u.createElement(_.Z,null,u.createElement(R.rZ,{label:"",value:e.handle_price,func:t.props.changeTableItem.bind(t,e.id,t.props.type[1])})))}))))}}]),i}(u.Component),$=function(t){(0,c.Z)(k,t);var e,i,l,h,o,f,v,_,Z,g,I=j(k);function k(t){var e;return(0,r.Z)(this,k),e=I.call(this,t),(0,n.Z)((0,s.Z)(e),"getData",(function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return 1==a&&e.setState({is_load:!0}),fetch("https://jacochef.ru/api/index_new.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:M.stringify({method:t,module:e.state.module,version:2,login:localStorage.getItem("token"),data:JSON.stringify(i)})}).then((function(t){return t.json()})).then((function(t){if(!1!==t.st||"redir"!=t.type){if(!1!==t.st||"auth"!=t.type)return setTimeout((function(){e.setState({is_load:!1})}),300),t;window.location.pathname="/auth"}else window.location.pathname="/"})).catch((function(t){setTimeout((function(){e.setState({is_load:!1})}),300),console.log(t)}))})),e.state={module:"sklad_items_module",module_name:"",is_load:!1,cats:[],allItems:[],vendor_items:[],modalDialog:!1,method:null,itemEdit:null,itemName:"",checkArtDialog:!1,checkArtList:[],freeItems:[],searchItem:"0"},e}return(0,m.Z)(k,[{key:"componentDidMount",value:(g=(0,a.Z)(d().mark((function t(){var e;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getData("get_all");case 2:e=t.sent,this.setState({module_name:e.module_info.name,cats:e.cats,freeItems:e.items_free}),document.title=e.module_info.name;case 5:case"end":return t.stop()}}),t,this)}))),function(){return g.apply(this,arguments)})},{key:"changeCity",value:(Z=(0,a.Z)(d().mark((function t(e){var i,a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={city:e.target.value},t.next=3,this.getData("get_vendors",i);case 3:a=t.sent,this.setState({vendors:a,city:e.target.value});case 5:case"end":return t.stop()}}),t,this)}))),function(t){return Z.apply(this,arguments)})},{key:"changeSort",value:function(t,e){var i=this;this.state.vendor_items.map((function(a,s){parseInt(a.item_id)==parseInt(t)&&(i.state.vendor_items[s].sort=e.target.value)})),this.setState({vendor_items:this.state.vendor_items})}},{key:"showEditItem",value:(_=(0,a.Z)(d().mark((function t(e,i){var a,s,n=this;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={item_id:e},t.next=3,this.getData("get_one",a);case 3:(s=t.sent).item.pf_id=s.pf_list.find((function(t){return t.id===s.item.pf_id})),this.setState({modalDialog:!0,method:i,itemEdit:s,itemName:s.item.name}),setTimeout((function(){console.log("storages=",n.state.itemEdit.storages),console.log("this_storages=",n.state.itemEdit.this_storages)}),300);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return _.apply(this,arguments)})},{key:"saveEditItem",value:(v=(0,a.Z)(d().mark((function t(e){var i,a,s,n,r=arguments;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=r.length>1&&void 0!==r[1]?r[1]:0,a=e.item.pf_id.id,e.item.pf_id=a,s={id:e.item.id,item:e.item,storages:e.this_storages,main_item_id:0==parseInt(i)?e.item.id:parseInt(i)},t.next=6,this.getData("saveEditItem",s);case 6:if(!1!==(n=t.sent).st){t.next=11;break}alert(n.text),t.next=16;break;case 11:return this.setState({modalDialog:!1,itemEdit:null,checkArtDialog:!1,checkArtList:[]}),t.next=14,this.getData("get_all");case 14:n=t.sent,this.setState({cats:n.cats,freeItems:n.items_free});case 16:case"end":return t.stop()}}),t,this)}))),function(t){return v.apply(this,arguments)})},{key:"saveNewItem",value:(f=(0,a.Z)(d().mark((function t(e){var i,a,s,n,r=arguments;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=r.length>1&&void 0!==r[1]?r[1]:0,a=e.item.pf_id.id,e.item.pf_id=a,s={id:e.item.id,item:e.item,storages:e.this_storages,main_item_id:0==parseInt(i)?e.item.id:parseInt(i)},t.next=6,this.getData("saveNewItem",s);case 6:if(!1!==(n=t.sent).st){t.next=11;break}alert(n.text),t.next=16;break;case 11:return this.setState({modalDialog:!1,itemEdit:null,checkArtDialog:!1,checkArtList:[]}),t.next=14,this.getData("get_all");case 14:n=t.sent,this.setState({cats:n.cats,freeItems:n.items_free});case 16:case"end":return t.stop()}}),t,this)}))),function(t){return f.apply(this,arguments)})},{key:"checkArt",value:(o=(0,a.Z)(d().mark((function t(e){var i,a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={id:e.item.id,art:e.item.art},t.next=3,this.getData("checkArt",i);case 3:!1===(a=t.sent).st?this.setState({checkArtDialog:!0,checkArtList:a.data}):this.saveEditItem(e);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"checkArtNew",value:(h=(0,a.Z)(d().mark((function t(e){var i,a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={id:e.item.id,art:e.item.art},t.next=3,this.getData("checkArt",i);case 3:!1===(a=t.sent).st?(a.data.push({id:-1,name:this.state.itemEdit.item.name}),this.setState({checkArtDialog:!0,checkArtList:a.data})):this.saveNewItem(e);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return h.apply(this,arguments)})},{key:"chooseArt",value:function(t){!0===this.state.modalItemNew?this.saveNewItem(t):this.saveEditItem(t)}},{key:"openModalItemNew",value:(l=(0,a.Z)(d().mark((function t(e){var i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getData("get_all_for_new");case 2:i=t.sent,this.setState({modalDialog:!0,itemEdit:i,itemName:"",method:e});case 4:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"saveItem",value:(i=(0,a.Z)(d().mark((function t(e,i,a){var s,n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={item_id:e,type:i,value:a},t.next=3,this.getData("saveItem",s,!1);case 3:if(!1!==(n=t.sent).st){t.next=8;break}alert(n.text),t.next=13;break;case 8:return this.setState({modalItemNew:!1,modalItemEdit:!1,itemEdit:null,checkArtDialog:!1,checkArtList:[]}),t.next=11,this.getData("get_all");case 11:n=t.sent,this.setState({cats:n.cats,freeItems:n.items_free});case 13:case"end":return t.stop()}}),t,this)}))),function(t,e,a){return i.apply(this,arguments)})},{key:"changeTableItem",value:function(t,e,i){if(1==parseInt(e)){var a=i.target.checked,s=this.state.cats;s.map((function(e,i){e.cats.map((function(e,n){e.items.map((function(e,r){parseInt(e.id)==parseInt(t)&&(s[i].cats[n].items[r].show_in_rev=1==a?1:0)}))}))})),this.setState({cats:s}),this.saveItem(t,"show_in_rev",1==a?1:0)}if(3==parseInt(e)){var n=i.target.value,r=this.state.cats;r.map((function(e,i){e.cats.map((function(e,a){e.items.map((function(e,s){parseInt(e.id)==parseInt(t)&&(r[i].cats[a].items[s].handle_price=n)}))}))})),this.setState({cats:r}),this.saveItem(t,"handle_price",n)}if(2==parseInt(e)){var m=i.target.value,c=this.state.freeItems;c.map((function(e,i){parseInt(e.id)==parseInt(t)&&(c[i].show_in_rev=1==m?1:0)})),this.setState({freeItems:c}),this.saveItem(t,"show_in_rev",1==m?1:0)}if(4==parseInt(e)){var l=i.target.value,h=this.state.freeItems;h.map((function(e,i){parseInt(e.id)==parseInt(t)&&(h[i].handle_price=l)})),this.setState({freeItems:h}),this.saveItem(t,"handle_price",l)}}},{key:"search",value:(e=(0,a.Z)(d().mark((function t(){var e,i;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={item:this.state.searchItem},t.next=3,this.getData("get_all_search",e);case 3:i=t.sent,this.setState({cats:i.cats,freeItems:i.items_free});case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"render",value:function(){var t=this;return u.createElement(u.Fragment,null,u.createElement(z.Z,{style:{zIndex:99},open:this.state.is_load},u.createElement(B.Z,{color:"inherit"})),u.createElement(x.Z,{onClose:function(){t.setState({checkArtDialog:!1,checkArtList:[]})},open:this.state.checkArtDialog},u.createElement(P.Z,null,"Такой код 1с уже задан у следующих позиций:"),u.createElement(w.Z,{sx:{pt:0}},this.state.checkArtList.map((function(e,i){return u.createElement(b.ZP,{button:!0,onClick:t.chooseArt.bind(t,e.id),key:i},u.createElement(y.Z,{primary:e.name}))})))),u.createElement(O,{open:this.state.modalDialog,onClose:function(){t.setState({modalDialog:!1})},checkArtNew:this.checkArtNew.bind(this),checkArt:this.checkArt.bind(this),method:this.state.method,event:this.state.itemEdit,itemName:this.state.itemName}),u.createElement(p.ZP,{container:!0,spacing:3},u.createElement(p.ZP,{item:!0,xs:12,sm:12},u.createElement("h1",null,this.state.module_name)),u.createElement(p.ZP,{item:!0,xs:12,sm:3},u.createElement(E.Z,{onClick:this.openModalItemNew.bind(this,"Новый товар"),variant:"contained"},"Добавить товар")),u.createElement(p.ZP,{item:!0,xs:12,sm:3},u.createElement(R.rZ,{label:"Поиск",value:this.state.searchItem,func:function(e){t.setState({searchItem:e.target.value})},onBlur:this.search.bind(this)})),u.createElement(p.ZP,{item:!0,xs:12,style:{paddingBottom:"10px"}},this.state.cats.map((function(e,i){return u.createElement(D.Z,{key:i},u.createElement(C.Z,{expandIcon:u.createElement(L.Z,null)},u.createElement(T.Z,null,e.name)),u.createElement(N.Z,null,e.cats.map((function(e,i){return u.createElement(D.Z,{key:i},u.createElement(C.Z,{expandIcon:u.createElement(L.Z,null)},u.createElement(T.Z,null,e.name)),u.createElement(N.Z,{style:{width:"100%",overflow:"scroll"}},u.createElement(W,{items:e.items,changeTableItem:t.changeTableItem.bind(t),showEditItem:t.showEditItem.bind(t),type:[1,3]})))}))))})),0==this.state.freeItems.length?null:u.createElement(D.Z,null,u.createElement(C.Z,{expandIcon:u.createElement(L.Z,null)},u.createElement(T.Z,null,"Без категории")),u.createElement(N.Z,{style:{width:"100%",overflow:"scroll"}},u.createElement(W,{items:this.state.freeItems,changeTableItem:this.changeTableItem.bind(this),showEditItem:this.showEditItem.bind(this),type:[2,4]}))))))}}]),k}(u.Component);function q(){return u.createElement($,null)}},9839:(t,e,i)=>{var a=i(4783)(t.id,{locals:!1});t.hot.dispose(a),t.hot.accept(void 0,a)}}]);
//# sourceMappingURL=31.645f0d722cae027af868.js.map